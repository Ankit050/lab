(function(){grapher={version:"0.0.1"},grapher.data=function(a){var b=0,c=a.length,d=[];for(b=0;b<c;b=b+2)d.push({x:a[b],y:a[b+1]});return d},grapher.indexedData=function(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f},grapher.colors=function(a){var b={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return b[a]},grapher.sampleGraph=function(a){function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),c=y.tickFormat(10),d=j.selectAll("g.x").data(x.ticks(10),String).attr("transform",f);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",f);e.append("svg:line").attr("stroke",h).attr("y1",0).attr("y2",b[1]),e.append("svg:text").attr("y",b[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var i=j.selectAll("g.y").data(y.ticks(10),String).attr("transform",g);i.select("text").text(c);var k=i.enter().insert("svg:g","a").attr("class","y").attr("transform",g).attr("background-fill","#FFEEB6");k.append("svg:line").attr("stroke",h).attr("x1",0).attr("x2",b[0]),k.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(c).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),i.exit().remove(),l()}function o(){if(!!selected)switch(d3.event.keyCode){case 8:case 46:var a=i.indexOf(selected);i.splice(a,1),selected=i.length?i[a>0?a-1:0]:null,l()}}function n(){!dragged||(m(),dragged=null)}function m(){if(!!dragged){var a=d3.svg.mouse(j.node());dragged.x=x.invert(Math.max(0,Math.min(b[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(b[1],a[1]))),l()}}function l(){var a=j.select("path").attr("d",line(i)),b=j.selectAll("circle").data(i,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}var b=[890,450],c=[20,30,20,40],d=b[0]-c[1]-c[3],e=b[1]-c[0]-c[2],f=function(a){return"translate("+x(a)+",0)"},g=function(a){return"translate(0,"+y(a)+")"},h=function(a){return a?"#ccc":"#666"},i=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([15,45]).range([0,d]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([40,10]).range([0,e]),line=d3.svg.line().x(function(a,b){return x(i[b].x)}).y(function(a,b){return y(i[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=i[0];var j=d3.select("#chart").append("svg:svg").attr("width",b[0]+c[3]+c[1]).attr("height",b[1]+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),k=j.append("svg:rect").attr("width",b[0]).attr("height",b[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(i.push(selected=dragged=d3.svg.mouse(j.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});j.append("svg:path").attr("class","line").attr("d",line(i)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(j[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.graph=function(a){function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),d=k.selectAll("g.x").data(x.ticks(10),String).attr("transform",g);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",g);e.append("svg:line").attr("stroke",i).attr("y1",0).attr("y2",c[1]),e.append("svg:text").attr("y",c[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var f=k.selectAll("g.y").data(y.ticks(10),String).attr("transform",h);f.select("text").text(b);var j=f.enter().insert("svg:g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");j.append("svg:line").attr("stroke",i).attr("x1",0).attr("x2",c[0]),j.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),f.exit().remove(),l()}function o(){if(!!selected)switch(d3.event.keyCode){case 8:case 46:var a=j.indexOf(selected);j.splice(a,1),selected=j.length?j[a>0?a-1:0]:null,l()}}function n(){!dragged||(m(),dragged=null)}function m(){if(!!dragged){var a=d3.svg.mouse(k.node());dragged.x=x.invert(Math.max(0,Math.min(c[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(c[1],a[1]))),l()}}function l(){var a=k.select("path").attr("d",line(j)),b=k.selectAll("circle").data(j,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function b(a){a.each(function(a,b){var c=d3.select(this),d=Infinity,d=Infinity,e=-Infinity,e=-Infinity,f=x.call(this,a,b),g=y.call(this,a,b),h=domain&&domain.call(this,a,b)||[d3.min(f),d3.max(f)],i=domain&&domain.call(this,a,b)||[d3.min(g),d3.max(g)],j=d3.scale.linear().domain(h).range([0,width]),k=d3.scale.linear().domain(i).range([height,0]),l=this.__chart__&&this.__chart__.x||j,m=this.__chart__&&this.__chart__.y||k,n=c.selectAll(".x.axis").data([]);n.enter().append("svg:g").attr("class","x axis"),n.attr("transform","translate(0,"+height+")").call(xAxis.scales([l,j]));var o=c.selectAll(".y.axis").data([]);o.enter().append("svg:g").attr("class","y axis"),o.call(yAxis.scales([m,k])),this.__chart__={x:j,y:k};var p=c.selectAll("g.datum").data(f),q=function(a,b){return"translate("+j(a)+","+k(g[b])+")"};p.enter().append("svg:g").attr("class","datum").attr("transform",function(a,b){return"translate("+l(a)+","+m(g[b])+")"}).style("opacity",1e-6).transition().duration(duration).delay(function(a){return l(a)*5}).attr("transform",q).style("opacity",1),p.transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1),p.exit().transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1e-6).remove(),d3.timer.flush()})}var c=[890,450],d=[20,30,20,40],e=c[0]-d[1]-d[3],f=c[1]-d[0]-d[2],g=function(a){return"translate("+x(a)+",0)"},h=function(a){return"translate(0,"+y(a)+")"},i=function(a){return a?"#ccc":"#666"},j=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([15,45]).range([0,e]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([40,10]).range([0,f]),line=d3.svg.line().x(function(a,b){return x(j[b].x)}).y(function(a,b){return y(j[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=j[0];var k=d3.select("#chart").append("svg:svg").attr("width",c[0]+d[3]+d[1]).attr("height",c[1]+d[0]+d[2]).append("svg:g").attr("transform","translate("+d[3]+","+d[0]+")"),b=k.append("svg:rect").attr("width",c[0]).attr("height",c[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(j.push(selected=dragged=d3.svg.mouse(k.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});k.append("svg:path").attr("class","line").attr("d",line(j)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(k[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.citiesSampleGraph=function(a){function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),c=y.tickFormat(10),d=j.selectAll("g.x").data(x.ticks(10),String).attr("transform",f);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",f);e.append("svg:line").attr("stroke",h).attr("y1",0).attr("y2",b[1]),e.append("svg:text").attr("y",b[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var i=j.selectAll("g.y").data(y.ticks(10),String).attr("transform",g);i.select("text").text(c);var k=i.enter().insert("svg:g","a").attr("class","y").attr("transform",g).attr("background-fill","#FFEEB6");k.append("svg:line").attr("stroke",h).attr("x1",0).attr("x2",b[0]),k.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(c).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),i.exit().remove(),l()}function o(){if(!!selected)switch(d3.event.keyCode){case 8:case 46:var a=i.indexOf(selected);i.splice(a,1),selected=i.length?i[a>0?a-1:0]:null,l()}}function n(){!dragged||(m(),dragged=null)}function m(){if(!!dragged){var a=d3.svg.mouse(j.node());dragged.x=x.invert(Math.max(0,Math.min(b[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(b[1],a[1]))),l()}}function l(){var a=j.select("path").attr("d",line(i)),b=j.selectAll("circle").data(i,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}var b=[890,450],c=[20,30,20,40],d=b[0]-c[1]-c[3],e=b[1]-c[0]-c[2],f=function(a){return"translate("+x(a)+",0)"},g=function(a){return"translate(0,"+y(a)+")"},h=function(a){return a?"#ccc":"#666"},i=grapher.indexedData(a.average_temperatures,1);x=d3.scale.linear().domain([1,12]).range([0,d]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([30,-30]).range([0,e]),line=d3.svg.line().x(function(a,b){return x(i[b].x)}).y(function(a,b){return y(i[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=i[0];var j=d3.select("#chart").append("svg:svg").attr("width",b[0]+c[3]+c[1]).attr("height",b[1]+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),k=j.append("svg:rect").attr("width",b[0]).attr("height",b[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(i.push(selected=dragged=d3.svg.mouse(j.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});j.append("svg:path").attr("class","line").attr("d",line(i)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(j[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=downx/c,h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.surfaceTemperatureSampleGraph=function(a){function C(){d3.event&&d3.event.transform&&isNaN(p)&&isNaN(t)&&d3.event.transform(n,q);var a=n.tickFormat(10),b=q.tickFormat(10),c=w.selectAll("g.x").data(n.ticks(10),String).attr("transform",j);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",j);d.append("svg:line").attr("stroke",l).attr("y1",0).attr("y2",g.height),d.append("svg:text").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(w[0][0]);p=n.invert(b[0]),o=null,o=n.copy()}),c.exit().remove();var e=w.selectAll("g.y").data(q.ticks(10),String).attr("transform",k);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",k).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",l).attr("x1",0).attr("x2",g.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(w[0][0]);t=q.invert(b[1]),s=q.copy()}),e.exit().remove(),y()}function B(){if(!!v)switch(d3.event.keyCode){case 8:case 46:var a=m.indexOf(v);m.splice(a,1),v=m.length?m[a>0?a-1:0]:null,y()}}function A(){!u||(z(),u=null)}function z(){if(!!u){var a=d3.svg.mouse(w.node());u[0]=n.invert(Math.max(0,Math.min(g.width,a[0]))),u[1]=q.invert(Math.max(0,Math.min(g.height,a[1]))),y()}}function y(){var a=w.select("path").attr("d",r(m)),b=n.domain()[1]-n.domain()[0],c=w.select("svg").selectAll("circle").data(m,function(a){return a});c.enter().append("svg:circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return q(a[1])}).attr("r",4).on("mousedown",function(a){v=u=a,y()}).transition().duration(300).ease("elastic").attr("r",2),c.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return q(a[1])}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}var b={};b.xmax=2e3,b.xmin=500,b.ymax=15,b.ymin=13,b.title="Earth's Surface Temperature: years 500-2009",b.xlabel="Year",b.ylabel="Degrees C";var c=document.getElementById("chart"),d=c.clientWidth,e=c.clientHeight,f={top:b.title?30:20,right:30,bottom:b.xlabel?40:10,left:b.ylabel?70:45},g={width:d-f.left-f.right,height:e-f.top-f.bottom},h=g.width,i=g.height,j=function(a){return"translate("+n(a)+",0)"},k=function(a){return"translate(0,"+q(a)+")"},l=function(a){return a?"#ccc":"#666"},m=a.temperature_anomolies.map(function(b){return[b[0],b[1]+a.global_surface_temperature_1961_1990]}),n=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,h]),o=n.copy(),p=Math.NaN,q=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,i]).nice(),r=d3.svg.line().x(function(a,b){return n(m[b][0])}).y(function(a,b){return q(m[b][1])}),s=q.copy(),t=Math.NaN,u=null,v=m[0],w=d3.select("#chart").append("svg:svg").attr("width",d).attr("height",e).append("svg:g").attr("transform","translate("+f.left+","+f.top+")"),x=w.append("svg:rect").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",C)).on("mousedown",function(){d3.event.altKey&&(points.push(v=u=d3.svg.mouse(w.node())),y(),d3.event.preventDefault(),d3.event.stopPropagation())});w.append("svg:svg").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height).append("svg:path").attr("class","line").attr("d",r(m)),b.title&&w.append("svg:text").text(b.title).attr("x",g.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&w.append("svg:text").text(b.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&w.append("svg:g").append("svg:text").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+g.height/2+") rotate(-90)"),d3.select(window).on("mousemove",z).on("mouseup",A).on("keydown",B),C(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(w[0][0]);if(!isNaN(p)){var c=o.invert(b[0]),d=o.domain()[0],e=o.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/p,g=1+(p/c-1)*(f/(p-d))/h,i=[d,d+f*g],n.domain(i),C()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(t)){var j=s.invert(b[1]),k=s.domain()[1],l=s.domain()[0],m=l-k;if(j!==0){var r,u,v;u=m/t,r=1-(j/t-1)*(m/(t-k))/u,v=[k+m*r,k],q.domain(v),C()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(p)||(C(),p=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(t)||(C(),t=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.lennardJonesSampleGraph=function(){function s(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),c=m.selectAll("g.x").data(x.ticks(10),String).attr("transform",i);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",i);d.append("svg:line").attr("stroke",k).attr("y1",0).attr("y2",f.height),d.append("svg:text").attr("y",f.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),c.exit().remove();var e=m.selectAll("g.y").data(y.ticks(10),String).attr("transform",j);e.select("text").text(b);var g=e.enter().insert("svg:g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");g.append("svg:line").attr("stroke",k).attr("x1",0).attr("x2",f.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),e.exit().remove(),o()}function r(){if(!!selected)switch(d3.event.keyCode){case 8:case 46:var a=l.indexOf(selected);l.splice(a,1),selected=l.length?l[a>0?a-1:0]:null,o()}}function q(){!dragged||(p(),dragged=null)}function p(){if(!!dragged){var a=d3.svg.mouse(m.node());dragged[0]=x.invert(Math.max(0,Math.min(f.width,a[0]))),dragged[1]=y.invert(Math.max(0,Math.min(f.height,a[1]))),o()}}function o(){var a=m.select("path").attr("d",line(l)),b=x.domain()[1]-x.domain()[0],c=m.select("svg").selectAll("circle").data(l,function(a){return a});c.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",4).on("mousedown",function(a){selected=dragged=a,o()}).transition().duration(300).ease("elastic").attr("r",2),c.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}var a={};a.epsilon=-0.5,a.sigma=10,a.r_min=Math.pow(2,1/6)*a.sigma,a.alpha=4*Math.pow(a.epsilon*a.sigma,12),a.beta=4*Math.pow(a.epsilon*a.sigma,6),a.xmax=a.sigma,a.xmin=0,a.ymax=5,a.ymin=-1,a.title="Lennard-Jones potential",a.xlabel="Radius",a.ylabel="Potential Well";var b=document.getElementById("chart"),c=b.clientWidth,d=b.clientHeight,e={top:a.title?100:20,right:30,bottom:a.xlabel?40:10,left:a.ylabel?70:45},f={width:c-e.left-e.right,height:d-e.top-e.bottom},g=f.width,h=f.height,i=function(a){return"translate("+x(a)+",0)"},j=function(a){return"translate(0,"+y(a)+")"},k=function(a){return a?"#ccc":"#666"},l=d3.range(a.sigma*10).map(function(b){return{x:b*.1,y:a.alpha/Math.pow(b*10,12)-a.beta/Math.pow(b*10,6)}});x=d3.scale.linear().domain([a.xmin,a.xmax]).range([0,g]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([a.ymax,a.ymin]).nice().range([0,h]).nice(),line=d3.svg.line().x(function(a,b){return x(l[b].x)}).y(function(a,b){return y(l[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=l[0];var m=d3.select("#chart").append("svg:svg").attr("width",c).attr("height",d).append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),n=m.append("svg:rect").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",s)).on("mousedown",function(){d3.event.altKey&&(points.push(selected=dragged=d3.svg.mouse(m.node())),o(),d3.event.preventDefault(),d3.event.stopPropagation())});m.append("svg:svg").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height).append("svg:path").attr("class","line").attr("d",line(l)),a.title&&m.append("svg:text").text(a.title).attr("x",f.width/2).attr("dy","-1em").style("text-anchor","middle"),a.xlabel&&m.append("svg:text").text(a.xlabel).attr("x",f.width/2).attr("y",f.height).attr("dy","2.4em").style("text-anchor","middle"),a.ylabel&&m.append("svg:g").append("svg:text").text(a.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+f.height/2+") rotate(-90)"),d3.select(window).on("mousemove",p).on("mouseup",q).on("keydown",r),s(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(m[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/downx,g=1+(downx/c-1)*(f/(downx-d))/h,i=[d,d+f*g],x.domain(i),s()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){var j=downscaley.invert(b[1]),k=downscaley.domain()[1],l=downscaley.domain()[0],n=l-k;if(j!==0){var o,p,q;p=n/downy,o=1-(j/downy-1)*(n/(downy-k))/p,q=[k+n*o,k],y.domain(q),s()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(s(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(s(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})}})()