(function(){graphx={version:"0.0.1"},graphx.graph=function(a){function C(){e=d.clientWidth,f=d.clientHeight,g={top:graph.title?40:20,right:30,bottom:graph.xlabel?50:10,left:graph.ylabel?70:45},h={width:e-g.left-g.right,height:f-g.top-g.bottom},i=h.width,j=h.height,k=function(a){return"translate("+n(a)+",0)"},l=function(a){return"translate(0,"+r(a)+")"},m=function(a){return a?"#ccc":"#666"},n=d3.scale.linear().domain([graph.xmin,graph.xmax]).range([0,i]),p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),q=function(a){return"translate("+p(a)+",0)"},o=Math.NaN,r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([0,j]),t=d3.svg.line().x(function(a,b){return n(B[b].x)}).y(function(a,b){return r(B[b].y)}),s=Math.NaN,u=null,v=B[0];if(undefined!==z){var a=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;a&&(r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([j,0])),d3.select(d).select("svg").attr("width",e).attr("height",f),z.select("rect.plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE"),z.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height),graph.title&&z.select("text.title").attr("x",h.width/2).attr("dy","-1em"),graph.xlabel&&z.select("text.xlabel").attr("x",h.width/2).attr("y",h.height),graph.ylabel&&z.select("text.ylabel").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),z.selectAll("g.x").remove(),z.selectAll("g.y").remove(),M()}else z=d3.select(d).append("svg:svg").attr("width",e).attr("height",f).append("svg:g").attr("transform","translate("+g.left+","+g.top+")"),z.append("svg:rect").attr("class","plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",S)).on("mousedown",function(){d3.event.altKey&&(B.push(v=u=d3.svg.mouse(z.node())),O(),d3.event.preventDefault(),d3.event.stopPropagation())}),z.append("svg:svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height).append("svg:path").attr("class","line").attr("d",t(B)),w=z.select("path")[0][0],x=w.pathSegList,y=z.node(),A=document.createElementNS("http://www.w3.org/2000/svg","circle"),A.setAttribute("cx",1),A.setAttribute("cy",1),A.setAttribute("r",1),graph.title&&z.append("svg:text").attr("class","title").text(graph.title).attr("x",h.width/2).attr("dy","-1em").style("text-anchor","middle"),graph.xlabel&&z.append("svg:text").attr("class","xlabel").text(graph.xlabel).attr("x",h.width/2).attr("y",h.height).attr("dy","2.4em").style("text-anchor","middle"),graph.ylabel&&z.append("svg:g").append("svg:text").attr("class","ylabel").text(graph.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),L();S()}function D(a){B=T(a,0),O()}function F(a){var b=B.length;if(b===0)x;else{var c={x:b,y:a};B.push(c);var d=n.call(self,b,b),e=r.call(self,a,b);x.appendItem(w.createSVGPathSegLinetoAbs(d,e))}}function G(a){if(B.length==0)return;var b=B.length,d=n.call(self,b-1,b-1),e=r.call(self,B[b-1].y,b-1),f={x:b,y:a};B.push(f);var g=n.call(self,b,b),h=r.call(self,a,b);c.beginPath(),c.moveTo(d,e),c.lineTo(g,h),c.stroke()}function H(){b.width=b.width,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,b.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)"}function I(){x.clear(),b.style.zIndex=100}function J(){b.style.zIndex=-100,z.select("path.line").attr("d",t(B))}function K(){if(B.length==0)return;var a=n.call(self,0,0),d=r.call(self,B[0].y,0),e;H(),c.fillRect(0,0,b.width,b.height),c.beginPath(),c.moveTo(a,d);for(e=0;e<B.length-1;e++)a=n.call(self,e,e),d=r.call(self,B[e].y,e),c.lineTo(a,d);c.stroke()}function L(){b=document.createElement("canvas"),d.appendChild(b),b.style.zIndex=-100,N(b)}function M(){N(b),K()}function N(a){var e={};e.rect=d.children[0].getElementsByTagName("rect")[0],e.width=e.rect.width.baseVal.value,e.height=e.rect.height.baseVal.value,e.left=e.rect.getCTM().e,e.top=e.rect.getCTM().f,a.style.position="absolute",a.width=e.width,a.height=e.height,a.offsetLeft=e.left,a.offsetTop=e.top,a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.border="solid 1px red",c=b.getContext("2d"),c.globalCompositeOperation="source-over",c.lineWidth=1,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,a.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)",b.style.border="solid 1px red"}function O(){var a,c,e,f,g,h=d.children[0].getElementsByTagName("rect")[0];if(b.style.zIndex==-100)var i=z.select("path").attr("d",t(B));K();if(graph.selectable_points){var j=z.selectAll("circle").data(B,function(a){return a});j.enter().append("svg:circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}).attr("r",1).on("mousedown",function(a){v=u=a,O()}),j.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}),j.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function P(){if(!u)return;d.onselectstart=function(){return!1};var a=d3.svg.mouse(z.node());u.x=n.invert(Math.max(0,Math.min(h.width,a[0]))),u.y=r.invert(Math.max(0,Math.min(h.height,a[1]))),O()}function Q(){if(!u)return;d.onselectstart=function(){return!0},P(),u=null}function R(){if(!v)return;switch(d3.event.keyCode){case 8:case 46:var a=B.indexOf(v);B.splice(a,1),v=B.length?B[a>0?a-1:0]:null,O()}}function S(){d3.event&&d3.event.transform&&isNaN(o)&&isNaN(s)&&d3.event.transform(n,r),graph.xmin=n.domain()[0],graph.xmax=n.domain()[1],graph.ymin=r.domain()[0],graph.ymax=r.domain()[1];var a=p.tickFormat(10),b=r.tickFormat(10),c=z.selectAll("g.x").data(p.ticks(10),String).attr("transform",q);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",q);d.append("svg:line").attr("stroke",m).attr("y1",0).attr("y2",h.height),d.append("svg:text").attr("y",h.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);o=p.invert(b[0])}),c.exit().remove();var e=z.selectAll("g.y").data(r.ticks(10),String).attr("transform",l);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",l).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",m).attr("x1",0).attr("x2",h.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);s=r.invert(b[1])}),e.exit().remove(),O()}function T(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f}graph={},graph.container=a.container||document.getElementById("chart"),graph.dataset=a.dataset||[0],graph.xmax=a.xmax||10,graph.xmin=a.xmin||0,graph.sample=a.sample||1,graph.ymax=a.ymax||10,graph.ymin=a.ymin||0,graph.title=a.title,graph.xlabel=a.xlabel,graph.ylabel=a.ylabel,graph.selectable_points=a.selectable_points||!1,graph.setup_graph=function(a){C()},graph.new_data=function(a){D(a),O()},graph.change_xaxis=function(a){n=d3.scale.linear().domain([0,a]).range([0,i]),graph.xmax=a,p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),O(),K(),S()},graph.change_yaxis=function(a){r=d3.scale.linear().domain([a,0]).range([0,j]),graph.ymax=a,O(),K(),S()},graph.add_point=function(a){F(a)},graph.update=function(){O()},graph.add_canvas_point=function(a){G(a)},graph.initialize_canvas=function(){L()},graph.show_canvas=function(){I()},graph.hide_canvas=function(){J()},graph.clear_canvas=function(){H()},graph.update_canvas=function(){K()};var b,c,d,e,f,g={},h={},i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=T(graph.dataset,0);d=graph.container,C(),d3.select(d).on("mousemove",P).on("mouseup",Q).on("keydown",R);var E=function(){var a="",b=function(b,c,d){var e=a,f=-1,g=b.length,h=[],i;e.length===0&&(h.push("M",c.call(self,b[0].x,0),",",d.call(self,b[0].y,0)),f++);while(++f<g)h.push("L",c.call(self,b[f].x,f),",",d.call(self,b[f].y,f));return a+=h.join("")};return b}();return d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(z[0][0]);if(!isNaN(o)){var c=p.invert(b[0]),d=p.domain()[0],e=p.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/o,g=1+(o/c-1)*(f/(o-d))/h,i=[d,d+f*g],p.domain(i),graph.sample!==1&&n.domain([i[0]/graph.sample,i[1]/graph.sample]),S()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(s)){var j=r.invert(b[1]),k=r.domain()[1],l=r.domain()[0],m=l-k;if(j!==0){var q,t,u;t=m/s,q=(j-k)/(s-k)*(m/(s-k))/t,u=[k+m*1/q,k],k>0&&(u[0]+=k),r.domain(u),S()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(o)||(S(),o=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(s)||(S(),s=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),graph}})();