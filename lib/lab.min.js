//
// lab.js
//
lab={},function(){grapher={version:"0.0.1"},grapher.data=function(a){var b=0,c=a.length,d=[];for(b=0;b<c;b+=2)d.push({x:a[b],y:a[b+1]});return d},grapher.indexedData=function(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f},grapher.colors=function(a){var b={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return b[a]},grapher.sampleGraph=function(a){function l(){var a=j.select("path").attr("d",line(i)),b=j.selectAll("circle").data(i,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function m(){if(!dragged)return;var a=d3.svg.mouse(j.node());dragged.x=x.invert(Math.max(0,Math.min(b[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(b[1],a[1]))),l()}function n(){if(!dragged)return;m(),dragged=null}function o(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=i.indexOf(selected);i.splice(a,1),selected=i.length?i[a>0?a-1:0]:null,l()}}function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),c=y.tickFormat(10),d=j.selectAll("g.x").data(x.ticks(10),String).attr("transform",f);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",f);e.append("svg:line").attr("stroke",h).attr("y1",0).attr("y2",b[1]),e.append("svg:text").attr("y",b[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var i=j.selectAll("g.y").data(y.ticks(10),String).attr("transform",g);i.select("text").text(c);var k=i.enter().insert("svg:g","a").attr("class","y").attr("transform",g).attr("background-fill","#FFEEB6");k.append("svg:line").attr("stroke",h).attr("x1",0).attr("x2",b[0]),k.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(c).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),i.exit().remove(),l()}var b=[890,450],c=[20,30,20,40],d=b[0]-c[1]-c[3],e=b[1]-c[0]-c[2],f=function(a){return"translate("+x(a)+",0)"},g=function(a){return"translate(0,"+y(a)+")"},h=function(a){return a?"#ccc":"#666"},i=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([15,45]).range([0,d]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([40,10]).range([0,e]),line=d3.svg.line().x(function(a,b){return x(i[b].x)}).y(function(a,b){return y(i[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=i[0];var j=d3.select("#chart").append("svg:svg").attr("width",b[0]+c[3]+c[1]).attr("height",b[1]+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),k=j.append("svg:rect").attr("width",b[0]).attr("height",b[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(i.push(selected=dragged=d3.svg.mouse(j.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});j.append("svg:path").attr("class","line").attr("d",line(i)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(j[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.graph=function(a){function b(a){a.each(function(a,b){var c=d3.select(this),d=Infinity,d=Infinity,e=-Infinity,e=-Infinity,f=x.call(this,a,b),g=y.call(this,a,b),h=domain&&domain.call(this,a,b)||[d3.min(f),d3.max(f)],i=domain&&domain.call(this,a,b)||[d3.min(g),d3.max(g)],j=d3.scale.linear().domain(h).range([0,width]),k=d3.scale.linear().domain(i).range([height,0]),l=this.__chart__&&this.__chart__.x||j,m=this.__chart__&&this.__chart__.y||k,n=c.selectAll(".x.axis").data([,]);n.enter().append("svg:g").attr("class","x axis"),n.attr("transform","translate(0,"+height+")").call(xAxis.scales([l,j]));var o=c.selectAll(".y.axis").data([,]);o.enter().append("svg:g").attr("class","y axis"),o.call(yAxis.scales([m,k])),this.__chart__={x:j,y:k};var p=c.selectAll("g.datum").data(f),q=function(a,b){return"translate("+j(a)+","+k(g[b])+")"};p.enter().append("svg:g").attr("class","datum").attr("transform",function(a,b){return"translate("+l(a)+","+m(g[b])+")"}).style("opacity",1e-6).transition().duration(duration).delay(function(a){return l(a)*5}).attr("transform",q).style("opacity",1),p.transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1),p.exit().transition().duration(duration).delay(function(a){return j(a)*5}).attr("transform",q).style("opacity",1e-6).remove(),d3.timer.flush()})}function l(){var a=k.select("path").attr("d",line(j)),b=k.selectAll("circle").data(j,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function m(){if(!dragged)return;var a=d3.svg.mouse(k.node());dragged.x=x.invert(Math.max(0,Math.min(c[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(c[1],a[1]))),l()}function n(){if(!dragged)return;m(),dragged=null}function o(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=j.indexOf(selected);j.splice(a,1),selected=j.length?j[a>0?a-1:0]:null,l()}}function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),d=k.selectAll("g.x").data(x.ticks(10),String).attr("transform",g);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",g);e.append("svg:line").attr("stroke",i).attr("y1",0).attr("y2",c[1]),e.append("svg:text").attr("y",c[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var f=k.selectAll("g.y").data(y.ticks(10),String).attr("transform",h);f.select("text").text(b);var j=f.enter().insert("svg:g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");j.append("svg:line").attr("stroke",i).attr("x1",0).attr("x2",c[0]),j.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(k[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),f.exit().remove(),l()}var c=[890,450],d=[20,30,20,40],e=c[0]-d[1]-d[3],f=c[1]-d[0]-d[2],g=function(a){return"translate("+x(a)+",0)"},h=function(a){return"translate(0,"+y(a)+")"},i=function(a){return a?"#ccc":"#666"},j=grapher.indexedData(d3.range(1,60).map(function(a){return a,15+Math.random()*10}));x=d3.scale.linear().domain([15,45]).range([0,e]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([40,10]).range([0,f]),line=d3.svg.line().x(function(a,b){return x(j[b].x)}).y(function(a,b){return y(j[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=j[0];var k=d3.select("#chart").append("svg:svg").attr("width",c[0]+d[3]+d[1]).attr("height",c[1]+d[0]+d[2]).append("svg:g").attr("transform","translate("+d[3]+","+d[0]+")"),b=k.append("svg:rect").attr("width",c[0]).attr("height",c[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(j.push(selected=dragged=d3.svg.mouse(k.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});k.append("svg:path").attr("class","line").attr("d",line(j)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(k[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=1+(downx/c-1)*(f/(downx-d)),h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.citiesSampleGraph=function(a){function l(){var a=j.select("path").attr("d",line(i)),b=j.selectAll("circle").data(i,function(a){return a});b.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",6).on("mousedown",function(a){selected=dragged=a,l()}),b.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),b.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function m(){if(!dragged)return;var a=d3.svg.mouse(j.node());dragged.x=x.invert(Math.max(0,Math.min(b[0],a[0]))),dragged.y=y.invert(Math.max(0,Math.min(b[1],a[1]))),l()}function n(){if(!dragged)return;m(),dragged=null}function o(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=i.indexOf(selected);i.splice(a,1),selected=i.length?i[a>0?a-1:0]:null,l()}}function p(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),c=y.tickFormat(10),d=j.selectAll("g.x").data(x.ticks(10),String).attr("transform",f);d.select("text").text(a);var e=d.enter().insert("svg:g","a").attr("class","x").attr("transform",f);e.append("svg:line").attr("stroke",h).attr("y1",0).attr("y2",b[1]),e.append("svg:text").attr("y",b[1]).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),d.exit().remove();var i=j.selectAll("g.y").data(y.ticks(10),String).attr("transform",g);i.select("text").text(c);var k=i.enter().insert("svg:g","a").attr("class","y").attr("transform",g).attr("background-fill","#FFEEB6");k.append("svg:line").attr("stroke",h).attr("x1",0).attr("x2",b[0]),k.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(c).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(j[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),i.exit().remove(),l()}var b=[890,450],c=[20,30,20,40],d=b[0]-c[1]-c[3],e=b[1]-c[0]-c[2],f=function(a){return"translate("+x(a)+",0)"},g=function(a){return"translate(0,"+y(a)+")"},h=function(a){return a?"#ccc":"#666"},i=grapher.indexedData(a.average_temperatures,1);x=d3.scale.linear().domain([1,12]).range([0,d]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([30,-30]).range([0,e]),line=d3.svg.line().x(function(a,b){return x(i[b].x)}).y(function(a,b){return y(i[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=i[0];var j=d3.select("#chart").append("svg:svg").attr("width",b[0]+c[3]+c[1]).attr("height",b[1]+c[0]+c[2]).append("svg:g").attr("transform","translate("+c[3]+","+c[0]+")"),k=j.append("svg:rect").attr("width",b[0]).attr("height",b[1]).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",p)).on("mousedown",function(){d3.event.altKey&&(i.push(selected=dragged=d3.svg.mouse(j.node())),l(),d3.event.preventDefault(),d3.event.stopPropagation())});j.append("svg:path").attr("class","line").attr("d",line(i)),d3.select(window).on("mousemove",m).on("mouseup",n).on("keydown",o),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),l()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String),p(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(j[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!=0){var g,h;g=downx/c,h=[d,d+f*g],x.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){rupy=downscaley.invert(b[1]),yaxis1=downscaley.domain()[1],yaxis2=downscaley.domain()[0],yextent=yaxis2-yaxis1;if(rupy!=0){var i,h;i=downy/rupy,h=[yaxis1+yextent*i,yaxis1],y.domain(h),p()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(p(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(p(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.surfaceTemperatureSampleGraph=function(a){function y(){var a=w.select("path").attr("d",r(m)),b=n.domain()[1]-n.domain()[0],c=w.select("svg").selectAll("circle").data(m,function(a){return a});c.enter().append("svg:circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return q(a[1])}).attr("r",4).on("mousedown",function(a){v=u=a,y()}).transition().duration(300).ease("elastic").attr("r",2),c.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return q(a[1])}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function z(){if(!u)return;var a=d3.svg.mouse(w.node());u[0]=n.invert(Math.max(0,Math.min(g.width,a[0]))),u[1]=q.invert(Math.max(0,Math.min(g.height,a[1]))),y()}function A(){if(!u)return;z(),u=null}function B(){if(!v)return;switch(d3.event.keyCode){case 8:case 46:var a=m.indexOf(v);m.splice(a,1),v=m.length?m[a>0?a-1:0]:null,y()}}function C(){d3.event&&d3.event.transform&&isNaN(p)&&isNaN(t)&&d3.event.transform(n,q);var a=n.tickFormat(10),b=q.tickFormat(10),c=w.selectAll("g.x").data(n.ticks(10),String).attr("transform",j);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",j);d.append("svg:line").attr("stroke",l).attr("y1",0).attr("y2",g.height),d.append("svg:text").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(w[0][0]);p=n.invert(b[0]),o=null,o=n.copy()}),c.exit().remove();var e=w.selectAll("g.y").data(q.ticks(10),String).attr("transform",k);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",k).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",l).attr("x1",0).attr("x2",g.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(w[0][0]);t=q.invert(b[1]),s=q.copy()}),e.exit().remove(),y()}var b={};b.xmax=2e3,b.xmin=500,b.ymax=15,b.ymin=13,b.title="Earth's Surface Temperature: years 500-2009",b.xlabel="Year",b.ylabel="Degrees C";var c=document.getElementById("chart"),d=c.clientWidth,e=c.clientHeight,f={top:b.title?30:20,right:30,bottom:b.xlabel?40:10,left:b.ylabel?70:45},g={width:d-f.left-f.right,height:e-f.top-f.bottom},h=g.width,i=g.height,j=function(a){return"translate("+n(a)+",0)"},k=function(a){return"translate(0,"+q(a)+")"},l=function(a){return a?"#ccc":"#666"},m=a.temperature_anomolies.map(function(b){return[b[0],b[1]+a.global_surface_temperature_1961_1990]}),n=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,h]),o=n.copy(),p=Math.NaN,q=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,i]).nice(),r=d3.svg.line().x(function(a,b){return n(m[b][0])}).y(function(a,b){return q(m[b][1])}),s=q.copy(),t=Math.NaN,u=null,v=m[0],w=d3.select("#chart").append("svg:svg").attr("width",d).attr("height",e).append("svg:g").attr("transform","translate("+f.left+","+f.top+")"),x=w.append("svg:rect").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",C)).on("mousedown",function(){d3.event.altKey&&(points.push(v=u=d3.svg.mouse(w.node())),y(),d3.event.preventDefault(),d3.event.stopPropagation())});w.append("svg:svg").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height).append("svg:path").attr("class","line").attr("d",r(m)),b.title&&w.append("svg:text").text(b.title).attr("x",g.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&w.append("svg:text").text(b.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&w.append("svg:g").append("svg:text").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+g.height/2+") rotate(-90)"),d3.select(window).on("mousemove",z).on("mouseup",A).on("keydown",B),C(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(w[0][0]);if(!isNaN(p)){var c=o.invert(b[0]),d=o.domain()[0],e=o.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/p,g=1+(p/c-1)*(f/(p-d))/h,i=[d,d+f*g],n.domain(i),C()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(t)){var j=s.invert(b[1]),k=s.domain()[1],l=s.domain()[0],m=l-k;if(j!==0){var r,u,v;u=m/t,r=1-(j/t-1)*(m/(t-k))/u,v=[k+m*r,k],q.domain(v),C()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(p)||(C(),p=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(t)||(C(),t=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})},grapher.lennardJonesSampleGraph=function(){function o(){var a=m.select("path").attr("d",line(l)),b=x.domain()[1]-x.domain()[0],c=m.select("svg").selectAll("circle").data(l,function(a){return a});c.enter().append("svg:circle").attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",4).on("mousedown",function(a){selected=dragged=a,o()}).transition().duration(300).ease("elastic").attr("r",2),c.attr("class",function(a){return a===selected?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function p(){if(!dragged)return;var a=d3.svg.mouse(m.node());dragged[0]=x.invert(Math.max(0,Math.min(f.width,a[0]))),dragged[1]=y.invert(Math.max(0,Math.min(f.height,a[1]))),o()}function q(){if(!dragged)return;p(),dragged=null}function r(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var a=l.indexOf(selected);l.splice(a,1),selected=l.length?l[a>0?a-1:0]:null,o()}}function s(){d3.event&&d3.event.transform&&isNaN(downx)&&isNaN(downy)&&d3.event.transform(x,y);var a=x.tickFormat(10),b=y.tickFormat(10),c=m.selectAll("g.x").data(x.ticks(10),String).attr("transform",i);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",i);d.append("svg:line").attr("stroke",k).attr("y1",0).attr("y2",f.height),d.append("svg:text").attr("y",f.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downx=x.invert(b[0]),downscalex=null,downscalex=x.copy()}),c.exit().remove();var e=m.selectAll("g.y").data(y.ticks(10),String).attr("transform",j);e.select("text").text(b);var g=e.enter().insert("svg:g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");g.append("svg:line").attr("stroke",k).attr("x1",0).attr("x2",f.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(m[0][0]);downy=y.invert(b[1]),downscaley=y.copy()}),e.exit().remove(),o()}var a={};a.epsilon=-0.5,a.sigma=10,a.r_min=Math.pow(2,1/6)*a.sigma,a.alpha=4*Math.pow(a.epsilon*a.sigma,12),a.beta=4*Math.pow(a.epsilon*a.sigma,6),a.xmax=a.sigma,a.xmin=0,a.ymax=5,a.ymin=-1,a.title="Lennard-Jones potential",a.xlabel="Radius",a.ylabel="Potential Well";var b=document.getElementById("chart"),c=b.clientWidth,d=b.clientHeight,e={top:a.title?100:20,right:30,bottom:a.xlabel?40:10,left:a.ylabel?70:45},f={width:c-e.left-e.right,height:d-e.top-e.bottom},g=f.width,h=f.height,i=function(a){return"translate("+x(a)+",0)"},j=function(a){return"translate(0,"+y(a)+")"},k=function(a){return a?"#ccc":"#666"},l=d3.range(a.sigma*10).map(function(b){return{x:b*.1,y:a.alpha/Math.pow(b*10,12)-a.beta/Math.pow(b*10,6)}});x=d3.scale.linear().domain([a.xmin,a.xmax]).range([0,g]),downscalex=x.copy(),downx=Math.NaN,y=d3.scale.linear().domain([a.ymax,a.ymin]).nice().range([0,h]).nice(),line=d3.svg.line().x(function(a,b){return x(l[b].x)}).y(function(a,b){return y(l[b].y)}),downscaley=y.copy(),downy=Math.NaN,dragged=null,selected=l[0];var m=d3.select("#chart").append("svg:svg").attr("width",c).attr("height",d).append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),n=m.append("svg:rect").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",s)).on("mousedown",function(){d3.event.altKey&&(points.push(selected=dragged=d3.svg.mouse(m.node())),o(),d3.event.preventDefault(),d3.event.stopPropagation())});m.append("svg:svg").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height).append("svg:path").attr("class","line").attr("d",line(l)),a.title&&m.append("svg:text").text(a.title).attr("x",f.width/2).attr("dy","-1em").style("text-anchor","middle"),a.xlabel&&m.append("svg:text").text(a.xlabel).attr("x",f.width/2).attr("y",f.height).attr("dy","2.4em").style("text-anchor","middle"),a.ylabel&&m.append("svg:g").append("svg:text").text(a.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+f.height/2+") rotate(-90)"),d3.select(window).on("mousemove",p).on("mouseup",q).on("keydown",r),s(),d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(m[0][0]);if(!isNaN(downx)){var c=downscalex.invert(b[0]),d=downscalex.domain()[0],e=downscalex.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/downx,g=1+(downx/c-1)*(f/(downx-d))/h,i=[d,d+f*g],x.domain(i),s()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(downy)){var j=downscaley.invert(b[1]),k=downscaley.domain()[1],l=downscaley.domain()[0],n=l-k;if(j!==0){var o,p,q;p=n/downy,o=1-(j/downy-1)*(n/(downy-k))/p,q=[k+n*o,k],y.domain(q),s()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(downx)||(s(),downx=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(downy)||(s(),downy=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())})}}(),function(){molecules_coulomb={},molecules_coulomb={version:"0.0.1"};var a=-50;molecules_coulomb.force=function(b,c,d){return a*(c*d/(b*b))},molecules_coulomb.energy=function(b,c,d){return-a*(c*d/b)},molecules_lennard_jones={},molecules_lennard_jones={version:"0.0.1"};var b=-1,c=4,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6);molecules_lennard_jones.epsilon=function(a){return molecules_lennard_jones.coefficients(a,c)},molecules_lennard_jones.sigma=function(a){return molecules_lennard_jones.coefficients(b,a)},molecules_lennard_jones.coefficients=function(a,g){arguments.length&&(b=a,c=g,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6));var h={epsilon:b,sigma:c,rmin:d,alpha:e,beta:f};return h},molecules_lennard_jones.potential=function(a){return(e/Math.pow(a,12)-f/Math.pow(a,6))*-1},molecules_lennard_jones.force=function(a){return 12*e/Math.pow(a,13)-6*f/Math.pow(a,7)},modeler={},modeler.layout={},modeler.VERSION="0.1.0",modeler.layout.model=function(){function bs(a){var b={};return b.index=a,b.radius=br[be][a],b.px=br[bf][a],b.py=br[bg][a],b.x=br[bh][a],b.y=br[bi][a],b.vx=br[bj][a],b.vy=br[bk][a],b.speed=br[bl][a],b.ax=br[bm][a],b.ay=br[bn][a],b.mass=br[bo][a]*2,b.charge=br[bp][a],b}function bt(){var a,b=mol_number,c=[];a=-1;while(++a<b)molecules[a]=bs(a);molecules.length=b}function bu(a){return.005*Math.pow(Math.E/2,a)}function bv(){var a,b;for(a=0;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>F){I=a;break}}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>G)break}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b<G){H=a;break}}}function bw(){var a,b;for(a=.001;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<J){M=a;break}}for(;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<K)break}L=a}function bx(){var a=br[0].length,b,g,i,o,p,q,r,p,s,t,v,w,x,y,z,A,B,C,D,E,G=V[0],I=V[0],K=c[0]-V[0],M=c[1]-V[0];R=0,E=-1;while(++E<N){g=-1;while(++g<a)C=Y[g],D=Z[g],Y[g]+=$[g]*O+.5*P*bb[g],Z[g]+=_[g]*O+.5*P*bc[g],$[g]+=.5*O*bb[g],_[g]+=.5*O*bc[g],z=Y[g]-C,A=Z[g]-D,q=Math.sqrt(z*z+A*A),ba[g]=q,Y[g]<G?(Y[g]=G+(G-Y[g]),W[g]=Y[g]+z,X[g]=D,$[g]*=-1,R+=ba[g]):Y[g]>K?(Y[g]=K+(K-Y[g]),W[g]=Y[g]+z,X[g]=D,$[g]*=-1,R+=ba[g]):Z[g]<I?(Z[g]=I+(I-Z[g]),X[g]=Z[g]+A,W[g]=C,_[g]*=-1,R+=ba[g]):Z[g]>M?(Z[g]=M+(M-Z[g]),X[g]=Z[g]+A,W[g]=C,_[g]*=-1,R+=ba[g]):(W[g]=C,X[g]=D);g=-1;while(++g<a)bb[g]=0,bc[g]=0;if(e||f){g=-1;while(++g<a){i=g;while(++i<a)z=Y[i]-Y[g],A=Z[i]-Z[g],s=z*z+A*A,q=Math.sqrt(s),e&&q<H&&(v=Math.max(F,molecules_lennard_jones.force(q)),x=z/q*v,y=A/q*v,bb[g]+=x,bc[g]+=y,bb[i]-=x,bc[i]-=y),f&&q<L&&(w=Math.min(J,molecules_coulomb.force(q,u[g],u[i])),h+=molecules_coulomb.energy(q,u[g],u[i]),x=z/q*w,y=A/q*w,bb[g]+=x,bc[g]+=y,bb[i]-=x,bc[i]-=y)}}if(d){j=bM(),m=k*1.1,n=k*.9,speed_max=k*2,speed_max_one_percent=speed_max*.01,speed_min=k*.5,speed_min_one_percent=speed_min*.01,g=-1;while(++g<a)j>m?(bb[g]*=.5,bc[g]*=.5,ba[g]>speed_max&&(l=speed_max/ba[g],$[g]*=l,_[g]*=l,ba[g]=speed_max-Math.random()*speed_max_one_percent,W[g]=Y[g]-$[g],X[g]=Z[g]-_[g])):j<n&&(bb[g]*=2,bc[g]*=2,ba[g]<speed_min&&(l=speed_min/ba[g],$[g]*=l,_[g]*=l,ba[g]=speed_min+Math.random()*speed_min_one_percent,W[g]=Y[g]-$[g],X[g]=Z[g]-_[g]))}g=-1;while(++g<a)$[g]+=.5*O*bb[g],_[g]+=.5*O*bc[g]}}function by(){return bx(),S.push(R),S.splice(0,S.length-16),bJ(),bt(),bB(),r||(t=Date.now(),T?(T=t-T,T&&U.push(T),T=t,U.splice(0,U.length-128)):T=t,b.tick({type:"tick"})),r}function bz(){y=[],z=0,A=-1}function bA(){y.length=z+1}function bB(){var a,b,c,d=[],e=br.length;a=-1;while(++a<e)d[a]=arrays.clone(br[a]);y.length=z,z++,A++,B=!0,y.push({nodes:d,ke:g}),z>1e3&&(y.splice(0,1),z=1e3)}function bC(a){var b,c=br.length;if(a<0)throw new Error("modeler: request for tick_history_list["+a+"]");if(a>=y.length)throw new Error("modeler: request for tick_history_list["+a+"], tick_history_list.length="+y.length);b=-1;while(++b<c)arrays.copy(y[a].nodes[b],br[b]);g=y[a].ke,bt()}function bD(a){var b,c,d=br[0].length;b=-1;while(++b<d)c=a/ba[b],$[b]=(Y[b]-W[b])*c,_[b]=(Z[b]-X[b])*c,W[b]+=$[b],X[b]+=_[b],ba[b]=a}function bE(a){var b,c=br[0].length;b=-1;while(++b<c)$[b]=(Y[b]-W[b])*a,_[b]=(Z[b]-X[b])*a,W[b]+=$[b],X[b]+=_[b],ba[b]*-a}function bF(a){var b,c,d=br[0].length;b=-1;while(++b<d)ba[b]>a&&(c=a/ba[b],$[b]=(Y[b]-W[b])*c,_[b]=(Z[b]-X[b])*c,W[b]+=$[b],X[b]+=_[b],ba[b]=a)}function bG(a){var b,c=br[0].length;b=-1;while(++b<c)bb[b]=a,bc[b]=a}function bH(){return S.reduce(function(a,b){return a+b})/S.length}function bI(a){if(arguments.length)bI.push(a),bI.splice(0,bI.length-100);else return bI.reduce(function(a,b){return a+b})/S.length}function bJ(){var a,b,c,d,e,f,i=br[0].length;g=0,h=0,a=-1;while(++a<i)b=ba[a],c=b*b*bd[a],g+=c,d=bb[a],e=bc[a],f=d+d,h+=f}function bK(){var a,b,c,d,e=br[0].length;h=0,a=-1;while(++a<e)b=bb[a],c=bc[a],d=Math.sqrt(b*b+c*c),h+=d;return h}function bL(){var a,b,c,d=br[0].length;g=0,a=-1;while(++a<d)b=ba[a],c=b*b*bd[a],g+=c;return g}function bM(){var a,b=0,c=br[0].length;a=-1;while(++a<c)b+=ba[a];return b/c}function bN(){var a,b,c=0,d=U.length;a=-1;while(++a<d)c+=U[a];return b=c/d,b?1/b*1e3:0}function bO(a){var b;save_temperature_control=d,d=!0,b=-1;while(++b<a)bx();d=save_temperature_control,bt()}function bP(a){temperature=a,k=bu(temperature)}var a={},b=d3.dispatch("tick"),c=[1,1],d,e=!0,f=!0,g,h,j,k,l,m,n,o,p,q,r=!0,s=.9,u=-0.1,v=.1,w=.8,x,y=[],z=0,A=0,B=!1,C,D,E,F=-200,G=.001,H,I,J=20,K=.01,L,M,N=50,O=1/N,P=O*O,Q,R,S=[0],T,U=[],V,W,X,Y,Z,$,_,ba,bb,bc,bd,u,be=0,bf=1,bg=2,bh=3,bi=4,bj=5,bk=6,bl=7,bm=8,bn=9,bo=10,bp=11;a.RADIUS=0,a.PX=1,a.PY=2,a.X=3,a.Y=4,a.VX=5,a.VY=6,a.SPEED=7,a.AX=8,a.AY=9,a.HALFMASS=10,a.CHARGE=11;var bq=11,br=arrays.create(bq,null,"regular");return a.getStats=function(){var a;return a={speed:bM(),ke:g,temperature:temperature,pressure:bH(),current_step:A,steps:y.length-1},a},a.stepCounter=function(){return A},a.steps=function(){return y.length-1},a.isNewStep=function(){return B},a.stepBack=function(){return r=!0,B=!1,z>1&&(z--,A--,bC(z-1),model_listener()),A},a.stepForward=function(){return r=!0,z<y.length?(bC(z),z++,A++,model_listener()):(by(),model_listener()),A},a.on=function(c,d){return b.on(c,d),a},a.tickInPlace=function(){return b.tick({type:"tick"}),a},a.tick=function(){return by(),a},a.set_lj_coefficients=function(b,c){return D=b,E=c,bv(),a},a.set_radius=function(a){var b,c=br[0].length;b=-1;while(++b<c)V[b]=a;bt()},a.get_speed=function(a){if(!arguments.length)var a=[];return arrays.copy(ba,a)},a.get_rate=function(){return bN()},a.set_temperature_control=function(a){d=a},a.set_lennard_jones_forces=function(a){e=a},a.set_coulomb_forces=function(a){f=a},a.initialize=function(b,d){var e,f,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=br[0].length,G=c[0],H=c[1],I=4,J=b,K=d,L=25
,M,N,O,P,Q;return bs,bt,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bK,bL,bM,bO,bP,bz(),M=bu(I),bv(),bw(),bO(L),j=bM(),g=bL(),h=bK(),bB(),a},a.nodes=function(b,c,d,e,f,g){var h;br=arrays.create(bq,null,"regular");var j=!!window.WebGLRenderingContext,k=benchmark.what_browser.browser!="Safari",l=j&&k?"Float32Array":"regular";br[a.RADIUS]=arrays.create(b,f*g,l),V=br[a.RADIUS],br[a.PX]=arrays.create(b,0,l),W=br[a.PX],br[a.PY]=arrays.create(b,0,l),X=br[a.PY],br[a.X]=arrays.create(b,0,l),Y=br[a.X],br[a.Y]=arrays.create(b,0,l),Z=br[a.Y],br[a.VX]=arrays.create(b,0,l),$=br[a.VX],br[a.VY]=arrays.create(b,0,l),_=br[a.VY],br[a.SPEED]=arrays.create(b,0,l),ba=br[a.SPEED],br[a.AX]=arrays.create(b,0,l),bb=br[a.AX],br[a.AY]=arrays.create(b,0,l),bc=br[a.AY],br[a.HALFMASS]=arrays.create(b,.5,l),bd=br[a.HALFMASS],br[a.CHARGE]=arrays.create(b,0,l),u=br[a.CHARGE],i=-1;while(++i<b)W[i]=Math.random()*c*.8+c*.1,X[i]=Math.random()*d*.8+d*.1,Y[i]=W[i]+Math.random()*e/100-e/200,Z[i]=X[i]+Math.random()*e/100-e/200,$[i]=Y[i]-W[i],_[i]=Z[i]-X[i],ba[i]=Math.sqrt($[i]*$[i]+_[i]*_[i]),bb[i]=0,bc[i]=0,u[i]=Math.random()>.5?1:-1;return bt(),a},a.start=function(){return a.initialize(),a.resume()},a.resume=function(){return r=!1,d3.timer(by),a},a.stop=function(){return r=!0,a},a.ke=function(){return g=g||bL(),g},a.pe=function(){return h=h||bK(),h},a.speed=function(){return bM()},a.pressure=function(){return bH()},a.temperature=function(b){return arguments.length?(bP(b),a):temperature},a.links=function(b){return arguments.length?(links=b,a):links},a.size=function(b){return arguments.length?(c=b,a):c},a.linkDistance=function(b){return arguments.length?(linkDistance=d3.functor(b),a):linkDistance},a.linkStrength=function(b){return arguments.length?(linkStrength=d3.functor(b),a):linkStrength},a.friction=function(b){return arguments.length?(s=b,a):s},a.charge=function(b){return arguments.length?(u=typeof b=="function"?b:+b,a):u},a.gravity=function(b){return arguments.length?(v=b,a):v},a.theta=function(b){return arguments.length?(w=b,a):w},a}}(),function(){function a(){var a=/ (Chrome)\/(.*?) /,b=/ (Firefox)\/([0123456789ab.]+)/,c=/ Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,d=/ (MSIE) ([0123456789.]+);/,e=/([0123456789.]+) \((iPad);.*? Version\/([0123456789.]+) Mobile\/(\S+)/,f;return f=navigator.userAgent.match(a),f&&f[1]?navigator.platform.match(/Win/)?{browser:f[1],version:f[2],oscpu:navigator.platform}:{browser:f[1],version:f[2],oscpu:navigator.appVersion.match(/(Macintosh); (.*?)\)/)[2]}:(f=navigator.userAgent.match(b),f&&f[1]?navigator.oscpu.match(/Windows /)?{browser:f[1],version:f[2],oscpu:navigator.platform}:{browser:f[1],version:f[2],oscpu:navigator.oscpu}:(f=navigator.userAgent.match(c),f&&f[2]?{browser:f[2],version:f[1],oscpu:navigator.appVersion.match(/(Macintosh); (.*?)\)/)[2]}:(f=navigator.userAgent.match(d),f&&f[1]?{browser:f[1],version:f[2],oscpu:navigator.cpuClass+"/"+navigator.platform}:(f=navigator.userAgent.match(e),f&&f[2]?{browser:f[2],version:f[3]+"/"+f[4],oscpu:f[1]}:{browser:"",version:navigator.appVersion,oscpu:""}))))}function b(b,c){function i(){return b.appendChild(document.createElement("tr"))}function l(a,b,c){c=c||"td",a.appendChild(document.createElement(c)).textContent=b}function m(a,b){h&&l(j,a,"th"),l(k,b)}var d=0,e,f,g=[];b.style.display="";var h=b.getElementsByTagName("tr").length==0,j=i(),k=i();f=a(),m("browser",f.browser),m("version",f.version),m("cpu/os",f.oscpu);var n=d3.time.format("%Y-%m-%d %H:%M");m("date",n(new Date));for(d=0;d<c.length;d++)e=c[d],m(e.name,e.run())}benchmark={},benchmark={version:"0.0.1"},benchmark.what_browser=function(){return a()},benchmark.run=function(a,c){b(a,c)}}(),function(){(function(){arrays={},arrays={version:"0.0.1"},arrays.webgl=!!window.WebGLRenderingContext,arrays.typed=!1;try{var a=new Float64Array(0);arrays.typed=!0}catch(b){}arrays.create=function(a,b,c){c||(arrays.webgl||arrays.typed?c="Float32Array":c="regular"),b=b||0;var d,e;if(c==="regular")d=new Array(a);else switch(c){case"Float64Array":d=new Float64Array(a);break;case"Float32Array":d=new Float32Array(a);break;case"Int32Array":d=new Int32Array(a);break;case"Int16Array":d=new Int16Array(a);break;case"Int8Array":d=new Int8Array(a);break;case"Uint32Array":d=new Uint32Array(a);break;case"Uint16Array":d=new Uint16Array(a);break;case"Uint8Array":d=new Uint8Array(a);break;default:d=new Array(a)}e=-1;while(++e<a)d[e]=b;return d},arrays.constructor_function=function(a){if(a.buffer&&a.buffer.__proto__.constructor)return a.__proto__.constructor;if(a.constructor===Array)return a.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+a+", source.constructor: "+a.constructor+", source.buffer: "+a.buffer+", source.buffer.slice: "+a.buffer.slice+", source.buffer.__proto__: "+a.buffer.__proto__+", source.buffer.__proto__.constructor: "+a.buffer.__proto__.constructor)},arrays.copy=function(a,b){var c=a.length;i=-1;while(++i<c)b[i]=a[i];return b.length=c,b},arrays.clone=function(a){var b,c=a.length,d,e;e=arrays.constructor_function(a);if(e==Array){d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d}if(a.buffer.slice)return d=new e(a.buffer.slice(0)),d;d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d},arrays.between=function(a,b,c){return c<Math.max(a,b)&&c>Math.min(a,b)},arrays.max=function(a){return Math.max.apply(Math,a)},arrays.min=function(a){return Math.min.apply(Math,a)},arrays.maxTypedArray=function(a){var b,c,d=Number.MIN_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b>d?b:d;return d},arrays.minTypedArray=function(a){var b,c,d=Number.MAX_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b<d?b:d;return d},arrays.maxAnyArray=function(a){try{return Math.max.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MIN_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c>e?c:e;return e}}},arrays.minAnyArray=function(a){try{return Math.min.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MAX_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c<e?c:e;return e}}},arrays.average=function(a){var b,c=0,d=a.length;for(b=0;b<d;b++)c+=a[b];return c/d}})()}(),function(){function B(a){}function C(a){z.style("opacity",1).style("left",d3.event.pageX+6+"px").style("top",d3.event.pageY-30+"px").transition().duration(250),A.text("speed: "+d3.format("6.3f")(a.speed)+"\n"+"vx:    "+d3.format("6.3f")(a.vx)+"\n"+"vy:    "+d3.format("6.3f")(a.vy)+"\n")}function D(a){}function E(){z.style("opacity",1e-6)}function Y(){G=F.clientWidth,H=F.clientHeight,I={top:lj_graph.title?36:20,right:30,bottom:lj_graph.xlabel?46:20,left:lj_graph.ylabel?60:45},J={width:G-I.left-I.right,height:H-I.top-I.bottom},K=J.width,L=J.height,M=function(a){return"translate("+P(a)+",0)"},N=function(a){return"translate(0,"+R(a)+")"},O=function(a){return a?"#ccc":"#666"},P=d3.scale.linear().domain([lj_graph.xmin,lj_graph.xmax]).range([0,K]),Q=Math.NaN,R=d3.scale.linear().domain([lj_graph.ymax,lj_graph.ymin]).nice().range([0,L]).nice(),lj_line=d3.svg.line().x(function(a,b){return P(lennard_jones_potential[b][0])}).y(function(a,b){return R(lennard_jones_potential[b][1])}),S=Math.NaN,T=null,lj_selected=lj_graph.variables[0],U,coefficient_selected=lj_graph.variables[0],undefined!==V?(d3.select(F).select("svg").attr("width",G).attr("height",H),V.select("svg").attr("width",G).attr("height",H),V.select("rect.plot").attr("width",J.width).attr("height",J.height).style("fill","#EEEEEE"),V.select("svg.container").attr("top",0).attr("left",0).attr("width",J.width).attr("height",J.height).attr("viewBox","0 0 "+J.width+" "+J.height),V.select("svg.linebox").attr("top",0).attr("left",0).attr("width",J.width).attr("height",J.height).attr("viewBox","0 0 "+J.width+" "+J.height),lj_graph.title&&V.select("text.title").attr("x",J.width/2).attr("dy","-1em"),lj_graph.xlabel&&V.select("text.xlabel").attr("x",J.width/2).attr("y",J.height),lj_graph.ylabel&&V.select("text.ylabel").attr("transform","translate(-40 "+J.height/2+") rotate(-90)"),V.selectAll("g.x").remove(),V.selectAll("g.y").remove()):(V=d3.select(F).append("svg:svg").attr("width",G).attr("height",H).append("svg:g").attr("transform","translate("+I.left+","+I.top+")"),W=V.append("svg:rect").attr("class","plot").attr("width",J.width).attr("height",J.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",layout.lj_redraw)).on("mousedown",function(){d3.event.altKey&&(lj_points.push(lj_selected=T=d3.svg.mouse(V.node())),Z(),d3.event.preventDefault(),d3.event.stopPropagation())}),V.append("svg:svg").attr("class","linebox").attr("top",0).attr("left",0).attr("width",J.width).attr("height",J.height).attr("viewBox","0 0 "+J.width+" "+J.height).append("svg:path").attr("class","line").attr("d",lj_line(lennard_jones_potential)),lj_graph.title&&V.append("svg:text").attr("class","title").text(lj_graph.title).attr("x",J.width/2).attr("dy","-1em").style("text-anchor","middle"),lj_graph.xlabel&&V.append("svg:text").attr("class","xlabel").text(lj_graph.xlabel).attr("x",J.width/2).attr("y",J.height).attr("dy","2.4em").style("text-anchor","middle"),lj_graph.ylabel&&V.append("svg:g").append("svg:text").attr("class","ylabel").text(lj_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+J.height/2+") rotate(-90)"),V.on("mousemove",$).on("mouseup",_)),layout.lj_redraw()}function Z(){var a=V.selectAll("circle").data(lj_graph.variables,function(a){return a}),b=V.select("path").attr("d",lj_line(lennard_jones_potential)),c=P.domain()[1]-P.domain()[0];a.enter().append("svg:circle").attr("class",function(a){return a===U?"selected":null}).attr("cx",function(a){return P(a.x)}).attr("cy",function(a){return R(a.y)}).attr("r",8).on("mousedown",function(a){a.coefficient=="epsilon"?a.x=lj_graph.coefficients.rmin:a.y=0,coefficient_selected=U=a,Z()}),a.attr("class",function(a){return a===coefficient_selected?"selected":null}).attr("cx",function(a){return P(a.x)}).attr("cy",function(a){return R(a.y)}),a.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function $(){if(!U)return;F.onselectstart=function(){return!1};var a=d3.svg.mouse(V.node()),b,c;U.coefficient=="epsilon"?(b=lj_graph.coefficients.rmin,c=R.invert(Math.max(0,Math.min(J.height,a[1]))),c>lj_epsilon_max&&(c=lj_epsilon_max),c<lj_epsilon_min&&(c=lj_epsilon_min),update_epsilon(c)):(c=0,b=P.invert(Math.max(0,Math.min(J.width,a[0]))),b<lj_sigma_min&&(b=lj_sigma_min),b>lj_sigma_max&&(b=lj_sigma_max),update_sigma(b)),layout.update_molecule_radius(),model.tick(),U.x=b,U.y=c,Z()}function _(){isNaN(Q)||(F.onselectstart=function(){return!0},layout.lj_redraw(),Q=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(S)||(layout.lj_redraw(),S=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),U=null}function bv(){bt=[],model.get_speed(bt),speed_graph.xmax=d3.max(bt),speed_graph.xmin=d3.min(bt),speed_graph.quantile=d3.quantile(bt,.1),bo=speed_graph.ymax,bj=d3.scale.linear().domain([speed_graph.xmin,speed_graph.xmax]).range([0,be]),bk=d3.scale.linear().domain([speed_graph.ymax,speed_graph.ymin]).nice().range([0,bf])}function bw(){speed_bins=d3.layout.histogram().frequency(!1).bins(bj.ticks(60))(bt),bl=(bd.width-speed_bins.length)/speed_bins.length,bn=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y})}function bx(){ba=speed_distribution_chart.clientWidth,bb=speed_distribution_chart.clientHeight,bc={top:speed_graph.title?36:20,right:30,bottom:speed_graph.xlabel?46:20,left:speed_graph.ylabel?60:45},bd={width:ba-bc.left-bc.right,height:bb-bc.top-bc.bottom},be=bd.width,bf=bd.height,bg=function(a){return"translate("+bj(a)+",0)"},bh=function(a){return"translate(0,"+bk(a)+")"},bi=function(a){return a?"#ccc":"#666"},bv(),bw(),undefined!==bp?(d3.select(speed_distribution_chart).select("svg").attr("width",ba).attr("height",bb),bp.select("rect.plot").attr("width",bd.width).attr("height",bd.height),speed_graph.title&&bp.select("text.title").attr("x",bd.width/2).attr("dy","-1em"),speed_graph.xlabel&&bp.select("text.xlabel").attr("x",bd.width/2).attr("y",bd.height),speed_graph.ylabel&&bp.select("text.ylabel").attr("transform","translate(-40 "+bd.height/2+") rotate(-90)"),bp.selectAll("g.x").remove(),bp.selectAll("g.y").remove()):(bp=d3.select(speed_distribution_chart).append("svg:svg").attr("width",ba).attr("height",bb).append("svg:g").attr("transform","translate("+bc.left+","+bc.top+")"),bq=bp.append("svg:rect").attr("class","plot").attr("width",bd.width).attr("height",bd.height).style("fill","#EEEEEE"),speed_graph.title&&bp.append("svg:text").attr("class","title").text(speed_graph.title).attr("x",bd.width/2).attr("dy","-1em").style("text-anchor","middle"),speed_graph.xlabel&&bp.append("svg:text").attr("class","xlabel").text(speed_graph.xlabel).attr("x",bd.width/2).attr("y",bd.height).attr("dy","2.4em").style("text-anchor","middle"),speed_graph.ylabel&&bp.append("svg:g").append("svg:text").attr("class","ylabel").text(speed_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+bd.height/2+") rotate(-90)")),layout.speed_redraw()}function bF(){temperature=+bD.value,bD.type==="range"&&(bE.innerText=d3.format("4.1f")(temperature)),model.temperature(temperature)}function bG(){layout.temperature_control_checkbox.checked?model.set_temperature_control(!0):model.set_temperature_control(!1)}function bH(){layout.lennard_jones_forces_checkbox.checked?model.set_lennard_jones_forces(!0):model.set_lennard_jones_forces(!1)}function bI(){layout.coulomb_forces_checkbox.checked?model.set_coulomb_forces(!0):model.set_coulomb_forces(!1),layout.setup_particles()}layout={version:"0.0.1"},layout.setupScreen=function(){var a=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;a?layout.setupFullScreen():layout.setupRegularScreen(),layout.setupTemperature(),bz.style.display="none"},layout.setupFullScreen=function(){layout.setupFullScreenMoleculeContainer(),layout.setupFullScreenPotentialChart(),layout.setupFullScreenSpeedDistributionChart(),layout.setupFullScreenKEChart()},layout.setupRegularScreen=function(){layout.setupRegularScreenMoleculeContainer(),layout.setupRegularScreenPotentialChart(),layout.setupRegularSpeedDistributionChart(),layout.setupRegularScreenKEChart()},layout.setupRegularScreenMoleculeContainer=function(){a.style.width=document.body.clientWidth*.45+"px",a.style.height=document.body.clientWidth*.45+2+"px",layout.finishSetupMoleculeContainer()},layout.setupRegularScreenPotentialChart=function(){F.style.width=document.body.clientWidth*.25+"px",F.style.height=document.body.clientWidth*.2+"px",Y()},layout.setupRegularSpeedDistributionChart=function(){speed_distribution_chart.style.width=document.body.clientWidth*.25+"px",speed_distribution_chart.style.height=document.body.clientWidth*.2+"px",bx()},layout.setupRegularScreenKEChart=function(){kechart.style.width=document.body.clientWidth*.5+5+"px",kechart.style.height=document.body.clientWidth*.25-3+"px",finishSetupKEChart()},layout.setupFullScreenMoleculeContainer=function(){a.style.width=screen.width*.48+"px",a.style.height=screen.height*.8+3+"px",finishSetupMoleculeContainer()},layout.setupFullScreenPotentialChart=function(){F.style.width=screen.width*.22+"px",F.style.height=screen.height*.35+"px",Y()},layout.setupFullScreenSpeedDistributionChart=function(){speed_distribution_chart.style.width=screen.width*.22+"px",speed_distribution_chart.style.height=screen.height*.35+"px",bx()},layout.setupFullScreenKEChart=function(){kechart.style.width=screen.width*.44+5+"px",kechart.style.height=screen.height*.45-2+"px",finishSetupKEChart()};var a=document.getElementById("molecule-container"),b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;layout.finishSetupMoleculeContainer=function(){b=a.clientWidth,c=a.clientHeight,d={top:mc_graph.title?36:20,right:30,bottom:mc_graph.xlabel?46:20,left:mc_graph.ylabel?60:45},e={width:b-d.left-d.right,height:c-d.top-d.bottom},f=e.width,g=e.height,h=function(a){return"translate("+k(a)+",0)"},i=function(a){return"translate(0,"+n(a)+")"},j=function(a){return a?"#ccc":"#666"},k=d3.scale.linear().domain([mc_graph.xmin,mc_graph.xmax]).range([0,f]),l=k.copy(),m=Math.NaN,n=d3.scale.linear().domain([mc_graph.ymax,mc_graph.ymin]).nice().range([0,g]).nice(),o=n.copy(),p=Math.NaN,q=null,undefined!==r?(d3.select(a).select("svg").attr("width",b).attr("height",c),r.select("svg").attr("width",b).attr("height",c),r.select("rect.mc_plot").attr("width",e.width).attr("height",e.height).style("fill","#EEEEEE"),r.select("svg.mc_container").attr("top",0).attr("left",0).attr("width",e.width).attr("height",e.height).attr("viewBox","0 0 "+e.width+" "+e.height),mc_graph.title&&r.select("text.title").attr("x",e.width/2).attr("dy","-1em"),mc_graph.xlabel&&r.select("text.xlabel").attr("x",e.width/2).attr("y",e.height),mc_graph.ylabel&&r.select("text.ylabel").attr("transform","translate(-40 "+e.height/2+") rotate(-90)"),r.selectAll("g.x").remove(),r.selectAll("g.y").remove(),update_molecule_radius(),t.attr("cx",function(a){return k(a.x)}).attr("cy",function(a){return n(a.y)}).attr("r",function(a){return k(a.radius)}),u.attr("transform",function(a){return"translate("+k(a.x)+","+n(a.y)+")"})):(r=d3.select(a).append("svg:svg").attr("width",b).attr("height",c).append("svg:g").attr("transform","translate("+d.left+","+d.top+")"),s=r.append("svg:rect").attr("class","mc_plot").attr("width",e.width).attr("height",e.height).style("fill","#EEEEEE"),layout.mc_container=r.append("svg:svg").attr("class","mc_container").attr("top",0).attr("left",0).attr("width",e.width).attr("height",e.height).attr("viewBox","0 0 "+e.width+" "+e.height),mc_graph.title&&r.append("svg:text").attr("class","title").text(mc_graph.title).attr("x",e.width/2).attr("dy","-1em").style("text-anchor","middle"),mc_graph.xlabel&&r.append("svg:text").attr("class","xlabel").text(mc_graph.xlabel).attr("x",e.width/2).attr("y",e.height).attr("dy","2.4em").style("text-anchor","middle"),mc_graph.ylabel&&r.append("svg:g").append("svg:text").attr("class","ylabel").text(mc_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+e.height/2+") rotate(-90)")),layout.mc_redraw()},layout.mc_redraw=function(){d3.event&&d3.event.transform&&isNaN(m)&&isNaN(p)&&d3.event.transform(x,y);var a=k.tickFormat(10),b=n.tickFormat(10),c=r.selectAll("g.x").data(k.ticks(10),String).attr("transform",h);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",h);d.append("svg:line").attr("stroke",j).attr("y1",0).attr("y2",e.height),d.append("svg:text").attr("y",e.height).attr("dy","1em").attr("text-anchor","middle").text(a),c.exit().remove();var f=r.selectAll("g.y").data(n.ticks(10),String).attr("transform",i);f.select("text").text(b);var g=f.enter().insert("svg:g","a").attr("class","y").attr("transform",i).attr("background-fill","#FFEEB6");g.append("svg:line").attr("stroke",j).attr("x1",0).attr("x2",e.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b),f.exit().remove()},layout.update_molecule_radius=function(){var a=lj_graph.coefficients.rmin*mol_rmin_radius_factor;model.set_radius(a),layout.mc_container.selectAll("circle").data(molecules).attr("r",function(a){return k(a.radius)}),layout.mc_container.selectAll("text").attr("font-size",k(a*1.3))};var t,u,v,w,z=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),A=z.append("pre");layout.setup_particles=function(){var a=lj_graph.coefficients.rmin*mol_rmin_radius_factor;model.set_radius(a),layout.mc_container.selectAll("circle").remove(),layout.mc_container.selectAll("g").remove();var b=k(lj_graph.coefficients.rmin*mol_rmin_radius_factor*1.3);mol_number>100&&(b*=.9),u=layout.mc_container.selectAll("g.label").data(molecules),v=u.enter().append("svg:g").attr("class","label").attr("transform",function(a){return"translate("+k(a.x)+","+n(a.y)+")"}),v.append("svg:text").attr("class","index").attr("font-size",b).attr("x",0).attr("y","0.31em").text(function(a){return a.index}),t=layout.mc_container.selectAll("circle").data(molecules),t.enter().append("svg:circle").attr("r",function(a){return k(a.radius)}).attr("cx",function(a){return k(a.x)}).attr("cy",function(a){return n(a.y)}).style("fill",function(a,b){return layout.coulomb_forces_checkbox.checked?k(a.charge)>0?"#2ca02c":"#a02c2c":"#2ca02c"}).on("mousedown",C).on("mouseout",E)},layout.update_molecule_positions=function(){u=layout.mc_container.selectAll("g.label").data(molecules),u.attr("transform",function(a){return"translate("+k(a.x)+","+n(a.y)+")"}),t=layout.mc_container.selectAll("circle").data(molecules),t.attr("cx",function(a){return k(a.x)}).attr("cy",function(a){return n(a.y)}).attr("r",function(a){return k(a.radius)})};var F=document.getElementById("lj-potential-chart"),G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X;layout.lj_redraw=function(){d3.event&&d3.event.transform&&isNaN(Q)&&isNaN(S)&&d3.event.transform(P,R);var a=P.tickFormat(10),b=R.tickFormat(10),c=V.selectAll("g.x").data(P.ticks(10),String).attr("transform",M);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",M);d.append("svg:line").attr("stroke",O).attr("y1",0).attr("y2",J.height),d.append("svg:text").attr("y",J.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(V[0][0]);Q=P.invert(b[0])}),c.exit().remove();var e=V.selectAll("g.y").data(R.ticks(10),String).attr("transform",N);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",N).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",O).attr("x1",0).attr("x2",J.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(V[0][0]);S=R.invert(b[1])}),e.exit().remove(),Z()},d3.select(F).on("mousemove",function(a){var b=d3.svg.mouse(V[0][0]);if(!isNaN(Q)){var c=P.invert(b[0]),d=P.domain()[0],e=P.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/Q,g=1+(Q/c-1)*(f/(Q-d))/h,i=[d,d+f*g],P.domain(i),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(S)){var j=R.invert(b[1]),k=R.domain()[1],l=R.domain()[0],m=l-k;if(j!==0){var n,o,p;o=m/S,n=1-(j/S-1)*(m/(S-k))/o,p=[k+m*n,k],R.domain(p),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(Q)||(layout.lj_redraw(),Q=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(S)||(layout.lj_redraw(),S=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),speed_distribution_chart=document.getElementById("speed-distribution-chart");var ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu;layout.speed_redraw=function(){d3.event&&d3.event.transform&&isNaN(speed_downx)&&isNaN(speed_downy)&&d3.event.transform(bj,bk);var a=bj.tickFormat(5),b=bk.tickFormat(5),c=bp.selectAll("g.y").data(bk.ticks(5),String).attr("transform",bh);c.select("text").text(b);var d=c.enter().insert("svg:g","a").attr("class","y").attr("transform",bh).attr("background-fill","#FFEEB6");d.append("svg:line").attr("stroke",bi).attr("x1",0).attr("x2",bd.width),d.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bp[0][0]);speed_downy=bk.invert(b[1]),speed_downscaley=bk.copy()}),c.exit().remove(),layout.speed_update()},layout.speed_update=function(){bv(),speed_kde=science.stats.kde().sample(bt),bj.domain([speed_graph.xmin,speed_graph.xmax]),speed_bins=d3.layout.histogram().frequency(!0).bins(bj.ticks(60))(bt),bl=(bd.width-speed_bins.length)/speed_bins.length,bn=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y}),bp.selectAll("g.bar").remove(),br=bp.selectAll("g.bar").data(speed_bins),br.enter().append("svg:g").attr("class","bar").attr("transform",function(a,b){return"translate("+bj(a.x)+","+(bf-bk(bo-a.y))+")"}).append("svg:rect").attr("class","bar").attr("fill","steelblue").attr("width",bl).attr("height",function(a){return bk(bo-a.y)})};var by=document.getElementById("start-benchmarks"),bz=document.getElementById("benchmarks-table"),bA=[{name:"molecules",run:function(){return mol_number}},{name:"temperature",run:function(){return temperature}},{name:"100 Steps (steps/s)",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}},{name:"100 Steps w/graphics",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick(),model_listener();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}}];by.onclick=function(){benchmark.run(bz,bA)},layout.datatable_visible=!1;var bB=document.getElementById("toggle-datatable"),bC=document.getElementById("datatable-table");layout.render_datatable=function(a){function i(){return bC.getElementsByTagName("tr").length==0}function j(a){a=a||"data";var b=bC.appendChild(document.createElement("tr"));return b.className=a,b}function k(a,b,c,d){c=c||"td",d=d||1;var e=a.appendChild(document.createElement(c));e.textContent=b,d>1&&(e.colSpan=d)}function l(a,b,c){c=c||"td";var d;d=-1;while(++d<b.length)k(a,b[d])}function m(a,b,c){c=c||"td";var d=a.getElementsByTagName(c),f=-1;while(++f<d.length)d[f].textContent=h[f](b[e[f]]);f--;while(++f<e.length)k(a,h[f](b[e[f]]))}function n(a,b){i()&&k(j("title"),a,"th"),k(results_row,b)}function o(a,b,c){c=c||1;var d;d=-1;while(++d<b.length)k(a,b[d],"th",c)}function p(a){var b=-1,c=d.length;while(++b<a)b>=d.length&&j();while(--c>=b)bC.removeChild(d[b]);return bC.getElementsByClassName("data")}function q(a,b){var c=-1;while(++c<b.length)k(a,b[c])}function r(a,b,c,d){var e;e=-1;while(++e<d.length)q(b[e],d[e])}bC=document.getElementById("datatable-table"),bC.style.display="none";var b,c=bC.getElementsByClassName("title"),d=bC.getElementsByClassName("data"),e=["index","px","py","x","y","vx","vy","ax","ay","speed","radius","mass","charge"],f=d3.format(" 2d"),g=d3.format(" 3.4f"),h=[f,g,g,g,g,g,g,g,g,g,g,g,f];a=a||!1;if(c.length==0){var s=j("title");o(s,e),d=p(molecules.length)}a&&(d=p(molecules.length)),b=-1;while(++b<molecules.length)m(d[b],molecules[b])},bB.onclick=function(){layout.datatable_visible?(layout.datatable_visible=!1,bB.textContent="Show Data Table",bC.style.display="none"):(layout.datatable_visible=!0,bB.textContent="Hide Data Table",layout.render_datatable(),bC.style.display="")};var bD=document.getElementById("select-temperature"),bE=document.createElement("span");layout.setupTemperature=function(){if(Modernizr.inputtypes.range){var a=document.createElement("input");a.type="range",a.min="0",a.max="10",a.step="0.5",a.value=+bD.value,bD.parentNode.replaceChild(a,bD),a.id="select-temperature",bD=a,bE.id="select-temperature-display",bE.innerText=temperature,bD.parentNode.appendChild(bE),bD=document.getElementById("select-temperature")}bD.onchange=bF},bD.type==="range"&&(bD.value=temperature,bE.innerText=d3.format("4.1f")(temperature)),layout.temperature_control_checkbox=document.getElementById("temperature-control-checkbox"),layout.temperature_control_checkbox.onchange=bG,layout.lennard_jones_forces_checkbox=document.getElementById("lennard-jones-forces-checkbox"),layout.lennard_jones_forces_checkbox.onchange=bH,layout.coulomb_forces_checkbox=document.getElementById("coulomb-forces-checkbox"),layout.coulomb_forces_checkbox.onchange=bI;var bJ=document.getElementById("stats");layout.displayStats=function(){var a=model.ke(),b=model.pe(),c=a+b;bJ.textContent="Time: "+d3.format("5.2f")(model.stepCounter()*sample_time)+" (ns), "+"KE: "+d3.format("1.4f")(a)+", "+"TE: "+d3.format("1.4f")(c)+", "+"Pressure: "+d3.format("6.3f")(model.pressure())+", "+"Rate: "+d3.format("5.1f")(model.get_rate())+" (steps/s)"};if(document.querySelectorAll){var bK=document.querySelector("#fullscreen");bK&&(bK.style.cursor="pointer",bK.addEventListener("click",function(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen,c=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen,d=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;b?c?d.call(document):b.call(a):alert("You'll need to use a newer browser to use the\nfull-screen API.\n\nChrome v15 (beta)\nhttp://www.google.com/landing/chrome/beta/\n\nChrome v17 Canary:\nhttp://tools.google.com/dlpage/chromesxs\n\nSafari v5.1.1:\n\nFireFox v9 Aurora:\nhttps://www.mozilla.org/en-US/firefox/channel/\n\nFireFox v10 Nightly\nhttp://nightly.mozilla.org/\nOpen 'about:config' and set: full-screen-api-enabled")},!1))}}(),function(){graphx={version:"0.0.1"},graphx.graph=function(a){function C(){e=d.clientWidth,f=d.clientHeight,g={top:graph.title?40:20,right:30,bottom:graph.xlabel?50:10,left:graph.ylabel?70:45},h={width:e-g.left-g.right,height:f-g.top-g.bottom},i=h.width,j=h.height,k=function(a){return"translate("+n(a)+",0)"},l=function(a){return"translate(0,"+r(a)+")"},m=function(a){return a?"#ccc":"#666"},n=d3.scale.linear().domain([graph.xmin,graph.xmax]).range([0,i]),p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),q=function(a){return"translate("+p(a)+",0)"},o=Math.NaN,r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([0,j]),t=d3.svg.line().x(function(a,b){return n(B[b].x)}).y(function(a,b){return r(B[b].y)}),s=Math.NaN,u=null,v=B[0];if(undefined!==z){var a=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;a&&(r=d3.scale.linear().domain([graph.ymax,graph.ymin]).range([j,0])),d3.select(d).select("svg").attr("width",e).attr("height",f),z.select("rect.plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE"),z.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height),graph.title&&z.select("text.title").attr("x",h.width/2).attr("dy","-1em"),graph.xlabel&&z.select("text.xlabel").attr("x",h.width/2).attr("y",h.height),graph.ylabel&&z.select("text.ylabel").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),z.selectAll("g.x").remove(),z.selectAll("g.y").remove(),M()}else z=d3.select(d).append("svg:svg").attr("width",e).attr("height",f).append("svg:g").attr("transform","translate("+g.left+","+g.top+")"),z.append("svg:rect").attr("class","plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().on("zoom",S)).on("mousedown",function(){d3.event.altKey&&(B.push(v=u=d3.svg.mouse(z.node())),O(),d3.event.preventDefault(),d3.event.stopPropagation())}),z.append("svg:svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height).append("svg:path").attr("class","line").attr("d",t(B)),w=z.select("path")[0][0],x=w.pathSegList,y=z.node(),A=document.createElementNS("http://www.w3.org/2000/svg","circle"),A.setAttribute("cx",1),A.setAttribute("cy",1),A.setAttribute("r",1),graph.title&&z.append("svg:text").attr("class","title").text(graph.title).attr("x",h.width/2).attr("dy","-1em").style("text-anchor","middle"),graph.xlabel&&z.append("svg:text").attr("class","xlabel").text(graph.xlabel).attr("x",h.width/2).attr("y",h.height).attr("dy","2.4em").style("text-anchor","middle"),graph.ylabel&&z.append("svg:g").append("svg:text").attr("class","ylabel").text(graph.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+h.height/2+") rotate(-90)"),L();S()}function D(a){B=T(a,0),O()}function F(a){var b=B.length;if(b===0)x;else{var c={x:b,y:a};B.push(c);var d=n.call(self,b,b),e=r.call(self,a,b);x.appendItem(w.createSVGPathSegLinetoAbs(d,e))}}function G(a){if(B.length==0)return;var b=B.length,d=n.call(self,b-1,b-1),e=r.call(self,B[b-1].y,b-1),f={x:b,y:a};B.push(f);var g=n.call(self,b,b),h=r.call(self,a,b);c.beginPath(),c.moveTo(d,e),c.lineTo(g,h),c.stroke()}function H(){b.width=b.width,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,b.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)"}function I(){x.clear(),b.style.zIndex=100}function J(){b.style.zIndex=-100,z.select("path.line").attr("d",t(B))}function K(){if(B.length==0)return;var a=n.call(self,0,0),d=r.call(self,B[0].y,0),e;H(),c.fillRect(0,0,b.width,b.height),c.beginPath(),c.moveTo
(a,d);for(e=0;e<B.length-1;e++)a=n.call(self,e,e),d=r.call(self,B[e].y,e),c.lineTo(a,d);c.stroke()}function L(){b=document.createElement("canvas"),d.appendChild(b),b.style.zIndex=-100,N(b)}function M(){N(b),K()}function N(a){var e={};e.rect=d.children[0].getElementsByTagName("rect")[0],e.width=e.rect.width.baseVal.value,e.height=e.rect.height.baseVal.value,e.left=e.rect.getCTM().e,e.top=e.rect.getCTM().f,a.style.position="absolute",a.width=e.width,a.height=e.height,a.offsetLeft=e.left,a.offsetTop=e.top,a.style.left=e.left+"px",a.style.top=e.top+"px",a.style.border="solid 1px red",c=b.getContext("2d"),c.globalCompositeOperation="source-over",c.lineWidth=1,c.fillStyle="rgba(0,255,0, 0.05)",c.fillRect(0,0,a.width,b.height),c.strokeStyle="rgba(255,65,0, 1.0)",b.style.border="solid 1px red"}function O(){var a,c,e,f,g,h=d.children[0].getElementsByTagName("rect")[0];if(b.style.zIndex==-100)var i=z.select("path").attr("d",t(B));K();if(graph.selectable_points){var j=z.selectAll("circle").data(B,function(a){return a});j.enter().append("svg:circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}).attr("r",1).on("mousedown",function(a){v=u=a,O()}),j.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return n(a.x)}).attr("cy",function(a){return r(a.y)}),j.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function P(){if(!u)return;d.onselectstart=function(){return!1};var a=d3.svg.mouse(z.node());u.x=n.invert(Math.max(0,Math.min(h.width,a[0]))),u.y=r.invert(Math.max(0,Math.min(h.height,a[1]))),O()}function Q(){if(!u)return;d.onselectstart=function(){return!0},P(),u=null}function R(){if(!v)return;switch(d3.event.keyCode){case 8:case 46:var a=B.indexOf(v);B.splice(a,1),v=B.length?B[a>0?a-1:0]:null,O()}}function S(){d3.event&&d3.event.transform&&isNaN(o)&&isNaN(s)&&d3.event.transform(n,r),graph.xmin=n.domain()[0],graph.xmax=n.domain()[1],graph.ymin=r.domain()[0],graph.ymax=r.domain()[1];var a=p.tickFormat(10),b=r.tickFormat(10),c=z.selectAll("g.x").data(p.ticks(10),String).attr("transform",q);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",q);d.append("svg:line").attr("stroke",m).attr("y1",0).attr("y2",h.height),d.append("svg:text").attr("y",h.height).attr("dy","1em").attr("text-anchor","middle").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);o=p.invert(b[0])}),c.exit().remove();var e=z.selectAll("g.y").data(r.ticks(10),String).attr("transform",l);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",l).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",m).attr("x1",0).attr("x2",h.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(z[0][0]);s=r.invert(b[1])}),e.exit().remove(),O()}function T(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f}graph={},graph.container=a.container||document.getElementById("chart"),graph.dataset=a.dataset||[0],graph.xmax=a.xmax||10,graph.xmin=a.xmin||0,graph.sample=a.sample||1,graph.ymax=a.ymax||10,graph.ymin=a.ymin||0,graph.title=a.title,graph.xlabel=a.xlabel,graph.ylabel=a.ylabel,graph.selectable_points=a.selectable_points||!1,graph.setup_graph=function(a){C()},graph.new_data=function(a){D(a),O()},graph.change_xaxis=function(a){n=d3.scale.linear().domain([0,a]).range([0,i]),graph.xmax=a,p=d3.scale.linear().domain([graph.xmin*graph.sample,graph.xmax*graph.sample]).range([0,i]),O(),K(),S()},graph.change_yaxis=function(a){r=d3.scale.linear().domain([a,0]).range([0,j]),graph.ymax=a,O(),K(),S()},graph.add_point=function(a){F(a)},graph.update=function(){O()},graph.add_canvas_point=function(a){G(a)},graph.initialize_canvas=function(){L()},graph.show_canvas=function(){I()},graph.hide_canvas=function(){J()},graph.clear_canvas=function(){H()},graph.update_canvas=function(){K()};var b,c,d,e,f,g={},h={},i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=T(graph.dataset,0);d=graph.container,C(),d3.select(d).on("mousemove",P).on("mouseup",Q).on("keydown",R);var E=function(){var a="",b=function(b,c,d){var e=a,f=-1,g=b.length,h=[],i;e.length===0&&(h.push("M",c.call(self,b[0].x,0),",",d.call(self,b[0].y,0)),f++);while(++f<g)h.push("L",c.call(self,b[f].x,f),",",d.call(self,b[f].y,f));return a+=h.join("")};return b}();return d3.select("body").on("mousemove",function(a){var b=d3.svg.mouse(z[0][0]);if(!isNaN(o)){var c=p.invert(b[0]),d=p.domain()[0],e=p.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/o,g=1+(o/c-1)*(f/(o-d))/h,i=[d,d+f*g],p.domain(i),graph.sample!==1&&n.domain([i[0]/graph.sample,i[1]/graph.sample]),S()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(s)){var j=r.invert(b[1]),k=r.domain()[1],l=r.domain()[0],m=l-k;if(j!==0){var q,t,u;t=m/s,q=(j-k)/(s-k)*(m/(s-k))/t,u=[k+m*1/q,k],k>0&&(u[0]+=k),r.domain(u),S()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(o)||(S(),o=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(s)||(S(),s=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),graph}}();