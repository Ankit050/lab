(function(){molecules_coulomb={},molecules_coulomb={version:"0.0.1"};var a=-50;molecules_coulomb.force=function(b,c,d){return a*(c*d/(b*b))},molecules_coulomb.energy=function(b,c,d){return-a*(c*d/b)},molecules_lennard_jones={},molecules_lennard_jones={version:"0.0.1"};var b=-1,c=4,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6);molecules_lennard_jones.epsilon=function(a){return molecules_lennard_jones.coefficients(a,c)},molecules_lennard_jones.sigma=function(a){return molecules_lennard_jones.coefficients(b,a)},molecules_lennard_jones.coefficients=function(a,g){arguments.length&&(b=a,c=g,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6));var h={epsilon:b,sigma:c,rmin:d,alpha:e,beta:f};return h},molecules_lennard_jones.potential=function(a){return(e/Math.pow(a,12)-f/Math.pow(a,6))*-1},molecules_lennard_jones.force=function(a){return 12*e/Math.pow(a,13)-6*f/Math.pow(a,7)},modeler={},modeler.layout={},modeler.VERSION="0.1.0",modeler.layout.model=function(){function bs(a){var b={};return b.index=a,b.radius=br[be][a],b.px=br[bf][a],b.py=br[bg][a],b.x=br[bh][a],b.y=br[bi][a],b.vx=br[bj][a],b.vy=br[bk][a],b.speed=br[bl][a],b.ax=br[bm][a],b.ay=br[bn][a],b.mass=br[bo][a]*2,b.charge=br[bp][a],b}function bt(){var a,b=mol_number,c=[];a=-1;while(++a<b)molecules[a]=bs(a);molecules.length=b}function bu(a){return.005*Math.pow(Math.E/2,a)}function bv(){var a,b;for(a=0;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>F){I=a;break}}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>G)break}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b<G){H=a;break}}}function bw(){var a,b;for(a=.001;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<J){M=a;break}}for(;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<K)break}L=a}function bx(){var a=br[0].length,b,g,i,o,p,q,r,p,s,t,v,w,x,y,z,A,B,C,D,E,G=V[0],I=V[0],K=c[0]-V[0],M=c[1]-V[0];R=0,E=-1;while(++E<N){g=-1;while(++g<a)C=Y[g],D=Z[g],Y[g]+=$[g]*O+.5*P*bb[g],Z[g]+=_[g]*O+.5*P*bc[g],$[g]+=.5*O*bb[g],_[g]+=.5*O*bc[g],z=Y[g]-C,A=Z[g]-D,q=Math.sqrt(z*z+A*A),ba[g]=q,Y[g]<G?(Y[g]=G+(G-Y[g]),W[g]=Y[g]+z,X[g]=D,$[g]*=-1,R+=ba[g]):Y[g]>K?(Y[g]=K+(K-Y[g]),W[g]=Y[g]+z,X[g]=D,$[g]*=-1,R+=ba[g]):Z[g]<I?(Z[g]=I+(I-Z[g]),X[g]=Z[g]+A,W[g]=C,_[g]*=-1,R+=ba[g]):Z[g]>M?(Z[g]=M+(M-Z[g]),X[g]=Z[g]+A,W[g]=C,_[g]*=-1,R+=ba[g]):(W[g]=C,X[g]=D);g=-1;while(++g<a)bb[g]=0,bc[g]=0;if(e||f){g=-1;while(++g<a){i=g;while(++i<a)z=Y[i]-Y[g],A=Z[i]-Z[g],s=z*z+A*A,q=Math.sqrt(s),e&&q<H&&(v=Math.max(F,molecules_lennard_jones.force(q)),x=z/q*v,y=A/q*v,bb[g]+=x,bc[g]+=y,bb[i]-=x,bc[i]-=y),f&&q<L&&(w=Math.min(J,molecules_coulomb.force(q,u[g],u[i])),h+=molecules_coulomb.energy(q,u[g],u[i]),x=z/q*w,y=A/q*w,bb[g]+=x,bc[g]+=y,bb[i]-=x,bc[i]-=y)}}if(d){j=bM(),m=k*1.1,n=k*.9,speed_max=k*2,speed_max_one_percent=speed_max*.01,speed_min=k*.5,speed_min_one_percent=speed_min*.01,g=-1;while(++g<a)j>m?(bb[g]*=.5,bc[g]*=.5,ba[g]>speed_max&&(l=speed_max/ba[g],$[g]*=l,_[g]*=l,ba[g]=speed_max-Math.random()*speed_max_one_percent,W[g]=Y[g]-$[g],X[g]=Z[g]-_[g])):j<n&&(bb[g]*=2,bc[g]*=2,ba[g]<speed_min&&(l=speed_min/ba[g],$[g]*=l,_[g]*=l,ba[g]=speed_min+Math.random()*speed_min_one_percent,W[g]=Y[g]-$[g],X[g]=Z[g]-_[g]))}g=-1;while(++g<a)$[g]+=.5*O*bb[g],_[g]+=.5*O*bc[g]}}function by(){return bx(),S.push(R),S.splice(0,S.length-16),bJ(),bt(),bB(),r||(t=Date.now(),T?(T=t-T,T&&U.push(T),T=t,U.splice(0,U.length-128)):T=t,b.tick({type:"tick"})),r}function bz(){y=[],z=0,A=-1}function bA(){y.length=z+1}function bB(){var a,b,c,d=[],e=br.length;a=-1;while(++a<e)d[a]=arrays.clone(br[a]);y.length=z,z++,A++,B=!0,y.push({nodes:d,ke:g}),z>1e3&&(y.splice(0,1),z=1e3)}function bC(a){var b,c=br.length;if(a<0)throw new Error("modeler: request for tick_history_list["+a+"]");if(a>=y.length)throw new Error("modeler: request for tick_history_list["+a+"], tick_history_list.length="+y.length);b=-1;while(++b<c)arrays.copy(y[a].nodes[b],br[b]);g=y[a].ke,bt()}function bD(a){var b,c,d=br[0].length;b=-1;while(++b<d)c=a/ba[b],$[b]=(Y[b]-W[b])*c,_[b]=(Z[b]-X[b])*c,W[b]+=$[b],X[b]+=_[b],ba[b]=a}function bE(a){var b,c=br[0].length;b=-1;while(++b<c)$[b]=(Y[b]-W[b])*a,_[b]=(Z[b]-X[b])*a,W[b]+=$[b],X[b]+=_[b],ba[b]*-a}function bF(a){var b,c,d=br[0].length;b=-1;while(++b<d)ba[b]>a&&(c=a/ba[b],$[b]=(Y[b]-W[b])*c,_[b]=(Z[b]-X[b])*c,W[b]+=$[b],X[b]+=_[b],ba[b]=a)}function bG(a){var b,c=br[0].length;b=-1;while(++b<c)bb[b]=a,bc[b]=a}function bH(){return S.reduce(function(a,b){return a+b})/S.length}function bI(a){if(arguments.length)bI.push(a),bI.splice(0,bI.length-100);else return bI.reduce(function(a,b){return a+b})/S.length}function bJ(){var a,b,c,d,e,f,i=br[0].length;g=0,h=0,a=-1;while(++a<i)b=ba[a],c=b*b*bd[a],g+=c,d=bb[a],e=bc[a],f=d+d,h+=f}function bK(){var a,b,c,d,e=br[0].length;h=0,a=-1;while(++a<e)b=bb[a],c=bc[a],d=Math.sqrt(b*b+c*c),h+=d;return h}function bL(){var a,b,c,d=br[0].length;g=0,a=-1;while(++a<d)b=ba[a],c=b*b*bd[a],g+=c;return g}function bM(){var a,b=0,c=br[0].length;a=-1;while(++a<c)b+=ba[a];return b/c}function bN(){var a,b,c=0,d=U.length;a=-1;while(++a<d)c+=U[a];return b=c/d,b?1/b*1e3:0}function bO(a){var b;save_temperature_control=d,d=!0,b=-1;while(++b<a)bx();d=save_temperature_control,bt()}function bP(a){temperature=a,k=bu(temperature)}var a={},b=d3.dispatch("tick"),c=[1,1],d,e=!0,f=!0,g,h,j,k,l,m,n,o,p,q,r=!0,s=.9,u=-0.1,v=.1,w=.8,x,y=[],z=0,A=0,B=!1,C,D,E,F=-200,G=.001,H,I,J=20,K=.01,L,M,N=50,O=1/N,P=O*O,Q,R,S=[0],T,U=[],V,W,X,Y,Z,$,_,ba,bb,bc,bd,u,be=0,bf=1,bg=2,bh=3,bi=4,bj=5,bk=6,bl=7,bm=8,bn=9,bo=10,bp=11;a.RADIUS=0,a.PX=1,a.PY=2,a.X=3,a.Y=4,a.VX=5,a.VY=6,a.SPEED=7,a.AX=8,a.AY=9,a.HALFMASS=10,a.CHARGE=11;var bq=11,br=arrays.create(bq,null,"regular");return a.getStats=function(){var a;return a={speed:bM(),ke:g,temperature:temperature,pressure:bH(),current_step:A,steps:y.length-1},a},a.stepCounter=function(){return A},a.steps=function(){return y.length-1},a.isNewStep=function(){return B},a.stepBack=function(){return r=!0,B=!1,z>1&&(z--,A--,bC(z-1),model_listener()),A},a.stepForward=function(){return r=!0,z<y.length?(bC(z),z++,A++,model_listener()):(by(),model_listener()),A},a.on=function(c,d){return b.on(c,d),a},a.tickInPlace=function(){return b.tick({type:"tick"}),a},a.tick=function(){return by(),a},a.set_lj_coefficients=function(b,c){return D=b,E=c,bv(),a},a.set_radius=function(a){var b,c=br[0].length;b=-1;while(++b<c)V[b]=a;bt()},a.get_speed=function(a){if(!arguments.length)var a=[];return arrays.copy(ba,a)},a.get_rate=function(){return bN()},a.set_temperature_control=function(a){d=a},a.set_lennard_jones_forces=function(a){e=a},a.set_coulomb_forces=function(a){f=a},a.initialize=function(b,d){var e,f,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=br[0].length,G=c[0],H=c[1],I=4,J=b,K=d,L=25,M,N,O,P,Q;return bs,bt,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bK,bL,bM,bO,bP,bz(),M=bu(I),bv(),bw(),bO(L),j=bM(),g=bL(),h=bK(),bB(),a},a.nodes=function(b,c,d,e,f,g){var h;br=arrays.create(bq,null,"regular");var j=!!window.WebGLRenderingContext,k=benchmark.what_browser.browser!="Safari",l=j&&k?"Float32Array":"regular";br[a.RADIUS]=arrays.create(b,f*g,l),V=br[a.RADIUS],br[a.PX]=arrays.create(b,0,l),W=br[a.PX],br[a.PY]=arrays.create(b,0,l),X=br[a.PY],br[a.X]=arrays.create(b,0,l),Y=br[a.X],br[a.Y]=arrays.create(b,0,l),Z=br[a.Y],br[a.VX]=arrays.create(b,0,l),$=br[a.VX],br[a.VY]=arrays.create(b,0,l),_=br[a.VY],br[a.SPEED]=arrays.create(b,0,l),ba=br[a.SPEED],br[a.AX]=arrays.create(b,0,l),bb=br[a.AX],br[a.AY]=arrays.create(b,0,l),bc=br[a.AY],br[a.HALFMASS]=arrays.create(b,.5,l),bd=br[a.HALFMASS],br[a.CHARGE]=arrays.create(b,0,l),u=br[a.CHARGE],i=-1;while(++i<b)W[i]=Math.random()*c*.8+c*.1,X[i]=Math.random()*d*.8+d*.1,Y[i]=W[i]+Math.random()*e/100-e/200,Z[i]=X[i]+Math.random()*e/100-e/200,$[i]=Y[i]-W[i],_[i]=Z[i]-X[i],ba[i]=Math.sqrt($[i]*$[i]+_[i]*_[i]),bb[i]=0,bc[i]=0,u[i]=Math.random()>.5?1:-1;return bt(),a},a.start=function(){return a.initialize(),a.resume()},a.resume=function(){return r=!1,d3.timer(by),a},a.stop=function(){return r=!0,a},a.ke=function(){return g=g||bL(),g},a.pe=function(){return h=h||bK(),h},a.speed=function(){return bM()},a.pressure=function(){return bH()},a.temperature=function(b){return arguments.length?(bP(b),a):temperature},a.links=function(b){return arguments.length?(links=b,a):links},a.size=function(b){return arguments.length?(c=b,a):c},a.linkDistance=function(b){return arguments.length?(linkDistance=d3.functor(b),a):linkDistance},a.linkStrength=function(b){return arguments.length?(linkStrength=d3.functor(b),a):linkStrength},a.friction=function(b){return arguments.length?(s=b,a):s},a.charge=function(b){return arguments.length?(u=typeof b=="function"?b:+b,a):u},a.gravity=function(b){return arguments.length?(v=b,a):v},a.theta=function(b){return arguments.length?(w=b,a):w},a}})();