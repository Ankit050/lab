(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.modelController=function(e,t,n){function w(){y.update_drawable_positions()}function E(){s=n.layoutStyle,o=n.controlButtons,f=t.elements,l=t.atoms,c=t.mol_number,h=t.temperature_control,p=t.temperature,d=t.width,v=t.height,m=t.radialBonds,g=t.obstacles}function S(){u=!1,a=!1,o.length===1&&o[0]==="play"?u=!0:o.length>1&&(a=!0)}function x(){E(),S(),model=modeler.model({elements:f,temperature:p,temperature_control:h,width:d,height:v});if(l)model.createNewAtoms(l);else{if(!c)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(c),model.relax()}m&&model.createRadialBonds(m),g&&model.createObstacles(g),i.modelReset()}function T(){model_player=new ModelPlayer(b,!1),model_player.forward=function(){},model_player.back=function(){},y=Lab.moleculeContainer(e,{xmax:d,ymax:v,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},play_only_controller:u,playback_controller:a}),y.updateMoleculeRadius(),y.setup_drawables()}function N(){y.reset({xmax:d,ymax:v,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},play_only_controller:u,playback_controller:a})}function C(){model.resetTime(),model.stop(),model.on("tick",w)}function k(e){x(),C(),e?T():N()}function L(e,r){t=e,n=r,k(!1)}var r={},i=d3.dispatch("modelReset"),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b={resume:function(){model.resume()},stop:function(){model.stop()},seek:function(e){e===1&&L(t,n)}};if(typeof DEVELOPMENT=="undefined")try{k(!0)}catch(A){throw alert(A),new Error(A)}else k(!0);return r.on=function(e,t){i.on(e,t)},r.reload=L,r},controllers.interactivesController=function(e,t){function f(e){var t={controlButtons:u};$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,r?r.reload(e,t):(r=controllers.modelController("#molecule-container",e,t),m(),r.on("modelReset",m))})}function l(e){switch(e.type){case"button":return h(e);case"thermometer":return p(e)}}function c(e){var t,n,r,i;n=[],r=[];for(t in a)a.hasOwnProperty(t)&&(n.push(t),r.push(a[t]));return i="'use strict';"+e,function(){var t,s,o,u;s=[];for(t in window)window.hasOwnProperty(t)&&!a.hasOwnProperty(t)&&s.push(t);o=n.concat(s).concat(i);try{u=Function.apply(null,o)}catch(f){alert('Error compiling script: "'+f.toString()+'"\nScript:\n\n'+e)}try{u.apply(null,r)}catch(f){alert('Error running script: "'+f.toString()+'"\nScript:\n\n'+e)}}}function h(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),typeof e.action=="string"?n=e.action:n=e.action.join("\n"),t.click(c(n)),t}function p(e){var t=$("<div>").attr("id",e.id);return o=new Thermometer(t,null,e.min,e.max),v(["temperature"],d),$('<div class="interactive-thermometer">').append(t).append($('<p class="label">').text("Thermometer"))}function d(){o.add_value(model.get("temperature"))}function v(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):s.push([e,t])}function m(){var e,t;for(e=0;e<s.length;e++)t=s[e],model.addPropertiesListener(t[0],t[1]);o&&(o.resize(),d())}function g(e){e.controlButtons&&(u=e.controlButtons)}function y(t,n){var r,s,o={},u,a,c,h,p,d,v,m;e=t,i=$(n),i.children().length===0?(p=$('<div class="interactive-top" id="top"/>'),p.append('<div id="molecule-container"/>'),d=$('<div id="right"/>'),p.append(d),i.append(p),i.append('<div class="interactive-bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),i.append('<div id="bottom"/>')),typeof e.model=="string"?r=e.model:e.model!=null&&(r=e.model.url,g(e.model.viewOptions)),r&&f(r),s=e.components;for(v=0,m=s.length;v<m;v++)u=l(s[v]),o[s[v].id]=u;if(e.layout)for(c in e.layout)if(e.layout.hasOwnProperty(c)){a=e.layout[c];for(v=0,m=a.length;v<m;v++)h=a[v],o[h]&&($("#"+c).append(o[h]),delete o[h])}for(h in o)o.hasOwnProperty(h)&&$("#bottom").append(o[h])}var n={},r,i,s=[],o,u=["play"],a={addAtom:function(){return model.addAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},adjustTemperature:function(t){model.set({temperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("temperature")>t&&model.set({temperature:t})},alert:alert,console:window.console!=null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}};return y(e,t),n.loadInteractive=y,n},controllers.compareModelsController=function(e,t,n,r,i){function I(){function r(e){E.update_drawable_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}y&&model.createRadialBonds(y),b&&model.createObstacles(b)}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),E=layout.moleculeContainer(e,{playback_controller:!1,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),E.updateMoleculeRadius(),E.setup_drawables(),_=M(),_?O={params:[["script","page:0:import /imports/legacy-mw-content/"+_]]}:O={},A=layout.appletContainer(t,O),layout.addView("moleculeContainers",E),layout.addView("appletContainers",A),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function S(){model.stop(),model.stepBack()}function T(){model.stop(),model.stepForward()}function N(){model.stop(),i(),k(),r()}function k(){w=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),x=model.stepCounter()}function L(){return F=document.location.hash,F.length>0?F.substr(1,F.length):!1}function M(){var e=L();return e?j[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function q(){var e=L();e?B.value=e.replace("/imports/legacy-mw-content/",""):B.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function R(){var e,t,n,r,i;j={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],j[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function U(){R(),d3.select(B).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),q()}function z(e){return A.applet.runMwScript(e)}function W(){var e=$(B).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");C=t+n,document.location.hash="#"+C}function X(){M()&&(O={params:[["script","page:0:import "+M()]]},A=layout.appletContainer(t,O),z("page:0:set frank false"),layout.setView("appletContainers",[A]),layout.setupScreen())}function V(){layout.setupScreen()}function J(){U(),i(),k(),u(),q()}B=document.getElementById(n),D=document.getElementById("start"),D.onclick=function(){z("mw2d:1:run"),f()},P=document.getElementById("stop"),P.onclick=function(){z("mw2d:1:stop"),a()},H=document.getElementById("reset"),H.onclick=function(){z("mw2d:1:reset"),N()},B.onchange=W,document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();I.runMWScript=z}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y=r.radialBonds,b=r.obstacles,w,E,S,x,T,N,C,k,L,A,O={},M,_,D,P,H,B,j,F;return I(),I}})();