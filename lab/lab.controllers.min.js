(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.modelController=function(e,t,n){function T(){S.update_drawable_positions()}function N(){s=n.controlButtons,o=n.modelTimeLabel,a=n.enableAtomTooltips||!1,u=n.fit_to_parent,f=t.elements,l=t.atoms,c=t.mol_number,h=t.temperature_control,p=t.temperature,d=t.width,v=t.height,m=t.chargeShading,g=t.showVDWLines,y=t.radialBonds,b=t.obstacles,w=t.viscosity,E=t.gravitationalField}function C(){N(),model=modeler.model({elements:f,temperature:p,temperature_control:h,width:d,height:v,chargeShading:m,showVDWLines:g,viscosity:w,gravitationalField:E});if(l)model.createNewAtoms(l);else{if(!c)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(c),model.relax()}y&&model.createRadialBonds(y),g&&model.createVdwPairs(l),b&&model.createObstacles(b),i.modelReset()}function k(){model_player=new ModelPlayer(x,!1),model_player.forward=function(){},model_player.back=function(){},S=Lab.moleculeContainer(e,{fit_to_parent:u,xmax:d,ymax:v,chargeShading:m,enableAtomTooltips:a,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},get_vdw_pairs:function(){return model.get_vdw_pairs()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:s,modelTimeLabel:o}),S.updateMoleculeRadius(),S.setup_drawables()}function L(){S.reset({fit_to_parent:u,xmax:d,ymax:v,chargeShading:m,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_vdw_pairs:function(){return model.get_vdw_pairs()},get_obstacles:function(){return model.get_obstacles()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:s,modelTimeLabel:o}),S.updateMoleculeRadius(),S.setup_drawables()}function A(){model.resetTime(),model.stop(),model.on("tick",T)}function O(e){C(),A(),e?k():L()}function M(e,r){t=e||t,n=r||n,O(!1)}var r={},i=d3.dispatch("modelReset"),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x={resume:function(){model.resume()},stop:function(){model.stop()},reset:function(){model.stop(),M(t,n)},is_stopped:function(){return model.is_stopped()}};if(typeof DEVELOPMENT=="undefined")try{O(!0)}catch(_){throw alert(_),new Error(_)}else O(!0);return r.on=function(e,t){i.on(e,t)},r.reload=M,r.moleculeContainer=S,r},controllers.interactivesController=function(e,t,n,r){function d(e){e=ACTUAL_ROOT+e,$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,s?s.reload(e,a):(s=controllers.modelController("#molecule-container",e,a),L(),s.on("modelReset",L))})}function v(e){switch(e.type){case"button":return y(e);case"pulldown":return b(e);case"thermometer":return w(e);case"energyGraph":return x(e)}}function m(e){var t,n,r,i;n=[],r=[];for(t in p)p.hasOwnProperty(t)&&(n.push(t),r.push(p[t]));return i="'use strict';"+e,function(){var t,s,o,u;s=[];for(t in window)window.hasOwnProperty(t)&&!p.hasOwnProperty(t)&&s.push(t);o=n.concat(s).concat(i);try{u=Function.apply(null,o)}catch(a){alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+e)}try{u.apply(null,r)}catch(a){alert('Error running script: "'+a.toString()+'"\nScript:\n\n'+e)}}}function g(e){return typeof e=="string"?e:e.join("\n")}function y(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),t.addClass("component"),n=g(e.action),t.click(m(n)),{elem:t}}function b(e){var t,n,r=e.options||[],i,s,o;t=$("<select>").attr("id",e.id),t.addClass("component");for(s=0,o=r.length;s<o;s++)i=r[s],n=$("<option>").html(i.text),i.disabled&&n.attr("disabled",i.disabled),i.selected&&n.attr("selected",i.selected),t.append(n);return t.change(function(){var t=$(this).prop("selectedIndex"),n=e.options[t].action,r;n?(r=g(n),m(r)()):e.options[t].loadModel&&(model.stop(),d(e.options[t].loadModel))}),{elem:t}}function w(e){var t=$("<div>").attr("id",e.id);return l=new Thermometer(t,null,e.min,e.max),S(["temperature"],E),{elem:$('<div class="interactive-thermometer">').append(t).append($('<p class="label">').text("Thermometer")),callback:function(){l.resize(),E()}}}function E(){l.add_value(model.get("temperature"))}function S(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):u.push([e,t])}function x(e){var t=$("<div>").attr("id",e.id);return{elem:t,callback:function(){var t=e,n={title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:100,sample:.1,ylabel:"eV",ymin:-5,ymax:5};k(),c||($.extend(n,t.options||[]),T(t.id,n)),t.dimensions&&c.resize(t.dimensions.width,e.dimensions.height),model.on("tick.energyGraph",N),model.on("play.energyGraph",function(){c.number_of_points()&&model.stepCounter()<c.number_of_points()&&(k(model.stepCounter()),c.new_data(h)),c.show_canvas()}),model.on("reset.energyGraph",function(){k(),c.new_data(h),c.reset()}),model.on("seek.energyGraph",function(){var e=model.stepCounter();e>0?k(e):k(),c.new_data(h)})}}}function T(e,t){t=t||{},t.dataset=h,c=grapher.realTimeGraph("#"+e,t)}function N(){c.add_points(C())}function C(){var e=model.ke(),t=model.pe(),n=e+t;return h[0].push(e),h[1].push(t),h[2].push(n),[e,t,n]}function k(e){var t=model.stepCounter(),n,r;if(e){for(n=0,r=h.length;n<r;n++)h[n].length=t;return e}return h=[[0],[0],[0]],0}function L(){var e,t;r&&(layout.selection=r,layout.addView("moleculeContainers",s.moleculeContainer),l&&layout.addView("thermometers",l),layout.setupScreen(),$(window).unbind("resize"),$(window).on("resize",layout.setupScreen));for(e=0;e<u.length;e++)t=u[e],model.addPropertiesListener(t[0],t[1]);for(e=0;e<f.length;e++)f[e]();if(n)for(e=0;e<n.length;e++)n[e]()}function A(t,n){var i,s,u={},l,c,h,p,m,g,y,b;f=[],e=t,o=$(n),o.children().length===0?(m=$('<div class="interactive-top" id="top"/>'),m.append('<div id="molecule-container"/>'),g=$('<div id="right"/>'),m.append(g),o.append(m),o.append('<div class="interactive-bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),o.append('<div id="bottom"/>')),e.model!=null&&(i=e.model.url,e.model.viewOptions?a=e.model.viewOptions:a={controlButtons:"play"},a.fit_to_parent=!r),i&&d(i),s=e.components||[];for(y=0,b=s.length;y<b;y++)l=v(s[y]),u[s[y].id]=l;if(e.layout)for(h in e.layout)if(e.layout.hasOwnProperty(h)){c=e.layout[h];for(y=0,b=c.length;y<b;y++)p=c[y],u[p]&&($("#"+h).append(u[p].elem),u[p].callback&&f.push(u[p].callback),delete u[p])}for(p in u)u.hasOwnProperty(p)&&$("#bottom").append(u[p].elem);$("#right").children().length>0?$(".interactive-top").addClass("push-right"):$(".interactive-top").removeClass("push-right")}var i={},s,o,u=[],a,f=[],l,c,h=[[],[],[]],p={getRadialBond:function(t){return[model.get_radial_bonds()[0][t],model.get_radial_bonds()[1][t],model.get_radial_bonds()[2][t],model.get_radial_bonds()[3][t]]},setRadialBond:function(t,n){model.get_radial_bonds()[0][t]=n[0],model.get_radial_bonds()[1][t]=n[1],model.get_radial_bonds()[2][t]=n[2],model.get_radial_bonds()[3][t]=n[3]},addAtom:function(){return model.addAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},adjustTemperature:function(t){model.set({temperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("temperature")>t&&model.set({temperature:t})},loadModel:function(t){model.stop(),i.loadModel(t)},setAtomProperties:function(t,n,r,i){return model.setAtomProperties(t,n,r,i)},getAtomProperties:function(t){var n={},r=model.get_nodes(),i;for(i in model.ATOM_PROPERTIES)model.ATOM_PROPERTIES.hasOwnProperty(i)&&(n[model.ATOM_PROPERTIES[i]]=r[model.INDICES[i]][t]);return n},start:function(){model.start()},stop:function(){model.stop()},reset:function(){model.stop(),s.reload()},tick:function(){model.tick()},repaint:function(){s.moleculeContainer.update_drawable_positions()},alert:alert,console:window.console!=null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}};return A(e,t),i.loadInteractive=A,i.loadModel=d,i},controllers.compareModelsController=function(e,t,n,r,i){function I(){function r(e){E.update_drawable_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}y&&model.createRadialBonds(y),b&&model.createObstacles(b)}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),E=layout.moleculeContainer(e,{control_buttons:"",modelTimeLabel:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},get_radial_bonds:function(){return model.get_radial_bonds()}}),E.updateMoleculeRadius(),E.setup_drawables(),_=M(),_?O={params:[["script","page:0:import /imports/legacy-mw-content/"+_]]}:O={},A=layout.appletContainer(t,O),layout.addView("moleculeContainers",E),layout.addView("appletContainers",A),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function S(){model.stop(),model.stepBack()}function T(){model.stop(),model.stepForward()}function N(){model.stop(),i(),k(),r()}function k(){w=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),x=model.stepCounter()}function L(){return F=document.location.hash,F.length>0?F.substr(1,F.length):!1}function M(){var e=L();return e?j[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function q(){var e=L();e?B.value=e.replace("/imports/legacy-mw-content/",""):B.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function R(){var e,t,n,r,i;j={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],j[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function U(){R(),d3.select(B).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),q()}function z(e){return A.applet.runMwScript(e)}function W(){var e=$(B).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");C=t+n,document.location.hash="#"+C}function X(){M()&&(O={params:[["script","page:0:import "+M()]]},A=layout.appletContainer(t,O),z("page:0:set frank false"),layout.setView("appletContainers",[A]),layout.setupScreen())}function V(){layout.setupScreen()}function J(){U(),i(),k(),u(),q()}B=document.getElementById(n),D=document.getElementById("start"),D.onclick=function(){z("mw2d:1:run"),f()},P=document.getElementById("stop"),P.onclick=function(){z("mw2d:1:stop"),a()},H=document.getElementById("reset"),H.onclick=function(){z("mw2d:1:reset"),N()},B.onchange=W,document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();I.runMWScript=z}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y=r.radialBonds,b=r.obstacles,w,E,S,x,T,N,C,k,L,A,O={},M,_,D,P,H,B,j,F;return I(),I}})();