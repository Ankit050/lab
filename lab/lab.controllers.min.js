(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.simpleModelController=function(a,b,c){function w(){function b(){model=modeler.model({elements:i,model_listener:r,temperature:m,lennard_jones_forces:!0,coulomb_forces:n,temperature_control:l,width:o,height:p});if(j)model.createNewAtoms(j);else{if(!k)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(k),model.relax()}}function c(){layout.selection=d,model_player=new ModelPlayer(model,e),q=layout.moleculeContainer(a,{xmax:o,ymax:p}),q.updateMoleculeRadius(),q.setup_particles(),t=new Thermometer("#thermometer",model.temperature(),200,4e3),model.addPropertiesListener(["temperature"],h),t.resize(),h(),layout.heatCoolButtons("#heat_button","#cool_button",0,3800,model,function(a){t.add_value(a)}),model.addPropertiesListener(["coulomb_forces"],g),g(),v={moleculeContainers:[q],thermometers:[t]},layout.setupScreen(v)}function g(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),q.setup_particles()}function h(){t.add_value(model.get("temperature"))}function u(){model.stop()}function w(){model.on("tick",r),(!Number(f)||model.stepCounter()<f)&&model.resume()}function x(){u(),model.stepBack()}function y(){(!Number(f)||model.stepCounter()<f)&&model.stepForward()}function z(){atoms=model.get_atoms(),nodes=model.get_nodes(),model.resetTime(),u(),model.on("tick",r),s=model.stepCounter()}function A(){layout.setupScreen(v),t.resize(),h()}function B(a){a=a?a:window.event?event:null;if(a)switch(a.keyCode){case 32:model.is_stopped()?q.playback_component.action("play"):q.playback_component.action("stop"),a.preventDefault();break;case 13:q.playback_component.action("play"),a.preventDefault();break;case 37:model.is_stopped()||q.playback_component.action("stop"),x(),a.preventDefault();break;case 39:model.is_stopped()||q.playback_component.action("stop"),y(),a.preventDefault()}}r=function(a){q.update_molecule_positions(),s>=model.stepCounter()&&u()},document.onwebkitfullscreenchange=A,window.onresize=A,document.onkeydown=B;try{b(),z(),c()}catch(C){throw alert(C),new Error(C)}e&&w()}var d=c.layoutStyle,e=c.autostart,f=c.maximum_model_steps,g=c.lj_epsilon_max,h=c.lj_epsilon_min,i=b.elements,j=b.atoms,k=b.mol_number,l=b.temperature_control,m=b.temperature,n=b.coulomb_forces,o=b.width,p=b.height,q,r,s,t,u,v;return w(),w},controllers.compareModelsController=function(a,b,c,d){function I(){function d(a){r.update_molecule_positions()}function g(){model=modeler.model({elements:j,model_listener:d,temperature:n,lennard_jones_forces:!0,coulomb_forces:o,temperature_control:m,width:p,height:q});if(k)model.createNewAtoms(k);else{if(!l)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(l),model.relax()}}function h(){layout.selection=e,model_player=new ModelPlayer(model,f),r=layout.moleculeContainer(a,{playback_controller:!1,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:p,ymax:q}),r.updateMoleculeRadius(),r.setup_particles(),B=I(document.location.hash),B?z={params:[["script","page:0:import "+B]]}:z={},y=layout.appletContainer(b,z),w={moleculeContainers:[r],appletContainers:[y]},layout.setupScreen(w)}function i(){model.stop()}function s(){model.on("tick",d),model.resume()}function u(){model.stop(),model.stepBack()}function v(){model.stop(),model.stepForward()}function x(){model.stop(),g(),A(),d()}function A(){atoms=model.get_atoms(),nodes=model.get_nodes(),model.resetTime(),i(),model.on("tick",d),t=model.stepCounter()}function I(a){var b=/#*(.*?)(\$.*|\.json$)/,c;return c=b.exec(a)[1],c?c.replace("/converted","")+".cml":!1}function J(a){var b=/#*\/imports\/legacy-mw-content\/converted\/(.*?)\.json$/,c;return c=b.exec(a)[1],c?c:!1}function K(a){return y.applet.runMwScript(a)}function L(){var a="/imports/legacy-mw-content/converted/"+F.value+".json",b=I(a);document.location.hash="#"+a,z.params=[["script","page:0:import "+b]],$.get(a).done(function(a){G=a,H.resolve()}).fail(function(){$("#flash").html('<p class="error-message">Could not load config '+document.location.hash+"</p>"),H.resolve()})}function M(){F.value=J(document.location.hash),K("page:0:set %frank false")}function N(){layout.setupScreen(w)}function O(a){a=a?a:window.event?event:null;if(a)switch(a.keyCode){case 32:model.is_stopped()?r.playback_component.action("play"):r.playback_component.action("stop"),a.preventDefault();break;case 13:r.playback_component.action("play"),a.preventDefault();break;case 37:model.is_stopped()||r.playback_component.action("stop"),u(),a.preventDefault();break;case 39:model.is_stopped()||r.playback_component.action("stop"),v(),a.preventDefault()}}C=document.getElementById("start"),C.onclick=function(){K("mw2d:1:run"),s()},D=document.getElementById("stop"),D.onclick=function(){K("mw2d:1:stop"),i()},E=document.getElementById("reset"),E.onclick=function(){K("mw2d:1:reset"),x()},F=document.getElementById("model-select"),$.when(H).done(function(a){$.extend(c,G),x()}),F.onchange=L,document.onwebkitfullscreenchange=N,window.onresize=N,document.onkeydown=O;try{g(),A(),h(),M()}catch(P){throw alert(P),new Error(P)}}var e=d.layoutStyle,f=d.autostart,g=d.maximum_model_steps,h=d.lj_epsilon_max,i=d.lj_epsilon_min,j=c.elements,k=c.atoms,l=c.mol_number,m=c.temperature_control,n=c.temperature,o=c.coulomb_forces,p=c.width,q=c.height,r,s,t,u,v,w,x,y,z={},A,B,C,D,E,F,G,H=$.Deferred();return I(),I},controllers.complexModelController=function(a,b,c,d,e,f){function N(){function e(a){var b=model.ke(),c=model.pe(),d=b+c;J.update(),v.update_molecule_positions(),model.isNewStep()?(M++,C.push(d),model.is_stopped()?A.add_point(d):A.add_canvas_point(d)):A.update(),x>.95*A.xmax&&A.xmax<i&&A.change_xaxis(A.xmax*2),x>=i&&B(),layout.displayStats(),layout.datatable_visible&&layout.render_datatable()}function f(){C=[model.ke()+model.pe()]}function w(){model=modeler.model({elements:n,model_listener:e,temperature:q,lennard_jones_forces:!0,coulomb_forces:s,temperature_control:r,width:t,height:u});if(o)model.createNewAtoms(o);else{if(!p)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(p),model.relax()}}function y(){function e(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),v.setup_particles()}function i(){p=+F.value,S(),checkbox_thermalize.checked&&(model.relax(),v.update_molecule_positions()),L.checked=!1,o()}function o(){A.change_yaxis(G[p]),I.redraw(),J.redraw()}layout.selection=g,model_player=new ModelPlayer(model,h),v=layout.moleculeContainer(a,{title:"Simple Molecules",xlabel:"X position (nm)",ylabel:"Y position (nm)",playback_controller:!0,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,atom_mubers:!1,xmin:0,xmax:t,ymin:0,ymax:u}),model.addPropertiesListener(["sigma"],v.updateMoleculeRadius),f(),A=grapher.realTimeGraph(b,{title:"Total Energy of the System",xlabel:"Model Time (ps)",xmin:0,xmax:2500,sample:.25,ylabel:null,ymin:0,ymax:200,dataset:C}),A.new_data(C),model.on("play",function(){A.number_of_points()&&M<A.number_of_points()&&(M===0?f():C.length=M,A.new_data(C)),A.show_canvas()}),model.on("stop",function(){A.hide_canvas()}),model.on("seek",function(){f(),A.new_data(C)}),J=layout.speedDistributionChart(d,{title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01}),I=layout.potentialChart(c,model,{title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy",epsilon_max:j,epsilon_min:k,epsilon:n[0].epsilon,sigma_max:l,sigma_min:m,sigma:n[0].sigma}),model.addPropertiesListener(["epsilon"],I.ljUpdate),model.addPropertiesListener(["sigma"],I.ljUpdate),model.addPropertiesListener(["coulomb_forces"],e),e(),K={moleculeContainers:[v],potentialCharts:[I],speedDistributionCharts:[J],energyCharts:[A]},D=document.getElementById("model-controls"),D&&(E=D.getElementsByTagName("input"),D.onchange=modelController),F=document.getElementById("select-molecule-number"),L=document.getElementById("radio-randomize-pos-vel"),checkbox_thermalize=document.getElementById("checkbox-thermalize"),G={2:2,5:12.5,10:5,20:10,50:120,100:250,200:1e3,500:5e3},H={2:2,5:2,10:5,20:5,50:10,100:15,200:20,500:40},F.onchange=i,L.onclick=i,F.value=p}function z(){atoms=model.get_atoms(),nodes=model.get_nodes(),model.resetTime(),f(),v.updateMoleculeRadius(),v.setup_particles(),layout.setupScreen(K),x=model.stepCounter(),F.value=atoms.length,B(),model.on("tick",e)}function B(){model.stop(),A.hide_canvas(),v.playback_component.action("stop"),D&&(E[0].checked=!0)}function O(){model.stop(),model.stepCounter()<i?(model.stepForward(),A.hide_canvas(),D&&(E[0].checked=!0)):D&&(E[0].checked=!1)}function P(){model.on("tick",e),model.stepCounter()<i?(A.show_canvas(),model.resume(),D&&(E[0].checked=!0)):D&&(E[0].checked=!1)}function Q(){B(),M=model.stepBack(),A.showMarker(M)}function R(){model.stepCounter()<i?(M=model.stepForward(),A.showMarker(M)):D&&(E[0].checked=!0)}function S(){p=+F.value,model.createNewAtoms(p),z(),x=model.stepCounter(),layout.displayStats(),layout.datatable_visible?layout.render_datatable(!0):layout.hide_datatable(),f(),A.new_data(C),A.hide_canvas(),D&&(E[0].checked=!0)}function T(){layout.setupScreen(K)}function U(a){a=a?a:window.event?event:null;if(a)switch(a.keyCode){case 32:model.is_stopped()?v.playback_component.action("play"):v.playback_component.action("stop"),a.preventDefault();break;case 13:v.playback_component.action("play"),a.preventDefault();break;case 37:model.is_stopped()||v.playback_component.action("stop"),Q(),a.preventDefault();break;case 39:model.is_stopped()||v.playback_component.action("stop"),R(),a.preventDefault()}}document.onwebkitfullscreenchange=T,window.onresize=T,document.onkeydown=U;try{w(),y(),z()}catch(V){throw alert(V),new Error(V)}h&&P(),N.modelListener=e,N.modelGo=P,N.modelStop=B,N.modelReset=S,N.resetTEData=f,N.energyGraph=A,N.moleculeContainer=v}var g=f.layoutStyle,h=f.autostart,i=f.maximum_model_steps,j=f.lj_epsilon_max,k=f.lj_epsilon_min,l=2,m=.1,n=e.elements,o=e.atoms,p=e.mol_number,q=e.temperature,r=e.temperature_control,s=e.coulomb_forces,t=e.width,u=e.height,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,F,L,M=0;return N(),N}})();