(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.modelController=function(e,t,n){function E(){b.update_drawable_positions()}function S(){s=n.controlButtons,o=n.modelTimeLabel,enableAtomTooltips=n.enableAtomTooltips||!1,u=n.fit_to_parent,a=t.elements,f=t.atoms,l=t.mol_number,c=t.temperature_control,h=t.temperature,p=t.width,d=t.height,v=t.chargeShading,m=t.showVDWLines,g=t.radialBonds,y=t.obstacles,viscosity=t.viscosity,gravitationalField=t.gravitationalField}function x(){S(),model=modeler.model({elements:a,temperature:h,temperature_control:c,width:p,height:d,chargeShading:v,showVDWLines:m,viscosity:viscosity,gravitationalField:gravitationalField});if(f)model.createNewAtoms(f);else{if(!l)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(l),model.relax()}g&&model.createRadialBonds(g),y&&model.createObstacles(y),i.modelReset()}function T(){model_player=new ModelPlayer(w,!1),model_player.forward=function(){},model_player.back=function(){},b=Lab.moleculeContainer(e,{fit_to_parent:u,xmax:p,ymax:d,chargeShading:v,enableAtomTooltips:enableAtomTooltips,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:s,modelTimeLabel:o}),b.updateMoleculeRadius(),b.setup_drawables()}function N(){b.reset({fit_to_parent:u,xmax:p,ymax:d,chargeShading:v,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:s,modelTimeLabel:o}),b.updateMoleculeRadius(),b.setup_drawables()}function C(){model.resetTime(),model.stop(),model.on("tick",E)}function k(e){x(),C(),e?T():N()}function L(e,r){t=e||t,n=r||n,k(!1)}var r={},i=d3.dispatch("modelReset"),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w={resume:function(){model.resume()},stop:function(){model.stop()},reset:function(){model.stop(),model.reset()},seek:function(e){e===1&&L(t,n)},is_stopped:function(){return model.is_stopped()}};if(typeof DEVELOPMENT=="undefined")try{k(!0)}catch(A){throw alert(A),new Error(A)}else k(!0);return r.on=function(e,t){i.on(e,t)},r.reload=L,r.moleculeContainer=b,r},controllers.interactivesController=function(e,t,n,r){function v(e){e=ACTUAL_ROOT+e,$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,o?o.reload(e,f):(o=controllers.modelController("#molecule-container",e,f),L(),o.on("modelReset",L))})}function m(e){switch(e.type){case"button":return b(e);case"pulldown":return w(e);case"thermometer":return E(e);case"energyGraph":return T(e)}}function g(e){var t,n,r,i;n=[],r=[];for(t in d)d.hasOwnProperty(t)&&(n.push(t),r.push(d[t]));return i="'use strict';"+e,function(){var t,s,o,u;s=[];for(t in window)window.hasOwnProperty(t)&&!d.hasOwnProperty(t)&&s.push(t);o=n.concat(s).concat(i);try{u=Function.apply(null,o)}catch(a){alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+e)}try{u.apply(null,r)}catch(a){alert('Error running script: "'+a.toString()+'"\nScript:\n\n'+e)}}}function y(e){return typeof e=="string"?e:e.join("\n")}function b(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),t.addClass("component"),n=y(e.action),t.click(g(n)),{elem:t}}function w(e){var t,n,r=e.options||[],i,s,o;t=$("<select>").attr("id",e.id),t.addClass("component");for(s=0,o=r.length;s<o;s++)i=r[s],n=$("<option>").html(i.text),i.disabled&&n.attr("disabled",i.disabled),i.selected&&n.attr("selected",i.selected),t.append(n);return t.change(function(){var t=$(this).prop("selectedIndex"),n=e.options[t].action,r;n?(r=y(n),g(r)()):e.options[t].loadModel&&(model.stop(),v(e.options[t].loadModel))}),{elem:t}}function E(e){var t=$("<div>").attr("id",e.id);return c=new Thermometer(t,null,e.min,e.max),x(["temperature"],S),{elem:$('<div class="interactive-thermometer">').append(t).append($('<p class="label">').text("Thermometer")),callback:function(){c.resize(),S()}}}function S(){c.add_value(model.get("temperature"))}function x(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):a.push([e,t])}function T(e){var t=$("<div>").attr("id",e.id);return{elem:t,callback:function(){var t=e,n={title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:100,sample:.1,ylabel:"eV",ymin:-5,ymax:5};k(),n.dataset=p,t.options&&$.extend(n,t.options),model.on("tick.energyGraph",N),model.on("play.energyGraph",function(){var e,t;h.number_of_points()&&model.stepCounter()<h.number_of_points()&&(k(model.stepCounter()),h.new_data(p)),h.show_canvas()}),model.on("reset.energyGraph",function(){k(),h.new_data(p),h.reset()}),model.on("seek.energyGraph",function(){var e=model.stepCounter();e>0?k(e):k(),h.new_data(p)}),h=grapher.realTimeGraph("#"+t.id,n),t.dimensions&&h.resize(t.dimensions.width,e.dimensions.height)}}}function N(){h.add_points(C())}function C(){var e=model.ke(),t=model.pe(),n=e+t;return p[0].push(e),p[1].push(t),p[2].push(n),[e,t,n]}function k(e){var t=model.stepCounter();if(e){for(i=0,len=p.length;i<len;i++)p[i].length=t;return e}return p=[[0],[0],[0]],0}function L(){var e,t;r&&(layout.selection=r,layout.addView("moleculeContainers",o.moleculeContainer),c&&layout.addView("thermometers",c),layout.setupScreen(),$(window).unbind("resize"),$(window).on("resize",layout.setupScreen));for(e=0;e<a.length;e++)t=a[e],model.addPropertiesListener(t[0],t[1]);for(e=0;e<l.length;e++)l[e]();if(n)for(e=0;e<n.length;e++)n[e]()}function A(t,n){var i,s,o={},a,c,h,p,d,g,y,b;l=[],e=t,u=$(n),u.children().length===0?(d=$('<div class="interactive-top" id="top"/>'),d.append('<div id="molecule-container"/>'),g=$('<div id="right"/>'),d.append(g),u.append(d),u.append('<div class="interactive-bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),u.append('<div id="bottom"/>')),e.model!=null&&(i=e.model.url,e.model.viewOptions?f=e.model.viewOptions:f={controlButtons:"play"},f.fit_to_parent=!r),i&&v(i),s=e.components||[];for(y=0,b=s.length;y<b;y++)a=m(s[y]),o[s[y].id]=a;if(e.layout)for(h in e.layout)if(e.layout.hasOwnProperty(h)){c=e.layout[h];for(y=0,b=c.length;y<b;y++)p=c[y],o[p]&&($("#"+h).append(o[p].elem),o[p].callback&&l.push(o[p].callback),delete o[p])}for(p in o)o.hasOwnProperty(p)&&$("#bottom").append(o[p].elem);$("#right").children().length>0?$(".interactive-top").addClass("push-right"):$(".interactive-top").removeClass("push-right")}var s={},o,u,a=[],f,l=[],c,h,p=[[],[],[]],d={getRadialBond:function(t){return[model.get_radial_bonds()[0][t],model.get_radial_bonds()[1][t],model.get_radial_bonds()[2][t],model.get_radial_bonds()[3][t]]},setRadialBond:function(t,n){model.get_radial_bonds()[0][t]=n[0],model.get_radial_bonds()[1][t]=n[1],model.get_radial_bonds()[2][t]=n[2],model.get_radial_bonds()[3][t]=n[3]},addAtom:function(){return model.addAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},adjustTemperature:function(t){model.set({temperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("temperature")>t&&model.set({temperature:t})},loadModel:function(t){model.stop(),s.loadModel(t)},setAtomProperties:function(t,n,r,i){return model.setAtomProperties(t,n,r,i)},getAtomProperties:function(t){var n={},r=model.get_nodes();for(var i in model.ATOM_PROPERTIES)n[model.ATOM_PROPERTIES[i]]=r[model.INDICES[i]][t];return n},start:function(){model.start()},stop:function(){model.stop()},reset:function(){model.stop(),o.reload()},tick:function(){model.tick()},repaint:function(){o.moleculeContainer.update_drawable_positions()},alert:alert,console:window.console!=null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}};return A(e,t),s.loadInteractive=A,s.loadModel=v,s},controllers.compareModelsController=function(e,t,n,r,i){function I(){function r(e){E.update_drawable_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}y&&model.createRadialBonds(y),b&&model.createObstacles(b)}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),E=layout.moleculeContainer(e,{control_buttons:"",modelTimeLabel:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},get_radial_bonds:function(){return model.get_radial_bonds()}}),E.updateMoleculeRadius(),E.setup_drawables(),_=M(),_?O={params:[["script","page:0:import /imports/legacy-mw-content/"+_]]}:O={},A=layout.appletContainer(t,O),layout.addView("moleculeContainers",E),layout.addView("appletContainers",A),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function S(){model.stop(),model.stepBack()}function T(){model.stop(),model.stepForward()}function N(){model.stop(),i(),k(),r()}function k(){w=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),x=model.stepCounter()}function L(){return F=document.location.hash,F.length>0?F.substr(1,F.length):!1}function M(){var e=L();return e?j[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function q(){var e=L();e?B.value=e.replace("/imports/legacy-mw-content/",""):B.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function R(){var e,t,n,r,i;j={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],j[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function U(){R(),d3.select(B).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),q()}function z(e){return A.applet.runMwScript(e)}function W(){var e=$(B).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");C=t+n,document.location.hash="#"+C}function X(){M()&&(O={params:[["script","page:0:import "+M()]]},A=layout.appletContainer(t,O),z("page:0:set frank false"),layout.setView("appletContainers",[A]),layout.setupScreen())}function V(){layout.setupScreen()}function J(){U(),i(),k(),u(),q()}B=document.getElementById(n),D=document.getElementById("start"),D.onclick=function(){z("mw2d:1:run"),f()},P=document.getElementById("stop"),P.onclick=function(){z("mw2d:1:stop"),a()},H=document.getElementById("reset"),H.onclick=function(){z("mw2d:1:reset"),N()},B.onchange=W,document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();I.runMWScript=z}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y=r.radialBonds,b=r.obstacles,w,E,S,x,T,N,C,k,L,A,O={},M,_,D,P,H,B,j,F;return I(),I}})();