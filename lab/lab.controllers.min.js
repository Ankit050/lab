(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.modelController=function(e,t,n){function w(){y.update_drawable_positions()}function E(){s=n.controlButtons,enableAtomTooltips=n.enableAtomTooltips||!1,o=n.fit_to_parent,u=t.elements,a=t.atoms,f=t.mol_number,l=t.temperature_control,c=t.temperature,h=t.width,p=t.height,d=t.chargeShading,v=t.showVDWLines,m=t.radialBonds,g=t.obstacles}function S(){E(),model=modeler.model({elements:u,temperature:c,temperature_control:l,width:h,height:p,chargeShading:d,showVDWLines:v});if(a)model.createNewAtoms(a);else{if(!f)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(f),model.relax()}m&&model.createRadialBonds(m),g&&model.createObstacles(g),i.modelReset()}function x(){model_player=new ModelPlayer(b,!1),model_player.forward=function(){},model_player.back=function(){},y=Lab.moleculeContainer(e,{fit_to_parent:o,xmax:h,ymax:p,chargeShading:d,enableAtomTooltips:enableAtomTooltips,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},control_buttons:s}),y.updateMoleculeRadius(),y.setup_drawables()}function T(){y.reset({fit_to_parent:o,xmax:h,ymax:p,chargeShading:d,get_radial_bonds:function(){return model.get_radial_bonds()},get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},control_buttons:s}),y.updateMoleculeRadius(),y.setup_drawables()}function N(){model.resetTime(),model.stop(),model.on("tick",w)}function C(e){S(),N(),e?x():T()}function k(e,r){t=e||t,n=r||n,C(!1)}var r={},i=d3.dispatch("modelReset"),s,o,u,a,f,l,c,h,p,d,v,m,g,y,b={resume:function(){model.resume()},stop:function(){model.stop()},seek:function(e){e===1&&k(t,n)},is_stopped:function(){return model.is_stopped()}};if(typeof DEVELOPMENT=="undefined")try{C(!0)}catch(L){throw alert(L),new Error(L)}else C(!0);return r.on=function(e,t){i.on(e,t)},r.reload=k,r.moleculeContainer=y,r},controllers.interactivesController=function(e,t,n){function l(e){e=ACTUAL_ROOT+e,$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,i?i.reload(e,u):(i=controllers.modelController("#molecule-container",e,u),b(),i.on("modelReset",b))})}function c(e){switch(e.type){case"button":return d(e);case"pulldown":return v(e);case"thermometer":return m(e)}}function h(e){var t,n,r,i;n=[],r=[];for(t in f)f.hasOwnProperty(t)&&(n.push(t),r.push(f[t]));return i="'use strict';"+e,function(){var t,s,o,u;s=[];for(t in window)window.hasOwnProperty(t)&&!f.hasOwnProperty(t)&&s.push(t);o=n.concat(s).concat(i);try{u=Function.apply(null,o)}catch(a){alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+e)}try{u.apply(null,r)}catch(a){alert('Error running script: "'+a.toString()+'"\nScript:\n\n'+e)}}}function p(e){return typeof e=="string"?e:e.join("\n")}function d(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),t.addClass("component"),n=p(e.action),t.click(h(n)),t}function v(e){var t,n,r=e.options||[],i,s,o;t=$("<select>").attr("id",e.id),t.addClass("component");for(s=0,o=r.length;s<o;s++)i=r[s],n=$("<option>").html(i.text),i.disabled&&n.attr("disabled",i.disabled),i.selected&&n.attr("selected",i.selected),t.append(n);return t.change(function(){var t=$(this).prop("selectedIndex"),n=e.options[t].action,r;n?(r=p(n),h(r)()):e.options[t].loadModel&&(model.stop(),l(e.options[t].loadModel))}),t}function m(e){var t=$("<div>").attr("id",e.id);return a=new Thermometer(t,null,e.min,e.max),y(["temperature"],g),$('<div class="interactive-thermometer">').append(t).append($('<p class="label">').text("Thermometer"))}function g(){a.add_value(model.get("temperature"))}function y(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):o.push([e,t])}function b(){var e,t;n&&(layout.selection=n,layout.addView("moleculeContainers",i.moleculeContainer),a&&layout.addView("thermometers",a),layout.setupScreen(),$(window).unbind("resize"),$(window).on("resize",layout.setupScreen));for(e=0;e<o.length;e++)t=o[e],model.addPropertiesListener(t[0],t[1]);a&&(a.resize(),g())}function w(t,r){var i,o,a={},f,h,p,d,v,m,g,y;e=t,s=$(r),s.children().length===0?(v=$('<div class="interactive-top" id="top"/>'),v.append('<div id="molecule-container"/>'),m=$('<div id="right"/>'),v.append(m),s.append(v),s.append('<div class="interactive-bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),s.append('<div id="bottom"/>')),e.model!=null&&(i=e.model.url,e.model.viewOptions?u=e.model.viewOptions:u={controlButtons:"play"},u.fit_to_parent=!n),i&&l(i),o=e.components;for(g=0,y=o.length;g<y;g++)f=c(o[g]),a[o[g].id]=f;if(e.layout)for(p in e.layout)if(e.layout.hasOwnProperty(p)){h=e.layout[p];for(g=0,y=h.length;g<y;g++)d=h[g],a[d]&&($("#"+p).append(a[d]),delete a[d])}for(d in a)a.hasOwnProperty(d)&&$("#bottom").append(a[d]);$("#right").children().length>0?$(".interactive-top").addClass("push-right"):$(".interactive-top").removeClass("push-right")}var r={},i,s,o=[],u,a,f={getRadialBond:function(t){return[model.get_radial_bonds()[0][t],model.get_radial_bonds()[1][t],model.get_radial_bonds()[2][t],model.get_radial_bonds()[3][t]]},setRadialBond:function(t,n){model.get_radial_bonds()[0][t]=n[0],model.get_radial_bonds()[1][t]=n[1],model.get_radial_bonds()[2][t]=n[2],model.get_radial_bonds()[3][t]=n[3]},addAtom:function(){return model.addAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},adjustTemperature:function(t){model.set({temperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("temperature")>t&&model.set({temperature:t})},loadModel:function(t){model.stop(),r.loadModel(t)},setAtomProperties:function(t,n,r,i){return model.setAtomProperties(t,n,r,i)},getAtomProperties:function(t){var n={},r=model.get_nodes();for(property in model.ATOM_PROPERTIES)n[model.ATOM_PROPERTIES[property]]=r[model.INDICES[property]][t];return n},start:function(){model.start()},stop:function(){model.stop()},reset:function(){model.stop(),i.reload()},tick:function(){model.tick()},repaint:function(){i.moleculeContainer.update_drawable_positions()},alert:alert,console:window.console!=null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}};return w(e,t),r.loadInteractive=w,r.loadModel=l,r},controllers.compareModelsController=function(e,t,n,r,i){function I(){function r(e){E.update_drawable_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}y&&model.createRadialBonds(y),b&&model.createObstacles(b)}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),E=layout.moleculeContainer(e,{control_buttons:"",model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()},get_radial_bonds:function(){return model.get_radial_bonds()}}),E.updateMoleculeRadius(),E.setup_drawables(),_=M(),_?O={params:[["script","page:0:import /imports/legacy-mw-content/"+_]]}:O={},A=layout.appletContainer(t,O),layout.addView("moleculeContainers",E),layout.addView("appletContainers",A),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function S(){model.stop(),model.stepBack()}function T(){model.stop(),model.stepForward()}function N(){model.stop(),i(),k(),r()}function k(){w=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),x=model.stepCounter()}function L(){return F=document.location.hash,F.length>0?F.substr(1,F.length):!1}function M(){var e=L();return e?j[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function q(){var e=L();e?B.value=e.replace("/imports/legacy-mw-content/",""):B.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function R(){var e,t,n,r,i;j={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],j[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function U(){R(),d3.select(B).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),q()}function z(e){return A.applet.runMwScript(e)}function W(){var e=$(B).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");C=t+n,document.location.hash="#"+C}function X(){M()&&(O={params:[["script","page:0:import "+M()]]},A=layout.appletContainer(t,O),z("page:0:set frank false"),layout.setView("appletContainers",[A]),layout.setupScreen())}function V(){layout.setupScreen()}function J(){U(),i(),k(),u(),q()}B=document.getElementById(n),D=document.getElementById("start"),D.onclick=function(){z("mw2d:1:run"),f()},P=document.getElementById("stop"),P.onclick=function(){z("mw2d:1:stop"),a()},H=document.getElementById("reset"),H.onclick=function(){z("mw2d:1:reset"),N()},B.onchange=W,document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();I.runMWScript=z}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y=r.radialBonds,b=r.obstacles,w,E,S,x,T,N,C,k,L,A,O={},M,_,D,P,H,B,j,F;return I(),I}})();