(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.simpleModelController=function(e,t,n){function S(){function E(){r=n.layoutStyle,i=n.autostart,s=n.maximum_model_steps,o=n.lj_epsilon_max,u=n.lj_epsilon_min,a=t.elements,f=t.atoms,l=t.mol_number,c=t.temperature_control,h=t.temperature,p=t.coulomb_forces,d=t.width,v=t.height}function x(){model=modeler.model({elements:a,model_listener:y,temperature:h,lennard_jones_forces:!0,coulomb_forces:p,temperature_control:c,width:d,height:v});if(f)model.createNewAtoms(f);else{if(!l)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:l,relax:!0})}}function T(){layout.selection=r,model_player=new ModelPlayer(model,i),g=layout.moleculeContainer(e,{xmax:d,ymax:v,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),g.updateMoleculeRadius(),g.setup_particles(),w=new Thermometer("#thermometer",model.temperature(),200,4e3),model.addPropertiesListener(["temperature"],C),w.resize(),C(),layout.heatCoolButtons("#heat_button","#cool_button",0,3800,model,function(e){w.add_value(e)}),model.addPropertiesListener(["coulomb_forces"],N),N(),layout.addView("moleculeContainers",g),layout.addView("thermometers",w),layout.setupScreen()}function N(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),g.setup_particles()}function C(){w.add_value(model.get("temperature"))}function k(){model.stop()}function L(){model.on("tick",y),(!Number(s)||model.stepCounter()<s)&&model.resume()}function A(){k(),model.stepBack()}function O(){(!Number(s)||model.stepCounter()<s)&&model.stepForward()}function M(){m=model.get_nodes(),model.resetTime(),k(),model.on("tick",y),b=model.stepCounter()}function _(){layout.setupScreen(),w.resize(),C()}function D(e){E(),x(),M(),e?T():H()}function H(){layout.setupScreen(!0)}function B(e,r){t=e,n=r,D(!1)}y=function(e){g.update_molecule_positions(),b>=model.stepCounter()&&k()},document.onwebkitfullscreenchange=_,window.onresize=_;if(typeof DEVELOPMENT=="undefined")try{D(!0)}catch(P){throw alert(P),new Error(P)}else D(!0);i&&L(),S.updateLayout=H,S.reload=B}var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;return S(),S},controllers.compareModelsController=function(e,t,n,r,i){function j(){function r(e){b.update_molecule_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),b=layout.moleculeContainer(e,{playback_controller:!1,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),b.updateMoleculeRadius(),b.setup_particles(),O=A(),O?L={params:[["script","page:0:import /imports/legacy-mw-content/"+O]]}:L={},k=layout.appletContainer(t,L),layout.addView("moleculeContainers",b),layout.addView("appletContainers",k),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function w(){model.stop(),model.stepBack()}function S(){model.stop(),model.stepForward()}function x(){model.stop(),i(),N(),r()}function N(){y=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),E=model.stepCounter()}function C(){return B=document.location.hash,B.length>0?B.substr(1,B.length):!1}function A(){var e=C();return e?H[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function j(){var e=C();e?P.value=e.replace("/imports/legacy-mw-content/",""):P.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function F(){var e,t,n,r,i;H={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],H[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function I(){F(),d3.select(P).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),j()}function q(e){return k.applet.runMwScript(e)}function R(){var e=$(P).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");T=t+n,document.location.hash="#"+T}function U(){A()&&(L={params:[["script","page:0:import "+A()]]},k=layout.appletContainer(t,L),q("page:0:set frank false"),layout.setView("appletContainers",[k]),layout.setupScreen())}function z(){layout.setupScreen()}function W(){I(),i(),N(),u(),j()}P=document.getElementById(n),M=document.getElementById("start"),M.onclick=function(){q("mw2d:1:run"),f()},_=document.getElementById("stop"),_.onclick=function(){q("mw2d:1:stop"),a()},D=document.getElementById("reset"),D.onclick=function(){q("mw2d:1:reset"),x()},P.onchange=R,document.onwebkitfullscreenchange=z,window.onresize=z;if(typeof DEVELOPMENT=="undefined")try{W()}catch(X){throw alert(X),new Error(X)}else W()}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y,b,w,E,S,x,T,N,C,k,L={},A,O,M,_,D,P,H,B;return j(),j},controllers.complexModelController=function(e,t,n,r,s,o){function q(){function s(e){var t=model.ke(),n=model.pe(),r=t+n;j.update(),x.update_molecule_positions(),model.isNewStep()?(O[0].push(t),O[1].push(n),O[2].push(r),L.add_points([t,n,r])):L.update(model.stepCounter()),N>=f&&A(),layout.displayStats(),layout.datatable_visible&&layout.render_datatable()}function o(e){var t=model.stepCounter();if(e)for(i=0,len=O.length;i<len;i++)O[i].length=t;else ke=model.ke(),pe=model.pe(),te=ke+pe,O=[[ke],[pe],[te]]}function T(){model=modeler.model({elements:d,model_listener:s,temperature:y,lennard_jones_forces:!0,coulomb_forces:w,temperature_control:b,width:E,height:S});if(v)model.createNewAtoms(v),model.createRadialBonds(m);else{if(!g)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:g,relax:!0})}}function C(){function i(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),x.setup_particles()}function s(){g=+D.value,X(),F.checked=!1,f()}function f(){L.change_yaxis(P[g]),B.redraw(),j.redraw()}layout.selection=u,model_player=new ModelPlayer(model,a),x=layout.moleculeContainer(e,{title:"Simple Molecules",xlabel:"X position (nm)",ylabel:"Y position (nm)",playback_controller:!0,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,atom_mubers:!1,xmin:0,xmax:E,ymin:0,ymax:S,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),model.addPropertiesListener(["sigma"],x.updateMoleculeRadius),o(),L=grapher.realTimeGraph(t,{title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:100,sample:.25,ylabel:null,ymin:-5,ymax:5,dataset:O}),L.new_data(O),model.on("play",function(){var e,t;L.number_of_points()&&model.stepCounter()<L.number_of_points()&&(o(model.stepCounter()),L.new_data(O)),L.show_canvas()}),model.on("stop",function(){}),model.on("seek",function(){modelsteps=model.stepCounter(),modelsteps>0?(o(modelsteps),L.new_data(O)):(o(),L.new_data(O))}),j=layout.speedDistributionChart(r,{title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01}),B=layout.potentialChart(n,model,{title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy",epsilon_max:l,epsilon_min:c,epsilon:d[0].epsilon,sigma_max:h,sigma_min:p,sigma:d[0].sigma}),model.addPropertiesListener(["epsilon"],B.ljUpdate),model.addPropertiesListener(["sigma"],B.ljUpdate),model.addPropertiesListener(["coulomb_forces"],i),i(),layout.addView("moleculeContainers",x),layout.addView("potentialCharts",B),layout.addView("speedDistributionCharts",j),layout.addView("energyCharts",L),M=document.getElementById("model-controls"),M&&(_=M.getElementsByTagName("input"),M.onchange=modelController),D=document.getElementById("select-molecule-number"),F=document.getElementById("radio-randomize-pos-vel"),checkbox_thermalize=document.getElementById("checkbox-thermalize"),P={2:2,5:12.5,10:5,20:10,50:120,100:250,200:1e3,500:5e3},H={2:2,5:2,10:5,20:5,50:10,100:15,200:20,500:40},D.onchange=s,F.onclick=s,D.value=g}function k(){I=model.get_nodes(),model.resetTime(),o(),x.setup_particles(),x.updateMoleculeRadius(),layout.setupScreen(),N=model.stepCounter(),D.value=model.get_num_atoms(),A(),model.on("tick",s)}function A(){model.stop(),x.playback_component.action("stop"),M&&(_[0].checked=!0)}function R(){model.stop(),model.stepCounter()<f?(model.stepForward(),M&&(_[0].checked=!0)):M&&(_[0].checked=!1)}function U(){model.on("tick",s),model.stepCounter()<f?(L.show_canvas(),model.resume(),M&&(_[0].checked=!0)):M&&(_[0].checked=!1)}function z(){A(),model.stepBack(),L.showMarker(model.stepCounter())}function W(){model.stepCounter()<f?model.stepForward():M&&(_[0].checked=!0)}function X(){var e=!checkbox_thermalize.checked;g=+D.value,model.createNewAtoms(g,e),k(),x.update_molecule_positions(),N=model.stepCounter(),layout.displayStats(),layout.datatable_visible?layout.render_datatable(!0):layout.hide_datatable(),o(),L.new_data(O),M&&(_[0].checked=!0)}function V(){layout.setupScreen()}function J(){T(),C(),k()}document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();a&&U(),q.modelListener=s,q.modelGo=U,q.modelStop=A,q.modelReset=X,q.resetEnergyData=o,q.energyGraph=L,q.moleculeContainer=x}var u=o.layoutStyle,a=o.autostart,f=o.maximum_model_steps,l=o.lj_epsilon_max,c=o.lj_epsilon_min,h=2,p=.1,d=s.elements,v=s.atoms,m=s.radialBonds,g=s.mol_number,y=s.temperature,b=s.temperature_control,w=s.coulomb_forces,E=s.width,S=s.height,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,D,F,I;return q(),q},controllers.interactivesController=function(interactive,interactive_view_id){function loadModel(e){var t={layoutStyle:"interactive",maximum_model_steps:Infinity};$.get(e).done(function(e){modelController?modelController.reload(e,t):(modelController=controllers.modelController("#molecule-container",e,t),modelLoaded())})}function createComponent(e){switch(e.type){case"button":return createButton(e);case"thermometer":return createThermometer(e)}}function createButton(component){var $button,scriptStr,script;return $button=$("<button>").attr("id",component.id).html(component.text),typeof component.action=="string"?scriptStr=component.action:scriptStr=component.action.join("\n"),eval("script = function() {"+scriptStr+"}"),$button.click(script),$button}function createThermometer(e){function i(){n.add_value(model.get("temperature"))}var t=$("<div>").attr("id",e.id),n=new Thermometer(t,0,e.min,e.max),r=$("<div>").css("padding-bottom","4em").append(t).append($("<div>").text("Thermometer"));return queuePropertiesListener(["temperature"],i),queueActionOnModelLoad(function(){n.resize(),i()}),layout.addView("thermometers",n),r}function queuePropertiesListener(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):propertiesListeners.push([e,t])}function queueActionOnModelLoad(e){typeof model!="undefined"?e():actionQueue.push(e)}function modelLoaded(){var e,t;while(propertiesListeners.length>0)e=propertiesListeners.pop(),model.addPropertiesListener(e[0],e[1]);while(actionQueue.length>0)t=actionQueue.pop()()}function loadInteractive(e,t){var n,r={},i,s,o,u,a,f,l,c;interactive=e,$interactiveContainer=$(t),$interactiveContainer.children().length===0?(a=$('<div class="top" id="top"/>'),a.append('<div id="molecule-container"/>'),f=$('<div id="right"/>'),a.append(f),$interactiveContainer.append(a),$interactiveContainer.append('<div class="bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),$interactiveContainer.append('<div id="bottom"/>')),interactive.model&&loadModel(interactive.model),n=interactive.components;for(l=0,c=n.length;l<c;l++)i=createComponent(n[l]),r[n[l].id]=i;if(interactive.layout)for(o in interactive.layout)if(interactive.layout.hasOwnProperty(o)){s=interactive.layout[o];for(l=0,c=s.length;l<c;l++)u=s[l],r[u]&&($("#"+o).append(r[u]),delete r[u])}for(u in r)r.hasOwnProperty(u)&&$("#bottom").append(r[u])}function updateLayout(){layout.setupScreen(!0)}var controller={},modelController,$interactiveContainer,propertiesListeners=[],actionQueue=[];return loadInteractive(interactive,interactive_view_id),controller.loadInteractive=loadInteractive,controller.updateLayout=updateLayout,controller},controllers.modelController=function(e,t,n){function w(e){m.update_molecule_positions(),g>=model.stepCounter()&&x()}function E(){model=modeler.model({elements:u,model_listener:w,temperature:c,lennard_jones_forces:!0,coulomb_forces:h,temperature_control:l,width:p,height:d});if(a)model.createNewAtoms(a);else{if(!f)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(f),model.relax()}}function S(){layout.selection=i,model_player=new ModelPlayer(model,s),m=layout.moleculeContainer(e,{xmax:p,ymax:d,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),m.updateMoleculeRadius(),m.setup_particles(),layout.addView("moleculeContainers",m),layout.setupScreen()}function x(){model.stop()}function T(){model.on("tick",w),(!Number(o)||model.stepCounter()<o)&&model.resume()}function N(){x(),model.stepBack()}function C(){(!Number(o)||model.stepCounter()<o)&&model.stepForward()}function k(){v=model.get_nodes(),model.resetTime(),x(),model.on("tick",w),g=model.stepCounter()}function L(e){E(),k(),e?S():layout.setupScreen(!0)}function A(e,r){t=e,n=r,L(!1)}var r={},i=n.layoutStyle,s=n.autostart,o=n.maximum_model_steps,u=t.elements,a=t.atoms,f=t.mol_number,l=t.temperature_control,c=t.temperature,h=t.coulomb_forces,p=t.width,d=t.height,v,m,g,y,b;if(typeof DEVELOPMENT=="undefined")try{L(!0)}catch(O){throw alert(O),new Error(O)}else L(!0);return s&&T(),r.reload=A,r}})();