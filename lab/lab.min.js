(function(){var e,t,n;(function(r){function c(e,t){var n=t&&t.split("/"),r=o.map,i=r&&r["*"]||{},s,u,a,f,l,c,h,p,d,v;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(p=0;v=e[p];p++)if(v===".")e.splice(p,1),p-=1;else if(v===".."){if(p===1&&(e[2]===".."||e[0]===".."))return!0;p>0&&(e.splice(p-1,2),p-=2)}e=e.join("/")}if((n||i)&&r){s=e.split("/");for(p=s.length;p>0;p-=1){u=s.slice(0,p).join("/");if(n)for(d=n.length;d>0;d-=1){a=r[n.slice(0,d).join("/")];if(a){a=a[u];if(a){f=a,l=p;break}}}if(f)break;!c&&i&&i[u]&&(c=i[u],h=p)}!f&&c&&(f=c,l=h),f&&(s.splice(0,l,f),e=s.join("/"))}return e}function h(e,t){return function(){return l.apply(r,a.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){i[e]=t}}function v(e){if(s.hasOwnProperty(e)){var t=s[e];delete s[e],u[e]=!0,f.apply(r,t)}if(!i.hasOwnProperty(e))throw new Error("No "+e);return i[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return o&&o.config&&o.config[e]||{}}}var i={},s={},o={},u={},a=[].slice,f,l;f=function(e,t,n,o){var a=[],f,l,c,p,y,b;o=o||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(b=0;b<t.length;b++){y=m(t[b],o),c=y.f;if(c==="require")a[b]=h(e);else if(c==="exports")a[b]=i[e]={},f=!0;else if(c==="module")l=a[b]={id:e,uri:"",exports:i[e],config:g(e)};else if(i.hasOwnProperty(c)||s.hasOwnProperty(c))a[b]=v(c);else if(y.p)y.p.load(y.n,h(o,!0),d(c),{}),a[b]=i[c];else if(!u[c])throw new Error(e+" missing "+c)}p=n.apply(i[e],a);if(e)if(l&&l.exports!==r&&l.exports!==i[e])i[e]=l.exports;else if(p!==r||!f)i[e]=p}else e&&(i[e]=n)},e=t=l=function(e,t,n,i){return typeof e=="string"?v(m(e,t).f):(e.splice||(o=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),l)},l.config=function(e){return o=e,l},n=function(e,t,n){t.splice||(n=t,t=[]),s[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../vendor/almond/almond",function(){}),n("grapher/core/axis",["require"],function(e){return{axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.2+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.2+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.2+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}}}),n("grapher/core/register-keyboard-handler",["require"],function(e){return function(t){d3.select(window).on("keydown",t)}}),n("common/layout/layout",["require"],function(e){var t={version:"0.0.1"};t.selection="",t.display={},t.canonical={width:1280,height:800},t.regular_display=!1,t.not_rendered=!0,t.fontsize=!1,t.cancelFullScreen=!1,t.screen_factor=1,t.checkbox_factor=1.1,t.checkbox_scale=1.1,t.fullScreenRender=!1,t.canonical.width=1280,t.canonical.height=800,t.getDisplayProperties=function(e){return arguments.length||(e={}),e.screen={width:screen.width,height:screen.height},e.client={width:document.body.clientWidth,height:document.body.clientHeight},e.window={width:$(window).width(),height:$(window).height()},e.page={width:t.getPageWidth(),height:t.getPageHeight()},e.screen_factor_width=e.window.width/t.canonical.width,e.screen_factor_height=e.window.height/t.canonical.height,e.emsize=Math.max(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setBodyEmsize=function(){var e,n=$("button.component"),r;t.display||(t.display=t.getDisplayProperties()),e=Math.min(t.display.screen_factor_width*1.2,t.display.screen_factor_height*1.2),$("body").css("font-size",e+"em"),e<=.5?(r=.7/e,n.css("font-size",r+"em")):n.css("font-size","")},t.getVizProperties=function(e){var n=$("#viz");return arguments.length||(e={}),e.width=n.width(),e.height=n.height(),e.screen_factor_width=e.width/t.canonical.width,e.screen_factor_height=e.height/t.canonical.height,e.emsize=Math.min(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setVizEmsize=function(){var e,n=$("#viz");t.vis||(t.vis=t.getVizProperties()),e=Math.min(t.viz.screen_factor_width*1.2,t.viz.screen_factor_height*1.2),n.css("font-size",e+"em")},t.screenEqualsPage=function(){return t.display.screen.width===t.display.page.width||t.display.screen.height===t.display.page.height},t.checkForResize=function(){(t.display.screen.width!==screen.width||t.display.screen.height!==screen.height||t.display.window.width!==document.width||t.display.window.height!==document.height)&&t.setupScreen()},t.views={},t.addView=function(e,n){t.views[e]||(t.views[e]=[]),t.views[e].push(n)},t.setView=function(e,n){t.views[e]=n},t.setupScreen=function(e){function o(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.4,i=n*1/l,i>h*.55&&(i=h*.55,n=i*l),e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);a=(c-n)*.35,o=i*.52,e=-1;while(++e<r.potentialCharts.length)r.potentialCharts[e].resize(a,o);e=-1;while(++e<r.speedDistributionCharts.length)r.speedDistributionCharts[e].resize(a,o);u=(c-n)*.72,o=i*.76,e=-1;while(++e<r.energyCharts.length)r.energyCharts[e].resize(u,o)}function u(){var e,n,i,s,o,u,a,f,l,c={},h=t.viz.width,p=t.viz.height;a=r.moleculeContainers[0].scale(),f=a[0]/a[1],l=.7,r.thermometers&&(l-=.1),r.energyGraphs&&(l-=.45),o=h*l,u=o/f,u>p*.6&&(u=p*.6,o=u*f),c.moleculeContainers=[o,u],r.energyGraphs&&(c.energyGraphs=[h*.4,u*1.25]);for(viewType in r)if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)c[viewType]?r[viewType][e].resize(c[viewType][0],c[viewType][1]):r[viewType][e].resize()}}function a(){var e,t,i,s,o,u,a,f=.85,l=.0025;viewSizes={},containerWidth=$(window).width(),containerHeight=$(window).height(),mcWidth=$("#molecule-container").width(),s=r.moleculeContainers[0].scale(),o=s[2]/s[3],u=.85,modelWidthPaddingFactor=s[0]/s[2]-1.05,u-=modelWidthPaddingFactor,modelHeightPaddingFactor=s[1]/s[3]-1.05,f-=modelHeightPaddingFactor,r.thermometers&&(u-=.05),r.energyGraphs&&(u-=.35),n<=.5&&(l*=.5/n),r.bottomItems=$("#bottom").children().length,r.bottomItems&&(f-=$("#bottom").height()*l),t=containerWidth*u,i=t/o,i>containerHeight*f&&(i=containerHeight*f,t=i*o),viewSizes.moleculeContainers=[t,i],r.energyGraphs&&(viewSizes.energyGraphs=[containerWidth*.4,i*1.2]);for(viewType in r)if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)viewSizes[viewType]?r[viewType][e].resize(viewSizes[viewType][0],viewSizes[viewType][1]):r[viewType][e].resize()}}function f(){var e,n,i,s,o,u=t.display.page.width,a=t.display.page.height;s=r.moleculeContainers[0].scale(),o=s[0]/s[1],n=u*.4,i=n*1/o,e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);if(r.appletContainers){e=-1;while(++e<r.appletContainers.length)r.appletContainers[e].resize(n,i)}}function l(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.46,i=n*1/l,i>h*.7&&(i=h*.7,n=i*l),e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);a=(c-n)*.41,o=i*.42,e=-1;while(++e<r.potentialCharts.length)r.potentialCharts[e].resize(a,o);e=-1;while(++e<r.speedDistributionCharts.length)r.speedDistributionCharts[e].resize(a,o);u=(c-n)*.86,o=i*.57,e=-1;while(++e<r.energyCharts.length)r.energyCharts[e].resize(u,o)}function c(){var e,n,i,s,o;i=Math.min(t.display.page.height*.45,t.display.page.width*.5),r.moleculeContainers[0].resize(i,i),s=r.moleculeContainers[0].scale(),o=s[0]/t.display.page.width,o>.5&&(i*=.5/o,r.moleculeContainers[0].resize(i,i)),r.thermometers[0].resize()}function h(){var e,n,i,s,o,u=document.getElementById("description-right");i=Math.min(t.display.page.height*.65,t.display.page.width*.5),r.moleculeContainers[0].resize(i,i),s=r.moleculeContainers[0].scale(),o=s[0]/t.display.page.width,o>.5&&(i*=.5/o,r.moleculeContainers[0].resize(i,i)),r.thermometers[0].resize()}function p(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.7,i=n*1/l,i>h*.7&&(i=h*.7,n=i*l),r.moleculeContainers[0].resize(n,i),s=r.moleculeContainers[0].scale(),r.thermometers[0].resize()}function d(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.6,i=n*1/l,i>h*.6&&(i=h*.6,n=i*l),r.moleculeContainers[0].resize(n,i)}function v(){var e=document.getElementById("description-right");e===null}var n,r=t.views,i=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;e&&e.forceRender&&(t.not_rendered=!0),t.display=t.getDisplayProperties(),t.viz=t.getVizProperties(),t.regular_display||(t.regular_display=t.getDisplayProperties());if(i||t.fullScreenRender||t.screenEqualsPage()){t.fullScreenRender=!0,t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor),$("body").css("font-size",t.screen_factor+"em"),t.not_rendered=!0;switch(t.selection){case"simple-screen":t.not_rendered&&d();break;case"simple-static-screen":t.not_rendered&&d();break;case"simple-iframe":d(),v();break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),f(),t.not_rendered=!1;break;default:t.not_rendered&&l()}}else{t.cancelFullScreen||t.fullScreenRender?(t.cancelFullScreen=!1,t.fullScreenRender=!1,t.not_rendered=!0,t.regular_display=t.previous_display):t.regular_display=t.getDisplayProperties(),t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor);switch(t.selection){case"simple-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),c();break;case"simple-static-screen":t.not_rendered&&(n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),h(),t.not_rendered=!1);break;case"simple-iframe":n=Math.min(t.screen_factor_width*1.5,t.screen_factor_height),$("body").css("font-size",n+"em"),p();break;case"full-static-screen":t.not_rendered&&(n=Math.min(t.screen_factor_width*1.5,t.screen_factor_height),$("body").css("font-size",n+"em"),regularScreen(),t.not_rendered=!1);break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),f();break;case"interactive":t.not_rendered&&(t.setVizEmsize(),u(),t.not_rendered=!1);break;case"interactive-iframe":t.setBodyEmsize(),a();break;default:t.setVizEmsize(),o()}t.regular_display=t.getDisplayProperties()}t.transform&&$("input[type=checkbox]").css(t.transform,"scale("+t.checkbox_factor+","+t.checkbox_factor+")"),t.temperature_control_checkbox&&(model.addPropertiesListener(["temperature_control"],t.temperatureControlUpdate),t.temperatureControlUpdate());var s=document.getElementById("benchmarks-table");s&&(s.style.display="none")},t.getStyleForSelector=function(e){var t,n=document.styleSheets;for(var r=0;r<n.length;r++)if(n[r])try{t=n[r].rules||n[r].cssRules;if(t)for(var i=0;i<t.length;i++)if(t[i].selectorText==e)return t[i]}catch(s){}return!1},t.getPageHeight=function(){var e;return window.innerHeight?e=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=t.display.window.height),e},t.getPageWidth=function(){var e;return window.innerWidth?e=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?e=document.documentElement.clientWidth:document.body&&(e=window.width),e},t.getTransformProperty=function(e){var t=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],n;if(e)while(n=t.shift())if(typeof e.style[n]!="undefined")return n;return!1};var n=document.getElementById("description-right");return n!==null&&(t.fontsize=parseInt(t.getStyleForSelector("#description-right").style.fontSize)),t.transform=t.getTransformProperty(document.body),t}),n("grapher/core/graph",["require","grapher/core/axis","grapher/core/register-keyboard-handler","common/layout/layout"],function(e){var t=e("grapher/core/axis"),n=e("grapher/core/register-keyboard-handler"),r=e("common/layout/layout");return function(i,s,o){function Q(e){if(e)for(var t in U)e[t]===undefined&&(e[t]=U[t]);else e=U;return e}function G(){u<=B.icon?(B.category="icon",B.value=0):u<=B.tiny?(B.category="tiny",B.value=1):u<=B.small?(B.category="small",B.value=2):u<=B.medium?(B.category="medium",B.value=3):u<=B.large?(B.category="large",B.value=4):(B.category="extralarge",B.value=5)}function Y(e,t){arguments.length?(u=e,a=t,f.style.width=u+"px",f.style.height=a+"px"):(u=i.property("clientWidth"),a=i.property("clientHeight")),G(),D=r.getDisplayProperties(),P=D.emsize}function Z(e,t){if(e||!s)s=Q(e);l!==undefined&&(l.remove(),l=undefined),t&&(o=t),s.dataChange?_="ns-resize":_="crosshair",Y(),s.xrange=s.xmax-s.xmin,s.yrange=s.ymax-s.ymin,s.datacount=2,H=s.strokeWidth;switch(B.value){case 0:w={top:4,right:4,bottom:4,left:4};break;case 1:w={top:8,right:8,bottom:8,left:8};break;case 2:w={top:s.title?25:15,right:15,bottom:20,left:60};break;case 3:w={top:s.title?30:20,right:30,bottom:s.xlabel?60:10,left:s.ylabel?90:60};break;default:w={top:s.title?40:20,right:30,bottom:s.xlabel?60:10,left:s.ylabel?90:60}}Object.prototype.toString.call(s.title)==="[object Array]"?R=s.title:R=[s.title],R.reverse(),B.value>2?w.top+=(R.length-1)*B.value/3*B.value/3*P*22:R=[R[0]],E={width:u-w.left-w.right,height:a-w.top-w.bottom},T=function(e){return e[0]},N=function(e){return e[1]},S=d3.scale[s.xscale]().domain([s.xmin,s.xmax]).range([0,E.width]),s.xscale==="pow"&&S.exponent(s.xscaleExponent),x=d3.scale[s.yscale]().domain([s.ymin,s.ymax]).range([E.height,0]),s.yscale==="pow"&&x.exponent(s.yscaleExponent),L=function(e){return"translate("+S(e)+",0)"},A=function(e){return"translate(0,"+x(e)+")"},k=function(e){return e?"#ccc":"#666"},O=d3.format(s.xFormatter),M=d3.format(s.yFormatter),C=d3.svg.line().x(function(e,t){return S(g[t][0])}).y(function(e,t){return x(g[t][1])}),j=NaN,F=NaN,I=q=null}function et(e){function r(e){o=e,e?y.text(e):y.text("")}function b(){var e=s.yrange/2,t=e/2,n;return s.datacount=E.width/30,s.xtic=s.xrange/s.datacount,s.ytic=s.yrange/s.datacount,n=d3.range(s.datacount).map(function(n){return[n*s.xtic+s.xmin,s.ymin+t+Math.random()*e]}),n}function T(){if(!q)return;switch(d3.event.keyCode){case 8:case 46:if(s.dataChange){var e=g.indexOf(q);g.splice(e,1),q=g.length?g[e>0?e-1:0]:null,z()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}}function N(){S.domain([s.xmin,s.xmax]).range([0,E.width])}function D(){x.domain([s.ymin,s.ymax]).range([E.height,0])}function U(){var e=c.selectAll("g.x").data(S.ticks(s.xTicCount),String).attr("transform",L),t=e.enter().insert("g","a").attr("class","x").attr("transform",L);t.append("line").attr("stroke",k).attr("y1",0).attr("y2",E.height),B.value>1&&t.append("text").attr("class","axis").style("font-size",B.value/2.7*100+"%").attr("y",E.height).attr("dy","1em").attr("text-anchor","middle").text(O).style("cursor","ew-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",X).on("touchstart.drag",X),e.exit().remove();var n=c.selectAll("g.y").data(x.ticks(s.yTicCount),String).attr("transform",A),r=n.enter().insert("g","a").attr("class","y").attr("transform",A).attr("background-fill","#FFEEB6");r.append("line").attr("stroke",k).attr("x1",0).attr("x2",E.width);if(B.value>1){if(s.yscale==="log"){var i=r[0].length;i>100?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[1]/)}):i>50?r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[12]/)}):r=r.filter(function(e){return!!e.toString().match(/(\.[0]*|^)[125]/)})}r.append("text").attr("class","axis").style("font-size",B.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(M).style("cursor","ns-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",V).on("touchstart.drag",V)}n.exit().remove(),h.call(d3.behavior.zoom().x(S).y(x).on("zoom",U)),z()}function z(){st(),c.select("path").attr("d",C(g));var e=c.select("svg").selectAll("circle").data(g,function(e){return e});s.circleRadius&&B.value>1&&(s.circleRadius<=4&&B.value<3||(e.enter().append("circle").attr("class",function(e){return e===q?"selected":null}).attr("cx",function(e){return S(e[0])}).attr("cy",function(e){return x(e[1])}).attr("r",s.circleRadius*(1+B.value)/4).style("stroke-width",s.circleRadius/6*(B.value-1.5)).style("cursor",_).on("mousedown.drag",$).on("touchstart.drag",$),e.attr("class",function(e){return e===q?"selected":null}).attr("cx",function(e){return S(e[0])}).attr("cy",function(e){return x(e[1])}).attr("r",s.circleRadius*(1+B.value)/4).style("stroke-width",s.circleRadius/6*(B.value-1.5)))),e.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function W(){var e;d3.event.preventDefault(),n(T),d3.select("body").style("cursor","move");if(d3.event.altKey)if(d3.event.shiftKey&&s.addData){e=d3.svg.mouse(c.node());var t=[];t[0]=S.invert(Math.max(0,Math.min(E.width,e[0]))),t[1]=x.invert(Math.max(0,Math.min(E.height,e[1]))),g.push(t),g.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),q=t,z()}else e=d3.svg.mouse(c[0][0]),j=S.invert(e[0]),F=x.invert(e[1]),I=!1,d3.event.stopPropagation()}function X(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(c[0][0]);j=S.invert(t[0])}function V(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(c[0][0]);F=x.invert(t[1])}function $(e){n(T),document.onselectstart=function(){return!1},q=I=e,z()}function K(){var e=d3.svg.mouse(c[0][0]);d3.event.preventDefault(),I&&s.dataChange&&(I[1]=x.invert(Math.max(0,Math.min(E.height,e[1]))),z()),isNaN(j)||(d3.select("body").style("cursor","ew-resize"),S.domain(t.axisProcessDrag(j,S.invert(e[0]),S.domain())),U(),d3.event.stopPropagation()),isNaN(F)||(d3.select("body").style("cursor","ns-resize"),x.domain(t.axisProcessDrag(F,x.invert(e[1]),x.domain())),U(),d3.event.stopPropagation())}function Q(){document.onselectstart=function(){return!0},d3.select("body").style("cursor","auto"),isNaN(j)||(j=NaN,U()),isNaN(F)||(F=NaN,U()),I=null}e||(e=i),e.each(function(){i=d3.select(this),this.clientWidth&&this.clientHeight&&(u=this.clientWidth,a=this.clientHeight,E.width=u-w.left-w.right,E.height=a-w.top-w.bottom),g=s.points,g==="fake"&&(g=b()),N(),D(),l===undefined?(l=i.append("svg").attr("width",u).attr("height",a),c=l.append("g").attr("transform","translate("+w.left+","+w.top+")"),h=c.append("rect").attr("class","plot").attr("width",E.width).attr("height",E.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown.drag",W).on("touchstart.drag",W).call(d3.behavior.zoom().x(S).y(x).on("zoom",U)),p=c.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",E.width).attr("height",E.height).attr("viewBox","0 0 "+E.width+" "+E.height),p.append("path").attr("class","line").style("stroke-width",H).attr("d",C(g)),J=p.append("g").attr("class","brush"),s.title&&B.value>1&&(d=c.selectAll("text").data(R,function(e){return e}),d.enter().append("text").attr("class","title").style("font-size",B.value/2.4*100+"%").text(function(e){return e}).attr("x",E.width/2).attr("dy",function(e,t){return-0.5+ -1*B.value/2.8*t*P+"em"}).style("text-anchor","middle")),s.xlabel&&B.value>2&&(v=c.append("text").attr("class","axis").style("font-size",B.value/2.6*100+"%").text(s.xlabel).attr("x",E.width/2).attr("y",E.height).attr("dy","2.4em").style("text-anchor","middle")),s.ylabel&&B.value>2&&(m=c.append("g").append("text").attr("class","axis").style("font-size",B.value/2.6*100+"%").text(s.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+E.height/2+") rotate(-90)")),d3.select(f).on("mousemove.drag",K).on("touchmove.drag",K).on("mouseup.drag",Q).on("touchend.drag",Q),y=c.append("text").attr("class","graph-notification").text(o).attr("x",E.width/2).attr("y",E.height/2).style("text-anchor","middle")):(c.attr("width",u).attr("height",a),h.attr("width",E.width).attr("height",E.height),p.attr("top",0).attr("left",0).attr("width",E.width).attr("height",E.height).attr("viewBox","0 0 "+E.width+" "+E.height),s.title&&B.value>1&&d.each(function(e,t){d3.select(this).attr("x",E.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-R.length+"em"})}),s.xlabel&&B.value>1&&v.attr("x",E.width/2).attr("y",E.height),s.ylabel&&B.value>1&&m.attr("transform","translate(-40 "+E.height/2+") rotate(-90)"),y.attr("x",E.width/2).attr("y",E.height/2)),U()}),et.elem=i,et.redraw=U,et.update=z,et.notify=r,et.points=g,et.initialize=Z,et.updateXScale=N,et.updateYScale=D,et.scale=Y}function tt(){s.title&&d&&d.text(s.title)}function nt(){s.xlabel&&v&&v.text(s.xlabel)}function rt(){s.ylabel&&m?m.text(s.ylabel):m.style("display","none")}function it(){var e;V&&(e=K.extent(),et.selection_domain(e[0]!==e[1]?e:[]))}function st(){W&&X?(K=K||d3.svg.brush().x(S).extent([z.xmin||0,z.xmax||0]).on("brush",it),J.call(K.extent([z.xmin||0,z.xmax||0])).style("display","inline").style("pointer-events",V?"all":"none").selectAll("rect").attr("height",E.height)):J.style("display","none")}var u=600,a=300,f;arguments.length&&(i=d3.select(i),f=i.node(),u=i.property("clientWidth"),a=i.property("clientHeight"));var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},j,F,I,q,R=[],U={title:"Graph",xlabel:"X Axis",ylabel:"Y Axis",xscale:"linear",yscale:"linear",xTicCount:10,yTicCount:8,xFormatter:"3.3r",yFormatter:"3.3r",xscaleExponent:.5,yscaleExponent:.5,xmax:60,xmin:0,ymax:40,ymin:0,circleRadius:10,strokeWidth:2,dataChange:!0,addData:!0,points:!1,notification:!1},z={xmin:null,xmax:null,ymin:null,ymax:null},W=!1,X=!1,V=!0,$,J,K;return Z(s),et.margin=function(e){return arguments.length?(b=e,et):b},et.xmin=function(e){return arguments.length?(s.xmin=e,s.xrange=s.xmax-s.xmin,et.updateXScale&&(et.updateXScale(),et.redraw()),et):s.xmin},et.xmax=function(e){return arguments.length?(s.xmax=e,s.xrange=s.xmax-s.xmin,et.updateXScale&&(et.updateXScale(),et.redraw()),et):s.xmax},et.ymin=function(e){return arguments.length?(s.ymin=e,s.yrange=s.ymax-s.ymin,et.updateYScale&&(et.updateYScale(),et.redraw()),et):s.ymin},et.ymax=function(e){return arguments.length?(s.ymax=e,s.yrange=s.ymax-s.ymin,et.updateYScale&&(et.updateYScale(),et.redraw()),et):s.ymax},et.xLabel=function(e){return arguments.length?(s.xlabel=e,nt(),et):s.xlabel},et.yLabel=function(e){return arguments.length?(s.ylabel=e,rt(),et):s.ylabel},et.title=function(e){return arguments.length?(s.title=e,tt(),et):s.title},et.width=function(e){return arguments.length?(E.width=e,et):E.width},et.height=function(e){return arguments.length?(E.height=e,et):E.height},et.x=function(e){return arguments.length?(T=e,et):T},et.y=function(e){return arguments.length?(N=e,et):N},et.elem=function(e){return arguments.length?(i=d3.select(e),i.call(et),et):i},et.data=function(e){if(!arguments.length)return g;var t=S.domain(),n=t[1]-t[0],r=n*.8;return s.points=g=e,g.length>t[1]?(t[0]+=r,t[1]+=r,S.domain(t),et.redraw()):et.update(),et},et.add_data=function(e){if(!arguments.length)return g;var t=S.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)g.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");g.push(e)}return g[g.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,S.domain(t),et.redraw()):et.update(),et},et.selection_domain=function(e){return arguments.length?(e===null?W=!1:e.length===0?(W=!0,z.xmin=Infinity,z.xmax=Infinity):(W=!0,z.xmin=e[0],z.xmax=e[1]),st(),$&&$(et.selection_domain()),et):W?z.xmax===Infinity&&z.xmin===Infinity?[]:[z.xmin,z.xmax]:null},et.has_selection=function(){return W},et.selection_visible=function(e){return arguments.length?(e=!!e,X!==e&&(X=e,st()),et):X},et.selection_enabled=function(e){return arguments.length?(e=!!e,V!==e&&(V=e,st()),et):V},et.selection_listener=function(e){return arguments.length?($=e,et):$},et.brush_element=function(){return J},et.brush_control=function(){return K},et.brush_listener=function(){return it},et.reset=function(e,t){return arguments.length?et.initialize(e,t):et.initialize(),et(),et},et.resize=function(e,t){return et.scale(e,t),et.initialize(),et(),et},i&&i.call(et),et}}),n("grapher/core/real-time-graph",["require","grapher/core/axis"],function(e){var t=e("grapher/core/axis");return function(n,r,i){function Y(e){if(e)for(var t in G)e[t]===undefined&&(e[t]=G[t]);else e=G;return e}function Z(){u<=B.icon?(B.category="icon",B.value=0):u<=B.tiny?(B.category="tiny",B.value=1):u<=B.small?(B.category="small",B.value=2):u<=B.medium?(B.category="medium",B.value=3):u<=B.large?(B.category="large",B.value=4):(B.category="extralarge",B.value=5)}function et(e,t){arguments.length?(u=e,a=t,o.style.width=u+"px",o.style.height=a+"px"):(u=s.property("clientWidth"),a=s.property("clientHeight")),Z(),D=parseFloat($("#viz").css("font-size")||$("body").css("font-size"))/12}function tt(e,t,n){e&&(s=d3.select(e),o=s.node(),u=s.property("clientWidth"),a=s.property("clientHeight"));if(t||!r)r=Y(t),newOptions=undefined;d!==undefined&&(d.remove(),d=undefined),J!==undefined&&($(J).remove(),J=undefined),V=r.sample,r.dataChange?M="ns-resize":M="crosshair",et(),r.xrange=r.xmax-r.xmin,r.yrange=r.ymax-r.ymin,z=[];switch(B.value){case 0:C={top:4,right:4,bottom:4,left:4};break;case 1:C={top:8,right:8,bottom:8,left:8};break;case 2:C={top:r.title?25:15,right:15,bottom:20,left:30};break;case 3:C={top:r.title?30:20,right:30,bottom:r.xlabel?60:10,left:r.ylabel?70:45};break;default:C={top:r.title?40:20,right:30,bottom:r.xlabel?60:10,left:r.ylabel?70:45}}if(Object.prototype.toString.call(r.dataset[0])==="[object Array]"){for(var i=0;i<r.dataset.length;i++)z.push(nt(r.dataset[i],0,V));U=z[0]}else U=nt(r.dataset,0),z=[U];Object.prototype.toString.call(r.title)==="[object Array]"?R=r.title:R=[r.title],R.reverse(),B.value>2?C.top+=(R.length-1)*B.value/3*B.value/3*D*22:R=[R[0]],k={width:u-C.left-C.right,height:a-C.top-C.bottom},L=d3.scale[r.xscale]().domain([r.xmin,r.xmax]).range([0,k.width]),r.xscale==="pow"&&L.exponent(r.xscaleExponent),A=d3.scale[r.yscale]().domain([r.ymin,r.ymax]).nice().range([k.height,0]).nice(),r.yscale==="pow"&&A.exponent(r.yscaleExponent),h=d3.format(r.xFormatter),p=d3.format(r.yFormatter),O=d3.svg.line().x(function(e,t){return L(U[t].x)}).y(function(e,t){return A(U[t].y)}),j=Math.NaN,F=Math.NaN,I=null}function nt(e,t,n){var r=0,i=t||0,s=e.length,o=[];n=n||1;for(r=0;r<s;r++)o.push({x:(r+i)*n,y:e[r]});return o}function rt(){return U?U.length:!1}function it(){function e(e){i=e,e?N.text(e):N.text("")}function n(){var e=v.selectAll("g.x").data(L.ticks(r.xTicCount),String).attr("transform",l),t=e.enter().insert("g","a").attr("class","x").attr("transform",l);t.append("line").attr("stroke",f).attr("y1",0).attr("y2",k.height),B.value>1&&t.append("text").attr("class","axis").style("font-size",B.value/2.7*100+"%").attr("y",k.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(h).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",M).on("touchstart.drag",M),e.exit().remove();var i=v.selectAll("g.y").data(A.ticks(r.yTicCount),String).attr("transform",c),s=i.enter().insert("g","a").attr("class","y").attr("transform",c).attr("background-fill","#FFEEB6");s.append("line").attr("stroke",f).attr("x1",0).attr("x2",k.width),B.value>1&&s.append("text").attr("class","axis").style("font-size",B.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(p).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",_).on("touchstart.drag",_),i.exit().remove(),m.call(d3.behavior.zoom().x(L).y(A).on("zoom",n)),S()}function S(e){mt(e);if(it.selectable_points){var t=v.selectAll("circle").data(U,function(e){return e});t.enter().append("circle").attr("class",function(e){return e===q?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}).attr("r",1).on("mousedown",function(e){q=I=e,S()}),t.attr("class",function(e){return e===q?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}),t.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function T(){d3.event.preventDefault(),m.style("cursor","move");if(d3.event.altKey){var e=d3.svg.mouse(v[0][0]);j=L.invert(e[0]),F=A.invert(e[1]),I=!1,d3.event.stopPropagation()}}function M(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(v[0][0]);j=L.invert(t[0])}function _(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(v[0][0]);F=A.invert(t[1])}function P(){var e=d3.svg.mouse(v[0][0]),r,i,s,o=d3.event.changedTouches;document.onselectstart=function(){return!0},d3.event.preventDefault(),isNaN(j)||(d3.select("body").style("cursor","ew-resize"),L.domain(t.axisProcessDrag(j,L.invert(e[0]),L.domain())),n(),d3.event.stopPropagation()),isNaN(F)||(d3.select("body").style("cursor","ns-resize"),A.domain(t.axisProcessDrag(F,A.invert(e[1]),A.domain())),n(),d3.event.stopPropagation())}function H(){d3.select("body").style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(j)||(n(),j=Math.NaN),isNaN(F)||(n(),F=Math.NaN),I=null}function $(e){W={x:U[e].x,y:U[e].y}}function G(){var e,t=L.domain(),r=t[1]-t[0],i=U.length*V,s=r*.9;i>t[1]?(t[0]+=s,t[1]+=s,L.domain(t),n()):S()}function Y(e){if(U.length===0)return;W=!1;var t=U.length,n=t*V,r={x:n,y:e},i,s;U.push(r),G()}function Z(e){if(U.length===0)return;Y(e),G()}function st(e){if(U.length===0)return;W=!1;var t=U.length,n=t*V,r=n-V,i={x:n,y:e},s=L.call(self,r,r),o=A.call(self,U[t-1].y,t-1),u,a;U.push(i),u=L.call(self,n,n),a=A.call(self,e,n),K.beginPath(),K.moveTo(s,o),K.lineTo(u,a),K.stroke()}function ot(e){for(var t=0;t<z.length;t++)U=z[t],Y(e[t]);G()}function ut(e){for(var t=0;t<z.length;t++)U=z[t],at(t),st(e[t])}function at(e,t){var n=t?.4:1;switch(e){case 0:K.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:K.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:K.strokeStyle="rgba(44,0,160,"+n+")"}}function ft(e,t){var n=t?.4:1;switch(e){case 0:K.fillStyle="rgba(160,00,0,"+n+")";break;case 1:K.fillStyle="rgba(44,160,0,"+n+")";break;case 2:K.fillStyle="rgba(44,0,160,"+n+")"}}function lt(e){var t;z=[];if(Object.prototype.toString.call(e)==="[object Array]")for(t=0;t<e.length;t++)U=nt(e[t],0,V),z.push(U);else U=nt(r.dataset,0,V),z=[U];G()}function ct(e){x=d3.scale[r.xscale]().domain([0,e]).range([0,k.width]),it.xmax=e,x_tics_scale=d3.scale[r.xscale]().domain([it.xmin*it.sample,it.xmax*it.sample]).range([0,k.width]),S(),n()}function ht(e){y=d3.scale[r.yscale]().domain([e,0]).range([0,k.height]),it.ymax=e,S(),n()}function pt(){J.width=J.width,K.fillStyle="rgba(0,255,0, 0.05)",K.fillRect(0,0,J.width,J.height),K.strokeStyle="rgba(255,65,0, 1.0)"}function dt(){v.select("path.line").remove(),J.style.zIndex=100}function vt(){J.style.zIndex=-100,S()}function mt(e){var t,n,i,s,o,u=A(1e-5),a=r.lines,f=r.bars,l=2*Math.PI;typeof e=="undefined"?s=z[0].length:s=e;if(U.length===0)return;pt(),K.fillRect(0,0,J.width,J.height);if(a)for(t=0;t<z.length;t++){U=z[t],px=L(0),i=A(U[0].y),n=0,lengthX=0,at(t),K.beginPath(),K.moveTo(px,i),o=s-1;for(n=1;n<o;n++)lengthX+=V,px=L(lengthX),i=A(U[n].y),K.lineTo(px,i);K.stroke(),o=U.length-1;if(n<o){at(t,!0);for(;n<o;n++)lengthX+=V,px=L(lengthX),i=A(U[n].y),K.lineTo(px,i);K.stroke()}}else if(f)for(t=0;t<z.length;t++){U=z[t],lengthX=0,at(t),o=s-1;for(n=0;n<o;n++){px=L(lengthX),i=A(U[n].y);if(i===0)continue;K.beginPath(),K.moveTo(px,u),K.lineTo(px,i),K.stroke(),lengthX+=V}o=U.length-1;if(n<o){at(t,!0);for(;n<o;n++)px=L(lengthX),i=A(U[n].y),K.beginPath(),K.moveTo(px,u),K.lineTo(px,i),K.stroke(),lengthX+=V}}else for(t=0;t<z.length;t++){U=z[t],lengthX=0,ft
(t),at(t,!0),o=s-1;for(n=0;n<o;n++)px=L(lengthX),i=A(U[n].y),K.arc(px,i,1,0,l,!1),K.fill(),lengthX+=V;o=U.length-1;if(n<o){ft(t,!0),at(t,!0);for(;n<o;n++)px=L(lengthX),i=A(U[n].y),K.arc(px,i,1,0,l,!1),K.fill(),lengthX+=V}}}function gt(){J||(J=J||document.createElement("canvas"),o.appendChild(J)),J.style.zIndex=-100,bt(J)}function yt(){bt(J),mt()}function bt(e){Q.rect=m.node(),Q.width=Q.rect.width.baseVal.value,Q.height=Q.rect.height.baseVal.value,Q.left=Q.rect.getCTM().e,Q.top=Q.rect.getCTM().f,e.style.position="absolute",e.width=Q.width,e.height=Q.height,e.style.width=Q.width+"px",e.style.height=Q.height+"px",e.offsetLeft=Q.left,e.offsetTop=Q.top,e.style.left=Q.left+"px",e.style.top=Q.top+"px",e.style.border="solid 1px red",e.style.pointerEvents="none",e.className+="canvas-overlay",K=J.getContext("2d"),K.globalCompositeOperation="source-over",K.lineWidth=1,K.fillStyle="rgba(0,255,0, 0.05)",K.fillRect(0,0,e.width,J.height),K.strokeStyle="rgba(255,65,0, 1.0)",J.style.border="solid 1px red"}et(),d===undefined?(d=s.append("svg").attr("width",u).attr("height",a),v=d.append("g").attr("transform","translate("+C.left+","+C.top+")"),m=v.append("rect").attr("class","plot").attr("width",k.width).attr("height",k.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",T).on("touchstart",T),m.call(d3.behavior.zoom().x(L).y(A).on("zoom",n)),g=v.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",k.width).attr("height",k.height).attr("viewBox","0 0 "+k.width+" "+k.height).append("path").attr("class","line").attr("d",O(U)),X=g.append("path").attr("class","marker"),r.title&&B.value>1&&(b=v.selectAll("text").data(R,function(e){return e}),b.enter().append("text").attr("class","title").style("font-size",B.value/3.2*100+"%").text(function(e){return e}).attr("x",k.width/2).attr("dy",function(e,t){return-0.5+ -1*B.value/2.8*t*D+"em"}).style("text-anchor","middle")),r.xlabel&&B.value>2&&(w=v.append("text").attr("class","axis").style("font-size",B.value/2.6*100+"%").attr("class","xlabel").text(r.xlabel).attr("x",k.width/2).attr("y",k.height).attr("dy","2.4em").style("text-anchor","middle")),r.ylabel&&B.value>2&&(E=v.append("g").append("text").attr("class","axis").style("font-size",B.value/2.6*100+"%").attr("class","ylabel").text(r.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+k.height/2+") rotate(-90)")),N=v.append("text").attr("class","graph-notification").text(i).attr("x",k.width/2).attr("y",k.height/2).style("text-anchor","middle"),d3.select(o).on("mousemove.drag",P).on("touchmove.drag",P).on("mouseup.drag",H).on("touchend.drag",H),gt(),dt()):(v.attr("width",u).attr("height",a),m.attr("width",k.width).attr("height",k.height).style("fill","#EEEEEE"),g.attr("top",0).attr("left",0).attr("width",k.width).attr("height",k.height).attr("viewBox","0 0 "+k.width+" "+k.height),r.title&&B.value>1&&b.each(function(e,t){d3.select(this).attr("x",k.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-R.length+"em"})}),r.xlabel&&B.value>1&&w.attr("x",k.width/2).attr("y",k.height),r.ylabel&&B.value>1&&E.attr("transform","translate(-40 "+k.height/2+") rotate(-90)"),N.attr("x",k.width/2).attr("y",k.height/2),v.selectAll("g.x").remove(),v.selectAll("g.y").remove(),yt()),n(),it.node=o,it.scale=et,it.update=S,it.redraw=n,it.initialize=tt,it.notify=e,it.number_of_points=rt,it.new_data=lt,it.add_point=Z,it.add_points=ot,it.add_canvas_point=st,it.add_canvas_points=ut,it.initialize_canvas=gt,it.show_canvas=dt,it.hide_canvas=vt,it.clear_canvas=pt,it.update_canvas=mt,it.showMarker=$,it.change_xaxis=ct,it.change_yaxis=ht}var s,o,u,a,f=function(e){return e?"#ccc":"#666"},l=function(e){return"translate("+L(e)+",0)"},c=function(e){return"translate(0,"+A(e)+")"},h,p,d,v,m,g,b,w,E,S,T,N,C,k,L,A,O,M,_,D,P,H,B={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},j=Math.NaN,F=Math.NaN,I=null,q=null,R=[],U,z,W,X,V,J,K,Q={},G={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xscale:"linear",yscale:"linear",xTicCount:10,yTicCount:10,xscaleExponent:.5,yscaleExponent:.5,xFormatter:"3.2r",yFormatter:"3.2r",xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1,points:!1,sample:1,lines:!0,bars:!1};return tt(n,r,i),it.add_data=function(e){if(!arguments.length)return U;var t=L.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)U.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");U.push(e)}return U[U.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,L.domain(t),it.redraw()):it.update(),it},it.reset=function(e,t,n){return arguments.length?it.initialize(e,t,n):it.initialize(),it(),it},it.resize=function(e,t){return it.scale(e,t),it.initialize(),it(),it},o&&it(),it}}),n("grapher/core/colors",["require"],function(e){return function(t){var n={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return n[t]}}),n("grapher/core/data",["require"],function(e){return function(t){var n=0,r=t.length,i=[];for(n=0;n<r;n+=2)i.push({x:t[n],y:t[n+1]});return i}}),n("grapher/core/indexed-data",["require"],function(e){return function(t,n){var r=0,i=n||0,s=t.length,o=[];for(r=0;r<s;r++)o.push({x:r+i,y:t[r]});return o}}),n("grapher/public-api",["require","grapher/core/graph","grapher/core/real-time-graph","grapher/core/axis","grapher/core/colors","grapher/core/data","grapher/core/indexed-data","grapher/core/register-keyboard-handler"],function(e){"use strict";var t=e("grapher/core/graph"),n=e("grapher/core/real-time-graph"),r=e("grapher/core/axis"),i=e("grapher/core/colors"),s=e("grapher/core/data"),o=e("grapher/core/indexed-data"),u=e("grapher/core/register-keyboard-handler"),a;return a={version:"0.0.1",graph:t,realTimeGraph:n,axis:r,colors:i,data:s,indexedData:o,registerKeyboardHandler:u},window.grapher=a,a}),t(["grapher/public-api"],undefined,undefined,!0)})(),function(){var e,t,n;(function(r){function c(e,t){var n=t&&t.split("/"),r=o.map,i=r&&r["*"]||{},s,u,a,f,l,c,h,p,d,v;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(p=0;v=e[p];p++)if(v===".")e.splice(p,1),p-=1;else if(v===".."){if(p===1&&(e[2]===".."||e[0]===".."))return!0;p>0&&(e.splice(p-1,2),p-=2)}e=e.join("/")}if((n||i)&&r){s=e.split("/");for(p=s.length;p>0;p-=1){u=s.slice(0,p).join("/");if(n)for(d=n.length;d>0;d-=1){a=r[n.slice(0,d).join("/")];if(a){a=a[u];if(a){f=a,l=p;break}}}if(f)break;!c&&i&&i[u]&&(c=i[u],h=p)}!f&&c&&(f=c,l=h),f&&(s.splice(0,l,f),e=s.join("/"))}return e}function h(e,t){return function(){return l.apply(r,a.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){i[e]=t}}function v(e){if(s.hasOwnProperty(e)){var t=s[e];delete s[e],u[e]=!0,f.apply(r,t)}if(!i.hasOwnProperty(e))throw new Error("No "+e);return i[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return o&&o.config&&o.config[e]||{}}}var i={},s={},o={},u={},a=[].slice,f,l;f=function(e,t,n,o){var a=[],f,l,c,p,y,b;o=o||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(b=0;b<t.length;b++){y=m(t[b],o),c=y.f;if(c==="require")a[b]=h(e);else if(c==="exports")a[b]=i[e]={},f=!0;else if(c==="module")l=a[b]={id:e,uri:"",exports:i[e],config:g(e)};else if(i.hasOwnProperty(c)||s.hasOwnProperty(c))a[b]=v(c);else if(y.p)y.p.load(y.n,h(o,!0),d(c),{}),a[b]=i[c];else if(!u[c])throw new Error(e+" missing "+c)}p=n.apply(i[e],a);if(e)if(l&&l.exports!==r&&l.exports!==i[e])i[e]=l.exports;else if(p!==r||!f)i[e]=p}else e&&(i[e]=n)},e=t=l=function(e,t,n,i){return typeof e=="string"?v(m(e,t).f):(e.splice||(o=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),l)},l.config=function(e){return o=e,l},n=function(e,t,n){t.splice||(n=t,t=[]),s[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../vendor/almond/almond",function(){}),n("common/console",["require"],function(e){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){})}),n("arrays/index",["require","exports","module"],function(e,t,n){var r={},i=function(){var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return t&&t[3]?!1:!0}();r.version="0.0.1",r.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,r.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),r.create=function(e,t,n){n||(r.webgl||r.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var i,s;if(n==="regular")i=new Array(e);else switch(n){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+n+'".')}s=-1;while(++s<e)i[s]=t;return i},r.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor)return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},r.copy=function(e,t){var n=e.length,i=-1;while(++i<n)t[i]=e[i];return r.constructor_function(t)===Array&&(t.length=n),t},r.clone=function(e){var t,n=e.length,i,s;s=r.constructor_function(e);if(s===Array){i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i}if(e.buffer.slice)return i=new s(e.buffer.slice(0)),i;i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i},r.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},r.max=function(e){return Math.max.apply(Math,e)},r.min=function(e){return Math.min.apply(Math,e)},r.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},r.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},r.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},r.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},r.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r},r.extend=function(e,t){var n,i,s,o;return o=r.constructor_function(e),o===Array?(e.length=t,e):(s=new o(t),s.set(e.subarray(0,t)),s)};for(var s in r)r.hasOwnProperty(s)&&(t[s]=r[s])}),n("arrays",["arrays/index"],function(e){return e}),n("md2d/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=1.66054e-27,i=1.602177e-19,s=i,o=1e-15,u=1e-9,a=10,f=1e3,l={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},c,h,p;t.unit=c={FEMTOSECOND:{name:"femtosecond",value:1,type:l.TIME},SECOND:{name:"second",value:o,type:l.TIME},NANOMETER:{name:"nanometer",value:1,type:l.LENGTH},ANGSTROM:{name:"Angstrom",value:1*a,type:l.LENGTH},METER:{name:"meter",value:1*u,type:l.LENGTH},DALTON:{name:"Dalton",value:1,type:l.MASS},GRAM:{name:"gram",value:1*r*f,type:l.MASS},KILOGRAM:{name:"kilogram",value:1*r,type:l.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:l.ENERGY},JOULE:{name:"Joule",value:r*u*u*(1/o)*(1/o),type:l.ENERGY},EV:{name:"electron volt",value:r*u*u*(1/o)*(1/o)*(1/s),type:l.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:l.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:l.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:l.CHARGE},COULOMB:{name:"Coulomb",value:i,type:l.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:l.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:l.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:l.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:l.FORCE},NEWTON:{name:"Newton",value:1*r*u*(1/o)*(1/o),type:l.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*r*u*u*(1/o)*(1/o)*(1/s),type:l.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:l.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/o),type:l.VELOCITY}},t.ratio=h=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=p=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*h(r,{per:n})}}),n("md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={ELEMENTARY_CHARGE:{value:1,unit:i.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:i.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:i.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:s(i.DALTON,{per:i.GRAM}),unit:i.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:i.FARADS_PER_METER}},a,f;u.COULOMB_CONSTANT={value:1/(4*Math.PI*u.PERMITTIVITY_OF_FREE_SPACE.value),unit:i.METERS_PER_FARAD},t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),n("md2d/models/engine/math/distributions",["require","exports","module"],function(e,t,n){t.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),n("md2d/models/engine/math/utils",["require","exports","module"],function(e,t,n){t.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(s){return r-=n[t]||0,r+=s,n[t]=s,++t===e&&(t=0),n.length===e?r/e:NaN}}}),n("md2d/models/engine/math/minimizer",["require","exports","module"],function(e,t,n){t.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var r=n.precision,i=n.bounds,s=n.maxiter||1e3,o=n.stopval||-Infinity,u=n.maxstep||.01,a=n.eps||.01,f=t.length,l,c,h,p,d,v,m,g,y,b;v=u*u,l=[];for(y=0;y<f;y++)l[y]=t[y];c=e.apply(null,l),h=c[0],d=c[1],g=0;do{if(h<=o)break;if(g>s)return console.log("maxiter reached"),{error:"maxiter reached",f:h,iter:s,x:l};m=0;for(y=0;y<f;y++)m+=d[y]*d[y];if(a*a*m>v){b=Math.sqrt(v/m)/a;for(y=0;y<f;y++)d[y]=b*d[y]}for(y=0;y<f;y++)l[y]-=a*d[y],i&&l[y]<i[y][0]&&(l[y]=i[y][0]),i&&l[y]>i[y][1]&&(l[y]=i[y][1]);p=h,c=e.apply(null,l),h=c[0],d=c[1],g++}while(Math.abs(h-p)>r);return[h,l]}}),n("md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./minimizer"],function(e,t,n){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.minimize=e("./minimizer").minimize}),n("md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=.346,o=r.COULOMB_CONSTANT.as(r.unit.METERS_PER_FARAD),u=r.ratio(i.NANOMETER,{per:i.METER}),a=Math.pow(r.ratio(i.COULOMB,{per:i.ELEMENTARY_CHARGE}),2),f=r.ratio(i.EV,{per:i.JOULE}),l=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON}),c=s*o*a*u*f,h=s*o*a*u*u*l,p=t.potential=function(e,t,n){return c*(t*n/e)},d=t.forceFromSquaredDistance=function(e,t,n){return-h*(t*n/e)},v=t.forceOverDistanceFromSquaredDistance=function(e,t,n){return d(e,t,n)/Math.sqrt(e)},m=t.force=function(e,t,n){return d(e*e,t,n)}}),n("md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=r.ratio(i.NANOMETER,{per:i.METER}),o=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,n){var u,a,f,l,c,h,p,d=!1,v=function(e,v){u=e,a=v,f=t.rmin(a),u!=null&&a!=null&&(l=4*u*Math.pow(a,12),c=4*u*Math.pow(a,6),h=12*r.convert(l,{from:i.EV,to:i.JOULE})*s*o,p=6*r.convert(c,{from:i.EV,to:i.JOULE})*s*o),d&&typeof n=="function"&&n(m(),this)},m=function(){return{epsilon:u,sigma:a,rmin:f}},g=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},y=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},b;return g(e.epsilon),y(e.sigma),v(e.epsilon,e.sigma),d=!0,b={getCoefficients:m,setEpsilon:function(e){g(e),v(e,a)},setSigma:function(e){y(e),v(u,e)},potentialFromSquaredDistance:function(e){return e?l*Math.pow(e,-6)-c*Math.pow(e,-3):-Infinity},potential:function(e){return b.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*b.forceOverDistanceFromSquaredDistance(e*e)}}}}),n("md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t,n){var r=t.potentials={};t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),n("md2d/models/engine/md2d",["require","exports","module","common/console","arrays","./constants/index","./math/index","./potentials/index","./potentials/index"],function(e,t,n){e("common/console");var r=e("arrays"),i=e("./constants/index"),s=i.unit,o=e("./math/index"),u=e("./potentials/index").coulomb,a=e("./potentials/index").lennardJones,f=function(){var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),l=r.typed&&f?"Float32Array":"regular",c=r.typed&&f?"Uint16Array":"regular",h=r.typed&&f?"Uint8Array":"regular",p=1,d=1e3,v=-120*i.BOLTZMANN_CONSTANT.as(s.EV_PER_KELVIN),m=.34,g=39.95,y=i.convert(g,{from:s.DALTON,to:s.KILOGRAM}),b=i.BOLTZMANN_CONSTANT.as(s.JOULES_PER_KELVIN),w,E,S,x,T,N,C,k=function(e,t,n,r){return e*r-t*n},L=function(e,t){return e*e+t*t},A=function(e,t){var n=2*t,r=2/n*e,o=i.convert(r,{from:s.MW_ENERGY_UNIT,to:s.JOULE});return o/b},O=function(e,t){var n=2*t,r=e*b,o=i.convert(r,{from:s.JOULE,to:s.MW_ENERGY_UNIT}),u=o*n/2;return u},M=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")};t.ATOM_PROPERTY_LIST=E=["radius","px","py","x","y","vx","vy","speed","ax","ay","charge","element","pinned","friction","mass"],t.RADIAL_BOND_PROPERTY_LIST=x=["atom1","atom2","length","strength","style"],t.ANGULAR_BOND_PROPERTY_LIST=T=["atom1","atom2","atom3","angle","strength"],t.RADIAL_BOND_STYLES=C={RADIAL_BOND_STANDARD_STICK_STYLE:101,RADIAL_BOND_LONG_SPRING_STYLE:102,RADIAL_BOND_SOLID_LINE_STYLE:103,RADIAL_BOND_GHOST_STYLE:104,RADIAL_BOND_UNICOLOR_STICK_STYLE:105,RADIAL_BOND_SHORT_SPRING_STYLE:106,RADIAL_BOND_DOUBLE_BOND_STYLE:107,RADIAL_BOND_TRIPLE_BOND_STYLE:108},t.ELEMENT_PROPERTY_LIST=S=["mass","epsilon","sigma","radius"],t.OBSTACLE_PROPERTY_LIST=["x","y","width","height","mass","vx","vy","externalFx","externalFy","friction","xPrev","yPrev","colorR","colorG","colorB","visible"],t.VDW_INDICES=N={COUNT:0,ATOM1:1,ATOM2:2},t.DEFAULT_VALUES=w={charge:0,friction:0,pinned:0,RADIAL_BOND_STYLE:C.RADIAL_BOND_STANDARD_STICK_STYLE},t.createEngine=function(){var e,t=!1,n=!1,f=!1,v=!1,m=!1,g=!0,y=!1,b=!1,E=!1,S,x=.001,T=[10,10],C,O=0,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt=0,it,st,ot,ut,at,ft,lt,ct,ht=0,pt,dt,vt,mt,gt,yt,bt=0,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt=0,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t=0,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn=[],on=[],un=5,an=[],fn=[],ln=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},cn=function(e,t){var n=Z[e],r=Z[t],i=et[e],s=et[t],o,u;o=sn[e][t]=sn[t][e]=a.pairwiseEpsilon(n,r),u=on[e][t]=on[t][e]=a.pairwiseSigma(i,s),an[e][t]=an[t][e]=un*u*un*u,fn[e][t]=fn[t][e]=a.newLJCalculator({epsilon:o,sigma:u},ln)},hn=function(e,t){var n,i;if(Array.isArray(e))for(n=0,i=e.length;n<i;n++)e[n]=r.extend(e[n],t);else for(n in e)e.hasOwnProperty(n)&&(e[n]=r.extend(e[n],t))},pn={atoms:function(){B=G.radius,j=G.px,F=G.py,I=G.x,q=G.y,R=G.vx,U=G.vy,z=G.speed,W=G.ax,X=G.ay,V=G.charge,J=G.friction,$=G.element,K=G.pinned,Q=G.mass},radialBonds:function(){it=ft.atom1,st=ft.atom2,ot=ft.length,ut=ft.strength,at=ft.style},angularBonds:function(){pt=yt.atom1,dt=yt.atom2,vt=yt.atom3,mt=yt.angle,gt=yt.strength},elements:function(){Y=nt.mass,Z=nt.epsilon,et=nt.sigma,tt=nt.radius},obstacles:function(){wt=Bt.x,Et=Bt.y,St=Bt.width,xt=Bt.height,At=Bt.mass,Tt=Bt.vx,Nt=Bt.vy,Ct=Bt.externalFx,kt=Bt.externalFy,Lt=Bt.friction,Ot=Bt.xPrev,Mt=Bt.yPrev,_t=Bt.colorR,Dt=Bt.colorG,Pt=Bt.colorB,Ht=Bt.visible},springForces:function(){Ut=Vt[0],zt=Vt[1],Wt=Vt[2],Xt=Vt[3]}},dn=function(t){nt=e.elements={},nt.mass=r.create(t,0,l),nt.epsilon=r.create(t,0,l),nt.sigma=r.create(t,0,l),nt.radius=r.create(t,0,l),pn.elements()},vn=function(t){var n;ft=e.radialBonds={},ft.atom1=r.create(t,0,c),ft.atom2=r.create(t,0,c),ft.length=r.create(t,0,l),ft.strength=r.create(t,0,l),ft.style=r.create(t,0,h),pn.radialBonds(),lt=e.radialBondResults=[];for(n=0;n<t;n++)lt[n]={},lt[n].idx=n},mn=function(t){yt=e.angularBonds={},yt.atom1=r.create(t,0,c),yt.atom2=r.create(t,0,c),yt.atom3=r.create(t,0,c),yt.angle=r.create(t,0,l),yt.strength=r.create(t,0,l),pn.angularBonds()},gn=function(t){Vt=e.springForces=[],Vt[0]=r.create(t,0,c),Vt[1]=r.create(t,0,l),Vt[2]=r.create(t,0,l),Vt[3]=r.create(t,0,l),pn.springForces()},yn=function(t){Bt=e.obstacles={},Bt.x=r.create(t,0,l),Bt.y=r.create(t,0,l),Bt.width=r.create(t,0,l),Bt.height=r.create(t,0,l),Bt.mass=r.create(t,0,l),Bt.vx=r.create(t,0,l),Bt.vy=r.create(t,0,l),Bt.externalFx=r.create(t,0,l),Bt.externalFy=r.create(t,0,l),Bt.friction=r.create(t,0,l),Bt.xPrev=r.create(t,0,l),Bt.yPrev=r.create(t,0,l),Bt.colorR=r.create(t,0,l),Bt.colorG=r.create(t,0,l),Bt.colorB=r.create(t,0,l),Bt.visible=r.create(t,0,h),pn.obstacles()},bn,wn=function(){return v&&m?1e3:1e3},En=function(){E=!0,bn=o.getWindowedAverager(wn())},Sn=function(){var e=0,t;for(t=0;t<P;t++)e+=Q[t]*(R[t]*R[t]+U[t]*U[t]);for(t=0;t<jt;t++)At[t]!==Infinity&&(e+=At[t]*(Tt[t]*Tt[t]+Nt[t]*Nt[t]));return A(e/2,P)},xn=function(e,t){R[e]*=t,U[e]*=t,j[e]*=t,F[e]*=t},Tn=function(e,t){Tt[e]*=t,Nt[e]*=t},Nn=function(e,t,n){R[e]+=t,U[e]+=n,j[e]=R[e]*Q[e],F[e]=U[e]*Q[e]},Cn=function(e,t){R[e]-=t*(q[e]-Kt),U[e]+=t*(I[e]-Jt),j[e]=R[e]*Q[e],F[e]=U[e]*Q[e]},kn=function(){for(var e=0;e<P;e++)Nn(e,-Yt,-Zt),Cn(e,-nn)},Ln=function(){var e=0,t=0,n=0,r=0,i;for(i=0;i<P;i++)e+=I[i],t+=q[i],n+=j[i],r+=F[i];Jt=e/P,Kt=t/P,Qt=n,Gt=r,Yt=n/H,Zt=r/H},An=function(){var e=0,t=0,n,r;for(r=0;r<P;r++)n=Q[r],e+=n*k(I[r]-Jt,q[r]-Kt,R[r]-Yt,U[r]-Zt),t+=n*L(I[r]-Jt,q[r]-Kt);en=e,tn=t,nn=en/tn},On=function(){Ln(),An()},Mn=function(e){I[e]+=R[e]*_+.5*W[e]*D,q[e]+=U[e]*_+.5*X[e]*D},_n=function(e){var t,n,r,i=Tt[e],s=Nt[e],o=Ct[e],u=kt[e];if(i||s||o||u)r=C*Lt[e],t=o-r*i,n=u-r*s,Ot[e]=wt[e],Mt[e]=Et[e],wt[e]+=i*_+.5*t*D,Et[e]+=s*_+.5*n*D,Tt[e]+=t*_,Nt[e]+=n*_},Dn=function(e){var t=B[e],n=t,r=t,i=T[0],s=T[1],o=i-t,u=s-t;if(I[e]<n){while(I[e]<n-i)I[e]+=i;I[e]=n+(n-I[e]),R[e]*=-1,j[e]*=-1}else if(I[e]>o){while(I[e]>o+i)I[e]-=i;I[e]=o-(I[e]-o),R[e]*=-1,j[e]*=-1}if(q[e]<r){while(q[e]<r-s)q[e]+=s;q[e]=r+(r-q[e]),U[e]*=-1,F[e]*=-1}else if(q[e]>u){while(q[e]>u+i)q[e]-=i;q[e]=u-(q[e]-u),U[e]*=-1,F[e]*=-1}},Pn=function(e,t,n){if(jt<1)return;var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=0;r=B[e],i=I[e],s=q[e];for(o=0;o<jt;o++)u=wt[o]-r,a=wt[o]+St[o]+r,f=Et[o]+xt[o]+r,l=Et[o]-r,c=Ot[o]-r,h=Ot[o]+St[o]+r,p=Mt[o]+xt[o]+r,d=Mt[o]-r,i>u&&i<a&&s>l&&s<f&&(t<=c?(I[e]=u-(i-u),S=1):t>=h?(I[e]=a+(a-i),S=1):n<=p?(q[e]=l-(s-l),S=-1):n>=d&&(q[e]=f+(f-s),S=-1)),w=At[o],S&&(w!==Infinity?(b=Q[e],E=w+b,S===1?(v=R[e],g=Tt[o],R[e]=(v*(b-w)+2*w*g)/E,Tt[o]=(g*(w-b)+2*j[e])/E):(m=U[e],y=Nt[o],U[e]=(m*(b-w)+2*w*y)/E,Nt[o]=(y*(w-b)+2*F[e])/E)):S===1?R[e]*=-1:U[e]*=-1)},Hn=function(e){var t=Q[e];R[e]+=.5*W[e]*_,j[e]=t*R[e],U[e]+=.5*X[e]*_,F[e]=t*U[e]},Bn=function(e){R[e]=U[e]=W[e]=X[e]=0},jn=function(e){var t,n,r,i,s,o,a,f=$[e],l,c=V[e],h=ct&&ct[e];for(t=0;t<e;t++){if(h&&h[t])continue;l=$[t],n=I[t]-I[e],r=q[t]-q[e],i=n*n+r*r,s=0,g&&i<an[f][l]&&(s+=fn[f][l].forceOverDistanceFromSquaredDistance(i)),v&&m&&(s+=u.forceOverDistanceFromSquaredDistance(i,c,V[t])),s&&(o=s*n,a=s*r,W[e]+=o,X[e]+=a,W[t]-=o,X[t]-=a)}},Fn=function(){if(!b)return;var e;for(e=0;e<P;e++)X[e]-=b},In=function(){if(!C)return;var e,t;for(e=0;e<P;e++)t=C*J[e],W[e]+=-R[e]*t,X[e]+=-U[e]*t},qn=function(){if(ht<1)return;var e,t,n,r,o,u,a,f,l,c,h,p,d;for(e=0,t=it.length;e<t;e++)n=it[e],r=st[e],o=I[r]-I[n],u=q[r]-q[n],a=o*o+u*u,f=Math.sqrt(a),l=ut[e],c=ot[e],h=i.convert(l*(f-c),{from:s.EV_PER_NM,to:s.MW_FORCE_UNIT})/f,p=h*o,d=h*u,W[n]+=p,X[n]+=d,W[r]-=p,X[r]-=d},Rn=function(){if(bt<1)return;var e,t,n,r,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;for(e=0,t=yt.atom1.length;e<t;e++)n=pt[e],r=dt[e],o=vt[e],m=mt[e],v=gt[e],u=I[n]-I[o],f=I[r]-I[o],a=q[n]-q[o],l=q[r]-q[o],c=u*u+a*a,h=f*f+l*l,p=Math.sqrt(c),d=Math.sqrt(h),y=(u*f+a*l)/(p*d),y>1?y=1:y<-1&&(y=-1),b=Math.sqrt(1-y*y),g=Math.acos(y),b<1e-4&&(b=1e-4),T=i.convert(v*(g-m)/(b*p),{from:s.EV_PER_NM,to:s.MW_FORCE_UNIT})/d,N=u*f+a*l,w=T*(f-N*u/c),E=T*(l-N*a/c),S=T*(u-N*f/h),x=T*(a-N*l/h),W[n]+=w,X[n]+=E,W[r]+=S,X[r]+=x,W[o]-=w+S,X[o]-=E+x},Un=function(){if($t<1)return;var e,t,n,r,o,u,a,f,l,c;for(e=0;e<$t;e++){c=Ut[e],t=zt[e]-I[c],n=Wt[e]-q[c];if(t===0&&n===0)continue;o=t*t+n*n,r=Math.sqrt(o),u=Xt[e],a=i.convert(u*r,{from:s.EV_PER_NM,to:s.MW_FORCE_UNIT})/r,f=a*t,l=a*n,W[c]+=f,X[c]+=l}},zn=function(e,t){var n,r;e==null&&(e=S),rn=Sn(),E&&Math.abs(bn(rn)-e)<=e*x&&(E=!1);if(t||y||E&&rn>0){n=Math.sqrt(e/rn);for(r=0;r<P;r++)xn(r,n);for(r=0;r<jt;r++)Tn(r,n);rn=e}};return e={useCoulombInteraction:function(e){v=!!e},useLennardJonesInteraction:function(e){g=!!e},useThermostat:function(e){y=!!e},setGravitationalField:function(e){typeof e=="number"&&e!==0?b=e:b=!1},setTargetTemperature:function(e){M(e),S=e},setTime:function(e){O=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;T=[n,r]},getSize:function(){return[T[0],T[1]]},getLJCalculator:function(){return fn},setElementProperties:function(e,t){var n,r;if(t.mass!=null&&t.mass!==Y[e]){Y[e]=t.mass;for(n=0;n<P;n++)$[n]===e&&(Q[n]=t.mass)}if(t.sigma!=null){et[e]=t.sigma,r=a.radius(t.sigma);if(tt[e]!==r){tt[e]=r;for(n=0;n<P;n++)$[n]===e&&(B[n]=r)}}t.epsilon!=null&&(Z[e]=t.epsilon);for(n=0;n<rt;n++)cn(e,n)},createAtoms:function(i){var s;if(!f)throw new Error("md2d: createAtoms was called before setElements.");if(n)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");n=!0,t=!0;if(typeof i=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");s=i.num;if(typeof s=="undefined")throw new Error("md2d: createAtoms was called without the required 'num' option specifying the number of atoms to create.");if(s!==Math.floor(s))throw new Error("md2d: createAtoms was passed a non-integral 'num' option.");if(s<p)throw new Error("md2d: create Atoms was passed an 'num' option equal to: "+s+" which is less than the minimum allowable value: N_MIN = "+p+".");if(s>d)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+s+" which is greater than the minimum allowable value: N_MAX = "+d+".");G=e.atoms={},G.radius=r.create(s,0,l),G.px=r.create(s,0,l),G.py=r.create(s,0,l),G.x=r.create(s,0,l),G.y=r.create(s,0,l),G.vx=r.create(s,0,l),G.vy=r.create(s,0,l),G.speed=r.create(s,0,l),G.ax=r.create(s,0,l),G.ay=r.create(s,0,l),G.charge=r.create(s,0,l),G.friction=r.create(s,0,l),G.element=r.create(s,0,h),G.pinned=r.create(s,0,h),G.mass=r.create(s,0,l),pn.atoms(),P=0,H=0},addAtom:function(e,t,n,r,i,s,o,u){var a;return P+1>G.x.length&&(hn(G,P+10),pn.atoms()),s==null&&(s=w.charge),o==null&&(o=w.friction),u==null&&(u=w.pinned),a=Y[e],$[P]=e,B[P]=tt[e],I[P]=t,q[P]=n,R[P]=r,U[P]=i,j[P]=r*a,F[P]=i*a,W[P]=0,X[P]=0,z[P]=Math.sqrt(r*r+i*i),V[P]=s,J[P]=o,K[P]=u,Q[P]=a,s&&(m=!0),H+=a,P++},addElement:function(e){var t;rt>=Z.length&&(hn(nt,rt+10),pn.N_elements()),Y[rt]=e.mass,Z[rt]=e.epsilon,et[rt]=e.sigma,tt[rt]=a.radius(e.sigma),sn[rt]=[],on[rt]=[],fn[rt]=[],an[rt]=[];for(t=0;t<=rt;t++)cn(rt,t);f=!0,rt++},addRadialBond:function(e,t,n,r,i){i==null&&(i=w.RADIAL_BOND_STYLE),ht>=it.length&&(hn(ft,ht+10),pn.radialBonds()),lt[ht].atom1=it[ht]=e,lt[ht].atom2=st[ht]=t,lt[ht].lenght=ot[ht]=n,lt[ht].strength=ut[ht]=r,lt[ht].style=at[ht]=i,ct[e]||(ct[e]=[]),ct[e][t]=!0,ct[t]||(ct[t]=[]),ct[t][e]=!0,ht++},addAngularBond:function(e,t,n,r,i){bt+1>yt.atom1.length&&(hn(yt,bt+10),pn.angularBonds()),pt[bt]=e,dt[bt]=t,vt[bt]=n,mt[bt]=r,gt[bt]=i,bt++},addSpringForce:function(e,t,n,r){return Vt||gn(1),$t>Vt[0].length&&(hn(Vt,$t+1),pn.springForces()),Ut[$t]=e,zt[$t]=t,Wt[$t]=n,Xt[$t]=r,$t++},updateSpringForce:function(e,t,n){zt[e]=t,Wt[e]=n},removeSpringForce:function(e){if(e>=$t)return;$t--},springForceAtomIndex:function(e){return Ut[e]},addObstacle:function(e,t,n,r,i,s,o,u,a,f,l,c){var h;jt+1>Bt.x.length&&(hn(Bt,jt+1),pn.obstacles()),wt[jt]=e,Et[jt]=t,Ot[jt]=e,Mt[jt]=t,Tt[jt]=n,Nt[jt]=r,Ct[jt]=i,kt[jt]=s,Lt[jt]=o,St[jt]=u,xt[jt]=a,f=parseFloat(f),h=f*u*a,At[jt]=h,_t[jt]=l[0],Dt[jt]=l[1],Pt[jt]=l[2],Ht[jt]=c,jt++},atomInBounds:function(e,t,n){var r=B[n],i;if(e<r||e>T[0]-r||t<r||t>T[1]-r)return!1;for(i=0;i<jt;i++)if(e>wt[i]-r&&e<wt[i]+St[i]+r&&t>Et[i]-r&&t<Et[i]+xt[i]+r)return!1;return!0},canPlaceAtom:function(t,n,r,i){var s,o,u;return e.atomInBounds(n,r,i)?(typeof i=="number"&&(s=I[i],o=q[i],I[i]=q[i]=Infinity),u=e.newPotentialCalculator(t,0,!1)(n,r),typeof i=="number"&&(I[i]=s,q[i]=o),u<=0):!1},initializeAtomsFromProperties:function(t){var n,r,i,s,o,u,a,f,l,c;if(!t.x||!t.y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!t.vx||!t.vy)throw new Error("md2d: For now, velocities must be set when locations are set.");for(l=0,c=t.x.length;l<c;l++)u=t.element?t.element[l]:0,n=t.x[l],r=t.y[l],i=t.vx[l],s=t.vy[l],o=t.charge?t.charge[l]:0,f=t.pinned?t.pinned[l]:0,a=t.friction?t.friction[l]:0,e.addAtom(u,n,r,i,s,o,a,f);rn=Sn()},initializeAtomsRandomly:function(t){var n=t.temperature||100,r=t.num||G.x.length,i=Math.floor(Math.sqrt(r)),s=Math.ceil(r/i),u,a,f,l,c,h,p,d,v,m,g,y,b;M(n),c=T[0]/(1+s),l=T[1]/(1+i),u=-1;for(a=1;a<=i;a++)for(f=1;f<=s;f++){u++;if(u===r)break;b=Math.floor(Math.random()*Z.length),h=o.normal(1,.25),p=2*Math.random()*Math.PI,d=f*c,v=a*l,m=h*Math.cos(p),g=h*Math.sin(p),y=2*(u%2)-1,e.addAtom(b,d,v,m,g,y,0,0,1,0)}On(),kn(),zn(n,!0),rn=Sn()},initializeObstacles:function(t){var n=t.x.length,r;yn(n);for(r=0;r<n;r++)e.addObstacle(t.x[r],t.y[r],t.vx[r],t.vy[r],t.externalFx[r],t.externalFy[r],t.friction[r],t.width[r],t.height[r],t.density[r],t.color[r],t.visible[r])},initializeElements:function(t){var n=t.length,r;dn(n);for(r=0;r<n;r++)e.addElement(t[r]);f=!0},initializeRadialBonds:function(t){var n=t.atom1Index.length,r;ct=[],vn(n);for(r=0;r<n;r++)e.addRadialBond(t.
atom1Index[r],t.atom2Index[r],t.bondLength[r],t.bondStrength[r],t.bondStyle[r])},initializeAngularBonds:function(t){var n=t.atom1Index.length,r;mn(n);for(r=0;r<n;r++)e.addAngularBond(t.atom1Index[r],t.atom2Index[r],t.atom3Index[r],t.bondAngle[r],t.bondStrength[r])},createVdwPairsArray:function(){var t=P*(P-1)/2;Ft=e.vdwPairs=[],Ft[N.COUNT]=It,Ft[N.ATOM1]=qt=r.create(t,0,c),Ft[N.ATOM2]=Rt=r.create(t,0,c),e.updateVdwPairsArray()},updateVdwPairsArray:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=4;It=0;for(e=0;e<P;e++){c=$[e],u=et[c],a=et[c],s=I[e],o=q[e];for(t=e+1;t<P;t++){if(ht!==0&&ct[e]&&ct[e][t])continue;h=$[t],f=et[h],l=et[h],V[e]*V[t]<=0&&(n=I[t]-s,r=q[t]-o,i=n*n+r*r,p=.5*(u+f),p*=p,d=a*l,i<p*v&&d>0&&(qt[It]=e,Rt[It]=t,It++))}}Ft[N.COUNT]=It},relaxToTemperature:function(t){t!=null&&(S=t),M(S),En();while(E)e.integrate()},integrate:function(e,t){var r,i;if(!n)throw new Error("md2d: integrate called before atoms created.");e==null&&(e=100),t==null&&(t=1),_=t,D=_*_,r=tt[0];var s=O,o=Math.floor(e/_),u,a,f,l;for(u=1;u<=o;u++){O=s+u*_;for(a=0;a<P;a++)f=I[a],l=q[a],Mn(a),Dn(a),Pn(a,f,l),Hn(a),W[a]=X[a]=0,jn(a);for(a=0;a<jt;a++)_n(a);qn(),Rn(),Un(),In();for(a=0;a<P;a++)i=1/Q[a],W[a]*=i,X[a]*=i;Fn();for(a=0;a<P;a++)K[a]&&Bn(a),Hn(a),z[a]=Math.sqrt(R[a]*R[a]+U[a]*U[a]);zn()}},getTotalMass:function(){return H},getRadiusOfElement:function(e){return tt[e]},getNumberOfAtoms:function(){return P},computeOutputState:function(e){var t,n,r,o,a,f,l,c,h,p,d,y,w,E,S,x,T,N,C,k,L,A,M,_;_=0,M=0;for(t=0;t<P;t++){b&&(A=Q[t]*b*q[t],_+=i.convert(A,{from:s.MW_ENERGY_UNIT,to:s.EV})),M+=.5*Q[t]*(R[t]*R[t]+U[t]*U[t]);for(n=t+1;n<P;n++)c=I[n]-I[t],h=q[n]-q[t],x=c*c+h*h,g&&(_-=fn[$[t]][$[n]].potentialFromSquaredDistance(x)),v&&m&&(_+=u.potential(Math.sqrt(x),V[t],V[n]))}for(t=0;t<ht;t++)r=it[t],o=st[t],f=$[r],l=$[o],c=I[o]-I[r],h=q[o]-q[r],x=c*c+h*h,C=ut[t],k=Math.sqrt(x)-ot[t],_+=.5*C*k*k,g&&(_+=fn[f][l].potentialFromSquaredDistance(x)),v&&V[r]&&V[o]&&(_-=u.potential(Math.sqrt(x),V[r],V[o])),lt[t].x1=I[r],lt[t].y1=q[r],lt[t].x2=I[o],lt[t].y2=q[o];for(t=0;t<bt;t++)r=pt[t],o=dt[t],a=vt[t],p=I[r]-I[a],y=I[o]-I[a],d=q[r]-q[a],w=q[o]-q[a],T=Math.sqrt(p*p+d*d),N=Math.sqrt(y*y+w*w),E=(p*y+d*w)/(T*N),E>1?E=1:E<-1&&(E=-1),S=Math.acos(E),L=S-mt[t],_+=.5*gt[t]*L*L;for(t=0;t<jt;t++)At[t]!==Infinity&&(M+=.5*At[t]*(Tt[t]*Tt[t]+Nt[t]*Nt[t]));e.time=O,e.pressure=0,e.PE=_,e.KE=i.convert(M,{from:s.MW_ENERGY_UNIT,to:s.EV}),e.temperature=rn,e.pCM=[Qt,Gt],e.CM=[Jt,Kt],e.vCM=[Yt,Zt],e.omega_CM=nn},newPotentialCalculator:function(e,t,n){return function(r,o){var a=0,f=0,l=0,c,h,p=fn[e],d,y,b,w,E,S,x;for(d=0;d<P;d++)y=r-I[d],b=o-q[d],w=y*y+b*b,S=0,g&&(x=p[$[d]],a+=-x.potentialFromSquaredDistance(w,e,$[d]),n&&(S+=x.forceOverDistanceFromSquaredDistance(w))),v&&m&&t&&(E=Math.sqrt(w),a+=-u.potential(E,t,V[d]),n&&(S+=u.forceOverDistanceFromSquaredDistance(w,t,V[d]))),S&&(f+=S*y,l+=S*b);return n?(c=i.convert(f,{from:s.MW_FORCE_UNIT,to:s.EV_PER_NM}),h=i.convert(l,{from:s.MW_FORCE_UNIT,to:s.EV_PER_NM}),[a,[c,h]]):a}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),u=tt[t],a=o.minimize(s,[n,r],{bounds:[[u,T[0]-u],[u,T[1]-u]]});return a.error?!1:a[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),u=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},a=tt[t],f=o.minimize(u,[n,r],{bounds:[[a,T[0]-a],[a,T[1]-a]],stopval:1e-4,precision:1e-6});return f.error?!1:f[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t=[],n=this.getBondedAtoms(e),r=this.depth,i,s,o;this.depth++;for(i=0,s=n.length;i<s;i++)o=n[i],~this.atomsInMolecule.indexOf(o)||(t=t.concat(this.getMoleculeAtoms(o)));return r===0?(this.depth=0,this.atomsInMolecule=[]):t.push(e),t},getBondedAtoms:function(e){var t=[],n,r;if(ft)for(n=0,r=it.length;n<r;n++)it[n]===e&&t.push(st[n]),st[n]===e&&t.push(it[n]);return t},getAtomKineticEnergy:function(e){var t=.5*Q[e]*(R[e]*R[e]+U[e]*U[e]);return i.convert(t,{from:s.MW_ENERGY_UNIT,to:s.EV})},setViscosity:function(e){C=e}}}}),n("md2d/models/modeler",["require","common/console","arrays","md2d/models/engine/md2d"],function(e){e("common/console");var t=e("arrays"),n=e("md2d/models/engine/md2d"),r;return function(i){function et(){var e,t,r;s.ATOM_PROPERTY_LIST=[],r=0;for(t=0;t<n.ATOM_PROPERTY_LIST.length;t++)e=n.ATOM_PROPERTY_LIST[t],s.ATOM_PROPERTY_LIST[t]=e;s.RADIAL_BOND_PROPERTY_LIST=[];for(t=0;t<n.RADIAL_BOND_PROPERTY_LIST.length;t++)e=n.RADIAL_BOND_PROPERTY_LIST[t],s.RADIAL_BOND_PROPERTY_LIST[t]=e;s.ANGULAR_BOND_PROPERTY_LIST=[];for(t=0;t<n.ANGULAR_BOND_PROPERTY_LIST.length;t++)e=n.ANGULAR_BOND_PROPERTY_LIST[t],s.ANGULAR_BOND_PROPERTY_LIST[t]=e;s.ELEMENT_PROPERTY_LIST=[];for(t=0;t<n.ELEMENT_PROPERTY_LIST.length;t++)e=n.ELEMENT_PROPERTY_LIST[t],s.ELEMENT_PROPERTY_LIST[t]=e;s.NON_ENGINE_PROPERTY_LIST=["visible","marked","draggable"],s.NON_ENGINE_DEFAULT_VALUES={visible:1,marked:0,draggable:0},s.RADIAL_BOND_STYLES={RADIAL_BOND_STANDARD_STICK_STYLE:101,RADIAL_BOND_LONG_SPRING_STYLE:102,RADIAL_BOND_SOLID_LINE_STYLE:103,RADIAL_BOND_GHOST_STYLE:104,RADIAL_BOND_UNICOLOR_STICK_STYLE:105,RADIAL_BOND_SHORT_SPRING_STYLE:106,RADIAL_BOND_DOUBLE_BOND_STYLE:107,RADIAL_BOND_TRIPLE_BOND_STYLE:108},r=s.ATOM_PROPERTY_LIST.length;for(t=0;t<s.NON_ENGINE_PROPERTY_LIST.length;t++)e=s.NON_ENGINE_PROPERTY_LIST[t],s.ATOM_PROPERTY_LIST.push(e);s.SAVEABLE_PROPERTIES=["x","y","vx","vy","charge","element","pinned","friction","visible","marked","draggable"],s.OBSTACLE_PROPERTY_LIST=n.OBSTACLE_PROPERTY_LIST,s.VDW_INDICES=n.VDW_INDICES}function tt(e){$.unique(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function nt(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],K[t]&&(r=r.concat(K[t]));K.all&&(r=r.concat(K.all)),tt(r)}function rt(){var e,t=0,n=s.get_num_atoms();e=-1;while(++e<n)t+=r.atoms.speed[e];return t/n}function it(e,t){var n,i,s;return b?s=!0:(n=Date.now(),k?(i=n-k,1e3/i<C?(s=!0,k=n,L.push(i),L.splice(0,L.length-128)):s=!1):(k=n,s=!0)),s&&(r.integrate(g*y,y),vt(),N.push(T),N.splice(0,N.length-16),ot(),t||u.tick()),b}function st(){return E===0}function ot(){var e,n={};for(e in j)j.hasOwnProperty(e)&&(n[e]=t.clone(j[e]));w.length=E,E++,S++,x=!0,w.push({atoms:n,pressure:D.pressure,pe:D.PE,ke:D.KE,time:D.time}),E>1e3&&(w.splice(1,1),E=1e3)}function ut(){E=0,S=0,w.length=1,lt(E)}function at(){w=[],E=0,S=0}function ft(){w.length=E+1}function lt(e){var n;if(e<0)throw new Error("modeler: request for tick_history_list["+e+"]");if(e>=w.length)throw new Error("modeler: request for tick_history_list["+e+"], tick_history_list.length="+w.length);for(n in j)j.hasOwnProperty(n)&&t.copy(w[e].atoms[n],j[n]);_=w[e].ke,O=w[e].time,r.setTime(O)}function ct(){return N.reduce(function(e,t){return e+t})/N.length}function ht(){var e,t,n=0,r=L.length;e=-1;while(++e<r)n+=L[e];return t=n/r,t?1/t*1e3:0}function pt(e){A=e,r.setTargetTemperature(e)}function dt(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null&&(Q["set_"+t]?Q["set_"+t](e[t]):Q[t]=e[t],n.push(t));nt(n)}function vt(){var e,t,n;r.computeOutputState(D),mt();for(t in j)if(j.hasOwnProperty(t))for(e=0,n=s.get_num_atoms();e<n;e++)F[e][t]=j[t][e];T=D.pressure,M=D.PE,_=D.KE,O=D.time}function mt(){var e,t;F||(F=[]);for(e=F.length,t=s.get_num_atoms();e<t;e++)F[e]||(F[e]={},F[e].idx=e)}function gt(e){for(var t=0;t<s.get_num_atoms();t++)j[e][t]=s.NON_ENGINE_DEFAULT_VALUES[e]}function yt(e,t){for(var n=0;n<s.get_num_atoms();n++)j[e][n]=t[n]}function bt(e){var n,r;for(r=0;r<s.NON_ENGINE_PROPERTY_LIST.length;r++)n=s.NON_ENGINE_PROPERTY_LIST[r],j[n]=t.create(s.get_num_atoms(),0,Z),e[n]?yt(n,e[n]):gt(n)}function wt(){var e,t;for(e=0;e<n.ATOM_PROPERTY_LIST.length;e++)t=n.ATOM_PROPERTY_LIST[e],j[t]=r.atoms[t]}function Et(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t}function St(){var e={},t,n,r,i;for(r=0,i=s.SAVEABLE_PROPERTIES.length;r<i;r++)t=s.SAVEABLE_PROPERTIES[r],n=j[t],e[t]=n.slice?n.slice():Et(n);return e}var s={},o=i.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],u=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addAtom"),a,f,l,c,h,p,d,v,m=!1,g=50,y=1,b=!0,w=[],E=0,S=0,x=!1,T,N=[0],C=60,k,L=[],A,O,M,_,D,P,H=i.width,B=i.height,j,F,I,q,R,U,z,W,X,V,J={vx:0,vy:0,density:Infinity,color:[128,128,128]},K={},Q={temperature:300,modelSampleRate:60,coulomb_forces:!0,lennard_jones_forces:!0,temperature_control:!0,gravitationalField:!1,keShading:!1,chargeShading:!1,showVDWLines:!1,showClock:!0,viewRefreshInterval:50,timeStep:1,VDWLinesRatio:1.99,viscosity:0,set_temperature:function(e){this.temperature=e,r&&r.setTargetTemperature(e)},set_temperature_control:function(e){this.temperature_control=e,r&&r.useThermostat(e)},set_coulomb_forces:function(e){this.coulomb_forces=e,r&&r.useCoulombInteraction(e)},set_epsilon:function(e){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(e){console.log("set_sigma: This method is temporarily deprecated")},set_gravitationalField:function(e){this.gravitationalField=e,r&&r.setGravitationalField(e)},set_viewRefreshInterval:function(e){this.viewRefreshInterval=e},set_timeStep:function(e){this.timeStep=e},set_viscosity:function(e){this.viscosity=e,r&&r.setViscosity(e)}},G=function(){var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return t&&t[3]?!1:!0}(),Y=function(){try{new Float32Array}catch(e){return!1}return!0}(),Z=Y&&G?"Float32Array":"regular";return et(),s.LIVE_DRAG_FRICTION=10,P=i.model_listener,dt(i),s.getStats=function(){return{speed:rt(),ke:_,temperature:A,pressure:ct(),current_step:S,steps:w.length-1}},s.getStatsHistory=function(){var e,t,n,r=[];r.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(e=0,t=w.length;e<t;e++)n=w[e],r.push(n.time+"	"+n.pe+"	"+n.ke+"	"+(n.pe+n.ke));return r.join("\n")},s.stepCounter=function(){return S},s.steps=function(){return w.length-1},s.isNewStep=function(){return x},s.seek=function(e){return arguments.length||(e=0),b=!0,x=!1,E=e,S=e,lt(E),u.seek(),P&&P(),S},s.stepBack=function(e){arguments.length||(e=1);var t=-1;b=!0,x=!1;while(++t<e)E>1&&(E--,S--,lt(E-1),P&&P());return S},s.stepForward=function(e){arguments.length||(e=1);var t=-1;b=!0;while(++t<e)E<w.length?(lt(E),E++,S++,P&&P()):it();return S},s.createNewAtoms=function(e){var t;return typeof e=="number"?t=e:e.num!=null?t=e.num:e.x&&(t=e.x.length),r=n.createEngine(),r.setSize([H,B]),r.initializeElements(o),r.createAtoms({num:t}),a=Q.temperature_control,A=Q.temperature,C=Q.modelSampleRate,f=Q.keShading,l=Q.chargeShading,c=Q.showVDWLines,h=Q.VDWLinesRatio,p=Q.showClock,g=Q.viewRefreshInterval,y=Q.timeStep,W=Q.viscosity,m=Q.gravitationalField,r.useLennardJonesInteraction(Q.lennard_jones_forces),r.useCoulombInteraction(Q.coulomb_forces),r.useThermostat(a),r.setViscosity(W),r.setGravitationalField(m),r.setTargetTemperature(A),e.x&&e.y?r.initializeAtomsFromProperties(e):(r.initializeAtomsRandomly({temperature:A}),e.relax&&r.relaxToTemperature()),j={},wt(r.atoms),bt(e),window.state=D={},vt(),at(),ot(),S=0,x=!0,u.reset(),s},s.createRadialBonds=function(e){return r.initializeRadialBonds(e),R=r.radialBonds,I=r.radialBondResults,vt(),s},s.createAngularBonds=function(e){return r.initializeAngularBonds(e),U=r.angularBonds,vt(),s},s.createVdwPairs=function(e){return r.createVdwPairsArray(e),z=r.vdwPairs,vt(),s},s.createObstacles=function(e){var t=e.x.length,n,i;for(n=0;n<t;n++)for(i in J){if(!J.hasOwnProperty(i))continue;e[i]||(e[i]=[]),typeof e[i][n]=="undefined"&&(e[i][n]=J[i])}return r.initializeObstacles(e),q=r.obstacles,s},s.reset=function(){s.resetTime(),ut(),u.reset()},s.resetTime=function(){r.setTime(0)},s.getTime=function(){return D?D.time:undefined},s.getTotalMass=function(){return r.getTotalMass()},s.getAtomKineticEnergy=function(e){return r.getAtomKineticEnergy(e)},s.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*o.length)),t==null&&(t=0);var n=s.size(),i=r.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=Math.random()*n[0]-2*i,a=Math.random()*n[1]-2*i,f=r.findMinimumPELocation(e,u,a,0,0,t);if(f&&s.addAtom(e,f[0],f[1],0,0,t,0,0))return!0}while(++l<c);return!1},s.addAtom=function(e,n,i,o,a,f,l,c,h,p){var d=s.size(),v=r.getRadiusOfElement(e),m,g;return h==null&&(h=s.NON_ENGINE_DEFAULT_VALUES.visible),p==null&&(p=s.NON_ENGINE_DEFAULT_VALUES.draggable),n<v&&(n=v),n>d[0]-v&&(n=d[0]-v),i<v&&(i=v),i>d[1]-v&&(i=d[1]-v),r.canPlaceAtom(e,n,i)?(g=r.addAtom(e,n,i,o,a,f,l,c),wt(),m=j.element.length,j.visible.length<m&&(j.visible=t.extend(j.visible,m),j.draggable=t.extend(j.draggable,m)),j.visible[g]=h,j.draggable[g]=p,vt(),u.addAtom(),!0):!1},s.getMoleculeBoundingBox=function(e){var t,n,i,s,o,u=-Infinity,a=Infinity,f=Infinity,l=-Infinity,c,h;t=r.getMoleculeAtoms(e),t.push(e);for(n=0;n<t.length;n++)i=j.x[t[n]],s=j.y[t[n]],o=j.radius[t[n]],i-o<a&&(a=i-o),i+o>l&&(l=i+o),s-o<f&&(f=s-o),s+o>u&&(u=s+o);return c=j.x[e],h=j.y[e],{top:u-h,left:a-c,bottom:f-h,right:l-c}},s.setAtomProperties=function(e,t,n,i){var o,u,a,f,l,c,h,p;if(i){o=r.getMoleculeAtoms(e);if(o.length>0){u=typeof t.x=="number"?t.x-j.x[e]:0,a=typeof t.y=="number"?t.y-j.y[e]:0;for(c=0,h=o.length;c<h;c++){f=j.x[o[c]]+u,l=j.y[o[c]]+a;if(!s.setAtomProperties(o[c],{x:f,y:l},n,!1))return!1}}}if(n){var d=typeof t.x=="number"?t.x:j.x[e],v=typeof t.y=="number"?t.y:j.y[e],m=typeof t.element=="number"?t.y:j.element[e];if(!r.canPlaceAtom(m,d,v,e))return!1}for(p in t)t.hasOwnProperty(p)&&(j[p][e]=t[p]);return vt(),!0},s.getAtomProperties=function(e){var t,n,r={};for(t=0;t<s.ATOM_PROPERTY_LIST.length;t++)n=s.ATOM_PROPERTY_LIST[t],r[n]=j[n][e];return r},s.setElementProperties=function(e,t){r.setElementProperties(e,t),vt()},s.getElementProperties=function(e){var t,n={},i;for(t=0;t<s.ELEMENT_PROPERTY_LIST.length;t++)i=s.ELEMENT_PROPERTY_LIST[t],n[i]=r.elements[i][e];return n},s.setObstacleProperties=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(q[n][e]=t[n]);vt()},s.getObstacleProperties=function(e){var t,n,r={};for(t=0;t<s.OBSTACLE_PROPERTY_LIST.length;t++)n=s.OBSTACLE_PROPERTY_LIST[t],r[n]=q[n][e];return r},s.setRadialBondProperties=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(R[n][e]=t[n]);vt()},s.getRadialBondProperties=function(e){var t,n={},r;for(t=0;t<s.RADIAL_BOND_PROPERTY_LIST.length;t++)r=s.RADIAL_BOND_PROPERTY_LIST[t],n[r]=R[r][e];return n},s.setAngularBondProperties=function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(U[n][e]=t[n]);vt()},s.getAngularBondProperties=function(e){var t,n={},r;for(t=0;t<s.ANGULAR_BOND_PROPERTY_LIST.length;t++)r=s.ANGULAR_BOND_PROPERTY_LIST[t],n[r]=s.ANGULAR_BOND_PROPERTY_LIST[r][e];return n},s.addSpringForce=function(e,t,n,i){return i==null&&(i=500),r.addSpringForce(e,t,n,i)},s.updateSpringForce=function(e,t,n){r.updateSpringForce(e,t,n)},s.removeSpringForce=function(e){r.removeSpringForce(e)},s.liveDragStart=function(e,t,n){t==null&&(t=j.x[e]),n==null&&(n=j.y[e]),V=s.getAtomProperties(e).friction,s.setAtomProperties(e,{friction:s.LIVE_DRAG_FRICTION}),X=s.addSpringForce(e,t,n,500)},s.liveDrag=function(e,t){s.updateSpringForce(X,e,t)},s.liveDragEnd=function(){var e=r.springForceAtomIndex(X);s.setAtomProperties(e,{friction:V}),s.removeSpringForce(X)},s.get_speed=function(){return t.copy(r.atoms.speed,[])},s.get_rate=function(){return ht()},s.is_stopped=function(){return b},s.set_lennard_jones_forces=function(e){d=e,r.useLennardJonesInteraction(e)},s.set_coulomb_forces=function(e){v=e,r.useCoulombInteraction(e)},s.get_atoms=function(){return j},s.get_results=function(){return F},s.get_radial_bond_results=function(){return I},s.get_num_atoms=function(){return r.getNumberOfAtoms()},s.get_obstacles=function(){return q},s.get_radial_bonds=function(){return R},s.get_vdw_pairs=function(){return z&&r.updateVdwPairsArray(),z},s.on=function(e,t){return u.on(e,t),s},s.tickInPlace=function(){return u.tick(),s},s.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)it(null,n);return s},s.relax=function(){return r.relaxToTemperature(),s},s.start=function(){return s.resume()},s.resume=function(){return b=!1,d3.timer(function(t){return b?!0:(it(t,!1),!1)}),u.play(),s},s.stop=function(){return b=!0,u.stop(),s},s.ke=function(){return D.KE},s.ave_ke=function(){return D.KE/s.get_num_atoms()},s.pe=function(){return D.PE},s.ave_pe=function(){return D.PE/s.get_num_atoms()},s.speed=function(){return rt()},s.pressure=function(){return ct()},s.temperature=function(e){return arguments.length?(pt(e),s):A},s.size=function(e){return arguments.length?(r.setSize(e),s):r.getSize()},s.set=function(e){dt(e)},s.get=function(e){return Q[e]},s.setModelListener=function(e){return P=e,s.on("tick",P),s},s.addPropertiesListener=function(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],K[i]||(K[i]=[]),K[i].push(t)},s.serialize=function(e){var t=$.extend({},Q);return e&&(t.atoms=St()),o&&(t.elements=o),t.width=H,t.height=B,t},s}}),n("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){n("cs!common/components/model_controller_component",["require","common/console"],function(e){var t;return e("common/console"),t=function(){function e(e,t,n,r,i){var s=this;this.svg_element=e,this.playable=t!=null?t:null,this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view(),this.setup_buttons(),this.playable.isPlaying()?this.hide(this.play):this.hide(this.stop),model.on("play",function(){return s.update_ui()}),model.on("stop",function(){return s.update_ui()})}return e.prototype.offset=function(e){return e*this.unit_width*2+this.unit_width},e.prototype.setup_buttons=function(){},e.prototype.make_button=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this;t=e.action,u=e.offset,h=e.type,f=e.point_set,h==null&&(h="svg:polyline"),f==null&&(f=this.icon_shapes[t]),u=this.offset(u),s=this.group.append("svg:g"),s.attr("class","component playbacksvgbutton").attr("x",u).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),i=s.append("rect"),i.attr("class","bg").attr("x",u).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(v=0,g=f.length;v<g;v++){l=f[v],n=s.append(h),n.attr("class",""+t+" button-art"),c="";for(m=0,y=l.length;m<y;m++)a=l[m],p=u+10+a.x*this.unit_width,d=this.vertical_padding/.75+a.y*this.unit_width,c+=" "+p+","+d,n.attr("points",c);t==="stop"&&(r=s.append("rect"),r.attr("class","pause-center").attr("x",p+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return o=s.append("rect"),o.attr("class","highlight").attr("x",u+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),s.on("click",function(){return b.action(t)}),s},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"seek":this.playable.seek(1);break;case"reset":this.playable.reset();break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component model-controller playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.isPlaying()?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e.prototype.icon_shapes={play:[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],stop:[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],reset:[[{x:1,y:0},{x:.3,y:.5},{x:1,y:1}],[{x:0,y:0},{x:.3,y:0},{x:.3,y:1},{x:0,y:1},{x:0,y:0}]],back:[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],forward:[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]]},e}()})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/play_reset_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.play=this.make_button({action:"play",offset:1}),this.stop=this.make_button({action:"stop",offset:1})},n}(n)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/play_only_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.play=this.make_button({action:"play",offset:0}),this.stop=this.make_button({action:"stop",offset:0})},n}(n)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/playback_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.back=this.make_button({action:"back",offset:1}),this.play=this.make_button({action:"play",offset:2}),this.stop=this.make_button({action:"stop",offset:2}),this.forward=this.make_button({action:"forward",offset:3})},n}(n)})}.call(this),n("common/layout/layout",["require"],function(e){var t={version:"0.0.1"};t.selection="",t.display={},t.canonical={width:1280,height:800},t.regular_display=!1,t.not_rendered=!0,t.fontsize=!1,t.cancelFullScreen=!1,t.screen_factor=1,t.checkbox_factor=1.1,t.checkbox_scale=1.1,t.fullScreenRender=!1,t.canonical.width=1280,t.canonical.height=800,t.getDisplayProperties=function(e){return arguments.length||(e={}),e.screen={width:screen.width,height:screen.height},e.client={width:document.body.clientWidth,height:document.body.clientHeight},e.window={width:$(window).width(),height:$(window).height()},e.page={width:t.getPageWidth(),height:t.getPageHeight()},e.screen_factor_width=e.window.width/t.canonical.width,e.screen_factor_height=e.window.height/t.canonical.height,e.emsize=Math.max(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setBodyEmsize=function(){var e,n=$("button.component"),r;t.display||(t.display=t.getDisplayProperties()),e=Math.min(t.display.screen_factor_width*1.2,t.display.screen_factor_height*1.2),$("body").css("font-size",e+"em"),e<=.5?(r=.7/e,n.css("font-size",r+"em")):n.css("font-size","")},t.getVizProperties=function(e){var n=$("#viz");return arguments.length||(e={}),e.width=n.width(),e.height=n.height(),e.screen_factor_width=e.width/t.canonical.width,e.screen_factor_height=e.height/t.canonical.height,e.emsize=Math.min(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setVizEmsize=function(){var e,n=$("#viz");t.vis||(t.vis=t.getVizProperties()),e=Math.min(t.viz.screen_factor_width*1.2,t.viz.screen_factor_height*1.2),n.css("font-size",e+"em")},t.screenEqualsPage=function(){return t.display.screen.width===t.display.page.width||t.display.screen.height===t.display.page.height},t.checkForResize=function(){(t.display.screen.width!==screen.width||t.display.screen.height!==screen.height||t.display.window.width!==document.width||t.display.window.height!==document.height)&&t.setupScreen()},t.views={},t.addView=function(e,n){t.views[e]||(t.views[e]=[]),t.views[e].push(n)},t.setView=function(e,n){t.views[e]=n},t.setupScreen=function(e){function o(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.4,i=n*1/l,i>h*.55&&(i=h*.55,n=i*l),e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);a=(c-n)*.35,o=i*.52,e=-1;while(++e<r.potentialCharts.length)r.potentialCharts[e].resize(a,o);e=-1;while(++e<r.speedDistributionCharts.length)r.speedDistributionCharts[e].resize(a,o);u=(c-n)*.72,o=i*.76,e=-1;while(++e<r.energyCharts.length)r.energyCharts[e].resize(u,o)}function u(){var e,n,i,s,o,u,a,f,l,c={},h=t.viz.width,p=t.viz.height;a=r.moleculeContainers[0].scale(),f=a[0]/a[1],l=.7,r.thermometers&&(l-=.1),r.energyGraphs&&(l-=.45),o=h*l,u=o/f,u>p*.6&&(u=p*.6,o=u*f),c.moleculeContainers=[o,u],r.energyGraphs&&(c.energyGraphs=[h*.4,u*1.25]);for(viewType in r)if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)c[viewType]?r[viewType][e].resize(c[viewType][0],c[viewType][1]):r[viewType][e].resize()}}function a(){var e,t,i,s,o,u,a,f=.85,l=.0025;viewSizes={},containerWidth=$(window).width(),containerHeight=$(window).height(),mcWidth=$("#molecule-container").width(),s=r.moleculeContainers[0].scale(),o=s[2]/s[3],u=.85,modelWidthPaddingFactor=s[0]/s[2]-1.05,u-=modelWidthPaddingFactor,modelHeightPaddingFactor=s[1]/s[3]-1.05,f-=modelHeightPaddingFactor,r.thermometers&&(u-=.05),r.energyGraphs&&(u-=.35),n<=.5&&(l*=.5/n),r.bottomItems=$("#bottom").children().length,r.bottomItems&&(f-=$("#bottom").height()*l),t=containerWidth*u,i=t/o,i>containerHeight*f&&(i=containerHeight*f,t=i*o),viewSizes.moleculeContainers=[t,i],r.energyGraphs&&(viewSizes.energyGraphs=[containerWidth*.4,i*1.2]);for(viewType in r)if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)viewSizes[viewType]?r[viewType][e].resize(viewSizes[viewType][0],viewSizes[viewType][1]):r[viewType][e].resize()}}function f(){var e,n,i,s,o,u=t.display.page.width,a=t.display.page.height;s=r.moleculeContainers[0].scale(),o=s[0]/s[1],n=u*.4,i=n*1/o,e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);if(r.appletContainers){e=-1;while(++e<r.appletContainers.length)r.appletContainers[e].resize(n,i)}}function l(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.46,i=n*1/l,i>h*.7&&(i=h*.7,n=i*l),e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);a=(c-n)*.41,o=i*.42,e=-1;while(++e<r.potentialCharts.length)r.potentialCharts[e].resize(a,o);e=-1;while(++e<r.speedDistributionCharts.length)r.speedDistributionCharts[e].resize(a,o);u=(c-n)*.86,o=i*.57,e=-1;while(++e<r.energyCharts.length)r.energyCharts[e].resize(u,o)}function c(){var e,n,i,s,o;i=Math.min(t.display.page.height*.45,t.display.page.width*.5),r.moleculeContainers[0].resize(i,i),s=r.moleculeContainers[0].scale(),o=s[0]/t.display.page.width,o>.5&&(i*=.5/o,r.moleculeContainers[0].resize(i,i)),r.thermometers[0].resize()}function h(){var e,n,i,s,o,u=document.getElementById("description-right");i=Math.min(t.display.page.height*.65,t.display.page.width*.5),r.moleculeContainers[0].resize(i,i),s=r.moleculeContainers[0].scale(),o=s[0]/t.display.page.width,o>.5&&(i*=.5/o,r.moleculeContainers[0].resize(i,i)),r.thermometers[0].resize()}function p(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.7,i=n*1/l,i>h*.7&&(i=h*.7,n=i*l),r.moleculeContainers[0].resize(n,i),s=r.moleculeContainers[0].scale(),r.thermometers[0].resize()}function d(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.6,i=n*1/l,i>h*.6&&(i=h*.6,n=i*l),r.moleculeContainers[0].resize(n,i)}function v(){var e=document.getElementById("description-right");e===null}var n,r=t.views,i=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;e&&e.forceRender&&(t.not_rendered=!0),t.display=t.getDisplayProperties(),t.viz=t.getVizProperties(),t.regular_display||(t.regular_display=t.getDisplayProperties());if(i||t.fullScreenRender||t.screenEqualsPage()){t.fullScreenRender=!0,t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor),$("body").css("font-size",t.screen_factor+"em"),t.not_rendered=!0;switch(t.selection){case"simple-screen":t.not_rendered&&d();break;case"simple-static-screen":t.not_rendered&&d();break;case"simple-iframe":d(),v();break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),f(),t.not_rendered=!1;break;default:t.not_rendered&&l()}}else{t.cancelFullScreen||t.fullScreenRender?(t.cancelFullScreen=!1,t.fullScreenRender=!1,t.not_rendered=!0,t.regular_display=t.previous_display):t.regular_display=t.getDisplayProperties(),t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor);switch(t.selection){case"simple-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),c();break;case"simple-static-screen":t.not_rendered&&(n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),h(),t.not_rendered=!1);break;case"simple-iframe":n=Math.min(t.screen_factor_width*1.5,t.screen_factor_height),$("body").css("font-size",n+"em"),p();break;case"full-static-screen":t.not_rendered&&(n=Math.min(t.screen_factor_width*1.5,t.screen_factor_height),$("body").css("font-size",n+"em"),regularScreen(),t.not_rendered=!1);break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),f();break;case"interactive":t.not_rendered&&(t.setVizEmsize(),u(),t.not_rendered=!1);break;case"interactive-iframe":t.setBodyEmsize(),a();break;default:t.setVizEmsize(),o()}t.regular_display=t.getDisplayProperties()}t.transform&&$("input[type=checkbox]").css(t.transform,"scale("+t.checkbox_factor+","+t.checkbox_factor+")"),t.temperature_control_checkbox&&(model.addPropertiesListener(["temperature_control"],t.temperatureControlUpdate),t.temperatureControlUpdate());var s=document.getElementById("benchmarks-table");s&&(s.style.display="none")},t.getStyleForSelector=function(e){var t,n=document.styleSheets;for(var r=0;r<n.length;r++)if(n[r])try{t=n[r].rules||n[r].cssRules;if(t)for(var i=0;i<t.length;i++)if(t[i].selectorText==e)return t[i]}catch(s){}return!1},t.getPageHeight=function(){var e;return window.innerHeight?e=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=t.display.window.height),e},t.getPageWidth=function(){var e;return window.innerWidth?e=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?e=document.documentElement.clientWidth:document.body&&(e=window.width),e},t.getTransformProperty=function(e){var t=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],n;if(e)while(n=t.shift())if(typeof e.style[n]!="undefined")return n;return!1};var n=document.getElementById("description-right");return n!==null&&(t.fontsize=parseInt(t.getStyleForSelector("#description-right").style.fontSize)),t.transform=t.getTransformProperty(document.body),t}),n("md2d/views/molecule-container",["require","cs!common/components/play_reset_svg","cs!common/components/play_only_svg","cs!common/components/playback_svg","common/layout/layout"],function(
e){var t=e("cs!common/components/play_reset_svg"),n=e("cs!common/components/play_only_svg"),r=e("cs!common/components/playback_svg"),i=e("common/layout/layout");return function(s,o){function zt(e){e&&(o=e);if(o)for(var t in Dt)o[t]===undefined&&(o[t]=Dt[t]);else o=Dt;Pt=o.model,lt=o.get_results(),ct=o.get_radial_bond_results(),mt=o.get_obstacles,Ct=o.get_radial_bonds,Mt=o.get_vdw_pairs,ht=o.set_atom_properties,pt=o.is_stopped,kt=o.images,Lt=o.textBoxes||[],o.interactiveUrl&&(At=o.interactiveUrl,Ot=ACTUAL_ROOT+At.slice(0,At.lastIndexOf("/")+1)),o.showClock||(o.showClock=Pt.get("showClock")),Ht=101,Bt=102,jt=103,Ft=104,It=105,qt=106,Rt=107,Ut=108}function Wt(e,t){var n=Pt.size(),r=n[0]/n[1];v=i.screen_factor,S={top:o.title?40*i.screen_factor:20,right:25,bottom:10,left:o.ylabel?60*i.screen_factor:25},o.xlabel&&(S.bottom+=35*v),o.controlButtons?S.bottom+=40*v:S.bottom+=15*v,o.fit_to_parent?(l=500,h=l-S.left-S.right,p=h/r,c=p+S.top+S.bottom):arguments.length?(h=e,p=t,l=h+S.left+S.right,c=p+S.top+S.bottom,a.style.height=c+"px",a.style.width=l+"px"):(c=u.property("clientHeight"),p=c-S.top-S.bottom,h=p*r,l=h+S.left+S.right,a.style.width=l+"px"),x={width:h,height:p},m=x.width/(n[0]*100),tt=a.offsetTop+S.top,et=a.offsetLeft+S.left;switch(o.controlButtons){case"play":F=S.left+(x.width-75*v)/2;break;case"play_reset":F=S.left+(x.width-140*v)/2;break;case"play_reset_step":F=S.left+(x.width-230*v)/2;break;default:F=S.left+(x.width-230*v)/2}return I=c-42*v,T=x.width,N=x.height,A=d3.scale.linear().domain([o.xmin,o.xmax]).range([0,T]),O=A.copy(),M=Math.NaN,_=d3.scale.linear().domain([o.ymax,o.ymin]).range([0,N]),H=d3.scale.linear().domain([o.ymin,o.ymax]).nice().range([0,N]).nice(),D=_.copy(),P=Math.NaN,B=null,[l,c,h,p]}function Xt(){return R+q(Pt.getTime())+U}function Vt(e,t,n,r,i){return ht(e,{x:t,y:n},r,i)}function $t(e){return vt.x[e]}function Jt(e){return vt.y[e]}function Kt(e){return vt.width[e]}function Qt(e){return vt.height[e]}function Gt(e){return"rgb("+vt.colorR[e]+","+vt.colorG[e]+","+vt.colorB[e]+")"}function Yt(e){return vt.visible[e]}function Zt(e){return radialBonds[Pt.RADIAL_BOND_INDICES.ATOM1][e]}function en(e){return radialBonds[Pt.RADIAL_BOND_INDICES.ATOM2][e]}function tn(e){return radialBonds[Pt.RADIAL_BOND_INDICES.LENGTH][e]}function nn(e){return radialBonds[Pt.RADIAL_BOND_INDICES.STRENGTH][e]}function rn(e){return Et[Pt.VDW_INDICES.ATOM1][e]}function sn(e){return Et[Pt.VDW_INDICES.ATOM2][e]}function on(){function e(){d3.event&&d3.event.transform&&isNaN(M)&&isNaN(P)&&d3.event.transform(A,_);var e=A.tickFormat(10),t=_.tickFormat(10);if(o.xunits){var n=y.selectAll("g.x").data(A.ticks(10),String).attr("transform",C);n.select("text").text(e);var r=n.enter().insert("svg:g","a").attr("class","x").attr("transform",C);o.grid_lines&&r.append("svg:line").attr("stroke",L).attr("y1",0).attr("y2",x.height),r.append("svg:text").attr("y",x.height).attr("dy","1em").attr("text-anchor","middle").text(e),n.exit().remove()}if(o.xunits){var i=y.selectAll("g.y").data(_.ticks(10),String).attr("transform",k);i.select("text").text(t);var s=i.enter().insert("svg:g","a").attr("class","y").attr("transform",k).attr("background-fill","#FFEEB6");o.grid_lines&&s.append("svg:line").attr("stroke",L).attr("x1",0).attr("x2",x.width),s.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(t),o.showClock&&E.text(Xt()),i.exit().remove()}}function i(){var e=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#F2F2F2","#FF8080"]),t=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),n,r,i;X=y.append("g"),X.attr("class","image_container_below"),W=y.append("g"),W.attr("class","VDWLines_container"),z=y.append("svg").attr("class","container").attr("top",0).attr("left",0).attr("width",x.width).attr("height",x.height).attr("viewBox","0 0 "+x.width+" "+x.height),h("neg-grad","#ffefff","#fdadad","#e95e5e",z),h("pos-grad","#dfffff","#9abeff","#767fbf",z),h("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",z),h("mark-grad","#fceabb","#fccd4d","#f8b500",z),h("green-grad","#dfffef","#75a643","#2a7216",z),h("purple-grad","#EED3F0","#D941E0","#84198A",z),h("aqua-grad","#DCF5F4","#41E0D8","#12827C",z),h("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",z);for(i=0;i<Y;i++)n="ke-shading-"+i,r=i/Y,h(n,"#FFFFFF",e(r),t(r),z),G[i]="url('#"+n+"')";Q=["green-grad","purple-grad","aqua-grad","orange-grad"],_t=["#538f2f","#aa2bb1","#2cb6af","#b3831c","#7781c2","#ee7171"],V=y.append("g"),V.attr("class","image_container_top")}function h(e,t,n,r,i){gradient=i.append("defs").append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),gradient.append("stop").attr("stop-color",t).attr("offset","0%"),gradient.append("stop").attr("stop-color",n).attr("offset","40%"),gradient.append("stop").attr("stop-color",r).attr("offset","80%"),gradient.append("stop").attr("stop-color",n).attr("offset","100%")}function p(e){var t,n,r;return e.marked?"url(#mark-grad)":Tt?(t=Pt.getAtomKineticEnergy(e.idx),n=Math.min(5*t,1),G[Math.round(n*(Y-1))]):St?(r=e.charge,r===0?"url(#neutral-grad)":r>0?"url(#pos-grad)":"url(#neg-grad)"):"url('#"+Q[e.element%4]+"')"}function T(){var e="1%";y.append("image").attr({id:"heat-bath",x:e,width:"3%",height:"3%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/heatbath.gif"}),y.append("image").attr({id:"ke-gradient",x:e,width:"12%",height:"12%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/ke-gradient.png"})}function N(){var e=Pt.get("temperature_control"),t,n,r=0,i=1;e?(r+=i,t=d3.select("#heat-bath").attr("y",r+"%").style("display",""),n=t.attr("height"),n=Number(n.substring(0,n.length-1)),r+=n):d3.select("#heat-bath").style("display","none"),Tt?(r+=i,d3.select("#ke-gradient").attr("y",r+"%").style("display","")):d3.select("#ke-gradient").style("display","none")}function O(){y.selectAll("circle").data(lt).attr("r",function(e){return A(e.radius)})}function D(){nt.enter().append("circle").attr({"class":"draggable",r:function(e){return A(e.radius)},cx:function(e){return A(e.x)},cy:function(e){return _(e.y)}}).style({"fill-opacity":function(e){return e.visible},fill:p}).on("mousedown",Bt).on("mouseover",Ht).on("mouseout",It).call(d3.behavior.drag().on("dragstart",en).on("drag",an).on("dragend",fn))}function B(){dt.enter().append("rect").attr({x:function(e,t){return A($t(t))},y:function(e,t){return _(Jt(t)+Qt(t))},width:function(e,t){return A(Kt(t))},height:function(e,t){return H(Qt(t))}}).style({fill:function(e,t){return Yt(t)?Gt(t):"rgba(128,128,128, 0)"},"stroke-width":function(e,t){return Yt(t)?.2:0},stroke:function(e,t){return Yt(t)?Gt(t):"rgba(128,128,128, 0)"}})}function q(){bt.enter().append("path").attr("d",function(e,t){return R(e,1)}).attr("class","radialbond1").style("stroke-width",function(e,t){return U(e)?.3*m:A(Math.min(lt[e.atom1].radius,lt[e.atom2].radius))*.75}).style("stroke",function(e,t){var n,r,i;return U(e)?"#000000":St?(n=lt[e.atom1].charge,n>0?_t[4]:n<0?_t[5]:"#A4A4A4"):(r=lt[e.atom1].element%4,i=_t[r],i)}).style("fill","none"),wt.enter().append("path").attr("d",function(e){return R(e,2)}).attr("class","radialbond2").style("stroke-width",function(e,t){return U(e)?.3*m:A(Math.min(lt[e.atom1].radius,lt[e.atom2].radius))*.75}).style("stroke",function(e,t){var n,r,i;return U(e)?"#000000":St?(n=lt[e.atom2].charge,n>0?_t[4]:n<0?_t[5]:"#A4A4A4"):(r=lt[e.atom2].element%4,i=_t[r],i)}).style("fill","none")}function R(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,g,y,b,w,E,S,x=10;u=A(e.x1),f=_(e.y1),a=A(e.x2),l=_(e.y2),s=a-u,o=l-f,S=Math.sqrt(s*s+o*o)/m,w=s/S,E=o/S,c=A(lt[e.atom1].radius)*w,h=A(lt[e.atom2].radius)*w,d=A(lt[e.atom1].radius)*E,v=A(lt[e.atom2].radius)*E,p=c-h,g=d-v;if(U(e)){var T=S/x;b="M "+u+","+f+" ";for(i=0;i<x;i++)i%2===0?(n=u+(i+.5)*w*T-.5*E*x,r=f+(i+.5)*E*T+.5*w*x):(n=u+(i+.5)*w*T+.5*E*x,r=f+(i+.5)*E*T-.5*w*x),y=" L "+n+","+r,b+=y;return b+=" L "+a+","+l}return t===1?"M "+u+","+f+" L "+(a+u+p)/2+" , "+(l+f+g)/2:"M "+(a+u+p)/2+" , "+(l+f+g)/2+" L "+a+","+l}function U(e){return e.style===Pt.RADIAL_BOND_STYLES.RADIAL_BOND_SHORT_SPRING_STYLE}function $(){W.selectAll("line.attractionforce").remove();if(!Et)return;var e=Et[Pt.VDW_INDICES.COUNT],t,n,r;for(r=0;r<e;r++)t=rn(r),n=sn(r),(t!==0||n!==0)&&W.append("line").attr("class","attractionforce").attr("x1",A(lt[t].x)).attr("y1",_(lt[t].y)).attr("x2",A(lt[n].x)).attr("y2",_(lt[n].y)).style("stroke-width",2*m).style("stroke-dasharray",3*m+" "+2*m)}function J(){var e=[],t,n,r,i,s,o,u;V.selectAll("image").remove(),X.selectAll("image").remove();if(!kt)return;for(u=0;u<kt.length;u++)e[u]=new Image,e[u].src=Ot+kt[u].imageUri,e[u].onload=function(u){return function(){V.selectAll("image.image_attach"+u).remove(),X.selectAll("image.image_attach"+u).remove(),r=lt[kt[u].imageHostIndex],i=kt[u].imageHostType,s=kt[u].imageLayer,o=kt[u].imageX,imgY=kt[u].imageY,n=e[u].width*m,t=e[u].height*m,s===1?V.append("image").attr("x",function(){return i===""?o:A(r.x)-n/2}).attr("y",function(){return i===""?imgY:_(r.y)-t/2}).attr("class","image_attach"+u+" draggable").attr("xlink:href",e[u].src).attr("width",n).attr("height",t).attr("pointer-events","none"):X.append("image").attr("x",function(){return i===""?o:A(r.x)-n/2}).attr("y",function(){return i===""?imgY:_(r.y)-t/2}).attr("class","image_attach"+u+" draggable").attr("xlink:href",e[u].src).attr("width",n).attr("height",t).attr("pointer-events","none")}}(u)}function K(){var e,t,n;n=Pt.size(),e=z.selectAll(".textBox").data(Lt),e.enter().append("foreignObject").attr("class","textBox").append("xhtml:body"),e.exit().remove(),e.attr({width:A(n[0]),height:_(-n[1])}).each(function(e){d3.select(this).select("body").attr("class","textBoxBody").html(e.text)})}function st(){y.selectAll(".modelTimeLabel").remove(),o.showClock=Pt.get("showClock"),o.showClock&&(E=y.append("text").attr("class","modelTimeLabel").text(Xt()).attr("x",10).attr("y",x.height-35).attr("dy","2.4em").style("text-anchor","start"))}function ot(){vt=mt(),ht(),xt(),yt(),ft(),st(),N(),J(),K()}function ft(){var e=lt.length<=100?1:.9;St=Pt.get("chargeShading"),Tt=Pt.get("keShading"),z.selectAll("circle").remove(),z.selectAll("g").remove(),nt=z.selectAll("circle").data(lt),D(),rt=z.selectAll("g.label").data(lt),it=rt.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+A(e.x)+","+_(e.y)+")"}),o.atom_mubers?it.append("text").attr("class","index").attr("font-size",function(t){return 1.6*e*A(t.radius)}).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").attr("pointer-events","none").text(d.idx):it.append("text").attr("class","index").attr("font-size",function(e){return 1.6*A(e.radius)}).attr("style","font-weight: bold; opacity: .7").attr("x","-0.31em").attr("y","0.31em").attr("pointer-events","none").text(function(e){var t=e.charge;if(St||Tt){if(t>0)return"+";if(t<0)return"-";return}})}function ht(){z.selectAll("rect").remove(),vt&&(gt.length=vt.x.length,dt=z.selectAll("rect").data(gt),B())}function yt(){z.selectAll("path.radialbond1").remove(),z.selectAll("path.radialbond2").remove(),radialBonds=Ct(),ct=o.get_radial_bond_results(),ct&&(bt=z.selectAll("path.radialbond1").data(ct),wt=z.selectAll("path.radialbond2").data(ct),q())}function xt(){W.selectAll("line.attractionforce").remove(),Nt=Pt.get("showVDWLines"),Nt&&At()}function At(){Et=Mt(),$()}function Dt(){a.focus()}function Ht(e,t){o.enableAtomTooltips&&jt(t)}function Bt(e,t){a.focus(),o.enableAtomTooltips&&(Z!==!1?(ut.style("opacity",1e-6),ut.style("display","none"),Z=!1):(d3.event.shiftKey?Z=t:Z=!1,jt(t)))}function jt(e){ut.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",A(lt[e].x)+et+60+"px").style("top",_(lt[e].y)+tt-30+"px").style("zIndex",100).transition().duration(250),at.text("atom: "+e+"\n"+"time: "+Xt()+"\n"+"speed: "+d3.format("+6.3e")(lt[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(lt[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(lt[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(lt[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(lt[e].ay)+"\n")}function Ft(e){}function It(){!Z&&Z!==0&&ut.style("opacity",1e-6).style(NaN)}function qt(){vt&&dt.attr("x",function(e,t){return A($t(t))}).attr("y",function(e,t){return _(Jt(t)+Qt(t))}),Nt&&At(),ct&&Ut(),Rt(),kt&&kt.length!==0&&Zt()}function Rt(){o.showClock&&E.text(Xt()),nt.attr({cx:function(e){return A(e.x)},cy:function(e){return _(e.y)}}),Tt&&nt.style("fill",p),rt.attr("transform",function(e,t){return"translate("+A(e.x)+","+_(e.y)+")"}),(Z===0||Z>0)&&jt(Z)}function Ut(){bt.attr("d",function(e){return R(e,1)}),wt.attr("d",function(e){return R(e,2)})}function Zt(){var e,t,n,r,i,s,o,u,a;e=kt.length;for(var f=0;f<e;f++)i=lt[kt[f].imageHostIndex],s=kt[f].imageHostType,u=kt[f].imageX,a=kt[f].imageY,o=kt[f].imageLayer,t=new Image,t.src=Ot+kt[f].imageUri,r=t.width*m,n=t.height*m,o==1?V.selectAll("image.image_attach"+f).attr("x",function(){return s===""?u:A(i.x)-r/2}).attr("y",function(){return s===""?a:_(i.y)-n/2}):X.selectAll("image.image_attach"+f).attr("x",function(){return s===""?u:A(i.x)-r/2}).attr("y",function(){return s===""?a:_(i.y)-n/2})}function en(e,t){pt()?j=[e.x,e.y]:e.draggable&&Pt.liveDragStart(t)}function tn(e,t,n){return n.left+e<o.xmin&&(e=o.xmin-n.left),n.right+e>o.xmax&&(e=o.xmax-n.right),n.bottom+t<o.ymin&&(t=o.ymin-n.bottom),n.top+t>o.ymax&&(t=o.ymax-n.top),{x:e,y:t}}function nn(e,t,n){return e<t?t:e>n?n:e}function un(e,t){return{x:nn(e,o.xmin,o.xmax),y:nn(t,o.ymin,o.ymax)}}function an(e,t){var n=A.invert(d3.event.x),r=_.invert(d3.event.y),i;pt()?(i=tn(n,r,Pt.getMoleculeBoundingBox(t)),Vt(t,i.x,i.y,!1,!0),qt()):e.draggable&&(i=un(n,r),Pt.liveDrag(i.x,i.y))}function fn(e,t){var n,r;pt()?(Vt(t,e.x,e.y,!0,!0)||(alert("You can't drop the atom there"),Vt(t,j[0],j[1],!1,!0)),qt()):e.draggable&&Pt.liveDragEnd()}function ln(e){e=e?e:window.event?event:null;if(e)switch(e.keyCode){case 32:Pt.is_stopped()?w.action("play"):w.action("stop"),e.preventDefault();break;case 13:w.action("play"),e.preventDefault()}}function cn(){a.onkeydown=ln}Wt(),Pt.addPropertiesListener(["temperature_control"],N),Pt.addPropertiesListener(["keShading","chargeShading","showVDWLines","showClock"],ot),y===undefined?(o.fit_to_parent?(f=d3.select(s),u=f.append("div").attr("class","positioning-container").append("div").attr("class","molecules-view-aspect-container").attr("style","padding-top: "+Math.round(c/l*100)+"%").append("div").attr("class","molecules-view-svg-container"),a=u.node(),g=d3.select(a).append("svg").attr("viewBox","0 0 "+l+" "+c).attr("preserveAspectRatio","xMinYMin meet")):(f=u,g=d3.select(a).append("svg").attr("width",l).attr("height",c)),y=g.append("g").attr("transform","translate("+S.left+","+S.top+")"),b=y.append("rect").attr("class","plot").attr("width",x.width).attr("height",x.height).style("fill","#EEEEEE"),o.title&&y.append("text").attr("class","title").text(o.title).attr("x",x.width/2).attr("dy","-1em").style("text-anchor","middle"),o.xlabel&&y.append("text").attr("class","xlabel").text(o.xlabel).attr("x",x.width/2).attr("y",x.height).attr("dy","2.4em").style("text-anchor","middle"),o.ylabel&&y.append("g").append("text").attr("class","ylabel").text(o.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+x.height/2+") rotate(-90)"),ut=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),at=ut.append("pre"),d3.select(a).attr("tabindex",0).on("mousedown",Dt),cn(),e(),i(),T()):(o.fit_to_parent||d3.select(a).select("svg").attr("width",l).attr("height",c),y.select("svg").attr("width",l).attr("height",c),y.select("rect.plot").attr("width",x.width).attr("height",x.height).style("fill","#EEEEEE"),y.select("svg.container").attr("top",0).attr("left",0).attr("width",x.width).attr("height",x.height).attr("viewBox","0 0 "+x.width+" "+x.height),o.title&&y.select("text.title").attr("x",x.width/2).attr("dy","-1em"),o.xlabel&&y.select("text.xlabel").attr("x",x.width/2).attr("y",x.height),o.ylabel&&y.select("text.ylabel").attr("transform","translate(-40 "+x.height/2+") rotate(-90)"),o.showClock&&E.text(Xt()).attr("x",10).attr("y",x.height-35),y.selectAll("g.x").remove(),y.selectAll("g.y").remove(),o.playback_controller&&w.position(F,I,v),e()),d3.select(".model-controller").remove();switch(o.controlButtons){case"play":w=new n(g,model_player,F,I,v);break;case"play_reset":w=new t(g,model_player,F,I,v);break;case"play_reset_step":w=new r(g,model_player,F,I,v);break;default:w=null}on.node=a,on.outerNode=f.node(),on.updateMoleculeRadius=O,on.setup_drawables=ot,on.update_drawable_positions=qt,on.scale=Wt,on.playback_component=w,on.options=o,on.processOptions=zt}var u=d3.select(s),a=u.node(),f,l=u.property("clientWidth"),c=u.property("clientHeight"),h,p,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=d3.format("5.0f"),R="",U=" (fs)",z,W,X,V,$,J,K,Q,G=[],Y=25,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt=[],yt=[],bt,wt,Et,St,xt=["+","-",""],Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt={fit_to_parent:!1,title:!1,xlabel:!1,ylabel:!1,controlButtons:"play",grid_lines:!1,xunits:!1,yunits:!1,atom_mubers:!1,enableAtomTooltips:!1,xmin:0,xmax:10,ymin:0,ymax:10},Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut;return zt(),o.fit_to_parent||Wt(l,c),C=function(e,t){return"translate("+A(e)+",0)"},k=function(e,t){return"translate(0,"+_(e)+")"},L=function(e,t){return e?"#ccc":"#666"},on.resize=function(e,t){o.fit_to_parent?f.style("width",e+"px"):on.scale(e,t),on.processOptions(),on(),on.setup_drawables()},on.reset=function(e){on.processOptions(e),on(),on.setup_drawables(),on.updateMoleculeRadius()},a&&on(),on}}),function(){n("cs!common/components/model_player",["require"],function(e){var t;return t=function(){function e(e){this.model=e}return e.prototype.play=function(){return this.model.resume()},e.prototype.stop=function(){return this.model.stop()},e.prototype.forward=function(){return this.stop(),this.model.stepForward()},e.prototype.back=function(){return this.stop(),this.model.stepBack()},e.prototype.seek=function(e){return this.stop(),this.model.seek(e)},e.prototype.reset=function(){return this.model.reset()},e.prototype.isPlaying=function(){return!this.model.is_stopped()},e}()})}.call(this),n("md2d/controllers/model-controller",["require","md2d/models/modeler","md2d/views/molecule-container","cs!common/components/model_player"],function(e){var t=e("md2d/models/modeler"),n=e("md2d/views/molecule-container"),r=e("cs!common/components/model_player");return function(i,s,o){function B(){P.update_drawable_positions()}function j(){f=o.controlButtons,l=o.modelTimeLabel,h=o.enableAtomTooltips||!1,c=o.fit_to_parent,O=o.interactiveUrl,p=s.elements,d=s.atoms,v=s.mol_number,m=s.temperature_control,g=s.temperature,y=s.width,b=s.height,w=s.keShading,E=s.chargeShading,S=s.showVDWLines,M=s.showClock,_=s.viewRefreshInterval,D=s.timeStep,x=s.radialBonds,T=s.angularBonds,N=s.obstacles,C=s.viscosity,k=s.gravitationalField,L=s.images,A=s.textBoxes}function F(){j(),model=t({elements:p,temperature:g,temperature_control:m,width:y,height:b,keShading:w,chargeShading:E,showVDWLines:S,showClock:M,viewRefreshInterval:_,timeStep:D,viscosity:C,gravitationalField:k,images:L});if(d)model.createNewAtoms(d);else{if(!v)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(v),model.relax()}x&&model.createRadialBonds(x),T&&model.createAngularBonds(T),S&&model.createVdwPairs(d),N&&model.createObstacles(N)}function I(){F(),model.resetTime(),model.on("tick",B),model.on("addAtom",U)}function q(){return{model:model,fit_to_parent:c,xmax:y,ymax:b,keShading:w,chargeShading:E,enableAtomTooltips:h,images:L,interactiveUrl:O,textBoxes:A,get_results:function(){return model.get_results()},get_radial_bond_results:function(){return model.get_radial_bond_results()},get_radial_bonds:function(){return model.get_radial_bonds()},get_obstacles:function(){return model.get_obstacles()},get_vdw_pairs:function(){return model.get_vdw_pairs()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:f,modelTimeLabel:l}}function R(){model_player=new r(H,!1),model_player.forward=function(){},model_player.back=function(){},P=n(i,q()),P.updateMoleculeRadius(),P.setup_drawables()}function U(){P.reset(q()),P.updateMoleculeRadius(),P.setup_drawables()}function z(e,t){s=e||s,o=t||o,I(),U(),a.modelReset()}function W(){P.setup_drawables()}var u={},a=d3.dispatch("modelReset"),f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H={resume:function(){model.resume()},stop:function(){model.stop()},reset:function(){model.stop(),model.reset&&model.reset(),z(s,o)},is_stopped:function(){return model.is_stopped()}};if(typeof DEVELOPMENT=="undefined")try{I()}catch(X){throw alert(X),new Error(X)}else I();return R(),a.modelReset(),u.on=function(e,t){a.on(e,t)},u.reload=z,u.repaint=W,u.moleculeContainer=P,u}}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};n("cs!common/components/thermometer",["require"],function(t){var n;return n=function(){function t(t,n,r,i){this.dom_selector=t!=null?t:"#thermometer",this.value=n,this.min=r,this.max=i,this.resize=e(this.resize,this),this.dom_element=typeof this.dom_selector=="string"?$(this.dom_selector):this.dom_selector,this.dom_element.addClass("thermometer"),this.thermometer_fill=$("<div>").addClass("thermometer_fill"),this.dom_element.append(this.thermometer_fill),this.redraw()}return t.prototype.add_value=function(e){return this.value=e,this.redraw()},t.prototype.scaled_value=function(){return(this.value-this.min)/(this.max-this.min)},t.prototype.resize=function(){return this.redraw()},t.prototype.redraw=function(){return this.thermometer_fill.height(""+this.scaled_value()*this.dom_element.height()+"px")},t}()})}.call(this),n("common/layout/interactive-layout",["require","common/layout/layout"],function(e){function n(e,t){var n=$(".interactive-thermometer p.label").outerHeight(!0);$(".interactive-thermometer").height(t),t=$(".interactive-thermometer").height(),$(".interactive-thermometer .thermometer").height(t-n),e.redraw()}var t=e("common/layout/layout");return function(){var r,i,s,o,u,a,f,l,c={},h,p=$("#content").width(),d=$("#content").height(),v;l=t.views,i=$(l.moleculeContainers[0].outerNode).width(),s=$(l.moleculeContainers[0].outerNode).height(),a=i/s,f=.6,l.energyGraphs&&(f=.5),o=p*f,u=o/a,c.moleculeContainers=[o,u],l.energyGraphs&&(c.energyGraphs=[p*.45,u]);for(h in l)if(l.hasOwnProperty(h)&&l[h].length){r=-1;while(++r<l[h].length)c[h]?l[h][r].resize(c[h][0],c[h][1]):l[h][r].resize()}s=$(l.moleculeContainers[0].outerNode).height(),t.views.thermometers&&n(t.views.thermometers[0],.8*s),l.energyGraphs&&$(l.moleculeContainers[0].outerNode).css("top",5)}}),n("md2d/controllers/interactives-controller",["require","md2d/controllers/model-controller","cs!common/components/thermometer","common/layout/layout","common/layout/interactive-layout"],function(e){var t=e("md2d/controllers/model-controller"),n=e("cs!common/components/thermometer"),r=e("common/layout/layout"),i=e("common/layout/interactive-layout");return function(s,o,u,a){function E(){window.script=$.extend({},w),window.script.run=function(e,t){var n,r=[],i=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),i.push(t[n]));return T.apply(null,r.concat(e)).apply(null,i)}}function S(e){e=ACTUAL_ROOT+e,$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,l?l.reload(e,p):(l=t("#molecule-container",e,p),j(),l.on("modelReset",j),f.modelController=l)})}function x(e){switch(e.type){case"button":return C(e);case"checkbox":return k(e);case"pulldown":return L(e);case"thermometer":return m=O(e),m;case"energyGraph":return _(e);case"slider":return A(e)}}function T(){var e,t,n,r,i=Array.prototype.slice.call(arguments,0,arguments.length-1),s=arguments[arguments.length-1];t=[],n=[];for(e in w)w.hasOwnProperty(e)&&i.indexOf(e)<0&&(t.push(e),n.push(w[e]));return r="return function("+i.join(",")+") { 'use "+"strict'; "+s+"};",function(){var e,i,o,u;i=[];for(e in window)window.hasOwnProperty(e)&&!w.hasOwnProperty(e)&&i.push(e);o=t.concat(i).concat(r);try{u=Function.apply(null,o).apply(null,n)}catch(a){alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+s)}try{return u.apply(null,Array.prototype.slice.call(arguments))}catch(a){alert('Error running script: "'+a.toString()+'"\nScript:\n\n'+s)}}}function N(e){return typeof e=="string"?e:e.join("\n")}function C(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),t.addClass("component"),n=N(e.action),t.click(T(n)),{elem:t}}function k(e){var t=e.property,n=e.onClick,r,i;return r=$('<input type="checkbox">').attr("id",e.id),i=$("<label>").append(r).append(e.text),i.addClass("component"),n&&(n=N(n),n=T("value",n)),t!==undefined&&u.push(function(){var e=function(){var e=model.get(t);e?r.attr("checked",!0):r.attr("checked",!1)};model.addPropertiesListener([t],e),e()}),r.click(function(){var e=!1,r;$(this).is(":checked")&&(e=!0),t!==undefined&&(r={},r[t]=e,model.set(r)),n!==undefined&&n(e)}),{elem:i}}function L(e){var t,n,r=e.options||[],i,s,o;t=$("<select>").attr("id",e.id),t.addClass("component");for(s=0,o=r.length;s<o;s++)i=r[s],n=$("<option>").html(i.text),i.disabled&&n.attr("disabled",i.disabled),i.selected&&n.attr("selected",i.selected),t.append(n);return t.change(function(){var t=$(this).prop("selectedIndex"),n=e.options[t].action,r;n?(r=N(n),T(r)()):e.options[t].loadModel&&(model.stop(),S(e.options[t].loadModel))}),{elem:t}}function A(e){var t=e.min,n=e.max,r=e.steps,i=e.action,s=e.property,o=e.initialValue,a=e.title||"",f=e.labels||[],l,c,h,p,d,v,m;t==null&&(t=0),n==null&&(n=10),r==null&&(r=10),h=$('<p class="title">'+a+"</p>"),m=$('<div class="container">'),v=$('<div class="html-slider">'),m.append(v),v.slider({min:t,max:n,step:(n-t)/r}),c=$('<div class="interactive-slider">').append(h).append(m);for(l=0;l<f.length;l++)p=f[l],d=$('<p class="label">'+p.label+"</p>"),d.css("left",(p.value-t)/(n-t)*100+"%"),m.append(d);return i&&(i=T("value",i),v.bind("slide",function(e,t){i(t.value)})),s&&(v.bind("slide",function(e,t){var n={};n[s]=t.value,model&&model.set(n)}),u.push(function(){model.addPropertiesListener([s],function(){v.slider("value",model.get(s))})})),o!=null?(i&&u.push(function(){v.slider("value",o),i(o)}),s&&u.push(function(){var e={};e.propertyName=o,model.set(e)})):s&&u.push(function(){v.slider("value",model.get(s))}),{elem:c}}function O(e){function d(e){e=o*e+s,l.text(e.toFixed(u)+" "+i)}var t=$("<div>").attr("id",e.id),r,i="K",s=0,o=1,u=0,a=!!e.labelIsReading,f=a?"":"Thermometer",l=$('<p class="label">').text(f).width("6em"),c=$('<div class="interactive-thermometer">').append(t).append(l),h=new n(t,null,e.min,e.max),p;if(r=e.reading)r.units!=null&&(i=r.units),r.offset!=null&&(s=r.offset),r.scale!=null&&(o=r.scale),r.digits!=null&&(u=r.digits);return M(["temperature"],function(){p.update()}),p={elem:c,component:h,callback:function(){h.resize(),p.update()},update:function(){var e=model.get("temperature");h.add_value(e),a&&d(e)}}}function M(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):h.push([e,t])}function _(e){var t=$("<div>").attr("id",e.id);return{elem:t,callback:function(){var t=e,n=$("#"+t.id),r=model.get("viewRefreshInterval")/1e3,i={title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:20,sample:r,ylabel:"eV",ymin:-5,ymax:5};B(),model.addPropertiesListener(["viewRefreshInterval"],function(){i.sample=model.get("viewRefreshInterval")/1e3,g.reset("#"+t.id,i)}),g?(r=model.get("viewRefreshInterval")/1e3,i.sample=r,$.extend(i,t.options||[]),g.reset("#"+t.id,i,n[0])):($.extend(i,t.options||[]),D(t.id,i)),t.dimensions&&g.resize(t.dimensions.width,e.dimensions.height),model.on("tick.energyGraph",P),model.on("play.energyGraph",function(){g.number_of_points()&&model.stepCounter()<g.number_of_points()&&(B(model.stepCounter()),g.new_data(y)),g.show_canvas()}),model.on("reset.energyGraph",function(){r=model.get("viewRefreshInterval")/1e3,i.sample=r,B(),g.reset("#"+t.id,i),g.new_data(y)}),model.on("seek.energyGraph",function(){var e=model.stepCounter();e>0?B(e):B(),g.new_data(y)})}}}function D(e,t){t=t||{},t.dataset=y,g=grapher.realTimeGraph("#"+e,t)}function P(){g.add_points(H())}function H(){var e=model.ke(),t=model.pe(),n=e+t;return y[0].push(e),y[1].push(t),y[2].push(n),[e,t,n]}function B(e){var t=model.stepCounter(),n,r;if(e){for(n=0,r=y.length;n<r;n++)y[n].length=t;return e}return y=[[0],[0],[0]],0}function j(){var e,t;for(e=0;e<d.length;e++)d[e]();r.addView("moleculeContainers",l.moleculeContainer),m&&r.addView("thermometers",m.component),g&&r.addView("energyGraphs",g),$(window).unbind("resize"),a?(r.selection=a,r.setupScreen(),b||(r.setupScreen(),b=!0),$(window).on("resize",r.setupScreen)):(i(),$(window).on("resize",i));for(e=0;e<h.length;e++)t=h[e],model.addPropertiesListener(t[0],t[1]);for(e=0;e<v.length;e++)v[e]();for(e=0;e<u.length;e++)u[e]()}function F(e,t){var n,r,i={},o,u,f,l,h,m,g,y,b,w;d=[],s=e,c=$(t),c.children().length===0?(h=$('<div class="interactive-top" id="top"/>'),h.append('<div class="interactive-top" id="molecule-container"/>'),s.layout&&s.layout.right&&(m=$('<div class="interactive-top" id="right"/>'),h.append(m)),s.layout&&s.layout.rightwide&&(g=$('<div class="interactive-top" id="rightwide"/>'),h.append(g)),c.append(h),c.append('<div class="interactive-bottom" id="bottom"/>')):(y=$("#bottom"),m=$("#right"),g=$("#rightwide"),y.html(""),m&&m.empty(),g&&g.empty());if(s.model!=null){var E=s.model.onLoad;n=s.model.url,s.model.viewOptions?p=$.extend(!0,{},s.model.viewOptions):p={controlButtons:"play"},p.fit_to_parent=!a,p.interactiveUrl=n,E!=null&&v.push(T(N(E)))}n&&S(n),r=s.components||[];for(b=0,w=r.length;b<w;b++)o=x(r[b]),i[r[b].id]=o;if(s.layout)for(f in s.layout)if(s.layout.hasOwnProperty(f)){u=s.layout[f];for(b=0,w=u.length;b<w;b++)l=u[b],i[l]&&($("#"+f).append(i[l].elem),i[l].callback&&d.push(i[l].callback),delete i[l])}for(l in i)i.hasOwnProperty(l)&&$("#bottom").append(i[l].elem)}u=u||[];var f={},l,c,h=[],p,d=[],v=[],m,g,y=[[],[],[]],b=!1,w=function(){function e(e){return typeof e=="number"&&parseFloat(e)===parseInt(e,10)}function t(e){return typeof e=="object"&&e.slice===Array.prototype.slice}function n(e){return Math.floor(Math.random()*e)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t){var i=[],s;for(s=0;s<t;s++)i[s]=s;for(s=0;s<e;s++)r(i,s,s+n(t-s));return i.length=e,i}return{deg2rad:Math.PI/180,rad2deg:180/Math.PI,addAtom:function(){return model.addAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},adjustTemperature:function(t){model.set({temperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("temperature")>t&&model.set({temperature:t})},loadModel:function(t,n){model.stop(),f.loadModel(t),v=[],typeof n=="function"&&v.push(n)},randomAtoms:function(r){var s=model.get_num_atoms();r==null&&(r=1+n(s-1));if(!e(r))throw new Error("randomAtoms: number of atoms requested, "+r+", is not an integer.");if(r<0)throw new Error("randomAtoms: number of atoms requested, "+r+", was less be greater than zero.");return r>s&&(r=s),i(r,s)},markAtoms:function s(){var e,n;if(arguments.length===0)return;if(t(arguments[0]))return s.apply(null,arguments[0]);w.unmarkAllAtoms();for(e=0,n=arguments.length;e<n;e++)model.setAtomProperties(arguments[e],{marked:1});w.repaint()},unmarkAllAtoms:function(){for(var t=0,n=model.get_num_atoms();t<n;t++)model.setAtomProperties(t,{marked:0});w.repaint()},onPropertyChange:function(t,n){model.addPropertiesListener([t],function(){n(model.get(t))})},setAtomProperties:function(t,n,r,i){model.setAtomProperties(t,n,r,i),w.repaint()},getAtomProperties:function(t){return model.getAtomProperties(t)},setElementProperties:function(t,n){model.setElementProperties(t,n),w.repaint()},getElementProperties:function(t){return model.getElementProperties(t)},setObstacleProperties:function(t,n){model.setObstacleProperties(t,n),w.repaint()},getObstacleProperties:function(t){return model.getObstacleProperties(t)},setRadialBondProperties:function(t,n){model.setRadialBondProperties(t,n),w.repaint()},getRadialBondProperties:function(t){return model.getRadialBondProperties(t)},setAngularBondProperties:function(t,n){model.setAngularBondProperties(t,n),w.repaint()},getAngularBondProperties:function(t){return model.getAngularBondProperties(t)},pe:function(){return model.pe()},ke:function(){return model.ke()},start:function(){model.start()},stop:function(){model.stop()},reset:function(){model.stop(),l.reload()},tick:function(){model.tick()},repaint:function(){l.repaint()},alert:alert,console:window
.console!=null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}();return F(s,o),E(),f.loadInteractive=F,f.loadModel=S,f}}),n("md2d/views/applet-container",["require","common/layout/layout"],function(e){var t=e("common/layout/layout");return function(n,r){function N(e,n){return arguments.length?(u=n,o=e):(u=i.property("clientHeight"),o=i.property("clientWidth")),a&&(l=+a.runMwScript("mw2d:1:get %width"),c=+a.runMwScript("mw2d:1:get %height"),h=l/c,u=o*1/h*1.25),s.style.width=o+"px",s.style.height=u+"px",v=t.screen_factor,t.screen_factor_width&&t.screen_factor_height&&(v=Math.min(t.screen_factor_width,t.screen_factor_height)),v=o/600,m={top:5,right:5,bottom:5,left:5},d=u-m.top-m.bottom,p=o-m.left-m.right,g={width:p,height:d},[o,u]}function C(){function e(){var e,t,n;n=['<applet id="'+r.appletID+'", codebase="'+r.codebase+'", code="'+r.code+'"','     width="'+r.width+'" height="'+r.height+'" MAYSCRIPT="true"','     archive="'+r.archive+'">','     MAYSCRIPT="true">'];for(e=0;e<r.params.length;e++)t=r.params[e],n.push('  <param name="'+t[0]+'" value="'+t[1]+'"/>');return n.push('  <param name="MAYSCRIPT" value="true"/>'),n.push("  Your browser is completely ignoring the applet tag!"),n.push("</applet>"),n.join("\n")}a===undefined?(f=e(),s.innerHTML=f,a=document.getElementById(r.appletID)):(a.style.width=g.width,a.style.height=g.height,a.width=g.width,a.height=g.height),C.node=s,C.scale=N,C.applet=a}var i=d3.select(n),s=i.node(),o=i.property("clientWidth"),u=i.property("clientHeight"),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x={appletID:"mw-applet",codebase:"/jnlp",code:"org.concord.modeler.MwApplet",width:"100%",height:"100%",archive:"org/concord/modeler/unsigned/mw.jar",align:"left",hspace:"5",vspace:"5",params:[["script","page:0:import /imports/legacy-mw-content/potential-tests/two-atoms-two-elements/two-atoms-two-elements.cml"]]};if(r)for(var T in x)r[T]===undefined&&(r[T]=x[T]);else r=x;return N(o,u),C.resize=function(e,t){C.scale(e,t)},s&&C(),C}}),function(){n("cs!common/components/slider",["require"],function(e){var t;return t=function(){function e(e,t,n,r,i){this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.min=n,this.max=r,this.value=i,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return e.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},e.prototype.init_view=function(){var e;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(e=this.height/4,this.y1=this.y2=e,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},e.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},e.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},e.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/4,this.update_handle()},e.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},e.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},e.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},e.prototype.set_scaled_value=function(e){return this.value=(e-this.min)/this.domain,this.handle_x=e/this.domain*this.width,this.update()},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.update_label=function(){var e;return this.label?(e=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+e)):this.text_label.hide()},e.prototype.handle_mousedown=function(e){var t=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(e){return t.handle_mouseup(e)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(e){return t.handle_drag(e)}),this.handle_drag(e)},e.prototype.handle_drag=function(e){var t,n,r,i;return this.dragging?(document.onselectstart=function(){return!1},r=e.pageX-this.slider_well.position().left,i=e.pageY-this.slider_well.position().top,this.horizontal_orientation()?(t=this.width-this.handle_width/4,n=this.handle_width/4,this.handle_x=r,this.handle_x<n&&(this.handle_x=n),this.handle_x>t&&(this.handle_x=t),this.value=this.handle_x/this.width):(this.handle_y=e.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},e.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},e.prototype.init_mouse_handlers=function(){var e=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(t){return e.handle_mousedown(t)})},e}()})}.call(this),n("md2d/controllers/compare-models-controller",["require","md2d/models/modeler","md2d/views/applet-container","md2d/views/molecule-container","cs!common/components/model_player","cs!common/components/thermometer","cs!common/components/slider","common/layout/layout"],function(e){var t=e("md2d/models/modeler"),n=e("md2d/views/applet-container"),r=e("md2d/views/molecule-container"),i=e("cs!common/components/model_player"),s=e("cs!common/components/thermometer"),o=e("cs!common/components/slider"),u=e("common/layout/layout");return function(s,o,a,f,l){function nt(){function e(e){j.update_drawable_positions()}function p(){controlButtons=l.controlButtons,modelTimeLabel=l.modelTimeLabel,enableAtomTooltips=l.enableAtomTooltips||!1,fit_to_parent=l.fit_to_parent,interactiveUrl=l.interactiveUrl,m=f.elements,g=f.atoms,y=f.mol_number,b=f.temperature_control,w=f.temperature,E=f.width,S=f.height,x=f.keShading,T=f.chargeShading,N=f.showVDWLines,C=f.showClock,k=f.viewRefreshInterval,L=f.timeStep,A=f.radialBonds,O=f.angularBonds,M=f.obstacles,_=f.viscosity,D=f.gravitationalField,P=f.images,H=f.textBoxes}function d(){p(),model=t({elements:m,temperature:w,temperature_control:b,width:E,height:S,keShading:x,chargeShading:T,showVDWLines:N,showClock:C,viewRefreshInterval:k,timeStep:L,viscosity:_,gravitationalField:D,images:P});if(g)model.createNewAtoms(g);else{if(!y)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(y),model.relax()}A&&model.createRadialBonds(A),O&&model.createAngularBonds(O),N&&model.createVdwPairs(g),M&&model.createObstacles(M)}function v(){return{model:model,fit_to_parent:fit_to_parent,xmax:E,ymax:S,keShading:x,chargeShading:T,enableAtomTooltips:enableAtomTooltips,images:P,interactiveUrl:interactiveUrl,textBoxes:H,get_results:function(){return model.get_results()},get_radial_bond_results:function(){return model.get_radial_bond_results()},get_radial_bonds:function(){return model.get_radial_bonds()},get_obstacles:function(){return model.get_obstacles()},get_vdw_pairs:function(){return model.get_vdw_pairs()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:controlButtons,modelTimeLabel:modelTimeLabel}}function F(){u.selection=c,model_player=new i(model,h),j=r(s,v()),j.updateMoleculeRadius(),j.setup_drawables(),K=st(),K?V={params:[["script","page:0:import /imports/legacy-mw-content/"+K]]}:V={},X=n(o,V),u.addView("moleculeContainers",j),u.addView("appletContainers",X),u.setupScreen()}function q(){model.stop()}function R(){model.on("tick",e),model.resume()}function z(){model.stop(),model.stepBack()}function W(){model.stop(),model.stepForward()}function J(){model.stop(),d(),rt(),e()}function rt(){B=model.get_atoms(),model.resetTime(),q(),model.on("tick",e),I=model.stepCounter()}function it(){return tt=document.location.hash,tt.length>0?tt.substr(1,tt.length):!1}function st(){var e=it();return e?et[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function ot(){var e=it();e?Z.value=e.replace("/imports/legacy-mw-content/",""):Z.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function ut(){var e,t,n,r,i;et={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],et[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function at(){ut(),d3.select(Z).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),ot()}function ft(e){return X.applet.runMwScript(e)}function lt(){var e=$(Z).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");U=t+n,document.location.hash="#"+U}function ct(){st()&&(V={params:[["script","page:0:import "+st()]]},X=n(o,V),ft("page:0:set frank false"),u.setView("appletContainers",[X]),u.setupScreen())}function ht(){u.setupScreen()}function pt(){at(),d(),rt(),F(),ot()}Z=document.getElementById(a),Q=document.getElementById("start"),Q.onclick=function(){ft("mw2d:1:run"),R()},G=document.getElementById("stop"),G.onclick=function(){ft("mw2d:1:stop"),q()},Y=document.getElementById("reset"),Y.onclick=function(){ft("mw2d:1:reset"),J()},Z.onchange=lt,document.onwebkitfullscreenchange=ht,window.onresize=ht;if(typeof DEVELOPMENT=="undefined")try{pt()}catch(dt){throw alert(dt),new Error(dt)}else pt();nt.runMWScript=ft}var c=l.layoutStyle,h=l.autostart,p=l.maximum_model_steps,d=l.lj_epsilon_max,v=l.lj_epsilon_min,m=f.elements,g=f.atoms,y=f.mol_number,b=f.temperature_control,w=f.temperature,E=f.width,S=f.height,x=f.keShading,T=f.chargeShading,N=f.showVDWLines,C=f.showClock,k=f.viewRefreshInterval,L=f.timeStep,A=f.radialBonds,O=f.angularBonds,M=f.obstacles,_=f.viscosity,D=f.gravitationalField,P=f.images,H=f.textBoxes,B,j,F,I,q,R,U,z,W,X,V={},J,K,Q,G,Y,Z,et,tt;return nt(),nt}}),n("common/benchmark/benchmark",["require"],function(e){function i(){var e=/ (Chrome)\/(.*?) /,t=/ (Firefox)\/([0123456789ab.]+)/,r=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,o=/^(Opera)\/.+? Version\/([0123456789.]+)$/,u=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,f=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,l=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,c=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,h=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/,p;p=navigator.userAgent.match(e);if(p&&p[1])return{browser:p[1],version:p[2],oscpu:s()};p=navigator.userAgent.match(t);if(p&&p[1]){var d=navigator.buildID,v="";return d&&d.length>=8&&(v="("+d.slice(0,4)+"-"+d.slice(4,6)+"-"+d.slice(6,8)+")"),{browser:p[1],version:p[2]+" "+v,oscpu:s()}}p=navigator.userAgent.match(l);if(p&&p[1])return{browser:"Chrome",version:p[4],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(c);if(p&&p[1])return{browser:"Firefox",version:p[2],oscpu:p[1]};p=navigator.userAgent.match(h);if(p&&p[1])return{browser:"Android",version:p[2],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(r);if(p&&p[3])return{browser:p[3],version:p[2]+"/"+p[1],oscpu:s()};p=navigator.userAgent.match(i);if(p&&p[1]){var m=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:p[1],version:p[2],oscpu:n[m[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return p=navigator.userAgent.match(o),p&&p[1]?{browser:p[1],version:p[2],oscpu:s()}:(p=navigator.userAgent.match(u),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(a),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(f),p&&p[1]?{browser:"Mobile Safari",version:p[3],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function s(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var t=r[e[2]]||"32",i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return n[i[1]]+"/"+t}}function o(e,t){function a(){return e.appendChild(document.createElement("tr"))}function c(e,t,n){var r;n=n||"td",r=e.appendChild(document.createElement(n)),typeof t=="string"&&t.slice(0,1)==="<"?r.innerHTML=t:r.textContent=t}function h(e,t){u&&c(f,e,"th"),c(l,t)}var n=0,r,s,o=[];e.style.display="";var u=e.getElementsByTagName("tr").length===0,f=a(),l=a();s=i(),h("browser",s.browser),h("version",s.version),h("cpu/os",s.oscpu);var p=d3.time.format("%Y-%m-%d %H:%M");h("date",p(new Date));for(n=0;n<t.length;n++)r=t[n],h(r.name,r.run())}var t="0.0.1",n={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},r={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"};return{version:t,what_browser:function(){return i()},run:function(e,t){o(e,t)}}}),n("md2d/public-api",["require","md2d/controllers/interactives-controller","md2d/controllers/compare-models-controller","common/layout/layout","common/benchmark/benchmark"],function(e){var t=e("md2d/controllers/interactives-controller"),n=e("md2d/controllers/compare-models-controller"),r=e("common/layout/layout"),i=e("common/benchmark/benchmark"),s;return s={version:"0.0.1",interactivesController:t,compareModelsController:n},window.controllers=s,window.layout=r,window.benchmark=i,s}),t(["md2d/public-api"],undefined,undefined,!0)}(),function(){typeof Lab=="undefined"&&(Lab={}),Lab.version={repo:{branch:"master",commit:{sha:"0f681ec0f4a4f6dc096250930977fb3b320fbf3c",short_sha:"0f681ec0",url:"https://github.com/concord-consortium/lab/commit/0f681ec0",author:"Stephen Bannasch",email:"stephen.bannasch@gmail.com",date:"2012-10-18 17:32:50 -0400",short_message:"distribution in nested dir: load Images correctly",message:"distribution in nested dir: load Images correctly\n\n[#38053031]\n\nImages in Interactives aren&#x27;t loaded correctly when\na user uses a distribution archive to serve Lab content\nin a web directory which is not at the root level of\nthe web server."},dirty:!1}}}(),function(){typeof Lab=="undefined"&&(Lab={}),Lab.config={sharing:!1,home:"http://lab.concord.org",homeInteractivePath:"/examples/interactives/interactive.html",homeEmbeddablePath:"/examples/interactives/embeddable.html",utmCampaign:"EdX"}}();