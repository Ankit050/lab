(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),grapher={version:"0.0.1"},grapher.data=function(e){var t=0,n=e.length,r=[];for(t=0;t<n;t+=2)r.push({x:e[t],y:e[t+1]});return r},grapher.axis={axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.2+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.2+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.2+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}},grapher.indexedData=function(e,t){var n=0,r=t||0,i=e.length,s=[];for(n=0;n<i;n++)s.push({x:n+r,y:e[n]});return s},grapher.graph=function(e,t,n){function H(e){if(e)for(var t in P)e[t]===undefined&&(e[t]=P[t]);else e=P;return e}function B(){r<=L.icon?(L.category="icon",L.value=0):r<=L.tiny?(L.category="tiny",L.value=1):r<=L.small?(L.category="small",L.value=2):r<=L.medium?(L.category="medium",L.value=3):r<=L.large?(L.category="large",L.value=4):(L.category="extralarge",L.value=5)}function j(t,n){arguments.length?(r=t,i=n,s.style.width=r+"px",s.style.height=i+"px"):(r=e.property("clientWidth"),i=e.property("clientHeight")),B(),T=layout.getDisplayProperties(),N=T.emsize}function F(e,s){if(e||!t)t=H(e);o!==undefined&&(o.remove(),o=undefined),s&&(n=s),t.dataChange?x="ns-resize":x="crosshair",j(),t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,t.datacount=2,C=t.strokeWidth;switch(L.value){case 0:m={top:4,right:4,bottom:4,left:4};break;case 1:m={top:8,right:8,bottom:8,left:8};break;case 2:m={top:t.title?25:15,right:15,bottom:20,left:20};break;case 3:m={top:t.title?30:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45};break;default:m={top:t.title?40:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45}}Object.prototype.toString.call(t.title)==="[object Array]"?D=t.title:D=[t.title],D.reverse(),L.value>2?m.top+=(D.length-1)*L.value/3*L.value/3*N*22:D=[D[0]],g={width:r-m.left-m.right,height:i-m.top-m.bottom},w=function(e){return e[0]},E=function(e){return e[1]},y=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,g.width]),b=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,g.height]).nice(),S=d3.svg.line().x(function(e,t){return y(points[t][0])}).y(function(e,t){return b(points[t][1])})}function I(p){function d(e){e?v.text(e):v.text("")}function w(){var e=t.yrange/2,n=e/2,r;return t.datacount=g.width/30,t.xtic=t.xrange/t.datacount,t.ytic=t.yrange/t.datacount,r=d3.range(t.datacount).map(function(r){return[r*t.xtic+t.xmin,t.ymin+n+Math.random()*e]}),r}function E(){if(!_)return;switch(d3.event.keyCode){case 8:case 46:if(t.dataChange){var e=points.indexOf(_);points.splice(e,1),_=points.length?points[e>0?e-1:0]:null,B()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}}function T(){m={top:t.title?40:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45},g.width=r-m.left-m.right,g.height=i-m.top-m.bottom,a.attr("width",g.width).attr("height",g.height)}function k(){y.domain([t.xmin,t.xmax]).range([0,g.width])}function P(){b.domain([t.ymin,t.ymax]).range([g.height,0])}function H(){var e=function(e){return"translate("+y(e)+",0)"},t=function(e){return"translate(0,"+b(e)+")"},n=function(e){return e?"#ccc":"#666"},r=y.tickFormat(d3.format(".3r")),i=y.tickFormat(d3.format(".3r")),s=u.selectAll("g.x").data(y.ticks(10),String).attr("transform",e);s.select("text").text(r);var o=s.enter().insert("g","a").attr("class","x").attr("transform",e);o.append("line").attr("stroke",n).attr("y1",0).attr("y2",g.height),L.value>1&&o.append("text").attr("class","axis").style("font-size",L.value/2.7*100+"%").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").text(r).style("cursor","ew-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",R).on("touchstart.drag",R),s.exit().remove();var f=u.selectAll("g.y").data(b.ticks(10),String).attr("transform",t);f.select("text").text(i);var l=f.enter().insert("g","a").attr("class","y").attr("transform",t).attr("background-fill","#FFEEB6");l.append("line").attr("stroke",n).attr("x1",0).attr("x2",g.width),L.value>1&&l.append("text").attr("class","axis").style("font-size",L.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(i).style("cursor","ns-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",U).on("touchstart.drag",U),f.exit().remove(),a.call(d3.behavior.zoom().x(y).y(b).on("zoom",H)),B()}function B(){var e=u.select("path").attr("d",S(points)),n=u.select("svg").selectAll("circle").data(points,function(e){return e});t.circleRadius&&L.value>1&&(t.circleRadius<=4&&L.value<3||(n.enter().append("circle").attr("class",function(e){return e===_?"selected":null}).attr("cx",function(e){return y(e[0])}).attr("cy",function(e){return b(e[1])}).attr("r",t.circleRadius*(1+L.value)/4).style("stroke-width",t.circleRadius/6*(L.value-1.5)).style("cursor",x).on("mousedown.drag",z).on("touchstart.drag",z),n.attr("class",function(e){return e===_?"selected":null}).attr("cx",function(e){return y(e[0])}).attr("cy",function(e){return b(e[1])}).attr("r",t.circleRadius*(1+L.value)/4).style("stroke-width",t.circleRadius/6*(L.value-1.5)))),n.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function q(){d3.event.preventDefault(),grapher.registerKeyboardHandler(E),d3.select("body").style("cursor","move");if(d3.event.altKey)if(d3.event.shiftKey&&t.addData){var e=d3.svg.mouse(u.node()),n=[];n[0]=y.invert(Math.max(0,Math.min(g.width,e[0]))),n[1]=b.invert(Math.max(0,Math.min(g.height,e[1]))),points.push(n),points.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),_=n,B()}else{var e=d3.svg.mouse(u[0][0]);A=y.invert(e[0]),O=b.invert(e[1]),M=!1,d3.event.stopPropagation()}}function R(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(u[0][0]);A=y.invert(t[0])}function U(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(u[0][0]);O=b.invert(t[1])}function z(e){grapher.registerKeyboardHandler(E),document.onselectstart=function(){return!1},_=M=e,B()}function W(){var e=d3.svg.mouse(u[0][0]),n,r,i,s=d3.event.changedTouches;d3.event.preventDefault(),M&&t.dataChange&&(M[1]=b.invert(Math.max(0,Math.min(g.height,e[1]))),B()),isNaN(A)||(d3.select("body").style("cursor","ew-resize"),y.domain(grapher.axis.axisProcessDrag(A,y.invert(e[0]),y.domain())),H(),d3.event.stopPropagation()),isNaN(O)||(d3.select("body").style("cursor","ns-resize"),b.domain(grapher.axis.axisProcessDrag(O,b.invert(e[1]),b.domain())),H(),d3.event.stopPropagation())}function X(){document.onselectstart=function(){return!0},d3.select("body").style("cursor","auto"),isNaN(A)||(A=Math.NaN,H()),isNaN(O)||(O=Math.NaN,H()),M=null}p||(p=e),p.each(function(){e=d3.select(this),this.clientWidth&&this.clientHeight&&(r=this.clientWidth,i=this.clientHeight,g.width=r-m.left-m.right,g.height=i-m.top-m.bottom),points=t.points||w(),k(),P(),o===undefined?(o=e.append("svg").attr("width",r).attr("height",i),u=o.append("g").attr("transform","translate("+m.left+","+m.top+")"),a=u.append("rect").attr("class","plot").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown.drag",q).on("touchstart.drag",q).call(d3.behavior.zoom().x(y).y(b).on("zoom",H)),f=u.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height).attr("class","line"),f.append("path").attr("class","line").style("stroke-width",C).attr("d",S(points)),t.title&&L.value>1&&(l=u.selectAll("text").data(D,function(e){return e}),l.enter().append("text").attr("class","title").style("font-size",L.value/2.4*100+"%").text(function(e){return e}).attr("x",g.width/2).attr("dy",function(e,t){return-0.5+ -1*L.value/2.8*t*N+"em"}).style("text-anchor","middle")),t.xlabel&&L.value>2&&(c=u.append("text").attr("class","axis").style("font-size",L.value/2.6*100+"%").text(t.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle")),t.ylabel&&L.value>2&&(h=u.append("g").append("text").attr("class","axis").style("font-size",L.value/2.6*100+"%").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+g.height/2+") rotate(-90)")),d3.select(s).on("mousemove.drag",W).on("touchmove.drag",W).on("mouseup.drag",X).on("touchend.drag",X),v=u.append("text").attr("class","graph-notification").text(n).attr("x",g.width/2).attr("y",g.height/2).style("text-anchor","middle")):(u.attr("width",r).attr("height",i),a.attr("width",g.width).attr("height",g.height),f.attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height),t.title&&L.value>1&&l.each(function(e,t){d3.select(this).attr("x",g.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-D.length+"em"})}),t.xlabel&&L.value>1&&c.attr("x",g.width/2).attr("y",g.height),t.ylabel&&L.value>1&&h.attr("transform","translate(-40 "+g.height/2+") rotate(-90)"),v.attr("x",g.width/2).attr("y",g.height/2)),H()}),I.elem=e,I.redraw=H,I.update=B,I.notify=d,I.initialize=F,I.updateXScale=k,I.updateYScale=P,I.scale=j}function q(){t.title&&l&&l.text(t.title)}function R(){t.xlabel&&c&&c.text(t.xlabel)}function U(){t.ylabel&&h?h.text(t.ylabel):h.style("display","none")}function z(e){return y(e[0])}function W(e){return b(e[1])}function X(){redraw()}var r=600,i=300,s;arguments.length&&(e=d3.select(e),s=e.node(),r=e.property("clientWidth"),i=e.property("clientHeight"));var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},A=Math.NaN,O=Math.NaN,M=null,_=null,D=[],P={xmax:60,xmin:0,ymax:40,ymin:0,title:"Simple Graph1",xlabel:"X Axis",ylabel:"Y Axis",circleRadius:10,strokeWidth:2,dataChange:!0,addData:!0,points:!1,notification:!1};return F(t),I.margin=function(e){return arguments.length?(margin=e,I):margin},I.xmin=function(e){return arguments.length?(t.xmin=e,t.xrange=t.xmax-t.xmin,I.updateXScale&&(I.updateXScale(),I.redraw()),I):t.xmin},I.xmax=function(e){return arguments.length?(t.xmax=e,t.xrange=t.xmax-t.xmin,I.updateXScale&&(I.updateXScale(),I.redraw()),I):t.xmax},I.ymin=function(e){return arguments.length?(t.ymin=e,t.yrange=t.ymax-t.ymin,I.updateYScale&&(I.updateYScale(),I.redraw()),I):t.ymin},I.ymax=function(e){return arguments.length?(t.ymax=e,t.yrange=t.ymax-t.ymin,I.updateYScale&&(I.updateYScale(),I.redraw()),I):t.ymax},I.xLabel=function(e){return arguments.length?(t.xlabel=e,R(),I):t.xlabel},I.yLabel=function(e){return arguments.length?(t.ylabel=e,U(),I):t.ylabel},I.title=function(e){return arguments.length?(t.title=e,q(),I):t.title},I.width=function(e){return arguments.length?(g.width=e,I):g.width},I.height=function(e){return arguments.length?(g.height=e,I):g.height},I.x=function(e){return arguments.length?(w=e,I):w},I.y=function(e){return arguments.length?(E=e,I):E},I.elem=function(t){return arguments.length?(e=d3.select(t),e.call(I),I):e},I.data=function(e){if(!arguments.length)return points;var t=y.domain(),n=t[1]-t[0],r=n*.8;return points=e,points.length>t[1]?(t[0]+=r,t[1]+=r,y.domain(t),I.redraw()):I.update(),I},I.add_data=function(e){if(!arguments.length)return points;var t=y.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)points.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");points.push(e)}return points[points.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,y.domain(t),I.redraw()):I.update(),I},I.reset=function(e,t){return arguments.length?I.initialize(e,t):I.initialize(),I(),I},I.resize=function(e,t){return I.scale(e,t),I.initialize(),I(),I},e&&e.call(I),I},grapher.realTimeGraph=function(e,t){function j(e,t,n){var r=0,i=t||0,s=e.length,o=[];n=n||1;for(r=0;r<s;r++)o.push({x:(r+i)*n,y:e[r]});return o}function F(){return A?A.length:!1}function I(e,n){i=e,s=n,r.style.width=i+"px",r.style.height=s+"px",o={top:t.title?40:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45},E=layout.getDisplayProperties().emsize,Object.prototype.toString.call(t.title)==="[object Array]"?S=t.title:S=[t.title],o.top+=(S.length-1)*E*20,width=i-o.left-o.right,height=s-o.top-o.bottom,u={width:width,height:height},a=u.width,f=u.height,c.domain([t.xmin,t.xmax]).range([0,u.width]),d.domain([t.ymin,t.ymax]).nice().range([u.height,0]).nice(),h=Math.NaN,v=Math.NaN,b=null}function q(){function e(){var t=c.tickFormat(10),r=d.tickFormat(8),i=C.selectAll("g.x").data(c.ticks(8),String).attr("transform",p);i.select("text").text(t);var s=i.enter().insert("g","a").attr("class","x").attr("transform",p);s.append("line").attr("stroke",l).attr("y1",0).attr("y2",u.height),s.append("text").attr("y",u.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(t).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",T).on("touchstart.drag",T),i.exit().remove();var o=C.selectAll("g.y").data(d.ticks(10),String).attr("transform",m);o.select("text").text(r);var a=o.enter().insert("g","a").attr("class","y").attr("transform",m).attr("background-fill","#FFEEB6");a.append("line").attr("stroke",l).attr("x1",0).attr("x2",u.width),a.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(r).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",N).on("touchstart.drag",N),o.exit().remove(),k.call(d3.behavior.zoom().x(c).y(d).on("zoom",e)),n()}function n(e){var t,i=r.children[0].getElementsByTagName("rect")[0];et(e);if(q.selectable_points){var s=C.selectAll("circle").data(A,function(e){return e});s.enter().append("circle").attr("class",function(e){return e===w?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}).attr("r",1).on("mousedown",function(e){w=b=e,n()}),s.attr("class",function(e){return e===w?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}),s.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function E(){d3.event.preventDefault(),k.style("cursor","move");if(d3.event.altKey){var e=d3.svg.mouse(C[0][0]);h=c.invert(e[0]),v=d.invert(e[1]),b=!1,d3.event.stopPropagation()}}function T(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(C[0][0]);h=c.invert(t[0])}function N(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(C[0][0]);v=d.invert(t[1])}function P(){var t=d3.svg.mouse(C[0][0]),n,r,i,s=d3.event.changedTouches;document.onselectstart=function(){return!0},d3.event.preventDefault(),isNaN(h)||(d3.select("body").style("cursor","ew-resize"),c.domain(grapher.axis.axisProcessDrag(h,c.invert(t[0]),c.domain())),e(),d3.event.stopPropagation()),isNaN(v)||(d3.select("body").style("cursor","ns-resize"),d.domain(grapher.axis.axisProcessDrag(v,d.invert(t[1]),d.domain())),e(),d3.event.stopPropagation())}function H(){d3.select("body").style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(h)||(e(),h=Math.NaN),isNaN(v)||(e(),v=Math.NaN),b=null}function B(e){M={x:A[e].x,y:A[e].y}}function R(){var t,r=c.domain(),i=r[1]-r[0],s=A.length*D,o=i*.9;s>r[1]?(r[0]+=o,r[1]+=o,c.domain(r),e()):n()}function U(e){if(A.length===0)return;M=!1;var t=A.length,n=t*D,r={x:n,y:e},i,s;A.push(r),R()}function z(e){if(A.length===0)return;U(e),R()}function W(e){if(A.length===0)return;M=!1;var t=A.length,n=t*D,r=n-D,i={x:n,y:e},s=c.call(self,r,r),o=d.call(self,A[t-1].y,t-1),u,a;A.push(i),u=c.call(self,n,n),a=d.call(self,e,n),gctx.beginPath(),gctx.moveTo(s,o),gctx.lineTo(u,a),gctx.stroke()}function X(e){for(var t=0;t<O.length;t++)A=O[t],U(e[t]);R()}function V(e){for(var t=0;t<O.length;t++)A=O[t],$(t),W(e[t])}function $(e,t){var n=t?.4:1;switch(e){case 0:gctx.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:gctx.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:gctx.strokeStyle="rgba(44,0,160,"+n+")"}}function J(e){var n;O=[];if(Object.prototype.toString.call(e)==="[object Array]")for(n=0;n<e.length;n++)A=j(e[n],0,D),O.push(A);else A=j(t.dataset,0,D),O=[A];R()}function K(t){x=d3.scale.linear().domain([0,t]).range([0,a]),q.xmax=t,x_tics_scale=d3.scale.linear().domain([q.xmin*q.sample,q.xmax*q.sample]).range([0,a]),n(),e()}function Q(t){y=d3.scale.linear().domain([t,0]).range([0,f]),q.ymax=t,n(),e()}function G(){gcanvas.width=gcanvas.width,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,gcanvas.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)"}function Y(){C.select("path.line").attr("d",[]),gcanvas.style.zIndex=100}function Z(){gcanvas.style.zIndex=-100,n()}function et(e){var t,n,r,i,s,o;typeof e=="undefined"?s=O[0].length:s=e;if(A.length===0)return;G(),gctx.fillRect(0,0,gcanvas.width,gcanvas.height);for(t=0;t<O.length;t++){A=O[t],px=c.call(self,0,0),i=d.call(self,A[0].y,0),n=0,lengthX=0,$(t),gctx.beginPath(),gctx.moveTo(px,i),o=s-1;for(n=0;n<o;n++)lengthX+=D,px=c.call(self,lengthX,lengthX),i=d.call(self,A[n].y,lengthX),gctx.lineTo(px,i);gctx.stroke(),o=A.length-1;if(n<o){$(t,!0);for(;n<o;n++)lengthX+=D,px=c.call(self,lengthX,lengthX),i=d.call(self,A[n].y,lengthX),gctx.lineTo(px,i);gctx.stroke()}}}function tt(){gcanvas=document.createElement("canvas"),r.appendChild(gcanvas),gcanvas.style.zIndex=-100,rt(gcanvas)}function nt(){rt(gcanvas),et()}function rt(e){var t={};t.rect=r.children[0].getElementsByTagName("rect")[0],t.width=t.rect.width.baseVal.value,t.height=t.rect.height.baseVal.value,t.left=t.rect.getCTM().e,t.top=t.rect.getCTM().f,e.style.position="absolute",e.width=t.width,e.height=t.height,e.style.width=t.width+"px",e.style.height=t.height+"px",e.offsetLeft=t.left,e.offsetTop=t.top,e.style.left=t.left+"px",e.style.top=t.top+"px",e.style.border="solid 1px red",e.style.pointerEvents="none",e.className+="canvas-overlay",gctx=gcanvas.getContext("2d"),gctx.globalCompositeOperation="source-over",gctx.lineWidth=1,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,e.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)",gcanvas.style.border="solid 1px red"}I(i,s),C===undefined?(C=d3.select(r).append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+o.left+","+o.top+")"),k=C.append("rect").attr("class","plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",E).on("touchstart",E),k.call(d3.behavior.zoom().x(c).y(d).on("zoom",e)),L=C.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",u.width).attr("height",u.height).attr("viewBox","0 0 "+u.width+" "+u.height).append("path").attr("class","line").attr("d",g(A)),_=L.append("path").attr("class","marker").attr("d",[]),t.title&&(title=C.selectAll("text").data(S,function(e){return e}),title.enter().append("text").attr("class","title").text(function(e){return e}).attr("x",u.width/2).attr("dy",function(e,t){return 1.4*t-S.length+"em"}).style("text-anchor","middle")),t.xlabel&&C.append("text").attr("class","xlabel").text(t.xlabel).attr("x",u.width/2).attr("y",u.height).attr("dy","2.4em").style("text-anchor","middle"),t.ylabel&&C.append("g").append("text").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),d3.select(r).on("mousemove.drag",P).on("touchmove.drag",P).on("mouseup.drag",H).on("touchend.drag",H),tt()):(d3.select(r).select("svg").attr("width",i).attr("height",s),C.select("rect.plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE"),C.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",u.width).attr("height",u.height).attr("viewBox","0 0 "+u.width+" "+u.height),t.title&&C.select("text.title").attr("x",u.width/2).attr("dy","-1em"),t.xlabel&&C.select("text.xlabel").attr("x",u.width/2).attr("y",u.height),t.ylabel&&C.select("text.ylabel").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),C.selectAll("g.x").remove(),C.selectAll("g.y").remove(),nt()),e(),q.node=r,q.scale=I,q.update=n,q.redraw=e,q.number_of_points=F,q.new_data=J,q.add_point=z,q.add_points=X,q.add_canvas_point=W,q.add_canvas_points=V,q.initialize_canvas=tt,q.show_canvas=Y,q.hide_canvas=Z,q.clear_canvas=G,q.update_canvas=et,q.showMarker=B,q.change_xaxis=K,q.change_yaxis=Q}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l=function(e){return e?"#ccc":"#666"},c=d3.scale.linear(),h,p=function(e){return"translate("+c(e)+",0)"},d=d3.scale.linear(),v,m=function(e){return"translate(0,"+d(e)+")"},g=d3.svg.line().x(function(e,t){return c(A[t].x)}).y(function(e,t){return d(A[t].y)}),b,w,E=layout.getDisplayProperties().emsize,S=[],T,N,C,k,L,A,O,M,_,D,P={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1,points:!1,sample:1};if(t)for(var H in P)t[H]===undefined&&(t[H]=P[H]);else t=P;D=t.sample,t.dataChange?circleCursorStyle="ns-resize":circleCursorStyle="crosshair",t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,I(i,s),O=[];if(Object.prototype.toString.call(t.dataset[0])==="[object Array]"){for(var B=0;B<t.dataset.length;B++)O.push(j(t.dataset[B],0,D));A=O[0]}else A=j(t.dataset,0),O=[A];return q.resize=function(e,t){q.scale(e,t),q()},q.add_data=function(e){if(!arguments.length)return A;var t=c.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)A.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");A.push(e)}return A[A.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,c.domain(t),q.redraw()):q.update(),q},r&&q(),q},grapher.colors=function(e){var t={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return t[e]},grapher.registerKeyboardHandler=function(e){d3.select(window).on("keydown",e)}})(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){});var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=i._cached?i._cached:i();return s};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function a(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var s={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,t),e.modules[t]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),e.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),e.define("/arrays/arrays.js",function(e,t,n,r,i){var s;s=n.arrays={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t=t||0;var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r}}),e.define("/constants/index.js",function(e,t,n,r,i){var s=e("./units"),o=s.unit,u=s.ratio,a=s.convert,f={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:u(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}},l,c;f.COULOMB_CONSTANT={value:1/(4*Math.PI*f.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},n.unit=o,n.ratio=u,n.convert=a;for(l in f)f.hasOwnProperty(l)&&(c=f[l],n[l]=function(e){return{as:function(t){return s.convert(e.value,{from:e.unit,to:t})}}}(c))}),e.define("/constants/units.js",function(e,t,n,r,i){var s=1.66054e-27,o=1.602177e-19,u=o,a=1e-15,f=1e-9,l=10,c=1e3,h={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},p,d,v;n.unit=p={FEMTOSECOND:{name:"femtosecond",value:1,type:h.TIME},SECOND:{name:"second",value:a,type:h.TIME},NANOMETER:{name:"nanometer",value:1,type:h.LENGTH},ANGSTROM:{name:"Angstrom",value:1*l,type:h.LENGTH},METER:{name:"meter",value:1*f,type:h.LENGTH},DALTON:{name:"Dalton",value:1,type:h.MASS},GRAM:{name:"gram",value:1*s*c,type:h.MASS},KILOGRAM:{name:"kilogram",value:1*s,type:h.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:h.ENERGY},JOULE:{name:"Joule",value:s*f*f*(1/a)*(1/a),type:h.ENERGY},EV:{name:"electron volt",value:s*f*f*(1/a)*(1/a)*(1/u),type:h.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:h.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*u,type:h.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:h.CHARGE},COULOMB:{name:"Coulomb",value:o,type:h.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:h.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:h.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:h.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:h.FORCE},NEWTON:{name:"Newton",value:1*s*f*(1/a)*(1/a),type:h.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*s*f*f*(1/a)*(1/a)*(1/u),type:h.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:h.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*f*(1/a),type:h.VELOCITY}},n.ratio=d=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},n.convert=v=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*d(r,{per:n})}}),e.define("/math/index.js",function(e,t,n,r,i){n.normal=e("./distributions").normal,n.getWindowedAverager=e("./utils").getWindowedAverager,n.minimize=e("./minimizer").minimize,window&&(window.minimize=n.minimize)}),e.define("/math/distributions.js",function(e,t,n,r,i){n.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math
.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),e.define("/math/utils.js",function(e,t,n,r,i){n.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:NaN}}}),e.define("/math/minimizer.js",function(e,t,n,r,i){n.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var r=n.precision,i=n.bounds,s=n.maxiter||1e3,o=n.stopval||-Infinity,u=n.maxstep||.01,a=n.eps||.01,f=t.length,l,c,h,p,d,v,m,g,y,b;v=u*u,l=[];for(y=0;y<f;y++)l[y]=t[y];c=e.apply(null,l),h=c[0],d=c[1],g=0;do{if(h<=o)break;if(g>s)return console.log("maxiter reached"),{error:"maxiter reached",f:h,iter:s,x:l};m=0;for(y=0;y<f;y++)m+=d[y]*d[y];if(a*a*m>v){b=Math.sqrt(v/m)/a;for(y=0;y<f;y++)d[y]=b*d[y]}for(y=0;y<f;y++)l[y]-=a*d[y],i&&l[y]<i[y][0]&&(l[y]=i[y][0]),i&&l[y]>i[y][1]&&(l[y]=i[y][1]);p=h,c=e.apply(null,l),h=c[0],d=c[1],g++}while(Math.abs(h-p)>r);return[h,l]}}),e.define("/potentials/index.js",function(e,t,n,r,i){var s=n.potentials={};n.coulomb=e("./coulomb"),n.lennardJones=e("./lennard-jones")}),e.define("/potentials/coulomb.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.COULOMB_CONSTANT.as(s.unit.METERS_PER_FARAD),a=s.ratio(o.NANOMETER,{per:o.METER}),f=Math.pow(s.ratio(o.COULOMB,{per:o.ELEMENTARY_CHARGE}),2),l=s.ratio(o.EV,{per:o.JOULE}),c=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON}),h=u*f*a*l,p=u*f*a*a*c,d=n.potential=function(e,t,n){return h*(t*n/e)},v=n.forceFromSquaredDistance=function(e,t,n){return-p*(t*n/e)},m=n.forceOverDistanceFromSquaredDistance=function(e,t,n){return v(e,t,n)/Math.sqrt(e)},g=n.force=function(e,t,n){return v(e*e,t,n)}}),e.define("/potentials/lennard-jones.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.ratio(o.NANOMETER,{per:o.METER}),a=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON});n.pairwiseEpsilon=function(e,t){return.5*(e+t)},n.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},n.rmin=function(e){return Math.pow(2,1/6)*e},n.radius=function(e){return.5*n.rmin(e)},n.newLJCalculator=function(e,t){var r,i,f,l,c,h,p,d=function(e,d){r=e,i=d,f=n.rmin(i),r!=null&&i!=null&&(l=4*r*Math.pow(i,12),c=4*r*Math.pow(i,6),h=12*s.convert(l,{from:o.EV,to:o.JOULE})*u*a,p=6*s.convert(c,{from:o.EV,to:o.JOULE})*u*a),typeof t=="function"&&t(v(),this)},v=function(){return{epsilon:r,sigma:i,rmin:f}},m=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},g=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},y;return m(e.epsilon),g(e.sigma),d(e.epsilon,e.sigma),y={coefficients:v,setEpsilon:function(e){m(e),d(e,i)},setSigma:function(e){g(e),d(r,e)},potentialFromSquaredDistance:function(e){return l*Math.pow(e,-6)-c*Math.pow(e,-3)},potential:function(e){return y.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*y.forceOverDistanceFromSquaredDistance(e*e)}}}}),e.define("/md2d.js",function(e,t,n,r,i){typeof window=="undefined"&&(window={});var s=e("./arrays/arrays").arrays,o=e("./constants"),u=o.unit,a=e("./math"),f=e("./potentials").coulomb,l=e("./potentials").lennardJones,c=!0,h=function(){try{new Float32Array}catch(e){return!1}return!0}(),p=2,d=1e3,v=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),m=.34,g=39.95,y=o.convert(g,{from:u.DALTON,to:u.KILOGRAM}),b=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),w,E,S,x=function(e,t,n,r){return e*r-t*n},T=function(e,t){return e*e+t*t},N=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/b},C=function(e,t){var n=2*t,r=e*b,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},k=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")},L=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t};n.ELEMENT_INDICES=E={MASS:0,EPSILON:1,SIGMA:2,RADIUS:3},n.INDICES=w={RADIUS:0,PX:1,PY:2,X:3,Y:4,VX:5,VY:6,SPEED:7,AX:8,AY:9,CHARGE:10,ELEMENT:11},n.SAVEABLE_INDICES=S=["X","Y","VX","VY","CHARGE","ELEMENT"],n.makeModel=function(){var e,t=!1,n=!1,r=!1,i=!0,v=!1,m=!1,g,y=.001,b=[10,10],C,A,O,M,_=0,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt=0,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt=window.state={},dt=[],vt=[],mt=5,gt=[],yt=[],bt=function(e,t,n){gt[e][t]=gt[t][e]=mt*mt*n.sigma*n.sigma,e===t&&wt(e,n)},wt=function(e,t){j[e][E.RADIUS]=l.radius(t.sigma);if(!F||!K)return;for(var n=0,r=F.length;n<r;n++)F[n]=j[K[n]][E.RADIUS]},Et=function(t){var r=[],i,o;for(o=0;o<Q.length;o++)r[o]=Q[o];i=B,n=!1,e.createAtoms({num:t});for(o=0;o<Q.length;o++)s.copy(r[o],Q[o]);H=r[0].length,B=i},St=function(e){var t=h&&c?"Float32Array":"regular",n=h&&c?"Uint16Array":"regular";tt=[],tt[0]=G=s.create(e,0,n),tt[1]=Y=s.create(e,0,n),tt[2]=Z=s.create(e,0,t),tt[3]=et=s.create(e,0,t)},xt=function(e){var t=[],n;for(n=0;n<tt.length;n++)t[n]=tt[n];St(e);for(n=0;n<tt.length;n++)s.copy(t[n],tt[n])},Tt,Nt=function(){return r?1e3:1e3},Ct=function(){m=!0,Tt=a.getWindowedAverager(Nt())},kt=function(){var e=0,t;for(t=0;t<H;t++)e+=j[K[t]][0]*(z[t]*z[t]+W[t]*W[t]);return N(e/2,H)},Lt=function(e,t){z[e]*=t,W[e]*=t,I[e]*=t,q[e]*=t},At=function(e,t,n){z[e]+=t,W[e]+=n,I[e]=z[e]*j[K[e]][0],q[e]=W[e]*j[K[e]][0]},Ot=function(e,t){z[e]-=t*(U[e]-it),W[e]+=t*(R[e]-rt),I[e]=z[e]*j[K[e]][0],q[e]=W[e]*j[K[e]][0]},Mt=function(){for(var e=0;e<H;e++)At(e,-ut,-at),Ot(e,-ct)},_t=function(){for(var e=0;e<H;e++)At(e,ut,at),Ot(e,ct)},Dt=function(){var e=0,t=0,n=0,r=0,i;for(i=0;i<H;i++)e+=R[i],t+=U[i],n+=I[i],r+=q[i];rt=e/H,it=t/H,st=n,ot=r,ut=n/B,at=r/B},Pt=function(){var e=0,t=0,n,r;for(r=0;r<H;r++)n=j[K[r]][0],e+=n*x(R[r]-rt,U[r]-it,z[r]-ut,W[r]-at),t+=n*T(R[r]-rt,U[r]-it);ft=e,lt=t,ct=ft/lt},Ht=function(){Dt(),Pt()},Bt=function(e){R[e]+=z[e]*D+.5*V[e]*P,U[e]+=W[e]*D+.5*$[e]*P},jt=function(e){R[e]<M?(R[e]=M+(M-R[e]),z[e]*=-1,I[e]*=-1):R[e]>A&&(R[e]=A-(R[e]-A),z[e]*=-1,I[e]*=-1),U[e]<O?(U[e]=O+(O-U[e]),W[e]*=-1,q[e]*=-1):U[e]>C&&(U[e]=C-(U[e]-C),W[e]*=-1,q[e]*=-1)},Ft=function(e){var t=j[K[e]][0];z[e]+=.5*V[e]*D,I[e]=t*z[e],W[e]+=.5*$[e]*D,q[e]=t*W[e]},It=function(e){var t,n,s,o,u,a,l,c=K[e],h,p=1/j[c][0],d,v=J[e];for(t=0;t<e;t++)h=K[t],d=1/j[h][0],n=R[t]-R[e],s=U[t]-U[e],o=n*n+s*s,u=0,i&&o<gt[c][h]&&(u+=yt[c][h].forceOverDistanceFromSquaredDistance(o)),r&&(u+=f.forceOverDistanceFromSquaredDistance(o,v,J[t])),u&&(a=u*n,l=u*s,V[e]+=a*p,$[e]+=l*p,V[t]-=a*d,$[t]-=l*d)},qt=function(){if(nt<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,v,m;for(e=0,t=tt[0].length;e<t;e++)n=G[e],r=Y[e],v=1/j[K[n]][0],m=1/j[K[r]][0],i=R[r]-R[n],s=U[r]-U[n],a=i*i+s*s,f=Math.sqrt(a),l=et[e],c=Z[e],h=o.convert(l*(f-c),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/f,p=h*i,d=h*s,V[n]+=p*v,$[n]+=d*v,V[r]-=p*m,$[r]-=d*m},Rt=function(e,t){var n,r;e==null&&(e=g),ht=kt(),m&&Math.abs(Tt(ht)-e)<=e*y&&(m=!1);if(t||v||m&&ht>0){n=Math.sqrt(e/ht);for(r=0;r<H;r++)Lt(r,n);ht=e}};return e={outputState:pt,useCoulombInteraction:function(e){r=!!e},useLennardJonesInteraction:function(e){i=!!e},useThermostat:function(e){v=!!e},setTargetTemperature:function(e){k(e),g=e},setTime:function(e){pt.time=_=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;b=[n,r]},getSize:function(){return[b[0],b[1]]},getLJCalculator:function(){return yt},setElements:function(e){var t,r,i,s,o,u;if(n)throw new Error("md2d: setElements cannot be called after atoms have been created");j=e;for(t=0;t<j.length;t++)dt[t]=[],vt[t]=[],yt[t]=[],gt[t]=[];for(t=0;t<j.length;t++){i=j[t][E.EPSILON],o=j[t][E.SIGMA],j[t][E.RADIUS]=l.radius(o);for(r=t;r<j.length;r++)s=j[r][E.EPSILON],u=j[r][E.SIGMA],dt[t][r]=dt[r][t]=l.pairwiseEpsilon(i,s),vt[t][r]=vt[r][t]=l.pairwiseSigma(o,u),function(e,t){yt[e][t]=yt[t][e]=l.newLJCalculator({epsilon:dt[e][t],sigma:vt[e][t]},function(n){bt(e,t,n)})}(t,r)}},createAtoms:function(r){var i=h&&c?"Float32Array":"regular",o=h&&c?"Uint8Array":"regular",u,a;if(n)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");n=!0,t=!0;if(typeof r=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");a=r.num;if(typeof a=="undefined")throw new Error("md2d: createAtoms was called without the required 'num' option specifying the number of atoms to create.");if(a!==Math.floor(a))throw new Error("md2d: createAtoms was passed a non-integral 'num' option.");if(a<p)throw new Error("md2d: create Atoms was passed an 'num' option equal to: "+a+" which is less than the minimum allowable value: N_MIN = "+p+".");if(a>d)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+a+" which is greater than the minimum allowable value: N_MAX = "+d+".");u=function(){var e=0,t;for(t in w)w.hasOwnProperty(t)&&e++;return e}(),Q=e.atoms=s.create(u,null,"regular"),F=e.radius=Q[w.RADIUS]=s.create(a,0,i),I=e.px=Q[w.PX]=s.create(a,0,i),q=e.py=Q[w.PY]=s.create(a,0,i),R=e.x=Q[w.X]=s.create(a,0,i),U=e.y=Q[w.Y]=s.create(a,0,i),z=e.vx=Q[w.VX]=s.create(a,0,i),W=e.vy=Q[w.VY]=s.create(a,0,i),X=e.speed=Q[w.SPEED]=s.create(a,0,i),V=e.ax=Q[w.AX]=s.create(a,0,i),$=e.ay=Q[w.AY]=s.create(a,0,i),J=e.charge=Q[w.CHARGE]=s.create(a,0,i),K=e.element=Q[w.ELEMENT]=s.create(a,0,o),H=0,B=0},addAtom:function(e,t,n,r,i,s){var o,u;H+1>Q[0].length&&Et(H+1),o=j[e],u=o[E.MASS],K[H]=e,F[H]=j[e][E.RADIUS],R[H]=t,U[H]=n,z[H]=r,W[H]=i,I[H]=r*u,q[H]=i*u,V[H]=0,$[H]=0,X[H]=Math.sqrt(r*r+i*i),J[H]=s,B+=u,H++},addRadialBond:function(e,t,n,r){nt+1>G.length&&xt(H+1),G[nt]=e,Y[nt]=t,Z[nt]=n,et[nt]=r,nt++},initializeAtomsFromProperties:function(t){var n,r,i,s,o,u,a,f;if(!t.X||!t.Y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!t.VX||!t.VY)throw new Error("md2d: For now, velocities must be set when locations are set.");for(a=0,f=t.X.length;a<f;a++)u=t.ELEMENT?t.ELEMENT[a]:0,n=t.X[a],r=t.Y[a],i=t.VX[a],s=t.VY[a],o=t.CHARGE?t.CHARGE[a]:0,e.addAtom(u,n,r,i,s,o);ht=kt(),e.computeOutputState()},initializeAtomsRandomly:function(t){var n=t.temperature||100,r=t.num||Q[0].length,i=Math.floor(Math.sqrt(r)),s=Math.ceil(r/i),o,u,f,l,c,h,p,d,v,m,g,y,w;k(n),c=b[0]/(1+s),l=b[1]/(1+i),o=-1;for(u=1;u<=i;u++)for(f=1;f<=s;f++){o++;if(o===r)break;w=Math.floor(Math.random()*j.length),h=a.normal(1,.25),p=2*Math.random()*Math.PI,d=f*c,v=u*l,m=h*Math.cos(p),g=h*Math.sin(p),y=2*(o%2)-1,e.addAtom(w,d,v,m,g,y)}Ht(),Mt(),Rt(n,!0),ht=kt(),e.computeOutputState()},initializeRadialBonds:function(t){var n=t.atom1Index.length,r;St(t.atom1Index.length);for(r=0;r<n;r++)e.addRadialBond(t.atom1Index[r],t.atom2Index[r],t.bondLength[r],t.bondStrength[r])},relaxToTemperature:function(t){t!=null&&(g=t),k(g),Ct();while(m)e.integrate()},integrate:function(t,r){var i;if(!n)throw new Error("md2d: integrate called before atoms created.");t==null&&(t=100),D=r||1,P=D*D,i=j[K[0]][E.RADIUS],M=i,O=i,A=b[0]-i,C=b[1]-i;var s=_,o=Math.floor(t/D),u,a;for(u=1;u<=o;u++){_=s+u*D;for(a=0;a<H;a++)Bt(a),jt(a),Ft(a),V[a]=$[a]=0,It(a);qt();for(a=0;a<H;a++)Ft(a),X[a]=Math.sqrt(z[a]*z[a]+W[a]*W[a]);Rt()}e.computeOutputState()},getTotalMass:function(){return B},getRadiusOfElement:function(e){return j[e][E.RADIUS]},computeOutputState:function(){var e,t,n,s,a,l,c,h,p,d,v,m;m=0,v=0;for(e=0;e<H;e++){v+=.5*j[K[e]][0]*(z[e]*z[e]+W[e]*W[e]);for(t=e+1;t<H;t++)a=R[t]-R[e],l=U[t]-U[e],c=a*a+l*l,i&&(d=yt[K[e]][K[t]],m+=-d.potentialFromSquaredDistance(c,K[e],K[t])),r&&(m+=-f.potential(Math.sqrt(c),J[e],J[t]))}for(e=0;e<nt;e++)n=G[e],s=Y[e],a=R[s]-R[n],l=U[s]-U[n],c=a*a+l*l,h=et[e],p=Math.sqrt(c)-Z[e],m=.5*h*p*p;pt.time=_,pt.pressure=0,pt.PE=m,pt.KE=o.convert(v,{from:u.MW_ENERGY_UNIT,to:u.EV}),pt.T=ht,pt.pCM=[st,ot],pt.CM=[rt,it],pt.vCM=[ut,at],pt.omega_CM=ct},newPotentialCalculator:function(e,t,n){return function(s,a){var l=0,c=0,h=0,p,d,v=yt[e],m,g,y,b,w,E,S;for(m=0;m<H;m++)g=s-R[m],y=a-U[m],b=g*g+y*y,E=0,i&&(S=v[K[m]],l+=-S.potentialFromSquaredDistance(b,e,K[m]),n&&(E+=S.forceOverDistanceFromSquaredDistance(b))),r&&t&&(w=Math.sqrt(b),l+=-f.potential(w,t,J[m]),n&&(E+=f.forceOverDistanceFromSquaredDistance(b,t,J[m]))),E&&(c+=E*g,h+=E*y);return n?(p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),d=o.convert(h,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[l,[p,d]]):l}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=j[t][E.RADIUS],u=a.minimize(s,[n,r],{bounds:[[o,b[0]-o],[o,b[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=j[t][E.RADIUS],f=a.minimize(o,[n,r],{bounds:[[u,b[0]-u],[u,b[1]-u]],stopval:1e-4,precision:1e-6});return f.error?!1:f[1]},serialize:function(){var e={},t,n,r,i;for(r=0,i=S.length;r<i;r++)t=S[r],n=Q[w[t]],e[t]=n.slice?n.slice():L(n);return e}}}}),e("/md2d.js");var t=e("./md2d"),n;modeler={},modeler.VERSION="0.2.0",modeler.model=function(e){function A(e){$.unique(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function O(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],k[t]&&(r=r.concat(k[t]));k.all&&(r=r.concat(k.all)),A(r)}function M(){var e,t=0,i=r.get_num_atoms();e=-1;while(++e<i)t+=n.speed[e];return t/i}function _(e,t){var r;return n.integrate(),d=S.pressure,w=S.PE,E=S.KE,b=S.time,v.push(d),v.splice(0,v.length-16),P(),f||(r=Date.now(),m?(m=r-m,m&&g.push(m),m=r,g.splice(0,g.length-128)):m=r),t||s.tick(),f}function D(){return c===0}function P(){var e,t=[],n=C.length;e=-1;while(++e<n)t[e]=arrays.clone(C[e]);l.length=c,c++,h++,p=!0,l.push({nodes:t,pressure:S.pressure,pe:S.PE,ke:S.KE,time:S.time}),c>1e3&&(l.splice(0,1),c=1e3)}function H(){l=[],c=0,h=0}function B(){l.length=c+1}function j(e){var t,r=C.length;if(e<0)throw new Error("modeler: request for tick_history_list["+e+"]");if(e>=l.length)throw new Error("modeler: request for tick_history_list["+e+"], tick_history_list.length="+l.length);t=-1;while(++t<r)arrays.copy(l[e].nodes[t],C[t]);E=l[e].ke,b=l[e].time,n.setTime(b)}function F(){return v.reduce(function(e,t){return e+t})/v.length}function I(){var e,t,n=0,r=g.length;e=-1;while(++e<r)n+=g[e];return t=n/r,t?1/t*1e3:0}function q(e){y=e,n.setTargetTemperature(e)}function R(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null&&(L["set_"+t]?L["set_"+t](e[t]):L[t]&&(L[t]=e[t]),n.push(t));O(n)}function U(){n.computeOutputState(),d=S.pressure,w=S.PE,E=S.KE,b=S.time}var r={},i=e.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],s=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek"),o,u,a,f=!0,l=[],c=0,h=0,p=!1,d,v=[0],m,g=[],y,b,w,E,S,x,T=e.width,N=e.height,C,k={},L={temperature:300,coulomb_forces:!1,lennard_jones_forces:!0,temperature_control:!0,set_temperature:function(e){this.temperature=e,n&&n.setTargetTemperature(e)},set_temperature_control:function(e){this.temperature_control=e,n&&n.useThermostat(e)},set_coulomb_forces:function(e){this.coulomb_forces=e,n&&n.useCoulombInteraction(e)},set_epsilon:function(e){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(e){console.log("set_sigma: This method is temporarily deprecated")}};return r.INDICES={RADIUS:t.INDICES.RADIUS,PX:t.INDICES.PX,PY:t.INDICES.PY,X:t.INDICES.X,Y:t.INDICES.Y,VX:t.INDICES.VX,VY:t.INDICES.VY,SPEED:t.INDICES.SPEED,AX:t.INDICES.AX,AY:t.INDICES.AY,CHARGE:t.INDICES.CHARGE,ELEMENT:t.INDICES.ELEMENT},x=e.model_listener,R(e),r.getStats=function(){return{speed:M(),ke:E,temperature:y,pressure:F(),current_step:h,steps:l.length-1}},r.getStatsHistory=function(){var e,t,n,r=[];r.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(e=0,t=l.length;e<t;e++)n=l[e],r.push(n.time+"	"+n.pe+"	"+n.ke+"	"+(n.pe+n.ke));return r.join("\n")},r.stepCounter=function(){return h},r.steps=function(){return l.length-1},r.isNewStep=function(){return p},r.seek=function(e){return arguments.length||(e=0),f=!0,p=!1,c=e,h=e,j(c),s.seek(),O("seek"),x&&x(),h},r.stepBack=function(e){arguments.length||(e=1);var t=-1;f=!0,p=!1;while(++t<e)c>1&&(c--,h--,j(c-1),x&&x());return h},r.stepForward=function(e){arguments.length||(e=1);var t=-1;f=!0;while(++t<e)c<l.length?(j(c),c++,h++,x&&x()):_();return h},r.createNewAtoms=function(e){var s,u,a,f,l;typeof e=="number"?l=e:e.num!=null?l=e.num:e.X&&(l=e.X.length),s=[];for(a=0,f=i.length;a<f;a++)u=i[a],s[u.id]=[u.mass,u.epsilon,u.sigma];return n=t.makeModel(),n.setSize([T,N]),n.setElements(s),n.createAtoms({num:l}),C=n.atoms,S=n.outputState,o=L.temperature_control,y=L.temperature,n.useLennardJonesInteraction(L.lennard_jones_forces),n.useCoulombInteraction(L.coulomb_forces),n.useThermostat(o),n.setTargetTemperature(y),e.X&&e.Y?n.initializeAtomsFromProperties(e):(n.initializeAtomsRandomly({temperature:y}),e.relax&&n.relaxToTemperature()),U(),H(),P(),h=0,p=!0,r},r.createRadialBonds=function(e){return n.initializeRadialBonds(e),U(),r},r.setEpsilon=function(e){n.setLJEpsilon(e)},r.setSigma=function(e){n.setLJSigma(e)},r.getEpsilon=function(){return n.getLJEpsilon()},r.getSigma=function(){return n.getLJSigma()},r.getLJCalculator=function(){return n.getLJCalculator()},r.getPotentialFunction=function(e,t,r){return t==null&&(t=0),r=!!r,n.newPotentialCalculator(e,t,r)},r.resetTime=function(){n.setTime(0)},r.getTime=function(){return S?S.time:undefined},r.getTotalMass=function(){return n.getTotalMass()},r.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*i.length)),t==null&&(t=0);var s=r.size(),o=n.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=Math.random()*s[0]-2*o,a=Math.random()*s[1]-2*o,f=n.findMinimumPELocation(e,u,a,0,0,t);if(f&&r.addAtom(e,f[0],f[1],0,0,t))return!0}while(++l<c);return!1},r.addAtom=function(e,t,i,s,o,u){var a=r.size(),f=n.getRadiusOfElement(e);return t<f&&(t=f),t>a[0]-f&&(t=a[0]-f),i<f&&(i=f),i>a[1]-f&&(i=a[1]-f),r.getPotentialFunction(e,0,!1)(t,i)<=0?(n.addAtom(e,t,i,s,o,u),C=n.atoms,n.computeOutputState(),x&&x(),!0):!1},r.get_speed=function(){return arrays.copy(n.speed,[])},r.get_rate=function(){return I()},r.is_stopped=function(){return f},r.set_lennard_jones_forces=function(e){u=e,n.useLennardJonesInteraction(e)},r.set_coulomb_forces=function(e){a=e,n.useCoulombInteraction(e)},r.get_nodes=function(){return C},r.get_num_atoms=function(){return C[0].length},r.on=function(e,t){return s.on(e,t),r},r.tickInPlace=function(){return s.tick(),r},r.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,i=-1;while(++i<e)_(null,n);return r},r.relax=function(){return n.relaxToTemperature(),r},r.start=function(){return r.resume()},r.resume=function(){return f=!1,d3.timer(_),s.play(),O("play"),r},r.stop=function(){return f=!0,s.stop(),r},r.ke=function(){return S?S.KE:undefined},r.ave_ke=function(){return S?S.KE/r.get_num_atoms():undefined},r.pe=function(){return S?S.PE:undefined},r.ave_pe=function(){return S?S.PE/r.get_num_atoms():undefined},r.speed=function(){return M()},r.pressure=function(){return F()},r.temperature=function(e){return arguments.length?(q(e),r):y},r.size=function(e){return arguments.length?(n.setSize(e),r):n.getSize()},r.set=function(e){R(e)},r.get=function(e){return L[e]},r.addPropertiesListener=function(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],k[i]||(k[i]=[]),k[i].push(t)},r.serialize=function(e){var t=$.extend({},L);return e&&(t.atoms=n.serialize()),i&&(t.elements=i),t.width=T,t.height=N,t},r}}(),function(){function e(){var e=/ (Chrome)\/(.*?) /,n=/ (Firefox)\/([0123456789ab.]+)/,r=/ Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,s=/^(Opera)\/.+? Version\/([0123456789.]+)$/,o=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,u=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,f=/.+?(Android) ([0123456789.]+).+?; (.+?)\).+? CrMo\/([0123456789.]+)/,l=/.+?(Android) ([0123456789ab.]+).+?; (.+?)\)/,c;c=navigator.userAgent.match(e);if(c&&c[1])return{browser:c[1],version:c[2],oscpu:t()};c=navigator.userAgent.match(n);if(c&&c[1])return{browser:c[1],version:c[2],oscpu:t()};c=navigator.userAgent.match(f);if(c&&c[1])return{browser:"Chrome",version:c[4],oscpu:c[1]+"/"+c[2]+"/"+c[3]};c=navigator.userAgent.match(l);if(c&&c[1])return{browser:"Android",version:c[2],oscpu:c[1]+"/"+c[2]+"/"+c[3]};c=navigator.userAgent.match(r);if(c&&c[2])return{browser:c[2],version:c[1],oscpu:t()};c=navigator.userAgent.match(i);if(c&&c[1]){var h=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:c[1],version:c[2],oscpu:windows_platform_token[h[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return c=navigator.userAgent.match(s),c&&c[1]?{browser:c[1],version:c[2],oscpu:t()}:(c=navigator.userAgent.match(o),c&&c[1]?{browser:"Mobile Safari",version:c[2],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:(c=navigator.userAgent.match(u),c&&c[1]?{browser:"Mobile Safari",version:c[2],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:(c=navigator.userAgent.match(a),c&&c[1]?{browser:"Mobile Safari",version:c[3],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function t(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var t=windows_feature_token[e[2]]||"32",n=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return windows_platform_token[n[1]]+"/"+t}}function n(t,n){function a(){return t.appendChild(document.createElement("tr"))}function c(e,t,n){n=n||"td",e.appendChild(document.createElement(n)).textContent=t}function h(e,t){u&&c(f,e,"th"),c(l,t)}var r=0,i,s,o=[];t.style.display="";var u=t.getElementsByTagName("tr").length===0,f=a(),l=a();s=e(),h("browser",s.browser),h("version",s.version),h("cpu/os",s.oscpu);var p=d3.time.format("%Y-%m-%d %H:%M");h("date",p(new Date));for(r=0;r<n.length;r++)i=n[r],h(i.name,i.run())}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),benchmark={},benchmark={version:"0.0.1"},benchmark.what_browser=function(){return e()},benchmark.run=function(e,t){n(e,t)},windows_platform_token={"Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},windows_feature_token={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"}}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),function(){arrays={},arrays={version:"0.0.1"},arrays.webgl=!!window.WebGLRenderingContext,arrays.typed=!1;try{var e=new Float64Array(0);arrays.typed=!0}catch(t){}arrays.create=function(e,t,n){n||(arrays.webgl||arrays.typed?n="Float32Array":n="regular"),t=t||0;var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},arrays.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+(e.buffer?e.buffer.slice:"")+", source.buffer.__proto__: "+(e.buffer?e.buffer.__proto__:"")+", source.buffer.__proto__.constructor: "+(e.buffer?e.buffer.__proto__.constructor:""))},arrays.copy=function(e,t){var n=e.length;i=-1;while(++i<n)t[i]=e[i];return t.length=n,t},arrays.clone=function(e){var t,n=e.length,r,i;i=arrays.constructor_function(e);if(i==Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},arrays.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},arrays.max=function(e){return Math.max.apply(Math,e)},arrays.min=function(e){return Math.min.apply(Math,e)},arrays.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},arrays.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},arrays.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},arrays.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},arrays.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r}}()}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),layout={version:"0.0.1"},layout.selection="",layout.display={},layout.canonical={width:1280,height:800},layout.regular_display=!1,layout.not_rendered=!0,layout.fontsize=!1,layout.cancelFullScreen=!1,layout.screen_factor=1,layout.checkbox_factor=1.1,layout.checkbox_scale=1.1,layout.fullScreenRender=!1,layout.canonical.width=1280,layout.canonical.height=800,layout.getDisplayProperties=function(e){if(!arguments.length)var e={};return e.screen={width:screen.width,height:screen.height},e.client={width:document.body.clientWidth,height:document.body.clientHeight},e.window={width:document.width,height:document.height},e.page={width:layout.getPageWidth(),height:layout.getPageHeight()},e.screen_factor_width=e.page.width/layout.canonical.width,e.screen_factor_height=e.page.height/layout.canonical.height,e.emsize=Math.min(e.screen_factor_width*1.1,e.screen_factor_height),e},layout.screenEqualsPage=function(){return layout.display.screen.width===layout.display.page.width||layout.display.screen.height===layout.display.page.height},layout.checkForResize=function(){(layout.display.screen.width!=screen.width||layout.display.screen.height!=screen.height||layout.display.window.width!=document.width||layout.display.window.height!=document.height)&&layout.setupScreen()},layout.views={},layout.addView=function(e,t){layout.views[e]||(layout.views[e]=[]),layout.views[e].push(t)},layout.setView=function(e,t){layout.views[e]=t},layout.setupScreen=function(e){function s(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.46,r=n*1/f,r>c*.7&&(r=c*.7,n*r*f),e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);u=(l-n)*.415,s=r*.42,e=-1;while(++e<t.potentialCharts.length)t.potentialCharts[e].resize(u,s);e=-1;while(++e<t.speedDistributionCharts.length)t.speedDistributionCharts[e].resize(u,s);o=(l-n)*.86,s=r*.57,e=-1;while(++e<t.energyCharts.length)t.energyCharts[e].resize(o,s)}function o(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.46,r=n*1/f,r>c*.7&&(r=c*.7,n*r*f);for(viewType in t)if(t.hasOwnProperty(viewType)&&t[viewType].length){e=-1;while(++e<t[viewType].length)t[viewType][e].resize(n,r)}}function u(){var e,n,r,i,s,o=layout.display.page.width,u=layout.display.page.height;i=t.moleculeContainers[0].scale(),s=i[0]/i[1],n=o*.44,r=n*1/s,e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);if(t.appletContainers){e=-1;while(++e<t.appletContainers.length)t.appletContainers[e].resize(n,r)}}function a(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.46,r=n*1/f,r>c*.7&&(r=c*.7,n*r*f),e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);u=(l-n)*.41,s=r*.42,e=-1;while(++e<t.potentialCharts.length)t.potentialCharts[e].resize(u,s);e=-1;while(++e<t.speedDistributionCharts.length)t.speedDistributionCharts[e].resize(u,s);o=(l-n)*.86,s=r*.57,e=-1;while(++e<t.energyCharts.length)t.energyCharts[e].resize(o,s)}function f(){var e,n,r,i,s;r=Math.min(layout.display.page.height*.5,layout.display.page.width*.53),t.moleculeContainers[0].resize(r,r),i=t.moleculeContainers[0].scale(),s=i[0]/layout.display.page.width,s>.53&&(r*=.53/s,t.moleculeContainers[0].resize(r,r)),t.thermometers[0].resize()}function l(){var e,n,r,i,s,o=document.getElementById("description-right");r=Math.min(layout.display.page.height*.7,layout.display.page.width*.53),t.moleculeContainers[0].resize(r,r),i=t.moleculeContainers[0].scale(),s=i[0]/layout.display.page.width,s>.53&&(r*=.53/s,t.moleculeContainers[0].resize(r,r)),t.thermometers[0].resize()}function c(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.8,r=n*1/f,r>c*.8&&(r=c*.8,n*r*f),t.moleculeContainers[0].resize(n,r),i=t.moleculeContainers[0].scale(),t.thermometers[0].resize()}function h(){var e=layout.display.page.height*.7;t.moleculeContainers[0].resize(e,e)}function p(){var e=document.getElementById("description-right");e===null}var t=layout.views,n=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;e&&(layout.not_rendered=!0),layout.display=layout.getDisplayProperties(),layout.regular_display||(layout.regular_display=layout.getDisplayProperties());if(n||layout.fullScreenRender||layout.screenEqualsPage()){layout.fullScreenRender=!0,layout.screen_factor_width=layout.display.page.width/layout.canonical.width,layout.screen_factor_height=layout.display.page.height/layout.canonical.height,layout.screen_factor=layout.screen_factor_height,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor),layout.bodycss.style.fontSize=layout.screen_factor+"em",layout.not_rendered=!0;switch(layout.selection){case"simple-screen":layout.not_rendered&&h();break;case"simple-static-screen":layout.not_rendered&&h();break;case"simple-iframe":h(),p();break;case"compare-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",u(),layout.not_rendered=!1;break;default:layout.not_rendered&&a()}}else{layout.cancelFullScreen||layout.fullScreenRender?(layout.cancelFullScreen=!1,layout.fullScreenRender=!1,layout.not_rendered=!0,layout.regular_display=layout.previous_display):layout.regular_display=layout.getDisplayProperties(),layout.screen_factor_width=layout.display.page.width/layout.canonical.width,layout.screen_factor_height=layout.display.page.height/layout.canonical.height,layout.screen_factor=layout.screen_factor_height,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor);switch(layout.selection){case"simple-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",f();break;case"simple-static-screen":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",l(),layout.not_rendered=!1}break;case"simple-iframe":var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",c();break;case"full-static-screen":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",s(),layout.not_rendered=!1}break;case"compare-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",u();break;case"interactive":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",o(),layout.not_rendered=!1}break;default:layout.bodycss.style.fontSize=layout.screen_factor+"em",setupRegularScreen()}layout.regular_display=layout.getDisplayProperties()}layout.transform&&$("input[type=checkbox]").css(layout.transform,"scale("+layout.checkbox_factor+","+layout.checkbox_factor+")"),layout.setupTemperature(model),layout.temperature_control_checkbox&&(model.addPropertiesListener(["temperature_control"],layout.temperatureControlUpdate),layout.temperatureControlUpdate());var i=document.getElementById("benchmarks-table");i&&(i.style.display="none"
)},layout.getStyleForSelector=function(e){var t,n=document.styleSheets;for(var r=0;r<n.length;r++)if(n[r])try{t=n[r].rules||n[r].cssRules;if(t)for(var i=0;i<t.length;i++)if(t[i].selectorText==e)return t[i]}catch(s){}return!1},layout.getPageHeight=function(){var e;return self.innerHeight?e=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=layout.display.window.height),e},layout.getPageWidth=function(){var e;return self.innerWidth?e=self.innerWidth:document.documentElement&&document.documentElement.clientWidth?e=document.documentElement.clientWidth:document.body&&(e=window.width),e},layout.getTransformProperty=function(e){var t=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],n;if(e)while(n=t.shift())if(typeof e.style[n]!="undefined")return n;return!1};var e=document.getElementById("description-right");e!==null&&(layout.fontsize=parseInt(layout.getStyleForSelector("#description-right").style.fontSize)),layout.bodycss=layout.getStyleForSelector("body"),layout.transform=layout.getTransformProperty(document.body);if(document.querySelectorAll){var t=document.querySelector("#fullscreen");t&&(t.style.cursor="pointer",t.addEventListener("click",function(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen,n=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen,r=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;t?n?(layout.cancelFullScreen=!0,r.call(document)):(layout.cancelFullScreen=!1,t.call(e)):alert("You'll need to use a newer browser to use the\nfull-screen API.\n\nChrome v15 (beta)\nhttp://www.google.com/landing/chrome/beta/\n\nChrome v17 Canary:\nhttp://tools.google.com/dlpage/chromesxs\n\nSafari v5.1.1:\n\nFireFox v9 Aurora:\nhttps://www.mozilla.org/en-US/firefox/channel/\n\nFireFox v10 Nightly\nhttp://nightly.mozilla.org/\nOpen 'about:config' and set: full-screen-api-enabled")},!1))}}(),function(){function u(){var e=+s.value;s.type==="range"&&(o.innerText=d3.format("4.1f")(e)+" K"),model.set({temperature:e})}function a(){layout.lennard_jones_forces_checkbox.checked?model.set_lennard_jones_forces(!0):model.set_lennard_jones_forces(!1)}function f(){layout.coulomb_forces_checkbox.checked?model.set({coulomb_forces:!0}):model.set({coulomb_forces:!1})}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),views={version:"0.0.1"},layout.appletContainer=function(e,t){function x(e,t){return arguments.length?(s=t,i=e):(s=n.property("clientHeight"),i=n.property("clientWidth")),o&&(a=+o.runMwScript("mw2d:1:get %width"),f=+o.runMwScript("mw2d:1:get %height"),l=a/f,s=i*1/l*1.25),r.style.width=i+"px",r.style.height=s+"px",p=layout.screen_factor,layout.screen_factor_width&&layout.screen_factor_height&&(p=Math.min(layout.screen_factor_width,layout.screen_factor_height)),p=i/600,d={top:5,right:5,bottom:5,left:5},h=s-d.top-d.bottom,c=i-d.left-d.right,v={width:c,height:h},[i,s]}function T(){function e(){var e,n,r;r=['<applet id="'+t.appletID+'", codebase="'+t.codebase+'", code="'+t.code+'"','     width="'+t.width+'" height="'+t.height+'" MAYSCRIPT="true"','     archive="'+t.archive+'">','     MAYSCRIPT="true">'];for(e=0;e<t.params.length;e++)n=t.params[e],r.push('  <param name="'+n[0]+'" value="'+n[1]+'"/>');return r.push('  <param name="MAYSCRIPT" value="true"/>'),r.push("  Your browser is completely ignoring the applet tag!"),r.push("</applet>"),r.join("\n")}o===undefined?(u=e(),r.innerHTML=u,o=document.getElementById(t.appletID)):(o.style.width=v.width,o.style.height=v.height,o.width=v.width,o.height=v.height),T.node=r,T.scale=x,T.applet=o}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E={appletID:"mw-applet",codebase:"/jnlp",code:"org.concord.modeler.MwApplet",width:"100%",height:"100%",archive:"org/concord/modeler/mw.jar",align:"left",hspace:"5",vspace:"5",params:[["script","page:0:import /imports/legacy-mw-content/potential-tests/two-atoms-two-elements/two-atoms-two-elements.cml"]]};if(t)for(var S in E)t[S]===undefined&&(t[S]=E[S]);else t=E;return x(i,s),T.resize=function(e,t){T.scale(e,t)},r&&T(),T},layout.moleculeContainer=function(e,t){function et(e,f){var l=model.size(),c=l[0]/l[1];arguments.length?(s=f,r.style.height=s+"px",i=s*c):(s=n.property("clientHeight"),i=s*c),r.style.width=i+"px",a=layout.screen_factor,d={top:t.title?40*layout.screen_factor:20,right:25,bottom:10,left:t.ylabel?60*layout.screen_factor:25};if(t.xlabel||t.model_time_label)d.bottom+=35*a;if(t.playback_controller||t.play_only_controller)d.bottom+=40*a;return u=s-d.top-d.bottom,o=i-d.left-d.right,v={width:o,height:u},I=r.offsetLeft+d.left,q=r.offsetTop+d.top,t.playback_controller&&(L=d.left+(v.width-230*a)/2),t.play_only_controller&&(L=d.left+(v.width-140*a)/2),A=s-42*a,m=v.width,g=v.height,E=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,m]),S=E.copy(),x=Math.NaN,T=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,g]).nice(),N=T.copy(),C=Math.NaN,k=null,[i,s]}function tt(){return M+O(model.getTime()/1e3)+_}function nt(e){return Q[model.INDICES.ELEMENT][e]}function rt(e){return Q[model.INDICES.X][e]}function it(e){return Q[model.INDICES.Y][e]}function st(e){return Q[model.INDICES.RADIUS][e]}function ot(e){return Q[model.INDICES.SPEED][e]}function ut(e){return Q[model.INDICES.VX][e]}function at(e){return Q[model.INDICES.VY][e]}function ft(e){return Q[model.INDICES.AX][e]}function lt(e){return Q[model.INDICES.AY][e]}function ct(e){return Q[model.INDICES.CHARGE][e]}function ht(){function e(){d3.event&&d3.event.transform&&isNaN(x)&&isNaN(C)&&d3.event.transform(E,T);var e=E.tickFormat(10),n=T.tickFormat(10);if(t.xunits){var r=l.selectAll("g.x").data(E.ticks(10),String).attr("transform",y);r.select("text").text(e);var i=r.enter().insert("svg:g","a").attr("class","x").attr("transform",y);t.grid_lines&&i.append("svg:line").attr("stroke",w).attr("y1",0).attr("y2",v.height),i.append("svg:text").attr("y",v.height).attr("dy","1em").attr("text-anchor","middle").text(e),r.exit().remove()}if(t.xunits){var s=l.selectAll("g.y").data(T.ticks(10),String).attr("transform",b);s.select("text").text(n);var o=s.enter().insert("svg:g","a").attr("class","y").attr("transform",b).attr("background-fill","#FFEEB6");t.grid_lines&&o.append("svg:line").attr("stroke",w).attr("x1",0).attr("x2",v.width),o.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(n),t.model_time_label&&p.text(tt()),s.exit().remove()}}function o(){D=l.append("svg").attr("class","container").attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),u("neg-grad","#ffefff","#fdadad","#e95e5e",D),u("pos-grad","#dfffff","#9abeff","#767fbf",D),u("green-grad","#dfffef","#75a643","#2a7216",D),u("purple-grad","#EED3F0","#D941E0","#84198A",D),u("aqua-grad","#DCF5F4","#41E0D8","#12827C",D),u("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",D),j=["green-grad","purple-grad","aqua-grad","orange-grad"]}function u(e,t,n,r,i){gradient=i.append("defs").append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),gradient.append("stop").attr("stop-color",t).attr("offset","0%"),gradient.append("stop").attr("stop-color",n).attr("offset","40%"),gradient.append("stop").attr("stop-color",r).attr("offset","80%"),gradient.append("stop").attr("stop-color",n).attr("offset","100%")}function m(){l.selectAll("circle").data(J).attr("r",function(e,t){return E(st(t))})}function g(e){e.enter().append("circle").attr("r",function(e,t){return E(st(t))}).attr("cx",function(e,t){return E(rt(t))}).attr("cy",function(e,t){return T(it(t))}).style("cursor","crosshair").style("fill",function(e,t){return model.get("coulomb_forces")?E(ct(t))>0?"url('#pos-grad')":"url('#neg-grad')":(element=nt(t)%4,grad=j[element],"url('#"+grad+"')")}).on("mousedown",O).on("mouseout",P)}function S(){G=t.get_nodes,Q=G(),K=t.get_num_atoms,(J=[]).length=K();if(typeof J=="undefined"||!J)return;var e=model.getLJCalculator()[0][0].coefficients();D.selectAll("circle").remove(),D.selectAll("g").remove(),R=D.selectAll("circle").data(J),g(R);var n=E(e.rmin*.5*1.5);model.get("mol_number")>100&&(n*=.9),U=D.selectAll("g.label").data(J),z=U.enter().append("g").attr("class","label").attr("transform",function(e,t){return"translate("+E(rt(t))+","+T(it(t))+")"}),t.atom_mubers?z.append("text").attr("class","index").attr("font-size",n).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(e){return e.index}):z.append("text").attr("class","index").attr("font-size",n).attr("style","font-weight: bold; opacity: .7").attr("x","-0.31em").attr("y","0.31em").text(function(e,t){if(model.get("coulomb_forces"))return E(ct(t))>0?"+":"–";return})}function N(){r.focus()}function k(e){}function O(e,t){r.focus(),F?(V.style("opacity",1e-6),V.style("display","none"),F=!1):(d3.event.shiftKey?F=t:F=!1,M(t))}function M(e){V.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.5)").style("left",E(Q[model.INDICES.X][e])+I+16+"px").style("top",T(Q[model.INDICES.Y][e])+q-30+"px").transition().duration(250),$.text(tt()+"\n"+"speed: "+d3.format("+6.3e")(ot(e))+"\n"+"vx:    "+d3.format("+6.3e")(ut(e))+"\n"+"vy:    "+d3.format("+6.3e")(at(e))+"\n"+"ax:    "+d3.format("+6.3e")(ft(e))+"\n"+"ay:    "+d3.format("+6.3e")(lt(e))+"\n")}function _(e){}function P(){typeof F!="number"&&V.style("opacity",1e-6)}function H(){(J=[]).length=K(),Q=G(),t.model_time_label&&p.text(tt()),U=n.selectAll("g.label").data(J),U.attr("transform",function(e,t){return"translate("+E(rt(t))+","+T(it(t))+")"}),R=D.selectAll("circle").data(J),g(R),R.attr("cx",function(e,t){return E(Q[model.INDICES.X][t])}).attr("cy",function(e,t){return T(Q[model.INDICES.Y][t])}).attr("r",function(e,t){return E(Q[model.INDICES.RADIUS][t])}),typeof F=="number"&&M(F)}function B(e){e=e?e:window.event?event:null;if(e)switch(e.keyCode){case 32:model.is_stopped()?h.action("play"):h.action("stop"),e.preventDefault();break;case 13:h.action("play"),e.preventDefault()}}function W(){r.onkeydown=B}et(),l===undefined?(f=d3.select(r).append("svg").attr("width",i).attr("height",s),l=f.append("g").attr("transform","translate("+d.left+","+d.top+")"),c=l.append("rect").attr("class","plot").attr("width",v.width).attr("height",v.height).style("fill","#EEEEEE"),t.title&&l.append("text").attr("class","title").text(t.title).attr("x",v.width/2).attr("dy","-1em").style("text-anchor","middle"),t.xlabel&&l.append("text").attr("class","xlabel").text(t.xlabel).attr("x",v.width/2).attr("y",v.height).attr("dy","2.4em").style("text-anchor","middle"),t.ylabel&&l.append("g").append("text").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+v.height/2+") rotate(-90)"),t.model_time_label&&(p=l.append("text").attr("class","model_time_label").text(tt()).attr("x",v.width-100).attr("y",v.height).attr("dy","2.4em").style("text-anchor","start")),t.playback_controller&&(h=new PlaybackComponentSVG(f,model_player,L,A,a)),t.play_only_controller&&(h=new PlayOnlyComponentSVG(f,model_player,L,A,a)),V=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),$=V.append("pre"),d3.select(r).attr("tabindex",0).on("mousedown",N),W(),e(),o()):(d3.select(r).select("svg").attr("width",i).attr("height",s),l.select("svg").attr("width",i).attr("height",s),l.select("rect.plot").attr("width",v.width).attr("height",v.height).style("fill","#EEEEEE"),l.select("svg.container").attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),t.title&&l.select("text.title").attr("x",v.width/2).attr("dy","-1em"),t.xlabel&&l.select("text.xlabel").attr("x",v.width/2).attr("y",v.height),t.ylabel&&l.select("text.ylabel").attr("transform","translate(-40 "+v.height/2+") rotate(-90)"),t.model_time_label&&p.text(tt()).attr("x",v.width-100).attr("y",v.height),l.selectAll("g.x").remove(),l.selectAll("g.y").remove(),R&&(m(),R.attr("cx",function(e,t){return E(rt(t))}).attr("cy",function(e,t){return T(it(t))}).attr("r",function(e,t){return E(st(t))}),U.attr("transform",function(e,t){return"translate("+E(rt(t))+","+T(it(t))+")"})),(t.playback_controller||t.play_only_controller)&&h.position(L,A,a),e()),ht.node=r,ht.updateMoleculeRadius=m,ht.setup_particles=S,ht.update_molecule_positions=H,ht.scale=et,ht.playback_component=h}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=d3.format("5.2f"),M="time: ",_=" (ps)",D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y={title:!1,xlabel:!1,ylabel:!1,playback_controller:!1,play_only_controller:!0,model_time_label:!1,grid_lines:!1,xunits:!1,yunits:!1,atom_mubers:!1,xmin:0,xmax:10,ymin:0,ymax:10};if(t)for(var Z in Y)t[Z]===undefined&&(t[Z]=Y[Z]);else t=Y;return G=t.get_nodes,Q=G(),K=t.get_num_atoms,(J=[]).length=K(),et(i,s),y=function(e,t){return"translate("+E(e)+",0)"},b=function(e,t){return"translate(0,"+T(e)+")"},w=function(e,t){return e?"#ccc":"#666"},ht.resize=function(e,t){ht.scale(e,t),ht(),ht.setup_particles()},r&&ht(),ht},layout.potentialChart=function(e,t,n){function A(){var e,n,r,i,s,o;T=t.getLJCalculator()[0][0],N.coefficients=T.coefficients(),e=N.coefficients.sigma,n=N.coefficients.epsilon,r=N.coefficients.rmin,N.xmax=e*3,N.xmin=Math.floor(e/2),N.ymax=.4,N.ymin=Math.ceil(n*1)-1,N.variables[0].x=r,N.variables[0].y=n,N.variables[1].x=e,N.variables[1].y=0,C.length=0;for(s=e*.5;s<N.xmax*3;s+=.001)i=-T.potential(s,0,0),Math.abs(i)<100&&C.push([s,i])}function O(e,t){s=e,o=t,i.style.width=s+"px",i.style.height=o+"px",u={top:n.title?40:20,right:35,bottom:n.xlabel?56:30,left:n.ylabel?60:25},width=s-u.left-u.right,height=o-u.top-u.bottom,a={width:width,height:height},f=a.width,l=a.height,d=d3.scale.linear().domain([N.xmin,N.xmax]).range([0,f]),m=d3.scale.linear().domain([N.ymax,N.ymin]).range([0,l]),v=Math.NaN,g=Math.NaN,b=null}function M(){function e(){d3.event&&d3.event.transform&&isNaN(v)&&isNaN(g)&&d3.event.transform(x,y);var t=d.tickFormat(5),n=m.tickFormat(5),r=E.selectAll("g.x").data(d.ticks(5),String).attr("transform",c);r.select("text").text(t);var i=r.enter().insert("g","a").attr("class","x").attr("transform",c);i.append("line").attr("stroke",p).attr("y1",0).attr("y2",a.height),i.append("text").attr("y",a.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(t).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(E[0][0]);v=d.invert(t[0])}),r.exit().remove();var s=E.selectAll("g.y").data(m.ticks(10),String).attr("transform",h);s.select("text").text(n);var o=s.enter().insert("g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");o.append("line").attr("stroke",p).attr("x1",0).attr("x2",a.width),o.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(n).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(E[0][0]);g=m.invert(t[1])}),s.exit().remove(),S.call(d3.behavior.zoom().x(d).y(m).scaleExtent([1,8]).on("zoom",e)),f()}function f(){var e=E.selectAll("circle").data(N.variables,function(e){return e}),t=E.select("path").attr("d",line(C)),n=d.domain()[1]-d.domain()[0];e.enter().append("circle").attr("class",function(e){return e===w?"selected":null}).attr("cx",function(e){return d(e.x)}).attr("cy",function(e){return m(e.y)}).style("cursor",function(e){return e.cursorStyle}).attr("r",8).on("mousedown",function(e){e.coefficient=="epsilon"?e.x=N.coefficients.rmin:e.y=0,coefficient_selected=w=e,f()}),e.attr("class",function(e){return e===coefficient_selected?"selected":null}).attr("cx",function(e){return d(e.x)}).attr("cy",function(e){return m(e.y)}),e.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function l(){r.style("cursor","move")}function b(){var r=d3.svg.mouse(E[0][0]),s,o,u,l=d3.event.changedTouches;if(w){i.onselectstart=function(){return!1};var c=d3.svg.mouse(E.node()),h,p;w.coefficient=="epsilon"?(h=N.coefficients.rmin,p=m.invert(Math.max(0,Math.min(a.height,c[1]))),p>n.epsilon_max&&(p=n.epsilon_max),p<n.epsilon_min&&(p=n.epsilon_min),t.set({epsilon:p})):(p=0,h=d.invert(Math.max(0,Math.min(a.width,c[0]))),h<n.sigma_min&&(h=n.sigma_min),h>n.sigma_max&&(h=n.sigma_max),t.set({sigma:h})),w.x=h,w.y=p,f()}isNaN(v)||(d3.select("body").style("cursor","ew-resize"),d.domain(grapher.axis.axisProcessDrag(v,d.invert(r[0]),d.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(d3.select("body").style("cursor","ns-resize"),m.domain(grapher.axis.axisProcessDrag(g,m.invert(r[1]),m.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation())}function T(){isNaN(v)||(i.onselectstart=function(){return!0},e(),v=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(e(),g=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),w=null}O(s,o),E===undefined?(E=d3.select(i).append("svg").attr("width",s).attr("height",o).append("svg:g").attr("transform","translate("+u.left+","+u.top+")"),S=E.append("rect").attr("class","plot").attr("width",a.width).attr("height",a.height).style("fill","#EEEEEE").attr("pointer-events","all"),S.call(d3.behavior.zoom().x(d).y(m).scaleExtent([1,8]).on("zoom",e)),E.append("svg").attr("class","linebox").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height).append("path").attr("class","line").attr("d",line(C)),n.title&&E.append("text").attr("class","title").text(n.title).attr("x",a.width/2).attr("dy","-1em").style("text-anchor","middle"),n.xlabel&&E.append("text").attr("class","xlabel").text(n.xlabel).attr("x",a.width/2).attr("y",a.height).attr("dy","2.4em").style("text-anchor","middle"),n.ylabel&&E.append("g").append("text").attr("class","ylabel").text(n.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+a.height/2+") rotate(-90)"),E.on("mousemove",b).on("mouseup",T),e()):(d3.select(i).select("svg").attr("width",s).attr("height",o),E.select("svg").attr("width",s).attr("height",o),E.select("rect.plot").attr("width",a.width).attr("height",a.height).style("fill","#EEEEEE"),E.select("svg.container").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height),E.select("svg.linebox").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height),n.title&&E.select("text.title").attr("x",a.width/2).attr("dy","-1em"),n.xlabel&&E.select("text.xlabel").attr("x",a.width/2).attr("y",a.height),n.ylabel&&E.select("text.ylabel").attr("transform","translate(-40 "+a.height/2+") rotate(-90)"),E.selectAll("g.x").remove(),E.selectAll("g.y").remove(),d3.select(this).on("mousemove.drag",b).on("touchmove.drag",b).on("mouseup.drag",T).on("touchend.drag",T),e()),r.on("mousemove",function(t){document.onselectstart=function(){return!0};var n=d3.svg.mouse(E[0][0]);isNaN(v)||(d.domain(grapher.axis.axisProcessDrag(v,d.invert(n[0]),d.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(m.domain(grapher.axis.axisProcessDrag(g,m.invert(n[0]),m.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation())}).on("mouseup",function(t){document.onselectstart=function(){return!0},isNaN(v)||(e(),v=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(e(),g=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),M.node=i,M.scale=O,M.updateLJData=A,M.update=f,M.redraw=e}var r=d3.select(e),i=r.node(),s=r.property("clientWidth"),o=r.property("clientHeight"),u,a,f,l,c,h,p,d=d3.scale.linear(),v,m=d3.scale.linear(),g,b,w,E,S,T,N={},C=[],k={title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy"};if(n)for(var L in k)n[L]===undefined&&(n[L]=k[L]);else n=k;return N.variables=[],N.variables[0]={coefficient:"epsilon",cursorStyle:"ns-resize"},N.variables[1]={coefficient:"sigma",cursorStyle:"ew-resize"},A(),w=!1,coefficient_selected=N.variables[0],O(s,o),c=function(e,t){return"translate("+d(e)+",0)"},h=function(e,t){return"translate(0,"+m(e)+")"},p=function(e,t){return Math.abs(e)>1e-4?"#ccc":"#666"},line=d3.svg.line().x(function(e,t){return d(C[t][0])}).y(function(e,t){return m(C[t][1])}),M.resize=function(e,t){M.scale(e,t),M()},M.ljUpdate=function(){M.updateLJData(),M.redraw()},i&&M(),M},layout.speedDistributionChart=function(e,t){function H(){O=model.get_speed(),t.xmax=d3.max(O),t.xmin=d3.min(O),t.quantile=d3.quantile(O,.1),T=t.ymax,p=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,a]),m=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,f])}function B(){if(O.length>2){try{_=d3.layout.histogram().frequency(!1).bins(p.ticks(60))(O)}catch(e){return}w=(u.width-_.length)/_.length,S=(t.xmax-t.xmin)/_.length,N=d3.max(_,function(e){return e.y})}}function j(e,n){i=e,s=n,r.style.width=i+"px",r.style.height=s+"px",o={top:t.title?40:20,right:35,bottom:t.xlabel?56:30,left:t.ylabel?60:25},width=i-o.left-o.right,height=s-o.top-o.bottom,u={width:width,height:height},a=u.width,f=u.height,p=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,a]),m=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,f]).nice(),H(),B()}function F(){function e(){d3.event&&d3.event.transform&&isNaN(v)&&isNaN(b)&&d3.event.transform(x,y);var e=m.tickFormat(10),t=C.selectAll("g.y").data(m.ticks(5),String).attr("transform",c);t.select("text").text(e);var r=t.enter().insert("g","a").attr("class","y").attr("transform",c).attr("background-fill","#FFEEB6");r.append("line").attr("stroke",h).attr("x1",0).attr("x2",u.width),r.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(e).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(C[0][0]);b=y.invert(t[1])}),t.exit().remove(),n()}function n(){H();if(O.length>2){kde=science.stats.kde().sample(O),p.domain([t.xmin,t.xmax]);try{_=d3.layout.histogram().frequency(!0).bins(p.ticks(60))(O)}catch(e){return}w=(u.width-_.length)/_.length,S=(t.xmax-t.xmin)/_.length,N=d3.max(_,function(e){return e.y}),C.selectAll("g.bar").remove(),L=C.selectAll("g.bar").data(_),L.enter().append("g").attr("class","bar").attr("transform",function(e,t){return"translate("+p(e.x)+","+(f-m(T-e.y))+")"}).append("rect").attr("class","bar").attr("fill","steelblue").attr("width",w).attr("height",function(e){return m(T-e.y)})}}j(i,s),C===undefined?(C=d3.select(r).append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+o.left+","+o.top+")"),k=C.append("rect").attr("class","plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE"),t.title&&C.append("text").attr("class","title").text(t.title).attr("x",u.width/2).attr("dy","-1em").style("text-anchor","middle"),t.xlabel&&C.append("text").attr("class","xlabel").text(t.xlabel).attr("x",u.width/2).attr("y",u.height).attr("dy","2.4em").style("text-anchor","middle"),t.ylabel&&C.append("g").append("text").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),e()):(d3.select(r).select("svg").attr("width",i).attr("height",s),C.select("rect.plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE"),t.title&&C.select("text.title").attr("x",u.width/2).attr("dy","-1em"),t.xlabel&&C.select("text.xlabel").attr("x",u.width/2).attr("y",u.height),t.ylabel&&C.select("text.ylabel").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),C.selectAll("g.x").remove(),C.selectAll("g.y").remove(),e()),F.node=r,F.scale=j,F.update=n,F.redraw=e}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,b,w,E,S,T,N,C,k,L,A,O,M,_,D={title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01};if(t)for(var P in D)t[P]===undefined&&(t[P]=D[P]);else t=D;return j(i,s),l=function(e,t){return"translate("+p(e)+",0)"},c=function(e,t){return"translate(0,"+m(e)+")"},h=function(e,t){return e?"#ccc":"#666"},F.resize=function(e,t){F.scale(e,t),F()},r&&F(),F};var e=document.getElementById("start-benchmarks"),t=document.getElementById("benchmarks-table"),n=[{name:"molecules",run:function(){return model.get_num_atoms()}},{name:"temperature",run:function(){return model.get("temperature")}},{name:"100 Steps (steps/s)",run:function(){controller.modelStop();var e=+Date.now(),t=-1;while(t++<100)model.tick(1,{dontDispatchTickEvent:!0});return elapsed=Date.now()-e,d3.format("5.1f")(100/elapsed*1e3)}},{name:"100 Steps w/graphics",run:function(){controller.modelStop();var e=+Date.now(),t=-1;while(t++<100)model.tick();return elapsed=Date.now()-e,d3.format("5.1f")(100/elapsed*1e3)}}];e&&(e.onclick=function(){benchmark.run(t,n)}),layout.datatable_visible=!1;var r=document.getElementById("toggle-datatable"),i=document.getElementById("datatable-table");layout.hide_datatable=function(){i&&(i.style.display="none")},layout.render_datatable=function(e){function h(){return i.getElementsByTagName("tr").length==0}function p(e){e=e||"data";var t=i.appendChild(document.createElement("tr"));return t.className=e,t}function d(e,t,n,r){n=n||"td",r=r||1;var i=e.appendChild(document.createElement(n));i.textContent=t,r>1&&(i.colSpan=r)}function v(e,t,n){n=n||"td";var r;r=-1;while(++r<t.length)d(e,t[r])}function m(e,t,r){r=r||"td";var i=e.getElementsByTagName(r),s=0;if(i.length>0){i[0].textContent=t;while(++s<i.length)i[s].textContent=c[s](n[model.INDICES[u[s]]][t])}s--;while(++s<u.length)d(e,c[s](n[model.INDICES[u[s]]][t]))}function g(e,t){h()&&d(p("title"),e,"th"),d(results_row,t)}function y(e,t,n){n=n||1;var r;r=-1;while(++r<t.length)d(e,t[r],"th",n)}function b(e){var t=-1,n=o.length;while(++t<e)t>=o.length&&p();while(--n>=t)i.removeChild(o[t]);return i.getElementsByClassName("data")}function w(e,t){var n=-1;while(++n<t.length)d(e,t[n])}function E(e,t,n,r){var i;i=-1;while(++i<r.length)w(t[i],r[i])}i.style.display="";var t,n=model.get_nodes(),r=[],s=i.getElementsByClassName("title"),o=i.getElementsByClassName("data"),u=["PX","PY","X","Y","VX","VY","AX","AY","SPEED","CHARGE","RADIUS","ELEMENT"],a=d3.format(" 2d"),f=d3.format(" 1.1f"),l=d3.format(" 3.4f"),c=[l,l,l,l,l,l,l,l,l,f,l,a];r.length=n[0].length,e=e||!1;if(s.length==0){var S=p("title");y(S,u),o=b(r.length)}e&&(o=b(model.get_num_atoms())),t=-1;while(++t<r.length)m(o[t],t)},r&&(r.onclick=function(){layout.datatable_visible?(layout.datatable_visible=!1,r.textContent="Show Data Table",i.style.display="none"):(layout.datatable_visible=!0,r.textContent="Hide Data Table",layout.render_datatable(),i.style.display="")});var s=document.getElementById("select-temperature"),o=document.createElement("span");layout.setupTemperature=function(e){if(s){if(Modernizr.inputtypes.range){var t=document.createElement("input");t.type="range",t.min="0",t.max="1000",t.step="20",t.value=e.get("temperature"),s.parentNode.replaceChild(t,s),t.id="select-temperature",s=t,o.id="select-temperature-display",o.innerText=t.value+" K",s.parentNode.appendChild(o),s=document.getElementById("select-temperature")}s.onchange=u}},layout.temperature_control_checkbox=document.getElementById("temperature-control-checkbox"),layout.temperatureControlHandler=function(){layout.temperature_control_checkbox.checked?model.set({temperature_control:!0}):model.set({temperature_control:!1})},layout.temperatureControlUpdate=function(){var e=model.get("temperature_control");layout.temperature_control_checkbox.checked=e,s.disabled=!e,o.hidden=!e},layout.temperature_control_checkbox&&(layout.temperature_control_checkbox.onchange=layout.temperatureControlHandler),layout.lennard_jones_forces_checkbox=document.getElementById("lennard-jones-forces-checkbox"),layout.lennard_jones_forces_checkbox&&(layout.lennard_jones_forces_checkbox.onchange=a),layout.coulomb_forces_checkbox=document.getElementById("coulomb-forces-checkbox"),layout.coulomb_forces_checkbox&&(layout.coulomb_forces_checkbox.onchange=f);var l=document.getElementById("stats");layout.displayStats=function(){var e=model.ke(),t=model.pe(),n=e+t;l&&(l.textContent="Time: "+d3.format("5.2f")(model.getTime()/1e3)+" (ps), "+"KE: "+d3.format("1.4f")(e)+", "+"PE: "+d3.format("1.4f")(t)+", "+"TE: "+d3.format("1.4f")(n)+", "+"Pressure: "+d3.format("6.3f")(model.pressure())+", "+"Rate: "+d3.format("5.1f")(model.get_rate())+" (steps/s)")},layout.heatCoolButtons=function(e,t,n,r,i,s){var o=new ButtonComponent(e,"circlesmall-plus"),u=new ButtonComponent(t,"circlesmall-minus");o.add_action(function(){var n=i.get("temperature");n<r?($(e).removeClass("inactive"),$(t).removeClass("inactive"),n=Math.floor(n*2)/2+100,i.set({temperature:n}),typeof s=="function"&&s(n)):$(e).addClass("inactive")}),u.add_action(function(){var r=i.get("temperature");r>n?($(e).removeClass("inactive"),$(t).removeClass("inactive"),r=Math.floor(r*2)/2-100,i.set({temperature:r}),typeof s=="function"&&s(r)):$(t).addClass("inactive")})}}(),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=Object.prototype.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},v=function(e,t){return function(){return e.apply(t,arguments)}};h=typeof exports!="undefined"&&exports!==null?exports:this,n=function(){function e(e){this.dom_id=e,this.dom_id?this.dom_element=$(this.dom_id):this.dom_element=$("<div>"),this.dom_element.addClass("component")}return e}(),t=function(e){function t(e,n,r){this.dom_id=e,this.name=n!=null?n:"play",this.actions=r!=null?r:[],t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button").addClass(this.name).addClass("up"),this.state="up",this.init_mouse_handlers()}return d(t,e),t.prototype.set_state=function(e){return this.dom_element.removeClass(this.state),this.state=e,this.dom_element.addClass(this.state)},t.prototype.init_mouse_handlers=function(){var e,t=this;return e=this,this.dom_element.mousedown(function(t){return e.set_state("down"),e.start_down_ticker()}),this.dom_element.mouseup(function(){return clearInterval(t.ticker),e.set_state("up"),e.do_action()}),this.dom_element.mouseleave(function(){return clearInterval(t.ticker),e.set_state("up")})},t.prototype.add_action=function(e){return this.actions.push(e)},t.prototype.do_action=function(){var e,t,n,r,i;r=this.actions,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e());return i},t.prototype.start_down_ticker=function(){var e;return e=this,this.ticker_count=0,this.ticker=setInterval(function(){e.do_action(),e.ticker_count+=1,e.ticker_count>4&&e.do_action();if(e.ticker_count>8)return e.do_action(),e.do_action()},250)},t}(n),h.ButtonComponent=t,c=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id,"toggle"),this.buttons=[];for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r);this.button_index=0,this.enable_button(0)}return d(t,e),t.prototype.add_button=function(e){var t,n;e.dom_element.remove(),e.dom_element.css("margin","0px"),this.dom_element.append(e.dom_element),this.buttons.push(e),this.add_width(e.dom_element),this.add_height(e.dom_element),n=this,t=this.buttons.length-1;if(t!==this.button_index)return this.disable_button(t)},t.prototype.add_width=function(e){var t,n;n=this.dom_element.width(),t=e.outerWidth(!0);if(n<t)return this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t.prototype.disable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.addClass("hidden")},t.prototype.enable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.removeClass("hidden")},t.prototype.set_active=function(e){return this.disable_button(this.button_index),this.button_index=e,this.button_index=this.button_index%this.buttons.length,this.enable_button(this.button_index)},t.prototype.enable_next_button=function(){return this.set_active(this.button_index+1)},t.prototype.current_button=function(){return this.button_index<this.buttons.length?this
.buttons[this.button_index]:null},t.prototype.do_action=function(){if(this.current_button())return this.current_button().do_action(),this.enable_next_button()},t}(t),h.ToggleButtonComponent=c,e=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button_bar"),this.buttons=[],this.dom_element.width("1px"),this.dom_element.height("1px");for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r)}return d(t,e),t.prototype.add_button=function(e){var t;return t=e.dom_element,this.dom_element.append(t),this.add_width(t),this.add_height(t),this.buttons.push(e)},t.prototype.add_width=function(e){var t;return t=this.dom_element.width(),t+=e.outerWidth(!0),this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t}(n),h.ButtonBarComponent=e,o=function(e){function n(e,r,i){var s,o,u,a,f,l=this;this.dom_id=e,this.playable=r,i==null&&(i=!0),n.__super__.constructor.call(this,this.dom_id),a=new t(null,"play"),a.add_action(function(){return l.playable.play()}),u=new t(null,"pause"),u.add_action(function(){return l.playable.stop()}),this.toggle=new c(null,[a,u]),this.play_index=0,this.stop_index=1,f=new t(null,"reset"),f.add_action(function(){return l.playable.seek(1),l.play()}),this.add_button(f),i||(o=new t(null,"forward"),o.add_action(function(){return l.playable.forward(),l.stop()}),this.add_button(o)),this.add_button(this.toggle),i||(s=new t(null,"back"),s.add_action(function(){return l.playable.back(),l.stop()}),this.add_button(s)),this.play()}return d(n,e),n.prototype.stop=function(){return this.toggle.set_active(this.play_index)},n.prototype.play=function(){return this.toggle.set_active(this.stop_index)},n}(e),h.PlaybackBarComponent=o,r=function(){function e(e,t){var n=this;this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.dom_element=$(this.dom_id),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.step=this.dom_element.attr("data-stop")||.01,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.label_id=this.dom_element.attr("data-label-id"),this.orientation=this.dom_element.attr("data-orientation")||"horizontal",this.dom_element.slider(),this.update_options(),this.dom_element.bind("slide",function(e,t){console.log("slider value: "+t.value),n.update_label(t.value);if(n.value_changed_function)return n.value_changed_function(t.value)}),this.update_label(this.value)}return e.prototype.set_max=function(e){return this.max=e,this.update_options()},e.prototype.set_min=function(e){return this.min=e,this.update_options()},e.prototype.update_options=function(){var e;return e={orientation:this.orientation,min:this.min,max:this.max,value:this.value,step:this.step,range:"min"},this.dom_element.slider("option",e)},e.prototype.update_label=function(e){if(this.label_id)return $(this.label_id).text(""+this.label+" "+e)},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.JSliderComponent=r,s=function(){function e(e,t,n,r,i){this.svg_element=e,this.playable=t!=null?t:null,this.offsets={play:1,stop:1},this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=this;o=this.group.append("svg:g"),c=this.offset(e),o.attr("class","component playbacksvgbutton").attr("x",c).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),s=o.append("rect"),s.attr("class","bg").attr("x",this.offset(e)/1.2).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(p=0,v=n.length;p<v;p++){f=n[p],r=o.append(t),r.attr("class",""+e+" button-art"),l="";for(d=0,m=f.length;d<m;d++)a=f[d],c=this.offset(e)+a.x*this.unit_width,h=this.vertical_padding/.75+a.y*this.unit_width,l+=" "+c+","+h,r.attr("points",l);e==="stop"&&(i=o.append("rect"),i.attr("class","pause-center").attr("x",c+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return u=o.append("rect"),u.attr("class","highlight").attr("x",this.offset(e)/1.2+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),o.on("click",function(){return g.action(e)}),o},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_pause_button=function(){var e;return e=[[{x:.5,y:.5},{x:.5,y:0},{x:.5,y:1},{x:0,y:1},{x:0,y:0}]],this.pause=this.make_button("pause","svg:polygon",e)},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_play_button(),this.init_stop_button(),this.playable.playing?this.hide(this.play):this.hide(this.stop)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlayOnlyComponentSVG=s,h.ModelPlayer=i,i=function(){function e(e,t){this.model=e,arguments.length>1?this.playing=t:this.playing=!0}return e.prototype.play=function(){return this.model.resume(),this.playing=!0},e.prototype.stop=function(){return this.model.stop(),this.playing=!1},e.prototype.forward=function(){return this.stop(),this.model.stepForward()},e.prototype.back=function(){return this.stop(),this.model.stepBack()},e.prototype.seek=function(e){return this.stop(),this.model.seek(e)},e}(),u=function(){function e(e,t){this.dom_id=e!=null?e:"#playback",this.playable=t!=null?t:null,this.dom_element=d3.select(this.dom_id).attr("class","component playback"),this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=parseInt(this.dom_element.style("width")),this.height=parseInt(this.dom_element.style("height")),this.unit_width=this.width/9,this.height<this.unit_width&&(this.height=this.unit_width+2,this.dom_element.style("height",this.height+"px")),this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d=this;i=this.svg.append("svg:g"),a=this.offset(e),i.attr("x",a).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(l=0,h=n.length;l<h;l++){o=n[l],r=i.append(t),r.attr("class",""+e+" button-art"),u="";for(c=0,p=o.length;c<p;c++)s=o[c],a=this.offset(e)+s.x*this.unit_width,f=this.vertical_padding+s.y*this.unit_width,u+=" "+a+","+f,r.attr("points",u)}return i.on("click",function(){return d.action(e)}),i},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_reset_button=function(){var e;return e=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",e)},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_back_button=function(){var e;return e=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",e)},e.prototype.init_forward_button=function(){var e;return e=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",e)},e.prototype.init_view=function(){return this.svg=this.dom_element.append("svg:svg").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlaybackComponent=u,h.ModelPlayer=i,a=function(){function e(e,t,n,r,i){this.svg_element=e,this.playable=t!=null?t:null,this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=this;o=this.group.append("svg:g"),h=this.offset(e),o.attr("class","component playbacksvgbutton").attr("x",c).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),s=o.append("rect"),s.attr("class","bg").attr("x",h).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(d=0,m=n.length;d<m;d++){f=n[d],r=o.append(t),r.attr("class",""+e+" button-art"),l="";for(v=0,g=f.length;v<g;v++)a=f[v],c=h+8+a.x*this.unit_width,p=this.vertical_padding/.75+a.y*this.unit_width,l+=" "+c+","+p,r.attr("points",l);e==="stop"&&(i=o.append("rect"),i.attr("class","pause-center").attr("x",c+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return u=o.append("rect"),u.attr("class","highlight").attr("x",h+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),o.on("click",function(){return y.action(e)}),o},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_reset_button=function(){var e;return e=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",e)},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_pause_button=function(){var e;return e=[[{x:.5,y:.5},{x:.5,y:0},{x:.5,y:1},{x:0,y:1},{x:0,y:0}]],this.pause=this.make_button("pause","svg:polygon",e)},e.prototype.init_back_button=function(){var e;return e=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",e)},e.prototype.init_forward_button=function(){var e;return e=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",e)},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_back_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.playable.playing?this.hide(this.play):this.hide(this.stop)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlaybackComponentSVG=a,h.ModelPlayer=i,f=function(){function e(e,t,n,r,i){this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.min=n,this.max=r,this.value=i,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return e.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},e.prototype.init_view=function(){var e;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(e=this.height/4,this.y1=this.y2=e,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},e.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},e.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},e.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/4,this.update_handle()},e.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},e.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},e.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},e.prototype.set_scaled_value=function(e){return this.value=(e-this.min)/this.domain,this.handle_x=e/this.domain*this.width,this.update()},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.update_label=function(){var e;return this.label?(e=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+e)):this.text_label.hide()},e.prototype.handle_mousedown=function(e){var t=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(e){return t.handle_mouseup(e)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(e){return t.handle_drag(e)}),this.handle_drag(e)},e.prototype.handle_drag=function(e){var t,n,r,i;return this.dragging?(document.onselectstart=function(){return!1},r=e.pageX-this.slider_well.position().left,i=e.pageY-this.slider_well.position().top,this.horizontal_orientation()?(t=this.width-this.handle_width/4,n=this.handle_width/4,this.handle_x=r,this.handle_x<n&&(this.handle_x=n),this.handle_x>t&&(this.handle_x=t),this.value=this.handle_x/this.width):(this.handle_y=e.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},e.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},e.prototype.init_mouse_handlers=function(){var e=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(t){return e.handle_mousedown(t)})},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.SliderComponent=f,l=function(){function e(e,t,n,r){this.dom_id=e!=null?e:"#thermometer",this.min=n,this.max=r,this.resize=v(this.resize,this),this.dom_element=typeof this.dom_id=="string"?$(this.dom_id):this.dom_id,this.dom_element.addClass("thermometer"),this.samples=[],this.samples.push(t),this.value=t,this.first_sample=!0,this.last_draw_time=(new Date).getTime(),this.sample_interval_ms=250,this.last_draw_time-=this.sample_interval_ms,this.init_view()}return e.prototype.init_view=function(){var e;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.init_thermometer_fill(),d3.select("#therm_text").attr("class","therm_text")},e.prototype.init_thermometer_fill=function(){return this.thermometer_fill=$("<div>").addClass("thermometer_fill"),this.dom_element.append(this.thermometer_fill),this.redraw()},e.prototype.resize=function(){var e;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.redraw()},e.prototype.set_scaled_value=function(e){var t;return t=this.value,t*=this.max-this.min,t+=this.min,t},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.time_to_redraw=function(){var e;return e=(new Date).getTime(),e>this.last_draw_time+this.sample_interval_ms},e.prototype.add_value=function(e){this.samples.push(e),this.value=e;if(this.time_to_redraw()||this.first_sample)return this.first_sample=!1,this.redraw(),this.samples=[]},e.prototype.get_avg=function(){var e,t,n,r,i;if(this.samples.length>0){t=0,i=this.samples;for(n=0,r=i.length;n<r;n++)e=i[n],t+=e;return this.value=t/this.samples.length}return this.value},e.prototype.scaled_display_value=function(){return this.get_avg()/(this.max-this.min)*this.height},e.prototype.redraw=function(){var e,t;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,t=this.scaled_display_value(),this.thermometer_fill.css("bottom",""+(t-this.height)+"px"),this.thermometer_fill.height(""+t+"px"),this.last_draw_time=(new Date).getTime(),d3.select("#therm_text").text("Temperature")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.Thermometer=l}.call(this),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.simpleModelController=function(e,t,n){function S(){function E(){r=n.layoutStyle,i=n.autostart,s=n.maximum_model_steps,o=n.lj_epsilon_max,u=n.lj_epsilon_min,a=t.elements,f=t.atoms,l=t.mol_number,c=t.temperature_control,h=t.temperature,p=t.coulomb_forces,d=t.width,v=t.height}function x(){model=modeler.model({elements:a,model_listener:y,temperature:h,lennard_jones_forces:!0,coulomb_forces:p,temperature_control:c,width:d,height:v});if(f)model.createNewAtoms(f);else{if(!l)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:l,relax:!0})}}function T(){layout.selection=r,model_player=new ModelPlayer(model,i),g=layout.moleculeContainer(e,{xmax:d,ymax:v,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),g.updateMoleculeRadius(),g.setup_particles(),w=new Thermometer("#thermometer",model.temperature(),200,4e3),model.addPropertiesListener(["temperature"],C),w.resize(),C(),layout.heatCoolButtons("#heat_button","#cool_button",0,3800,model,function(e){w.add_value(e)}),model.addPropertiesListener(["coulomb_forces"],N),N(),layout.addView("moleculeContainers",g),layout.addView("thermometers",w),layout.setupScreen()}function N(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),g.setup_particles()}function C(){w.add_value(model.get("temperature"))}function k(){model.stop()}function L(){model.on("tick",y),(!Number(s)||model.stepCounter()<s)&&model.resume()}function A(){k(),model.stepBack()}function O(){(!Number(s)||model.stepCounter()<s)&&model.stepForward()}function M(){m=model.get_nodes(),model.resetTime(),k(),model.on("tick",y),b=model.stepCounter()}function _(){layout.setupScreen(),w.resize(),C()}function D(e){E(),x(),M(),e?T():H()}function H(){layout.setupScreen(!0)}function B(e,r){t=e,n=r,D(!1)}y=function(e){g.update_molecule_positions(),b>=model.stepCounter()&&k()},document.onwebkitfullscreenchange=_,window.onresize=_;if(typeof DEVELOPMENT=="undefined")try{D(!0)}catch(P){throw alert(P),new Error(P)}else D(!0);i&&L(),S.updateLayout=H,S.reload=B}var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;return S(),S},controllers.compareModelsController=function(e,t,n,r,i){function j(){function r(e){b.update_molecule_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),b=layout.moleculeContainer(e,{playback_controller:!1,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),b.updateMoleculeRadius(),b.setup_particles(),O=A(),O?L={params:[["script","page:0:import /imports/legacy-mw-content/"+O]]}:L={},k=layout.appletContainer(t,L),layout.addView("moleculeContainers",b),layout.addView("appletContainers",k),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function w(){model.stop(),model.stepBack()}function S(){model.stop(),model.stepForward()}function x(){model.stop(),i(),N(),r()}function N(){y=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),E=model.stepCounter()}function C(){return B=document.location.hash,B.length>0?B.substr(1,B.length):!1}function A(){var e=C();return e?H[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function j(){var e=C();e?P.value=e.replace("/imports/legacy-mw-content/",""):P.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function F(){var e,t,n,r,i;H={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],H[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function I(){F(),d3.select(P).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),j()}function q(e){return k.applet.runMwScript(e)}function R(){var e=$(P).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");T=t+n,document.location.hash="#"+T}function U(){A()&&(L={params:[["script","page:0:import "+A()]]},k=layout.appletContainer(t,L),q("page:0:set frank false"),layout.setView("appletContainers",[k]),layout.setupScreen())}function z(){layout.setupScreen()}function W(){I(),i(),N(),u(),j()}P=document.getElementById(n),M=document.getElementById("start"),M.onclick=function(){q("mw2d:1:run"),f()},_=document.getElementById("stop"),_.onclick=function(){q("mw2d:1:stop"),a()},D=document.getElementById("reset"),D.onclick=function(){q("mw2d:1:reset"),x()},P.onchange=R,document.onwebkitfullscreenchange=z,window.onresize=z;if(typeof DEVELOPMENT=="undefined")try{W()}catch(X){throw alert(X),new Error(X)}else W()}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y,b,w,E,S,x,T,N,C,k,L={},A,O,M,_,D,P,H,B;return j(),j},controllers.complexModelController=function(e,t,n,r,s,o){function q(){function s(e){var t=model.ke(),n=model.pe(),r=t+n;j.update(),x.update_molecule_positions(),model.isNewStep()?(O[0].push(t),O[1].push(n),O[2].push(r),L.add_points([t,n,r])):L.update(model.stepCounter()),N>=f&&A(),layout.displayStats(),layout.datatable_visible&&layout.render_datatable()}function o(e){var t=model.stepCounter();if(e)for(i=0,len=O.length;i<len;i++)O[i].length=t;else ke=model.ke(),pe=model.pe(),te=ke+pe,O=[[ke],[pe],[te]]}function T(){model=modeler.model({elements:d,model_listener:s,temperature:y,lennard_jones_forces:!0,coulomb_forces:w,temperature_control:b,width:E,height:S});if(v)model.createNewAtoms(v),model.createRadialBonds(m);else{if(!g)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:g,relax:!0})}}function C(){function i(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),x.setup_particles()}function s(){g=+D.value,X(),F.checked=!1,f()}function f(){L.change_yaxis(P[g]),B.redraw(),j.redraw()}layout.selection=u,model_player=new ModelPlayer(model,a),x=layout.moleculeContainer(e,{title:"Simple Molecules",xlabel:"X position (nm)",ylabel:"Y position (nm)",playback_controller:!0,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,atom_mubers:!1,xmin:0,xmax:E,ymin:0,ymax:S,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),model.addPropertiesListener(["sigma"],x.updateMoleculeRadius),o(),L=grapher.realTimeGraph(t,{title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:100,sample:.25,ylabel:null,ymin:-5,ymax:5,dataset:O}),L.new_data(O),model.on("play",function(){var e,t;L.number_of_points()&&model.stepCounter()<L.number_of_points()&&(o(model.stepCounter()),L.new_data(O)),L.show_canvas()}),model.on("stop",function(){}),model.on("seek",function(){modelsteps=model.stepCounter(),modelsteps>0?(o(modelsteps),L.new_data(O)):(o(),L.new_data(O))}),j=layout.speedDistributionChart(r,{title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01}),B=layout.potentialChart(n,model,{title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy",epsilon_max:l,epsilon_min:c,epsilon:d[0].epsilon,sigma_max:h,sigma_min:p,sigma:d[0].sigma}),model.addPropertiesListener(["epsilon"],B.ljUpdate),model.addPropertiesListener(["sigma"],B.ljUpdate),model.addPropertiesListener(["coulomb_forces"],i),i(),layout.addView("moleculeContainers",x),layout.addView("potentialCharts",B),layout.addView("speedDistributionCharts",j),layout.addView("energyCharts",L),M=document.getElementById("model-controls"),M&&(_=M.getElementsByTagName("input"),M.onchange=modelController),D=document.getElementById("select-molecule-number"),F=document.getElementById("radio-randomize-pos-vel"),checkbox_thermalize=document.getElementById("checkbox-thermalize"),P={2:2,5:12.5,10:5,20:10,50:120,100:250,200:1e3,500:5e3},H={2:2,5:2,10:5,20:5,50:10,100:15,200:20,500:40},D.onchange=s,F.onclick=s,D.value=g}function k(){I=model.get_nodes(),model.resetTime(),o(),x.setup_particles(),x.updateMoleculeRadius(),layout.setupScreen(),N=model.stepCounter(),D.value=model.get_num_atoms(),A(),model.on("tick",s)}function A(){model.stop(),x.playback_component.action("stop"),M&&(_[0].checked=!0)}function R(){model.stop(),model.stepCounter()<f?(model.stepForward(),M&&(_[0].checked=!0)):M&&(_[0].checked=!1)}function U(){model.on("tick",s),model.stepCounter()<f?(L.show_canvas(),model.resume(),M&&(_[0].checked=!0)):M&&(_[0].checked=!1)}function z(){A(),model.stepBack(),L.showMarker(model.stepCounter())}function W(){model.stepCounter()<f?model.stepForward():M&&(_[0].checked=!0)}function X(){var e=!checkbox_thermalize.checked;g=+D.value,model.createNewAtoms(g,e),k(),x.update_molecule_positions(),N=model.stepCounter(),layout.displayStats(),layout.datatable_visible?layout.render_datatable(!0):layout.hide_datatable(),o(),L.new_data(O),M&&(_[0].checked=!0)}function V(){layout.setupScreen()}function J(){T(),C(),k()}document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();a&&U(),q.modelListener=s,q.modelGo=U,q.modelStop=A,q.modelReset=X,q.resetEnergyData=o,q.energyGraph=L,q.moleculeContainer=x}var u=o.layoutStyle,a=o.autostart,f=o.maximum_model_steps,l=o.lj_epsilon_max,c=o.lj_epsilon_min,h=2,p=.1,d=s.elements,v=s.atoms,m=s.radialBonds,g=s.mol_number,y=s.temperature,b=s.temperature_control,w=s.coulomb_forces,E=s.width,S=s.height,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,D,F,I;return q(),q},controllers.interactivesController=function(interactive,interactive_view_id){function loadModel(e){var t={layoutStyle:"interactive",maximum_model_steps:Infinity};$.get(e).done(function(e){modelController?modelController.reload(e,t):(modelController=controllers.modelController("#molecule-container",e,t),modelLoaded())})}function createComponent(e){switch(e.type){case"button":return createButton(e);case"thermometer":return createThermometer(e)}}function createButton(component){var $button,scriptStr,script;return $button=$("<button>").attr("id",component.id).html(component.text),typeof component.action=="string"?scriptStr=component.action:scriptStr=component.action.join("\n"),eval("script = function() {"+scriptStr+"}"),$button.click(script),$button}function createThermometer(e){function i(){n.add_value(model.get("temperature"))}var t=$("<div>").attr("id",e.id),n=new Thermometer(t,0,e.min,e.max),r=$("<div>").css("padding-bottom","4em").append(t).append($("<div>").text("Thermometer"));return queuePropertiesListener
(["temperature"],i),queueActionOnModelLoad(function(){n.resize(),i()}),layout.addView("thermometers",n),r}function queuePropertiesListener(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):propertiesListeners.push([e,t])}function queueActionOnModelLoad(e){typeof model!="undefined"?e():actionQueue.push(e)}function modelLoaded(){var e,t;while(propertiesListeners.length>0)e=propertiesListeners.pop(),model.addPropertiesListener(e[0],e[1]);while(actionQueue.length>0)t=actionQueue.pop()()}function loadInteractive(e,t){var n,r={},i,s,o,u,a,f,l,c;interactive=e,$interactiveContainer=$(t),$interactiveContainer.children().length===0?(a=$('<div class="top" id="top"/>'),a.append('<div id="molecule-container"/>'),f=$('<div id="right"/>'),a.append(f),$interactiveContainer.append(a),$interactiveContainer.append('<div class="bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),$interactiveContainer.append('<div id="bottom"/>')),interactive.model&&loadModel(interactive.model),n=interactive.components;for(l=0,c=n.length;l<c;l++)i=createComponent(n[l]),r[n[l].id]=i;if(interactive.layout)for(o in interactive.layout)if(interactive.layout.hasOwnProperty(o)){s=interactive.layout[o];for(l=0,c=s.length;l<c;l++)u=s[l],r[u]&&($("#"+o).append(r[u]),delete r[u])}for(u in r)r.hasOwnProperty(u)&&$("#bottom").append(r[u])}function updateLayout(){layout.setupScreen(!0)}var controller={},modelController,$interactiveContainer,propertiesListeners=[],actionQueue=[];return loadInteractive(interactive,interactive_view_id),controller.loadInteractive=loadInteractive,controller.updateLayout=updateLayout,controller},controllers.modelController=function(e,t,n){function w(e){m.update_molecule_positions(),g>=model.stepCounter()&&x()}function E(){model=modeler.model({elements:u,model_listener:w,temperature:c,lennard_jones_forces:!0,coulomb_forces:h,temperature_control:l,width:p,height:d});if(a)model.createNewAtoms(a);else{if(!f)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(f),model.relax()}}function S(){layout.selection=i,model_player=new ModelPlayer(model,s),m=layout.moleculeContainer(e,{xmax:p,ymax:d,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()}}),m.updateMoleculeRadius(),m.setup_particles(),layout.addView("moleculeContainers",m),layout.setupScreen()}function x(){model.stop()}function T(){model.on("tick",w),(!Number(o)||model.stepCounter()<o)&&model.resume()}function N(){x(),model.stepBack()}function C(){(!Number(o)||model.stepCounter()<o)&&model.stepForward()}function k(){v=model.get_nodes(),model.resetTime(),x(),model.on("tick",w),g=model.stepCounter()}function L(e){E(),k(),e?S():layout.setupScreen(!0)}function A(e,r){t=e,n=r,L(!1)}var r={},i=n.layoutStyle,s=n.autostart,o=n.maximum_model_steps,u=t.elements,a=t.atoms,f=t.mol_number,l=t.temperature_control,c=t.temperature,h=t.coulomb_forces,p=t.width,d=t.height,v,m,g,y,b;if(typeof DEVELOPMENT=="undefined")try{L(!0)}catch(O){throw alert(O),new Error(O)}else L(!0);return s&&T(),r.reload=A,r}}();