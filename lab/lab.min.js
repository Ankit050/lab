(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),grapher={version:"0.0.1"},grapher.data=function(e){var t=0,n=e.length,r=[];for(t=0;t<n;t+=2)r.push({x:e[t],y:e[t+1]});return r},grapher.axis={axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.2+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.2+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.2+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}},grapher.indexedData=function(e,t){var n=0,r=t||0,i=e.length,s=[];for(n=0;n<i;n++)s.push({x:n+r,y:e[n]});return s},grapher.graph=function(e,t,n){function V(e){if(e)for(var t in F)e[t]===undefined&&(e[t]=F[t]);else e=F;return e}function $(){r<=_.icon?(_.category="icon",_.value=0):r<=_.tiny?(_.category="tiny",_.value=1):r<=_.small?(_.category="small",_.value=2):r<=_.medium?(_.category="medium",_.value=3):r<=_.large?(_.category="large",_.value=4):(_.category="extralarge",_.value=5)}function J(t,n){arguments.length?(r=t,i=n,s.style.width=r+"px",s.style.height=i+"px"):(r=e.property("clientWidth"),i=e.property("clientHeight")),$(),A=layout.getDisplayProperties(),O=A.emsize}function K(e,s){if(e||!t)t=V(e);o!==undefined&&(o.remove(),o=undefined),s&&(n=s),t.dataChange?L="ns-resize":L="crosshair",J(),t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,t.datacount=2,M=t.strokeWidth;switch(_.value){case 0:m={top:4,right:4,bottom:4,left:4};break;case 1:m={top:8,right:8,bottom:8,left:8};break;case 2:m={top:t.title?25:15,right:15,bottom:20,left:20};break;case 3:m={top:t.title?30:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?80:45};break;default:m={top:t.title?40:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?80:45}}Object.prototype.toString.call(t.title)==="[object Array]"?j=t.title:j=[t.title],j.reverse(),_.value>2?m.top+=(j.length-1)*_.value/3*_.value/3*O*22:j=[j[0]],g={width:r-m.left-m.right,height:i-m.top-m.bottom},w=function(e){return e[0]},E=function(e){return e[1]},y=d3.scale[t.xscale]().domain([t.xmin,t.xmax]).range([0,g.width]),t.xscale==="pow"&&y.exponent(t.xscaleExponent),b=d3.scale[t.yscale]().domain([t.ymin,t.ymax]).nice().range([g.height,0]).nice(),t.yscale==="pow"&&b.exponent(t.yscaleExponent),T=function(e){return"translate("+y(e)+",0)"},N=function(e){return"translate(0,"+b(e)+")"},x=function(e){return e?"#ccc":"#666"},C=y.tickFormat(t.xTicCount),k=b.tickFormat(t.yTicCount),S=d3.svg.line().x(function(e,t){return y(p[t][0])}).y(function(e,t){return b(p[t][1])}),D=NaN,P=NaN,H=B=null}function Q(v){function w(e){n=e,e?d.text(e):d.text("")}function E(){var e=t.yrange/2,n=e/2,r;return t.datacount=g.width/30,t.xtic=t.xrange/t.datacount,t.ytic=t.yrange/t.datacount,r=d3.range(t.datacount).map(function(r){return[r*t.xtic+t.xmin,t.ymin+n+Math.random()*e]}),r}function A(){if(!B)return;switch(d3.event.keyCode){case 8:case 46:if(t.dataChange){var e=p.indexOf(B);p.splice(e,1),B=p.length?p[e>0?e-1:0]:null,R()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}}function F(){y.domain([t.xmin,t.xmax]).range([0,g.width])}function I(){b.domain([t.ymin,t.ymax]).range([g.height,0])}function q(){var e=u.selectAll("g.x").data(y.ticks(t.xTicCount),String).attr("transform",T),n=e.enter().insert("g","a").attr("class","x").attr("transform",T);n.append("line").attr("stroke",x).attr("y1",0).attr("y2",g.height),_.value>1&&n.append("text").attr("class","axis").style("font-size",_.value/2.7*100+"%").attr("y",g.height).attr("dy","1em").attr("text-anchor","middle").text(C).style("cursor","ew-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",z).on("touchstart.drag",z),e.exit().remove();var r=u.selectAll("g.y").data(b.ticks(t.yTicCount),String).attr("transform",N),i=r.enter().insert("g","a").attr("class","y").attr("transform",N).attr("background-fill","#FFEEB6");i.append("line").attr("stroke",x).attr("x1",0).attr("x2",g.width),_.value>1&&i.append("text").attr("class","axis").style("font-size",_.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(k).style("cursor","ns-resize").on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",X).on("touchstart.drag",X),r.exit().remove(),a.call(d3.behavior.zoom().x(y).y(b).on("zoom",q)),R()}function R(){tt(),u.select("path").attr("d",S(p));var e=u.select("svg").selectAll("circle").data(p,function(e){return e});t.circleRadius&&_.value>1&&(t.circleRadius<=4&&_.value<3||(e.enter().append("circle").attr("class",function(e){return e===B?"selected":null}).attr("cx",function(e){return y(e[0])}).attr("cy",function(e){return b(e[1])}).attr("r",t.circleRadius*(1+_.value)/4).style("stroke-width",t.circleRadius/6*(_.value-1.5)).style("cursor",L).on("mousedown.drag",V).on("touchstart.drag",V),e.attr("class",function(e){return e===B?"selected":null}).attr("cx",function(e){return y(e[0])}).attr("cy",function(e){return b(e[1])}).attr("r",t.circleRadius*(1+_.value)/4).style("stroke-width",t.circleRadius/6*(_.value-1.5)))),e.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function U(){var e;d3.event.preventDefault(),grapher.registerKeyboardHandler(A),d3.select("body").style("cursor","move");if(d3.event.altKey)if(d3.event.shiftKey&&t.addData){e=d3.svg.mouse(u.node());var n=[];n[0]=y.invert(Math.max(0,Math.min(g.width,e[0]))),n[1]=b.invert(Math.max(0,Math.min(g.height,e[1]))),p.push(n),p.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),B=n,R()}else e=d3.svg.mouse(u[0][0]),D=y.invert(e[0]),P=b.invert(e[1]),H=!1,d3.event.stopPropagation()}function z(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(u[0][0]);D=y.invert(t[0])}function X(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(u[0][0]);P=b.invert(t[1])}function V(e){grapher.registerKeyboardHandler(A),document.onselectstart=function(){return!1},B=H=e,R()}function $(){var e=d3.svg.mouse(u[0][0]);d3.event.preventDefault(),H&&t.dataChange&&(H[1]=b.invert(Math.max(0,Math.min(g.height,e[1]))),R()),isNaN(D)||(d3.select("body").style("cursor","ew-resize"),y.domain(grapher.axis.axisProcessDrag(D,y.invert(e[0]),y.domain())),q(),d3.event.stopPropagation()),isNaN(P)||(d3.select("body").style("cursor","ns-resize"),b.domain(grapher.axis.axisProcessDrag(P,b.invert(e[1]),b.domain())),q(),d3.event.stopPropagation())}function G(){document.onselectstart=function(){return!0},d3.select("body").style("cursor","auto"),isNaN(D)||(D=NaN,q()),isNaN(P)||(P=NaN,q()),H=null}v||(v=e),v.each(function(){e=d3.select(this),this.clientWidth&&this.clientHeight&&(r=this.clientWidth,i=this.clientHeight,g.width=r-m.left-m.right,g.height=i-m.top-m.bottom),p=t.points,p==="fake"&&(p=E()),F(),I(),o===undefined?(o=e.append("svg").attr("width",r).attr("height",i),u=o.append("g").attr("transform","translate("+m.left+","+m.top+")"),a=u.append("rect").attr("class","plot").attr("width",g.width).attr("height",g.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown.drag",U).on("touchstart.drag",U).call(d3.behavior.zoom().x(y).y(b).on("zoom",q)),f=u.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height),f.append("path").attr("class","line").style("stroke-width",M).attr("d",S(p)),W=f.append("g").attr("class","brush"),t.title&&_.value>1&&(l=u.selectAll("text").data(j,function(e){return e}),l.enter().append("text").attr("class","title").style("font-size",_.value/2.4*100+"%").text(function(e){return e}).attr("x",g.width/2).attr("dy",function(e,t){return-0.5+ -1*_.value/2.8*t*O+"em"}).style("text-anchor","middle")),t.xlabel&&_.value>2&&(c=u.append("text").attr("class","axis").style("font-size",_.value/2.6*100+"%").text(t.xlabel).attr("x",g.width/2).attr("y",g.height).attr("dy","2.4em").style("text-anchor","middle")),t.ylabel&&_.value>2&&(h=u.append("g").append("text").attr("class","axis").style("font-size",_.value/2.6*100+"%").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-50 "+g.height/2+") rotate(-90)")),d3.select(s).on("mousemove.drag",$).on("touchmove.drag",$).on("mouseup.drag",G).on("touchend.drag",G),d=u.append("text").attr("class","graph-notification").text(n).attr("x",g.width/2).attr("y",g.height/2).style("text-anchor","middle")):(u.attr("width",r).attr("height",i),a.attr("width",g.width).attr("height",g.height),f.attr("top",0).attr("left",0).attr("width",g.width).attr("height",g.height).attr("viewBox","0 0 "+g.width+" "+g.height),t.title&&_.value>1&&l.each(function(e,t){d3.select(this).attr("x",g.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-j.length+"em"})}),t.xlabel&&_.value>1&&c.attr("x",g.width/2).attr("y",g.height),t.ylabel&&_.value>1&&h.attr("transform","translate(-40 "+g.height/2+") rotate(-90)"),d.attr("x",g.width/2).attr("y",g.height/2)),q()}),Q.elem=e,Q.redraw=q,Q.update=R,Q.notify=w,Q.points=p,Q.initialize=K,Q.updateXScale=F,Q.updateYScale=I,Q.scale=J}function G(){t.title&&l&&l.text(t.title)}function Y(){t.xlabel&&c&&c.text(t.xlabel)}function Z(){t.ylabel&&h?h.text(t.ylabel):h.style("display","none")}function et(){var e;U&&(e=X.extent(),Q.selection_domain(e[0]!==e[1]?e:[]))}function tt(){q&&R?(X=X||d3.svg.brush().x(y).extent([I.xmin||0,I.xmax||0]).on("brush",et),W.call(X.extent([I.xmin||0,I.xmax||0])).style("display","inline").style("pointer-events",U?"all":"none").selectAll("rect").attr("height",g.height)):W.style("display","none")}var r=600,i=300,s;arguments.length&&(e=d3.select(e),s=e.node(),r=e.property("clientWidth"),i=e.property("clientHeight"));var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},D,P,H,B,j=[],F={title:"Graph",xlabel:"X Axis",ylabel:"Y Axis",xscale:"linear",yscale:"linear",xTicCount:10,yTicCount:8,xscaleExponent:.5,yscaleExponent:.5,xmax:60,xmin:0,ymax:40,ymin:0,circleRadius:10,strokeWidth:2,dataChange:!0,addData:!0,points:!1,notification:!1},I={xmin:null,xmax:null,ymin:null,ymax:null},q=!1,R=!1,U=!0,z,W,X;return K(t),Q.margin=function(e){return arguments.length?(v=e,Q):v},Q.xmin=function(e){return arguments.length?(t.xmin=e,t.xrange=t.xmax-t.xmin,Q.updateXScale&&(Q.updateXScale(),Q.redraw()),Q):t.xmin},Q.xmax=function(e){return arguments.length?(t.xmax=e,t.xrange=t.xmax-t.xmin,Q.updateXScale&&(Q.updateXScale(),Q.redraw()),Q):t.xmax},Q.ymin=function(e){return arguments.length?(t.ymin=e,t.yrange=t.ymax-t.ymin,Q.updateYScale&&(Q.updateYScale(),Q.redraw()),Q):t.ymin},Q.ymax=function(e){return arguments.length?(t.ymax=e,t.yrange=t.ymax-t.ymin,Q.updateYScale&&(Q.updateYScale(),Q.redraw()),Q):t.ymax},Q.xLabel=function(e){return arguments.length?(t.xlabel=e,Y(),Q):t.xlabel},Q.yLabel=function(e){return arguments.length?(t.ylabel=e,Z(),Q):t.ylabel},Q.title=function(e){return arguments.length?(t.title=e,G(),Q):t.title},Q.width=function(e){return arguments.length?(g.width=e,Q):g.width},Q.height=function(e){return arguments.length?(g.height=e,Q):g.height},Q.x=function(e){return arguments.length?(w=e,Q):w},Q.y=function(e){return arguments.length?(E=e,Q):E},Q.elem=function(t){return arguments.length?(e=d3.select(t),e.call(Q),Q):e},Q.data=function(e){if(!arguments.length)return p;var n=y.domain(),r=n[1]-n[0],i=r*.8;return t.points=p=e,p.length>n[1]?(n[0]+=i,n[1]+=i,y.domain(n),Q.redraw()):Q.update(),Q},Q.add_data=function(e){if(!arguments.length)return p;var t=y.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)p.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");p.push(e)}return p[p.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,y.domain(t),Q.redraw()):Q.update(),Q},Q.selection_domain=function(e){return arguments.length?(e===null?q=!1:e.length===0?(q=!0,I.xmin=Infinity,I.xmax=Infinity):(q=!0,I.xmin=e[0],I.xmax=e[1]),tt(),z&&z(Q.selection_domain()),Q):q?I.xmax===Infinity&&I.xmin===Infinity?[]:[I.xmin,I.xmax]:null},Q.has_selection=function(){return q},Q.selection_visible=function(e){return arguments.length?(e=!!e,R!==e&&(R=e,tt()),Q):R},Q.selection_enabled=function(e){return arguments.length?(e=!!e,U!==e&&(U=e,tt()),Q):U},Q.selection_listener=function(e){return arguments.length?(z=e,Q):z},Q.brush_element=function(){return W},Q.brush_control=function(){return X},Q.brush_listener=function(){return et},Q.reset=function(e,t){return arguments.length?Q.initialize(e,t):Q.initialize(),Q(),Q},Q.resize=function(e,t){return Q.scale(e,t),Q.initialize(),Q(),Q},e&&e.call(Q),Q},grapher.realTimeGraph=function(e,t){function J(e){if(e)for(var t in $)e[t]===undefined&&(e[t]=$[t]);else e=$;return e}function K(){i<=D.icon?(D.category="icon",D.value=0):i<=D.tiny?(D.category="tiny",D.value=1):i<=D.small?(D.category="small",D.value=2):i<=D.medium?(D.category="medium",D.value=3):i<=D.large?(D.category="large",D.value=4):(D.category="extralarge",D.value=5)}function Q(e,t){arguments.length?(i=e,s=t,r.style.width=i+"px",r.style.height=s+"px"):(i=n.property("clientWidth"),s=n.property("clientHeight")),K(),A=layout.getDisplayProperties(),O=A.emsize}function G(e,n){if(e||!t)t=J(e);c!==undefined&&(c.remove(),c=undefined),n&&(message=n),z=t.sample,t.dataChange?L="ns-resize":L="crosshair",Q(),t.xrange=t.xmax-t.xmin,t.yrange=t.ymax-t.ymin,q=[];switch(D.value){case 0:S={top:4,right:4,bottom:4,left:4};break;case 1:S={top:8,right:8,bottom:8,left:8};break;case 2:S={top:t.title?25:15,right:15,bottom:20,left:20};break;case 3:S={top:t.title?30:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45};break;default:S={top:t.title?40:20,right:30,bottom:t.xlabel?60:10,left:t.ylabel?70:45}}if(Object.prototype.toString.call(t.dataset[0])==="[object Array]"){for(var r=0;r<t.dataset.length;r++)q.push(Y(t.dataset[r],0,z));I=q[0]}else I=Y(t.dataset,0),q=[I];Object.prototype.toString.call(t.title)==="[object Array]"?F=t.title:F=[t.title],F.reverse(),D.value>2?S.top+=(F.length-1)*D.value/3*D.value/3*O*22:F=[F[0]],T={width:i-S.left-S.right,height:s-S.top-S.bottom},N=d3.scale[t.xscale]().domain([t.xmin,t.xmax]).range([0,T.width]),t.xscale=="pow"&&N.exponent(t.xscaleExponent),C=d3.scale[t.yscale]().domain([t.ymin,t.ymax]).nice().range([T.height,0]).nice(),t.yscale=="pow"&&C.exponent(t.yscaleExponent),f=N.tickFormat(t.xTicCount),l=C.tickFormat(t.yTicCount),k=d3.svg.line().x(function(e,t){return N(I[t].x)}).y(function(e,t){return C(I[t].y)}),P=Math.NaN,H=Math.NaN,B=null}function Y(e,t,n){var r=0,i=t||0,s=e.length,o=[];n=n||1;for(r=0;r<s;r++)o.push({x:(r+i)*n,y:e[r]});return o}function Z(){return I?I.length:!1}function et(){function e(){var n=h.selectAll("g.x").data(N.ticks(t.xTicCount),String).attr("transform",u),r=n.enter().insert("g","a").attr("class","x").attr("transform",u);r.append("line").attr("stroke",o).attr("y1",0).attr("y2",T.height),D.value>1&&r.append("text").attr("class","axis").style("font-size",D.value/2.7*100+"%").attr("y",T.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(f).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",E).on("touchstart.drag",E),n.exit().remove();var i=h.selectAll("g.y").data(C.ticks(t.yTicCount),String).attr("transform",a),s=i.enter().insert("g","a").attr("class","y").attr("transform",a).attr("background-fill","#FFEEB6");s.append("line").attr("stroke",o).attr("x1",0).attr("x2",T.width),D.value>1&&s.append("text").attr("class","axis").style("font-size",D.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(l).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",L).on("touchstart.drag",L),i.exit().remove(),p.call(d3.behavior.zoom().x(N).y(C).on("zoom",e)),b()}function b(e){ht(e);if(et.selectable_points){var t=h.selectAll("circle").data(I,function(e){return e});t.enter().append("circle").attr("class",function(e){return e===j?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}).attr("r",1).on("mousedown",function(e){j=B=e,b()}),t.attr("class",function(e){return e===j?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}),t.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function w(){d3.event.preventDefault(),p.style("cursor","move");if(d3.event.altKey){var e=d3.svg.mouse(h[0][0]);P=N.invert(e[0]),H=C.invert(e[1]),B=!1,d3.event.stopPropagation()}}function E(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(h[0][0]);P=N.invert(t[0])}function L(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(h[0][0]);H=C.invert(t[1])}function A(){var t=d3.svg.mouse(h[0][0]),n,r,i,s=d3.event.changedTouches;document.onselectstart=function(){return!0},d3.event.preventDefault(),isNaN(P)||(d3.select("body").style("cursor","ew-resize"),N.domain(grapher.axis.axisProcessDrag(P,N.invert(t[0]),N.domain())),e(),d3.event.stopPropagation()),isNaN(H)||(d3.select("body").style("cursor","ns-resize"),C.domain(grapher.axis.axisProcessDrag(H,C.invert(t[1]),C.domain())),e(),d3.event.stopPropagation())}function M(){d3.select("body").style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(P)||(e(),P=Math.NaN),isNaN(H)||(e(),H=Math.NaN),B=null}function _(e){R={x:I[e].x,y:I[e].y}}function $(){var t,n=N.domain(),r=n[1]-n[0],i=I.length*z,s=r*.9;i>n[1]?(n[0]+=s,n[1]+=s,N.domain(n),e()):b()}function J(e){if(I.length===0)return;R=!1;var t=I.length,n=t*z,r={x:n,y:e},i,s;I.push(r),$()}function K(e){if(I.length===0)return;J(e),$()}function tt(e){if(I.length===0)return;R=!1;var t=I.length,n=t*z,r=n-z,i={x:n,y:e},s=N.call(self,r,r),o=C.call(self,I[t-1].y,t-1),u,a;I.push(i),u=N.call(self,n,n),a=C.call(self,e,n),X.beginPath(),X.moveTo(s,o),X.lineTo(u,a),X.stroke()}function nt(e){for(var t=0;t<q.length;t++)I=q[t],J(e[t]);$()}function rt(e){for(var t=0;t<q.length;t++)I=q[t],it(t),tt(e[t])}function it(e,t){var n=t?.4:1;switch(e){case 0:X.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:X.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:X.strokeStyle="rgba(44,0,160,"+n+")"}}function st(e,t){var n=t?.4:1;switch(e){case 0:X.fillStyle="rgba(160,00,0,"+n+")";break;case 1:X.fillStyle="rgba(44,160,0,"+n+")";break;case 2:X.fillStyle="rgba(44,0,160,"+n+")"}}function ot(e){var n;q=[];if(Object.prototype.toString.call(e)==="[object Array]")for(n=0;n<e.length;n++)I=Y(e[n],0,z),q.push(I);else I=Y(t.dataset,0,z),q=[I];$()}function ut(n){x=d3.scale[t.xscale]().domain([0,n]).range([0,T.width]),et.xmax=n,x_tics_scale=d3.scale[t.xscale]().domain([et.xmin*et.sample,et.xmax*et.sample]).range([0,T.width]),b(),e()}function at(n){y=d3.scale[t.yscale]().domain([n,0]).range([0,T.height]),et.ymax=n,b(),e()}function ft(){W.width=W.width,X.fillStyle="rgba(0,255,0, 0.05)",X.fillRect(0,0,W.width,W.height),X.strokeStyle="rgba(255,65,0, 1.0)"}function lt(){h.select("path.line").attr("d",[]),W.style.zIndex=100}function ct(){W.style.zIndex=-100,b()}function ht(e){var n,r,i,s,o,u=C(1e-5),a=t.lines,f=t.bars,l=2*Math.PI;typeof e=="undefined"?s=q[0].length:s=e;if(I.length===0)return;ft(),X.fillRect(0,0,W.width,W.height);if(a)for(n=0;n<q.length;n++){I=q[n],px=N(0),i=C(I[0].y),r=0,lengthX=0,it(n),X.beginPath(),X.moveTo(px,i),o=s-1;for(r=1;r<o;r++)lengthX+=z,px=N(lengthX),i=C(I[r].y),X.lineTo(px,i);X.stroke(),o=I.length-1;if(r<o){it(n,!0);for(;r<o;r++)lengthX+=z,px=N(lengthX),i=C(I[r].y),X.lineTo(px,i);X.stroke()}}else if(f)for(n=0;n<q.length;n++){I=q[n],lengthX=0,it(n),o=s-1;for(r=0;r<o;r++){px=N(lengthX),i=C(I[r].y);if(i===0)continue;X.beginPath(),X.moveTo(px,u),X.lineTo(px,i),X.stroke(),lengthX+=z}o=I.length-1;if(r<o){it(n,!0);for(;r<o;r++)px=N(lengthX),i=C(I[r].y),X.beginPath(),X.moveTo(px,u),X.lineTo(px,i),X.stroke(),lengthX+=z}}else for(n=0;n<q.length;n++){I=q[n],lengthX=0,st(n),it(n,!0),o=s-1;for(r=0;r<o;r++)px=N(lengthX),i=C(I[r].y),X.arc(px,i,1,0,l,!1),X.fill(),lengthX+=z;o=I.length-1;if(r<o){st(n,!0),it(n,!0);for(;r<o;r++)px=N(lengthX),i=C(I[r].y),X.arc(px,i,1,0,l,!1),X.fill(),lengthX+=z}}}function pt(){W||(W=W||document.createElement("canvas"),r.appendChild(W)),W.style.zIndex=-100,vt(W)}function dt(){vt(W),ht()}function vt(e){V.rect=p.node(),V.width=V.rect.width.baseVal.value,V.height=V.rect.height.baseVal.value,V.left=V.rect.getCTM().e,V.top=V.rect.getCTM().f,e.style.position="absolute",e.width=V.width,e.height=V.height,e.style.width=V.width+"px",e.style.height=V.height+"px",e.offsetLeft=V.left,e.offsetTop=V.top,e.style.left=V.left+"px",e.style.top=V.top+"px",e.style.border="solid 1px red",e.style.pointerEvents="none",e.className+="canvas-overlay",X=W.getContext("2d"),X.globalCompositeOperation="source-over",X.lineWidth=1,X.fillStyle="rgba(0,255,0, 0.05)",X.fillRect(0,0,e.width,W.height),X.strokeStyle="rgba(255,65,0, 1.0)",W.style.border="solid 1px red"}Q(),c===undefined?(c=n.append("svg").attr("width",i).attr("height",s),h=c.append("g").attr("transform","translate("+S.left+","+S.top+")"),p=h.append("rect").attr("class","plot").attr("width",T.width).attr("height",T.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",w).on("touchstart",w),p.call(d3.behavior.zoom().x(N).y(C).on("zoom",e)),d=h.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",T.width).attr("height",T.height).attr("viewBox","0 0 "+T.width+" "+T.height).append("path").attr("class","line").attr("d",k(I)),U=d.append("path").attr("class","marker").attr("d",[]),t.title&&D.value>1&&(v=h.selectAll("text").data(F,function(e){return e}),v.enter().append("text").attr("class","title").style("font-size",D.value/2.4*100+"%").text(function(e){return e}).attr("x",T.width/2).attr("dy",function(e,t){return-0.5+ -1*D.value/2.8*t*O+"em"}).style("text-anchor","middle")),t.xlabel&&D.value>2&&(m=h.append("text").attr("class","axis").style("font-size",D.value/2.6*100+"%").attr("class","xlabel").text(t.xlabel).attr("x",T.width/2).attr("y",T.height).attr("dy","2.4em").style("text-anchor","middle")),t.ylabel&&D.value>2&&(g=h.append("g").append("text").attr("class","axis").style("font-size",D.value/2.6*100+"%").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+T.height/2+") rotate(-90)")),d3.select(r).on("mousemove.drag",A).on("touchmove.drag",A).on("mouseup.drag",M).on("touchend.drag",M),pt(),lt()):(h.attr("width",i).attr("height",s),p.attr("width",T.width).attr("height",T.height).style("fill","#EEEEEE"),d.attr("top",0).attr("left",0).attr("width",T.width).attr("height",T.height).attr("viewBox","0 0 "+T.width+" "+T.height),t.title&&D.value>1&&v.each(function(e,t){d3.select(this).attr("x",T.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-F.length+"em"})}),t.xlabel&&D.value>1&&m.attr("x",T.width/2).attr("y",T.height),t.ylabel&&D.value>1&&g.attr("transform","translate(-40 "+T.height/2+") rotate(-90)"),h.selectAll("g.x").remove(),h.selectAll("g.y").remove(),dt()),e(),et.node=r,et.scale=Q,et.update=b,et.redraw=e,et.initialize=G,et.number_of_points=Z,et.new_data=ot,et.add_point=K,et.add_points=nt,et.add_canvas_point=tt,et.add_canvas_points=rt,et.initialize_canvas=pt,et.show_canvas=lt,et.hide_canvas=ct,et.clear_canvas=ft,et.update_canvas=ht,et.showMarker=_,et.change_xaxis=ut,et.change_yaxis=at}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o=function(e){return e?"#ccc":"#666"},u=function(e){return"translate("+N(e)+",0)"},a=function(e){return"translate(0,"+C(e)+")"},f,l,c,h,p,d,v,m,g,b,w,E,S,T,N,C,k,L,A,O,M,_,D={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},P=Math.NaN,H=Math.NaN,B=null,j=null,F=[],I,q,R,U,z,W,X,V={},$={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xscale:"linear",yscale:"linear",xTicCount:10,yTicCount:8,xscaleExponent:.5,yscaleExponent:.5,xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1,points:!1,sample:1,lines:!0,bars:!1};return G(t),et.add_data=function(e){if(!arguments.length)return I;var t=N.domain(),n=t[1]-t[0],r=n*.8,i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)I.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");I.push(e)}return I[I.length-1][0]>t[1]?(t[0]+=r,t[1]+=r,N.domain(t),et.redraw()):et.update(),et},et.reset=function(e,t){return arguments.length?et.initialize(e,t):et.initialize(),et(),et},et.resize=function(e,t){return et.scale(e,t),et.initialize(),et(),et},r&&et(),et},grapher.colors=function(e){var t={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return t[e]},grapher.registerKeyboardHandler=function(e){d3.select(window).on("keydown",e)}})(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){});var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=i._cached?i._cached:i();return s};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function a(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var s={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,t),e.modules[t]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),e.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),e.define("/node_modules/arrays/package.json",function(e,t,n,r,i){t.exports={}}),e.define("/node_modules/arrays/index.js",function(e,t,n,r,i){var s;s={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t=t||0;var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r};for(var a in s)s.hasOwnProperty(a)&&(n[a]=s[a])}),e.define("/constants/index.js",function(e,t,n,r,i){var s=e("./units"),o=s.unit,u=s.ratio,a=s.convert,f={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:u(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}},l,c;f.COULOMB_CONSTANT={value:1/(4*Math.PI*f.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},n.unit=o,n.ratio=u,n.convert=a;for(l in f
)f.hasOwnProperty(l)&&(c=f[l],n[l]=function(e){return{as:function(t){return s.convert(e.value,{from:e.unit,to:t})}}}(c))}),e.define("/constants/units.js",function(e,t,n,r,i){var s=1.66054e-27,o=1.602177e-19,u=o,a=1e-15,f=1e-9,l=10,c=1e3,h={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},p,d,v;n.unit=p={FEMTOSECOND:{name:"femtosecond",value:1,type:h.TIME},SECOND:{name:"second",value:a,type:h.TIME},NANOMETER:{name:"nanometer",value:1,type:h.LENGTH},ANGSTROM:{name:"Angstrom",value:1*l,type:h.LENGTH},METER:{name:"meter",value:1*f,type:h.LENGTH},DALTON:{name:"Dalton",value:1,type:h.MASS},GRAM:{name:"gram",value:1*s*c,type:h.MASS},KILOGRAM:{name:"kilogram",value:1*s,type:h.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:h.ENERGY},JOULE:{name:"Joule",value:s*f*f*(1/a)*(1/a),type:h.ENERGY},EV:{name:"electron volt",value:s*f*f*(1/a)*(1/a)*(1/u),type:h.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:h.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*u,type:h.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:h.CHARGE},COULOMB:{name:"Coulomb",value:o,type:h.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:h.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:h.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:h.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:h.FORCE},NEWTON:{name:"Newton",value:1*s*f*(1/a)*(1/a),type:h.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*s*f*f*(1/a)*(1/a)*(1/u),type:h.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:h.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*f*(1/a),type:h.VELOCITY}},n.ratio=d=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},n.convert=v=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*d(r,{per:n})}}),e.define("/math/index.js",function(e,t,n,r,i){n.normal=e("./distributions").normal,n.getWindowedAverager=e("./utils").getWindowedAverager,n.minimize=e("./minimizer").minimize}),e.define("/math/distributions.js",function(e,t,n,r,i){n.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),e.define("/math/utils.js",function(e,t,n,r,i){n.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:NaN}}}),e.define("/math/minimizer.js",function(e,t,n,r,i){n.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var r=n.precision,i=n.bounds,s=n.maxiter||1e3,o=n.stopval||-Infinity,u=n.maxstep||.01,a=n.eps||.01,f=t.length,l,c,h,p,d,v,m,g,y,b;v=u*u,l=[];for(y=0;y<f;y++)l[y]=t[y];c=e.apply(null,l),h=c[0],d=c[1],g=0;do{if(h<=o)break;if(g>s)return console.log("maxiter reached"),{error:"maxiter reached",f:h,iter:s,x:l};m=0;for(y=0;y<f;y++)m+=d[y]*d[y];if(a*a*m>v){b=Math.sqrt(v/m)/a;for(y=0;y<f;y++)d[y]=b*d[y]}for(y=0;y<f;y++)l[y]-=a*d[y],i&&l[y]<i[y][0]&&(l[y]=i[y][0]),i&&l[y]>i[y][1]&&(l[y]=i[y][1]);p=h,c=e.apply(null,l),h=c[0],d=c[1],g++}while(Math.abs(h-p)>r);return[h,l]}}),e.define("/potentials/index.js",function(e,t,n,r,i){var s=n.potentials={};n.coulomb=e("./coulomb"),n.lennardJones=e("./lennard-jones")}),e.define("/potentials/coulomb.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.COULOMB_CONSTANT.as(s.unit.METERS_PER_FARAD),a=s.ratio(o.NANOMETER,{per:o.METER}),f=Math.pow(s.ratio(o.COULOMB,{per:o.ELEMENTARY_CHARGE}),2),l=s.ratio(o.EV,{per:o.JOULE}),c=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON}),h=u*f*a*l,p=u*f*a*a*c,d=n.potential=function(e,t,n){return h*(t*n/e)},v=n.forceFromSquaredDistance=function(e,t,n){return-p*(t*n/e)},m=n.forceOverDistanceFromSquaredDistance=function(e,t,n){return v(e,t,n)/Math.sqrt(e)},g=n.force=function(e,t,n){return v(e*e,t,n)}}),e.define("/potentials/lennard-jones.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.ratio(o.NANOMETER,{per:o.METER}),a=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON});n.pairwiseEpsilon=function(e,t){return.5*(e+t)},n.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},n.rmin=function(e){return Math.pow(2,1/6)*e},n.radius=function(e){return.5*e},n.newLJCalculator=function(e,t){var r,i,f,l,c,h,p,d=function(e,d){r=e,i=d,f=n.rmin(i),r!=null&&i!=null&&(l=4*r*Math.pow(i,12),c=4*r*Math.pow(i,6),h=12*s.convert(l,{from:o.EV,to:o.JOULE})*u*a,p=6*s.convert(c,{from:o.EV,to:o.JOULE})*u*a),typeof t=="function"&&t(v(),this)},v=function(){return{epsilon:r,sigma:i,rmin:f}},m=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},g=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},y;return m(e.epsilon),g(e.sigma),d(e.epsilon,e.sigma),y={coefficients:v,setEpsilon:function(e){m(e),d(e,i)},setSigma:function(e){g(e),d(r,e)},potentialFromSquaredDistance:function(e){return l*Math.pow(e,-6)-c*Math.pow(e,-3)},potential:function(e){return y.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*y.forceOverDistanceFromSquaredDistance(e*e)}}}}),e.define("/md2d.js",function(e,t,n,r,i){typeof window=="undefined"&&(window={});var s=e("arrays"),o=e("./constants"),u=o.unit,a=e("./math"),f=e("./potentials").coulomb,l=e("./potentials").lennardJones,c=!0,h=function(){try{new Float32Array}catch(e){return!1}return!0}(),p=2,d=1e3,v=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),m=.34,g=39.95,y=o.convert(g,{from:u.DALTON,to:u.KILOGRAM}),b=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),w,E,S,x,T=function(e,t,n,r){return e*r-t*n},N=function(e,t){return e*e+t*t},C=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/b},k=function(e,t){var n=2*t,r=e*b,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},L=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")},A=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t};n.ELEMENT_INDICES=E={MASS:0,EPSILON:1,SIGMA:2,RADIUS:3},n.INDICES=w={RADIUS:0,PX:1,PY:2,X:3,Y:4,VX:5,VY:6,SPEED:7,AX:8,AY:9,CHARGE:10,ELEMENT:11},n.OBSTACLE_INDICES=S={X:0,Y:1,WIDTH:2,HEIGHT:3,MASS:4,VX:5,VY:6,X_PREV:7,Y_PREV:8,COLOR_R:9,COLOR_G:10,COLOR_B:11},n.SAVEABLE_INDICES=x=["X","Y","VX","VY","CHARGE","ELEMENT"],n.makeModel=function(){var e,t=!1,n=!1,r=!1,i=!1,v=!0,m=!1,g=!1,y,b=.001,k=[10,10],O=0,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et=0,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt=0,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt=window.state={},Ct=[],kt=[],Lt=5,At=[],Ot=[],Mt=function(e,t,n){At[e][t]=At[t][e]=Lt*Lt*n.sigma*n.sigma,e===t&&_t(e,n)},_t=function(e,t){H[e][E.RADIUS]=l.radius(t.sigma);if(!B||!$)return;for(var n=0,r=B.length;n<r;n++)B[n]=H[$[n]][E.RADIUS]},Dt=function(t){var r=[],i,o;for(o=0;o<J.length;o++)r[o]=J[o];i=P,n=!1,e.createAtoms({num:t});for(o=0;o<J.length;o++)s.copy(r[o],J[o]);D=r[0].length,P=i},Pt=function(e){var t=h&&c?"Float32Array":"regular",n=h&&c?"Uint16Array":"regular";Z=[],Z[0]=K=s.create(e,0,n),Z[1]=Q=s.create(e,0,n),Z[2]=G=s.create(e,0,t),Z[3]=Y=s.create(e,0,t)},Ht=function(e){var t=[],n;for(n=0;n<Z.length;n++)t[n]=Z[n];Pt(e);for(n=0;n<Z.length;n++)s.copy(t[n],Z[n])},Bt=function(t){var n=h&&c?"Float32Array":"regular",r=S;pt=e.obstacles=[],pt[r.X]=tt=s.create(t,0,n),pt[r.Y]=nt=s.create(t,0,n),pt[r.WIDTH]=rt=s.create(t,0,n),pt[r.HEIGHT]=it=s.create(t,0,n),pt[r.MASS]=ut=s.create(t,0,n),pt[r.VX]=st=s.create(t,0,n),pt[r.VY]=ot=s.create(t,0,n),pt[r.X_PREV]=at=s.create(t,0,n),pt[r.Y_PREV]=ft=s.create(t,0,n),pt[r.COLOR_R]=lt=s.create(t,0,n),pt[r.COLOR_G]=ct=s.create(t,0,n),pt[r.COLOR_B]=ht=s.create(t,0,n)},jt=function(e){var t=[],n;for(n=0;n<pt.length;n++)t[n]=pt[n];Bt(e);for(n=0;n<pt.length;n++)s.copy(t[n],pt[n])},Ft,It=function(){return r&&i?1e3:1e3},qt=function(){g=!0,Ft=a.getWindowedAverager(It())},Rt=function(){var e=0,t;for(t=0;t<D;t++)e+=H[$[t]][0]*(R[t]*R[t]+U[t]*U[t]);return C(e/2,D)},Ut=function(e,t){R[e]*=t,U[e]*=t,j[e]*=t,F[e]*=t},zt=function(e,t,n){R[e]+=t,U[e]+=n,j[e]=R[e]*H[$[e]][0],F[e]=U[e]*H[$[e]][0]},Wt=function(e,t){R[e]-=t*(q[e]-mt),U[e]+=t*(I[e]-vt),j[e]=R[e]*H[$[e]][0],F[e]=U[e]*H[$[e]][0]},Xt=function(){for(var e=0;e<D;e++)zt(e,-bt,-wt),Wt(e,-xt)},Vt=function(){var e=0,t=0,n=0,r=0,i;for(i=0;i<D;i++)e+=I[i],t+=q[i],n+=j[i],r+=F[i];vt=e/D,mt=t/D,gt=n,yt=r,bt=n/P,wt=r/P},$t=function(){var e=0,t=0,n,r;for(r=0;r<D;r++)n=H[$[r]][0],e+=n*T(I[r]-vt,q[r]-mt,R[r]-bt,U[r]-wt),t+=n*N(I[r]-vt,q[r]-mt);Et=e,St=t,xt=Et/St},Jt=function(){Vt(),$t()},Kt=function(e){I[e]+=R[e]*M+.5*W[e]*_,q[e]+=U[e]*M+.5*X[e]*_},Qt=function(e){var t=st[e],n=ot[e];if(t||n)at[e]=tt[e],ft[e]=nt[e],tt[e]+=t*M,nt[e]+=n*M},Gt=function(e){var t=B[e],n=t,r=t,i=k[0]-t,s=k[1]-t;I[e]<n?(I[e]=n+(n-I[e]),R[e]*=-1,j[e]*=-1):I[e]>i&&(I[e]=i-(I[e]-i),R[e]*=-1,j[e]*=-1),q[e]<r?(q[e]=r+(r-q[e]),U[e]*=-1,F[e]*=-1):q[e]>s&&(q[e]=s-(q[e]-s),U[e]*=-1,F[e]*=-1)},Yt=function(e,t,n){if(dt<1)return;var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=0;r=B[e],i=I[e],s=q[e];for(o=0;o<dt;o++)u=tt[o]-r,a=tt[o]+rt[o]+r,f=nt[o]+it[o]+r,l=nt[o]-r,c=at[o]-r,h=at[o]+rt[o]+r,p=ft[o]+it[o]+r,d=ft[o]-r,i>u&&i<a&&s>l&&s<f&&(t<=c?(I[e]=u-(i-u),S=1):t>=h?(I[e]=a+(a-i),S=1):n<=p?(q[e]=l-(s-l),S=-1):n>=d&&(q[e]=f+(f-s),S=-1)),w=ut[o],S&&(w!==Infinity?(b=H[$[e]][0],E=w+b,S===1?(v=R[e],g=st[o],R[e]=(v*(b-w)+2*w*g)/E,st[o]=(g*(w-b)+2*j[e])/E):(m=U[e],y=ot[o],U[e]=(m*(b-w)+2*w*y)/E,ot[o]=(y*(w-b)+2*F[e])/E)):S===1?R[e]*=-1:U[e]*=-1)},Zt=function(e){var t=H[$[e]][0];R[e]+=.5*W[e]*M,j[e]=t*R[e],U[e]+=.5*X[e]*M,F[e]=t*U[e]},en=function(e){var t,n,s,o,u,a,l,c=$[e],h,p=1/H[c][0],d,m=V[e];for(t=0;t<e;t++)h=$[t],d=1/H[h][0],n=I[t]-I[e],s=q[t]-q[e],o=n*n+s*s,u=0,v&&o<At[c][h]&&(u+=Ot[c][h].forceOverDistanceFromSquaredDistance(o)),r&&i&&(u+=f.forceOverDistanceFromSquaredDistance(o,m,V[t])),u&&(a=u*n,l=u*s,W[e]+=a*p,X[e]+=l*p,W[t]-=a*d,X[t]-=l*d)},tn=function(){if(et<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,m,g,y,b;for(e=0,t=Z[0].length;e<t;e++)n=K[e],r=Q[e],i=$[n],s=$[r],y=1/H[i][0],b=1/H[s][0],a=I[r]-I[n],f=q[r]-q[n],l=a*a+f*f,c=Math.sqrt(l),h=Y[e],p=G[e],d=o.convert(h*(c-p),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/c,v&&l<At[i][s]&&(d-=Ot[i][s].forceOverDistanceFromSquaredDistance(l)),m=d*a,g=d*f,W[n]+=m*y,X[n]+=g*y,W[r]-=m*b,X[r]-=g*b},nn=function(e,t){var n,r;e==null&&(e=y),Tt=Rt(),g&&Math.abs(Ft(Tt)-e)<=e*b&&(g=!1);if(t||m||g&&Tt>0){n=Math.sqrt(e/Tt);for(r=0;r<D;r++)Ut(r,n);Tt=e}};return e={outputState:Nt,useCoulombInteraction:function(e){r=!!e},useLennardJonesInteraction:function(e){v=!!e},useThermostat:function(e){m=!!e},setTargetTemperature:function(e){L(e),y=e},setTime:function(e){Nt.time=O=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;k=[n,r]},getSize:function(){return[k[0],k[1]]},getLJCalculator:function(){return Ot},setElements:function(e){var t,r,i,s,o,u;if(n)throw new Error("md2d: setElements cannot be called after atoms have been created");H=e;for(t=0;t<H.length;t++)Ct[t]=[],kt[t]=[],Ot[t]=[],At[t]=[];for(t=0;t<H.length;t++){i=H[t][E.EPSILON],o=H[t][E.SIGMA],H[t][E.RADIUS]=l.radius(o);for(r=t;r<H.length;r++)s=H[r][E.EPSILON],u=H[r][E.SIGMA],Ct[t][r]=Ct[r][t]=l.pairwiseEpsilon(i,s),kt[t][r]=kt[r][t]=l.pairwiseSigma(o,u),function(e,t){Ot[e][t]=Ot[t][e]=l.newLJCalculator({epsilon:Ct[e][t],sigma:kt[e][t]},function(n){Mt(e,t,n)})}(t,r)}},createAtoms:function(r){var i=h&&c?"Float32Array":"regular",o=h&&c?"Uint8Array":"regular",u,a;if(n)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");n=!0,t=!0;if(typeof r=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");a=r.num;if(typeof a=="undefined")throw new Error("md2d: createAtoms was called without the required 'num' option specifying the number of atoms to create.");if(a!==Math.floor(a))throw new Error("md2d: createAtoms was passed a non-integral 'num' option.");if(a<p)throw new Error("md2d: create Atoms was passed an 'num' option equal to: "+a+" which is less than the minimum allowable value: N_MIN = "+p+".");if(a>d)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+a+" which is greater than the minimum allowable value: N_MAX = "+d+".");u=function(){var e=0,t;for(t in w)w.hasOwnProperty(t)&&e++;return e}(),J=e.atoms=s.create(u,null,"regular"),B=e.radius=J[w.RADIUS]=s.create(a,0,i),j=e.px=J[w.PX]=s.create(a,0,i),F=e.py=J[w.PY]=s.create(a,0,i),I=e.x=J[w.X]=s.create(a,0,i),q=e.y=J[w.Y]=s.create(a,0,i),R=e.vx=J[w.VX]=s.create(a,0,i),U=e.vy=J[w.VY]=s.create(a,0,i),z=e.speed=J[w.SPEED]=s.create(a,0,i),W=e.ax=J[w.AX]=s.create(a,0,i),X=e.ay=J[w.AY]=s.create(a,0,i),V=e.charge=J[w.CHARGE]=s.create(a,0,i),$=e.element=J[w.ELEMENT]=s.create(a,0,o),D=0,P=0},addAtom:function(e,t,n,r,s,o){var u,a;D+1>J[0].length&&Dt(D+1),u=H[e],a=u[E.MASS],$[D]=e,B[D]=H[e][E.RADIUS],I[D]=t,q[D]=n,R[D]=r,U[D]=s,j[D]=r*a,F[D]=s*a,W[D]=0,X[D]=0,z[D]=Math.sqrt(r*r+s*s),V[D]=o,o&&(i=!0),P+=a,D++},addRadialBond:function(e,t,n,r){et+1>K.length&&Ht(et+1),K[et]=e,Q[et]=t,G[et]=n,Y[et]=r,et++},addObstacle:function(e,t,n,r,i,s){var o;dt+1>tt.length&&jt(dt+1),tt[dt]=e,nt[dt]=t,at[dt]=e,ft[dt]=t,rt[dt]=n,it[dt]=r,st[dt]=0,ot[dt]=0,i=parseFloat(i),o=i*n*r,ut[dt]=o,lt[dt]=s[0],ct[dt]=s[1],ht[dt]=s[2],dt++},initializeAtomsFromProperties:function(t){var n,r,i,s,o,u,a,f;if(!t.X||!t.Y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!t.VX||!t.VY)throw new Error("md2d: For now, velocities must be set when locations are set.");for(a=0,f=t.X.length;a<f;a++)u=t.ELEMENT?t.ELEMENT[a]:0,n=t.X[a],r=t.Y[a],i=t.VX[a],s=t.VY[a],o=t.CHARGE?t.CHARGE[a]:0,e.addAtom(u,n,r,i,s,o);Tt=Rt(),e.computeOutputState()},initializeAtomsRandomly:function(t){var n=t.temperature||100,r=t.num||J[0].length,i=Math.floor(Math.sqrt(r)),s=Math.ceil(r/i),o,u,f,l,c,h,p,d,v,m,g,y,b;L(n),c=k[0]/(1+s),l=k[1]/(1+i),o=-1;for(u=1;u<=i;u++)for(f=1;f<=s;f++){o++;if(o===r)break;b=Math.floor(Math.random()*H.length),h=a.normal(1,.25),p=2*Math.random()*Math.PI,d=f*c,v=u*l,m=h*Math.cos(p),g=h*Math.sin(p),y=2*(o%2)-1,e.addAtom(b,d,v,m,g,y)}Jt(),Xt(),nn(n,!0),Tt=Rt(),e.computeOutputState()},initializeObstacles:function(t){var n=t.x.length,r;Bt(n);for(r=0;r<n;r++)e.addObstacle(t.x[r],t.y[r],t.width[r],t.height[r],t.density[r],t.color[r])},initializeRadialBonds:function(t){var n=t.atom1Index.length,r;Pt(n);for(r=0;r<n;r++)e.addRadialBond(t.atom1Index[r],t.atom2Index[r],t.bondLength[r],t.bondStrength[r])},relaxToTemperature:function(t){t!=null&&(y=t),L(y),qt();while(g)e.integrate()},integrate:function(t,r){var i;if(!n)throw new Error("md2d: integrate called before atoms created.");t==null&&(t=100),M=r||1,_=M*M,i=H[$[0]][E.RADIUS];var s=O,o=Math.floor(t/M),u,a,f,l;for(u=1;u<=o;u++){O=s+u*M;for(a=0;a<D;a++)f=I[a],l=q[a],Kt(a),Gt(a),Yt(a,f,l),Zt(a),W[a]=X[a]=0,en(a);for(a=0;a<dt;a++)Qt(a);tn();for(a=0;a<D;a++)Zt(a),z[a]=Math.sqrt(R[a]*R[a]+U[a]*U[a]);nn()}e.computeOutputState()},getTotalMass:function(){return P},getRadiusOfElement:function(e){return H[e][E.RADIUS]},computeOutputState:function(){var e,t,n,s,a,l,c,h,p,d,m,g,y;y=0,g=0;for(e=0;e<D;e++){g+=.5*H[$[e]][0]*(R[e]*R[e]+U[e]*U[e]);for(t=e+1;t<D;t++)c=I[t]-I[e],h=q[t]-q[e],p=c*c+h*h,v&&(y+=-Ot[$[e]][$[t]].potentialFromSquaredDistance(p)),r&&i&&(y+=-f.potential(Math.sqrt(p),V[e],V[t]))}for(e=0;e<et;e++)n=K[e],s=Q[e],a=$[n],l=$[s],c=I[s]-I[n],h=q[s]-q[n],p=c*c+h*h,d=Y[e],m=Math.sqrt(p)-G[e],y+=.5*d*m*m,v&&(y+=Ot[a][l].potentialFromSquaredDistance(p));Nt.time=O,Nt.pressure=0,Nt.PE=y,Nt.KE=o.convert(g,{from:u.MW_ENERGY_UNIT,to:u.EV}),Nt.T=Tt,Nt.pCM=[gt,yt],Nt.CM=[vt,mt],Nt.vCM=[bt,wt],Nt.omega_CM=xt},newPotentialCalculator:function(e,t,n){return function(s,a){var l=0,c=0,h=0,p,d,m=Ot[e],g,y,b,w,E,S,x;for(g=0;g<D;g++)y=s-I[g],b=a-q[g],w=y*y+b*b,S=0,v&&(x=m[$[g]],l+=-x.potentialFromSquaredDistance(w,e,$[g]),n&&(S+=x.forceOverDistanceFromSquaredDistance(w))),r&&i&&t&&(E=Math.sqrt(w),l+=-f.potential(E,t,V[g]),n&&(S+=f.forceOverDistanceFromSquaredDistance(w,t,V[g]))),S&&(c+=S*y,h+=S*b);return n?(p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),d=o.convert(h,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[l,[p,d]]):l}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=H[t][E.RADIUS],u=a.minimize(s,[n,r],{bounds:[[o,k[0]-o],[o,k[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=H[t][E.RADIUS],f=a.minimize(o,[n,r],{bounds:[[u,k[0]-u],[u,k[1]-u]],stopval:1e-4,precision:1e-6});return f.error?!1:f[1]},serialize:function(){var e={},t,n,r,i;for(r=0,i=x.length;r<i;r++)t=x[r],n=J[w[t]],e[t]=n.slice?n.slice():A(n);return e}}}}),e("/md2d.js");var t=e("/md2d"),n=e("arrays"),r;modeler={},modeler.VERSION="0.2.0",modeler.model=function(e){function _(e){$.unique(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function D(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],O[t]&&(r=r.concat(O[t]));O.all&&(r=r.concat(O.all)),_(r)}function P(){var e,t=0,n=i.get_num_atoms();e=-1;while(++e<n)t+=r.speed[e];return t/n}function H(e,t){var n;return r.integrate(),v=x.pressure,E=x.PE,S=x.KE,w=x.time,m.push(v),m.splice(0,m.length-16),j(),l||(n=Date.now(),g?(g=n-g,g&&y.push(g),g=n,y.splice(0,y.length-128)):g=n),t||o.tick(),l}function B(){return h===0}function j(){var e,t=[],r=k.length;e=-1;while(++e<r)t[e]=n.clone(k[e]);c.length=h,h++,p++,d=!0,c.push({nodes:t,pressure:x.pressure,pe:x.PE,ke:x.KE,time:x.time}),h>1e3&&(c.splice(0,1),h=1e3)}function F(){c=[],h=0,p=0}function I(){c.length=h+1}function q(e){var t,i=k.length;if(e<0)throw new Error("modeler: request for tick_history_list["+e+"]");if(e>=c.length)throw new Error("modeler: request for tick_history_list["+e+"], tick_history_list.length="+c.length);t=-1;while(++t<i)n.copy(c[e].nodes[t],k[t]);S=c[e].ke,w=c[e].time,r.setTime(w)}function R(){return m.reduce(function(e,t){return e+t})/m.length}function U(){var e,t,n=0,r=y.length;e=-1;while(++e<r)n+=y[e];return t=n/r,t?1/t*1e3:0}function z(e){b=e,r.setTargetTemperature(e)}function W(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null&&(M["set_"+t]?M["set_"+t](e[t]):M[t]&&(M[t]=e[t]),n.push(t));D(n)}function X(){r.computeOutputState(),v=x.pressure,E=x.PE,S=x.KE,w=x.time}var i={},s=e.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],o=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek"),u,a,f,l=!0,c=[],h=0,p=0,d=!1,v,m=[0],g,y=[],b,w,E,S,x,T,N=e.width,C=e.height,k,L,A={vx:0,vy:0,density:Infinity,color:[128,128,128]},O={},M={temperature:300,coulomb_forces:!0,lennard_jones_forces:!0,temperature_control:!0,set_temperature:function(e){this.temperature=e,r&&r.setTargetTemperature(e)},set_temperature_control:function(e){this.temperature_control=e,r&&r.useThermostat(e)},set_coulomb_forces:function(e){this.coulomb_forces=e,r&&r.useCoulombInteraction(e)},set_epsilon:function(e){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(e){console.log("set_sigma: This method is temporarily deprecated")}};return i.INDICES={RADIUS:t.INDICES.RADIUS,PX:t.INDICES.PX,PY:t.INDICES.PY,X:t.INDICES.X,Y:t.INDICES.Y,VX:t.INDICES.VX,VY:t.INDICES.VY,SPEED:t.INDICES.SPEED,AX:t.INDICES.AX,AY:t.INDICES.AY,CHARGE:t.INDICES.CHARGE,ELEMENT:t.INDICES.ELEMENT},i.OBSTACLE_INDICES={X:t.OBSTACLE_INDICES.X,Y:t.OBSTACLE_INDICES.Y,WIDTH:t.OBSTACLE_INDICES.WIDTH,HEIGHT:t.OBSTACLE_INDICES.HEIGHT,COLOR_R:t.OBSTACLE_INDICES.COLOR_R,COLOR_G:t.OBSTACLE_INDICES.COLOR_G,COLOR_B:t.OBSTACLE_INDICES.COLOR_B},T=e.model_listener,W(e),i.getStats=function(){return{speed:P(),ke:S,temperature:b,pressure:R(),current_step:p,steps:c.length-1}},i.getStatsHistory=function(){var e,t,n,r=[];r.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(e=0,t=c.length;e<t;e++)n=c[e],r.push(n.time+"	"+n.pe+"	"+n.ke+"	"+(n.pe+n.ke));return r.join("\n")},i.stepCounter=function(){return p},i.steps=function(){return c.length-1},i.isNewStep=function(){return d},i.seek=function(e){return arguments.length||(e=0),l=!0,d=!1,h=e,p=e,q(h),o.seek(),D("seek"),T&&T(),p},i.stepBack=function(e){arguments.length||(e=1);var t=-1;l=!0,d=!1;while(++t<e)h>1&&(h--,p--,q(h-1),T&&T());return p},i.stepForward=function(e){arguments.length||(e=1);var t=-1;l=!0;while(++t<e)h<c.length?(q(h),h++,p++,T&&T()):H();return p},i.createNewAtoms=function(e){var n,o,a,f,l;typeof e=="number"?l=e:e.num!=null?l=e.num:e.X&&(l=e.X.length),n=[];for(a=0,f=s.length;a<f;a++)o=s[a],n[o.id]=[o.mass,o.epsilon,o.sigma];return r=t.makeModel(),r.setSize([N,C]),r.setElements(n),r.createAtoms({num:l}),k=r.atoms,x=r.outputState,u=M.temperature_control,b=M.temperature,r.useLennardJonesInteraction(M.lennard_jones_forces),r.useCoulombInteraction(M.coulomb_forces),r.useThermostat(u),r.setTargetTemperature(b),e.X&&e.Y?r.initializeAtomsFromProperties(e):(r.initializeAtomsRandomly({temperature:b}),e.relax&&r.relaxToTemperature()),X(),F(),j(),p=0,d=!0,i},i.createRadialBonds=function(e){return r.initializeRadialBonds(e),X(),i},i.createObstacles=function(e){var t=e.x.length;for(var n=0;n<t;n++)for(prop in A){if(!A.hasOwnProperty(prop))continue;e[prop]||(e[prop]=[]),typeof e[prop][n]=="undefined"&&(e[prop][n]=A[prop])}return r.initializeObstacles(e),L=r.obstacles,i},i.setEpsilon=function(e){r.setLJEpsilon(e)},i.setSigma=function(e){r.setLJSigma(e)},i.getEpsilon=function(){return r.getLJEpsilon()},i.getSigma=function(){return r.getLJSigma()},i.getLJCalculator=function(){return r.getLJCalculator()},i.getPotentialFunction=function(e,t,n){return t==null&&(t=0),n=!!n,r.newPotentialCalculator(e,t,n)},i.resetTime=function(){r.setTime(0)},i.getTime=function(){return x?x.time:undefined},i.getTotalMass=function(){return r.getTotalMass()},i.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*s.length)),t==null&&(t=0);var n=i.size(),o=r.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=Math.random()*n[0]-2*o,a=Math.random()*n[1]-2*o,f=r.findMinimumPELocation(e,u,a,0,0,t);if(f&&i.addAtom(e,f[0],f[1],0,0,t))return!0}while(++l<c);return!1},i.addAtom=function(e,t,n,s,o,u){var a=i.size(),f=r.getRadiusOfElement(e);return t<f&&(t=f),t>a[0]-f&&(t=a[0]-f),n<f&&(n=f),n>a[1]-f&&(n=a[1]-f),i.getPotentialFunction(e,0,!1)(t,n)<=0?(r.addAtom(e,t,n,s,o,u),k=r.atoms,r.computeOutputState(),T&&T(),!0):!1},i.get_speed=function(){return n.copy(r.speed,[])},i.get_rate=function(){return U()},i.is_stopped=function(){return l},i.set_lennard_jones_forces=function(e){a=e,r.useLennardJonesInteraction(e)},i.set_coulomb_forces=function(e){f=e,r.useCoulombInteraction(e)},i.get_nodes=function(){return k},i.get_num_atoms=function(){return k[0].length},i.get_obstacles=function(){return L},i.on=function(e,t){return o.on(e,t),i},i.tickInPlace=function(){return o.tick(),i},i.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)H(null,n);return i},i.relax=function(){return r.relaxToTemperature(),i},i.start=function(){return i.resume()},i.resume=function(){return l=!1,d3.timer(H),o.play(),D("play"),i},i.stop=function(){return l=!0,o.stop(),i},i.ke=function(){return x?x.KE:undefined},i.ave_ke=function(){return x?x.KE/i.get_num_atoms():undefined},i.pe=function(){return x?x.PE:undefined},i.ave_pe=function(){return x?x.PE/i.get_num_atoms():undefined},i.speed=function(){return P()},i.pressure=function(){return R()},i.temperature=function(e){return arguments.length?(z(e),i):b},i.size=function(e){return arguments.length?(r.setSize(e),i):r.getSize()},i.set=function(e){W(e)},i.get=function(e){return M[e]},i.setModelListener=function(e){return T=e,i.on("tick",T),i},i.addPropertiesListener=function(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],O[i]||(O[i]=[]),O[i].push(t)},i.serialize=function(e){var t=$.extend({},M);return e&&(t.atoms=r.serialize()),s&&(t.elements=s),t.width=N,t.height=C,t},i}}(),function(){function i(e,t){"use strict";this.buffer=null,this.target=e,this.type=t,this.data=[]}function s(e,t,n){"use strict";var r;while((r=e.exec(t))!==null)n(r)}function o(e){"use strict";var t=Object.prototype.toString.call(e);return t==="[object Array]"||t==="[object Float32Array]"}function u(e){"use strict";var t=Object.prototype.toString.call(e);return t==="[object Number]"||t==="[object Boolean]"}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),energy2d={VERSION:"0.1.0"},energy2d.namespace=function(e){"use strict";var t=e.split("."),n=energy2d,r;t[0]==="energy2d"&&(t=t.slice(1));for(r=0;r<t.length;r+=1)typeof n[t[r]]=="undefined"&&(n[t[r]]={}),n=n[t[r]];return n};var e=e||{};e.glsl={},e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/apply-buoyancy.fs.glsl"]="// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float g;\nuniform float b;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    float t = texture2D(data0_tex, coord).r;\n    // Get average column temperature.\n\n    float avg_t = t;\n    float count = 1.0;\n    vec2 n_coord = coord - dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x > 0.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord -= dx;\n      } else {\n        break;\n      }\n    }\n    n_coord = coord + dx;\n    // Silly while(true) loop (almost).\n    // While loops are not allowed.\n    // For loops with non-constant expressions also.\n    for (int i = 1; i != 0; i++) {\n      if (n_coord.x < 1.0 && texture2D(data1_tex, n_coord).a == 1.0) {\n        avg_t += texture2D(data0_tex, n_coord).r;\n        count += 1.0;\n        n_coord += dx;\n      } else {\n        break;\n      }\n    }\n    avg_t /= count;\n\n    // Update velocity V component.\n    data2.g += (g - b) * t + b * avg_t;\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/apply-u0v0-boundary.fs.glsl"]="// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_p_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_p_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_m_dx.ba);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.ba = 0.5 * (data2_m_dy.ba + data2_p_dx.ba);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    data2.ba = texture2D(data2_tex, coord + dx).ba;\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    data2.ba = texture2D(data2_tex, coord - dx).ba;\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    data2.ba = texture2D(data2_tex, coord + dy).ba;\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    data2.ba = texture2D(data2_tex, coord - dy).ba;\n  }\n  \n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/apply-uv-boundary.fs.glsl"]="// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  // Process corners.\n  // TODO: values from previous step are used for corners.\n  if (coord.x < grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_p_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y < grid.y) {  \n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_p_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x > 1.0 - grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_m_dx.rg);\n  }\n  else if (coord.x < grid.x && coord.y > 1.0 - grid.y) {  \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = 0.5 * (data2_m_dy.rg + data2_p_dx.rg);\n  }\n  // Process boundaries.\n  // Left.\n  else if (coord.x < grid.x) {\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    data2.rg = vec2(data2_p_dx.r, -data2_p_dx.g);\n  }\n  // Right.\n  else if (coord.x > 1.0 - grid.x) {\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    data2.rg = vec2(data2_m_dx.r, -data2_m_dx.g);\n  }\n  // Down.\n  else if (coord.y < grid.y) {\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    data2.rg = vec2(-data2_p_dy.r, data2_p_dy.g);\n  }\n  // Up.\n  else if (coord.y > 1.0 - grid.y) {\n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    data2.rg = vec2(-data2_m_dy.r, data2_m_dy.g);\n  }\n  \n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/basic.vs.glsl"]="varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/conserve-step1.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = 0.0;\n    // Div.\n    data2.a = (data2_p_dy.r - data2_m_dy.r) * i2dx + (data2_p_dx.g - data2_m_dx.g) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n\n"
,e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/conserve-step2.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float s;\nuniform float idxsq;\nuniform float idysq;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // Phi.\n    data2.b = s * ((data2_m_dy.b + data2_p_dy.b) * idxsq + (data2_m_dx.b + data2_p_dx.b) * idysq - data2.a);\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/conserve-step3.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float i2dx;\nuniform float i2dy;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    \n    // U.\n    data2.r -= (data2_p_dy.b - data2_m_dy.b) * i2dx;\n    // V.\n    data2.g -= (data2_p_dx.b - data2_m_dx.b) * i2dy;\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/diffuse.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float dn;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = (data2.ba + hx * (data2_m_dy.rg + data2_p_dy.rg)\n                         + hy * (data2_m_dx.rg + data2_p_dx.rg)) * dn;\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/maccormack-step1.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = data2.ba - tx * (data2_p_dy.bb * data2_p_dy.ba - data2_m_dy.bb * data2_m_dy.ba)\n              - ty * (data2_p_dx.aa * data2_p_dx.ba - data2_m_dx.aa * data2_m_dx.ba);\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/maccormack-step2.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 1.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    \n    vec4 data2_m_dy = texture2D(data2_tex, coord - dy);\n    vec4 data2_p_dy = texture2D(data2_tex, coord + dy);\n    vec4 data2_m_dx = texture2D(data2_tex, coord - dx);\n    vec4 data2_p_dx = texture2D(data2_tex, coord + dx);\n    // Update velocity UV components.\n    data2.rg = 0.5 * (data2.ba + data2.rg) \n            - 0.5 * tx * data2.bb * (data2_p_dy.rg - data2_m_dy.rg)\n            - 0.5 * ty * data2.aa * (data2_p_dx.rg - data2_m_dx.rg);\n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-boundary.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dy).ba;\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dy).ba;\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord - dx).ba;\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      data2.ba = texture2D(data2_tex, coord + dx).ba;\n    } \n  }\n\n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/set-obstacle-velocity.fs.glsl"]="// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n// texture 3: \n// - R: uWind\n// - G: vWind\n// - B: undefined\n// - A: undefined\nuniform sampler2D data3_tex;\n\nuniform vec2 grid;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data2 = texture2D(data2_tex, coord);\n  float fluidity = texture2D(data1_tex, coord).a;\n\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y &&\n      fluidity == 0.0) {\n    \n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n\n    int count = 0;\n\n    if (texture2D(data1_tex, coord - dy).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dy = texture2D(data2_tex, coord - dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_m_dy.r, data2_m_dy.g);\n    } \n    else if (texture2D(data1_tex, coord + dy).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dy = texture2D(data2_tex, coord + dy).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(-data2_p_dy.r, data2_p_dy.g);\n    } \n\n    if (texture2D(data1_tex, coord - dx).a == 1.0) {\n      count += 1;\n      vec2 data2_m_dx = texture2D(data2_tex, coord - dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_m_dx.r, -data2_m_dx.g);\n    } \n    else if (texture2D(data1_tex, coord + dx).a == 1.0) {\n      count += 1;\n      vec2 data2_p_dx = texture2D(data2_tex, coord + dx).rg;\n      data2.rg = texture2D(data3_tex, coord).rg + vec2(data2_p_dx.r, -data2_p_dx.g);\n    } \n\n    if (count == 0) {\n      data2.rg = texture2D(data3_tex, coord).rg;\n    }\n  }\n  \n  gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/uv-to-u0v0.fs.glsl"]="// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data2 = texture2D(data2_tex, coord);\n	data2.ba = data2.rg;\n	gl_FragColor = data2;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/basic.vs.glsl"]="varying vec2 coord;\n\nvoid main() {\n  coord = gl_Vertex.xy * 0.5 + 0.5;\n  gl_Position = vec4(gl_Vertex.xy, 0.0, 1.0);\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/force-flux-t.fs.glsl"]="// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.r = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.r = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.r = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.r = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/force-flux-t0.fs.glsl"]="// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nuniform vec2 grid;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\nuniform float delta_x;\nuniform float delta_y;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  vec2 dx = vec2(grid.x, 0.0);\n  vec2 dy = vec2(0.0, grid.y);\n  if (coord.x < grid.x) {\n    data0.g = texture2D(data0_tex, coord + dx).r\n            + vN * delta_y / data0.a;\n  } else if (coord.x > 1.0 - grid.x) {\n    data0.g = texture2D(data0_tex, coord - dx).r\n            - vS * delta_y / data0.a;\n  } else if (coord.y < grid.y) {\n    data0.g = texture2D(data0_tex, coord + dy).r\n            - vW * delta_x / data0.a;\n  } else if (coord.y > 1.0 - grid.y) {\n    data0.g = texture2D(data0_tex, coord - dy).r\n            + vE * delta_x / data0.a;\n  }\n  gl_FragColor = data0;\n}\n\n",e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/maccormack-step1.fs.glsl"]='// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature.\n      float t_m_dy = texture2D(data0_tex, coord - dy).r;\n      float t_p_dy = texture2D(data0_tex, coord + dy).r;\n      float t_m_dx = texture2D(data0_tex, coord - dx).r;\n      float t_p_dx = texture2D(data0_tex, coord + dx).r;\n      // Velocity.\n      float u_m_dy = texture2D(data2_tex, coord - dy).r;\n      float u_p_dy = texture2D(data2_tex, coord + dy).r;\n      float v_m_dx = texture2D(data2_tex, coord - dx).g;\n      float v_p_dx = texture2D(data2_tex, coord + dx).g;\n      // Update T0.\n      data0.g = data0.r - tx * (u_p_dy * t_p_dy - u_m_dy * t_m_dy)\n                        - ty * (v_p_dx * t_p_dx - v_m_dx * t_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.g = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.g = vS;\n    } else if (coord.y < grid.y) {\n      data0.g = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.g = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n\n',e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/maccormack-step2.fs.glsl"]='// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n// texture 2: \n// - R: u\n// - G: v\n// - B: u0\n// - A: v0\nuniform sampler2D data2_tex;\n\nuniform vec2 grid;\nuniform float tx;\nuniform float ty;\n\n// Boundary conditions uniforms.\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  \n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    \n    float fluidity = texture2D(data1_tex, coord).a;\n    if (fluidity == 1.0) {\n      vec2 dx = vec2(grid.x, 0.0);\n      vec2 dy = vec2(0.0, grid.y);\n\n      // Temperature t0.\n      float t0_m_dy = texture2D(data0_tex, coord - dy).g;\n      float t0_p_dy = texture2D(data0_tex, coord + dy).g;\n      float t0_m_dx = texture2D(data0_tex, coord - dx).g;\n      float t0_p_dx = texture2D(data0_tex, coord + dx).g;\n      // Velocity.\n      float u = texture2D(data2_tex, coord).r;\n      float v = texture2D(data2_tex, coord).g;\n      // Update T.\n      data0.r = 0.5 * (data0.r + data0.g)\n              - 0.5 * tx * u * (t0_p_dy - t0_m_dy)\n              - 0.5 * ty * v * (t0_p_dx - t0_m_dx);\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n\n',e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/solver.fs.glsl"]='// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n// texture 1: \n// - R: q\n// - G: capacity\n// - B: density\n// - A: fluidity\nuniform sampler2D data1_tex;\n\nuniform vec2 grid;\nuniform float hx;\nuniform float hy;\nuniform float inv_timestep;\n\n// Boundary conditions uniforms\nuniform float enforce_temp;\nuniform float vN;\nuniform float vS;\nuniform float vW;\nuniform float vE;\n\nvarying vec2 coord;\n\nvoid main() {\n  vec4 data0 = texture2D(data0_tex, coord);\n  if (coord.x > grid.x && coord.x < 1.0 - grid.x &&\n      coord.y > grid.y && coord.y < 1.0 - grid.y) {\n    vec2 dx = vec2(grid.x, 0.0);\n    vec2 dy = vec2(0.0, grid.y);\n    float tb = data0.b;\n    // Check if tb is NaN. isnan() function is not available\n    // in OpenGL ES GLSL, so use some tricks. IEEE 754 spec defines\n    // that NaN != NaN, however this seems to not work on Windows.\n    // So, also check if the value is outside [-3.4e38, 3.4e38] (3.4e38\n    // is close to 32Float max value), as such values are not expected.\n    if (tb != tb || tb < -3.4e38 || tb > 3.4e38) {\n      vec4 data1 = texture2D(data1_tex, coord);\n      vec4 data0_m_dy = texture2D(data0_tex, coord - dy);\n      vec4 data0_p_dy = texture2D(data0_tex, coord + dy);\n      vec4 data0_m_dx = texture2D(data0_tex, coord - dx);\n      vec4 data0_p_dx = texture2D(data0_tex, coord + dx);\n      float sij = data1.g * data1.b * inv_timestep;\n      float rij = data0.a;\n      float axij = hx * (rij + data0_m_dy.a);\n      float bxij = hx * (rij + data0_p_dy.a);\n      float ayij = hy * (rij + data0_m_dx.a);\n      float byij = hy * (rij + data0_p_dx.a);\n      data0.r = (data0.g * sij + data1.r\n                 + axij * data0_m_dy.r\n                 + bxij * data0_p_dy.r\n                 + ayij * data0_m_dx.r\n                 + byij * data0_p_dx.r)\n                 / (sij + axij + bxij + ayij + byij);\n    } else {\n      data0.r = tb;\n    }\n  } else if (enforce_temp == 1.0) {\n    // "temperature at border" boundary conditions are\n    // integrated into this shader.\n    if (coord.x < grid.x) {\n      data0.r = vN;\n    } else if (coord.x > 1.0 - grid.x) {\n      data0.r = vS;\n    } else if (coord.y < grid.y) {\n      data0.r = vW;\n    } else if (coord.y > 1.0 - grid.y) {\n      data0.r = vE;\n    }\n  }\n  gl_FragColor = data0;\n}\n\n',e.glsl["src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/t-to-t0.fs.glsl"]="// texture 0: \n// - R: t\n// - G: t0\n// - B: tb\n// - A: conductivity\nuniform sampler2D data0_tex;\n\nvarying vec2 coord;\n\nvoid main() {\n	vec4 data0 = texture2D(data0_tex, coord);\n	data0.g = data0.r;\n	gl_FragColor = data0;\n}\n\n",e.glsl["src/lab/views/energy2d/heatmap-webgl-glsl/basic.vs.glsl"]="varying vec2 coord;\n\nvoid main() {\n  coord = gl_TexCoord.xy;\n  gl_Position = vec4(gl_Vertex.xyz, 1.0);\n}\n\n",e.glsl["src/lab/views/energy2d/heatmap-webgl-glsl/temp-renderer.fs.glsl"]="// Provided textur contains temperature data in R channel.\nuniform sampler2D heatmap_tex;\nuniform sampler2D palette_tex;\n\nuniform float max_temp;\nuniform float min_temp;\n\nvarying vec2 coord;\n\nvoid main() {\n  float temp = texture2D(heatmap_tex, coord).r;\n  float scaled_temp = (temp - min_temp) / (max_temp - min_temp);\n  gl_FragColor = texture2D(palette_tex, vec2(scaled_temp, 0.5));\n}\n\n",e.glsl["src/lab/views/energy2d/vectormap-webgl-glsl/vectormap.fs.glsl"]="uniform vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n\n",e.glsl["src/lab/views/energy2d/vectormap-webgl-glsl/vectormap.vs.glsl"]="// Provided texture contains vector data in RG channels.\nattribute vec2 origin;\n\nuniform sampler2D vectormap_tex;\nuniform float base_length;\nuniform float vector_scale;\nuniform vec2 scale;\n\nvoid main() {\n  // Read vector which should be visualized.\n  vec2 vec = texture2D(vectormap_tex, gl_TexCoord.xy).xy;\n  vec.y = -vec.y;\n\n  if (length(vec) < 1e-15) {\n    // Do not draw to small vectors.\n    // Set position outside [-1, 1] region, which is rendered.\n    gl_Position = vec4(2.0);\n    return;\n  }\n\n  // Test which part of the vector arrow is being processed. \n  if (gl_Vertex.x == 0.0 && gl_Vertex.y == 0.0) {\n    // Origin of the arrow is being processed.\n    // Just transform its coordinates.\n    gl_Position = vec4(origin, 0.0, 1.0);\n  } else {\n    // Other parts of arrow are being processed.\n    // Set proper length of the arrow, rotate it, scale\n    // and finally transform.\n\n    // Calculate arrow length.\n    vec2 new_pos = gl_Vertex.xy;\n    new_pos.x += base_length + vector_scale * length(vec);\n\n    // Calculate angle between reference arrow (horizontal).\n    vec = normalize(vec);\n    float angle = acos(dot(vec, vec2(1.0, 0.0)));\n    if (vec.y < 0.0) {\n      angle = -angle;\n    }\n    // Prepare rotation matrix.\n    // See: http://en.wikipedia.org/wiki/Rotation_matrix\n    mat2 rot_m = mat2(\n      cos(angle), sin(angle),\n     -sin(angle), cos(angle)\n    );\n    // Rotate.\n    new_pos = rot_m * new_pos;\n    // Scale.\n    new_pos = new_pos * scale;\n    // Transform.\n    gl_Position = vec4(new_pos + origin, 0.0, 1.0);\n  }\n}\n\n";var t=function(e,n){var r=t.resolve(e,n||"/"),i=t.modules[r];if(!i)throw new Error("Failed to resolve module "+e+", tried "+r);var s=i._cached?i._cached:i();return s};t.paths=[],t.modules={},t.extensions=[".js",".coffee"],t._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},t.resolve=function(){return function(e,n){function u(e){if(t.modules[e])return e;for(var n=0;n<t.extensions.length;n++){var r=t.extensions[n];if(t.modules[e+r])return e+r}}function a(e){e=e.replace(/\/+$/,"");var n=e+"/package.json";if(t.modules[n]){var i=t.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(e,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(e,s));if(o)return o}else if(i.main){var o=u(r.resolve(e,i.main));if(o)return o}}return u(e+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(t._core[e])return e;var r=t.modules.path();n=r.resolve("/",n);var i=n||"/";if(e.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,e))||a(r.resolve(i,e));if(s)return s}var o=f(e,i);if(o)return o;throw new Error("Cannot find module '"+e+"'")}}(),t.alias=function(e,n){var r=t.modules.path(),i=null;try{i=t.resolve(e+"/package.json","/")}catch(s){i=t.resolve(e,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(t.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);t.modules[n+l]=t.modules[o+l]}else f===o&&(t.modules[n]=t.modules[o])}},t.define=function(e,n){var r=t._core[e]?"":t.modules.path().dirname(e),i=function(e){return t(e,r)};i.resolve=function(e){return t.resolve(e,r)},i.modules=t.modules,i.define=t.define;var s={exports:{}};t.modules[e]=function(){return t.modules[e]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,e),t.modules[e]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(e){if(e==="evals")return t("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),t.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),t.define("/arrays/arrays.js",function(e,t,n,r,i){var s;s=n.arrays={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r}}),t.define("/physics-solvers/heat-solver.js",function(e,t,n,r,i){var s=e("../arrays/arrays.js").arrays,o=5;n.makeHeatSolver=function(e){"use strict";var t=e.getGridWidth(),n=e.getGridHeight(),r=e.getModelOptions(),i=r.timestep,u=r.boundary,a=r.model_width/e.getGridWidth(),f=r.model_height/e.getGridHeight(),l=o,c=e.getConductivityArray(),h=e.getCapacityArray(),p=e.getDensityArray(),d=e.getUVelocityArray(),v=e.getVVelocityArray(),m=e.getBoundaryTemperatureArray(),g=e.getFluidityArray(),y=s.create(t*n,0,e.getArrayType()),b=t-1,w=n-1,E=t-2,S=n-2,x=function(e){var r,i,s,o,l,h,p,d;if(u.temperature_at_border){r=u.temperature_at_border.upper,i=u.temperature_at_border.lower,s=u.temperature_at_border.left,o=u.temperature_at_border.right;for(l=0;l<t;l+=1)p=l*t,e[p]=r,e[p+w]=i;for(h=0;h<n;h+=1)e[h]=s,e[b*t+h]=o}else{if(!u.flux_at_border)throw new Error("Heat solver: wrong boundary settings definition.");r=u.flux_at_border.upper,i=u.flux_at_border.lower,s=u.flux_at_border.left,o=u.flux_at_border.right;for(l=0;l<t;l+=1)p=l*t,d=p+w,e[p]=e[p+1]+r*f/c[p],e[d]=e[p+S]-i*f/c[d];for(h=0;h<n;h+=1)e[h]=e[t+h]-s*a/c[h],e[b*t+h]=e[E*t+h]+o*a/c[b*t+h]}},T=function(e){var n=.5*i/a,r=.5*i/f,s,o,u,l,c,h,p,m;for(s=1;s<b;s+=1){u=s*t;for(o=1;o<w;o+=1)l=u+o,h=l-t,c=l+t,m=l-1,p=l+1,g[l]&&(y[l]=e[l]-n*(d[c]*e[c]-d[h]*e[h])-r*(v[p]*e[p]-v[m]*e[m]))}x(y);for(s=1;s<b;s+=1){u=s*t;for(o=1;o<w;o+=1)l=u+o,g[l]&&(h=l-t,c=l+t,m=l-1,p=l+1,e[l]=.5*(e[l]+y[l])-.5*n*d[l]*(y[c]-y[h])-.5*r*v[l]*(y[p]-y[m]))}x(e)};return{solve:function(e,n,r){var o=.5/(a*a),u=.5/(f*f),d=1/i,v,g,E,S,N,C,k,L,A,O,M,_,D,P,H;s.copy(n,y);for(k=0;k<l;k+=1){for(L=1;L<b;L+=1){O=L*t;for(A=1;A<w;A+=1)M=O+A,isNaN(m[M])?(D=M-t,_=M+t,H=M-1,P=M+1,g=h[M]*p[M]*d,v=c[M],E=o*(v+c[D]),S=o*(v+c[_]),N=u*(v+c[H]),C=u*(v+c[P]),n[M]=(y[M]*g+r[M]+E*n[D]+S*n[_]+N*n[H]+C*n[P])/(g+E+S+N+C)):n[M]=m[M]}x(n)}e&&T(n)}}}}),t.define("/physics-solvers-gpu/heat-solver-gpu.js",function(t,n,r,i,s){var o=t("../arrays/arrays.js").arrays,u=10;r.makeHeatSolverGPU=function(t){"use strict";var n=energy2d.utils.gpu,r=energy2d.utils.gpu.gpgpu,i=e.glsl,s="src/lab/models/energy2d/engine/physics-solvers-gpu/heat-solver-glsl/",o=i[s+"basic.vs.glsl"],a=i[s+"solver.fs.glsl"],f=i[s+"force-flux-t.fs.glsl"],l=i[s+"force-flux-t.fs.glsl"],c=i[s+"t-to-t0.fs.glsl"],h=i[s+"maccormack-step1.fs.glsl"],p=i[s+"maccormack-step2.fs.glsl"],d=new n.Shader(o,a),v=new n.Shader(o,f),m=new n.Shader(o,l),g=new n.Shader(o,c),y=new n.Shader(o,h),b=new n.Shader(o,p),w=t.getGridWidth(),E=t.getGridHeight(),S=t.getModelOptions(),x=S.timestep,T=S.boundary,N=S.model_width/t.getGridWidth(),C=S.model_height/t.getGridHeight(),k=u,L=t.getSimulationTexture(0),A=t.getSimulationTexture(1),O=t.getSimulationTexture(2),M=[L,A,O],_=[L,A],D=[L],P=[1/E,1/w],H=function(){var e;e={data0_tex:0,data1_tex:1,grid:P,enforce_temp:0,hx:.5/(N*N),hy:.5/(C*C),inv_timestep:1/x},d.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:P,enforce_temp:0,tx:.5*x/N,ty:.5*x/C},y.uniforms(e),b.uniforms(e),T.temperature_at_border?(e={enforce_temp:1,vN:T.temperature_at_border.upper,vS:T.temperature_at_border.lower,vW:T.temperature_at_border.left,vE:T.temperature_at_border.right},d.uniforms(e),y.uniforms(e),b.uniforms(e)):T.flux_at_border&&(e={data0_tex:0,grid:P,vN:T.flux_at_border.upper,vS:T.flux_at_border.lower,vW:T.flux_at_border.left,vE:T.flux_at_border.right,delta_x:N,delta_y:C},v.uniforms(e),m.uniforms(e))},B=function(){r.executeProgram(y,M,L),T.flux_at_border&&r.executeProgram(m,D,L),r.executeProgram(b,M,L),T.flux_at_border&&r.executeProgram(v,D,L)},j={solve:function(e){var t;r.executeProgram(g,D,L);for(t=0;t<k;t+=1)r.executeProgram(d,_,L),T.flux_at_border&&r.executeProgram(v,D,L);e&&B(),r.tryFinish()}};return H(),j}}),t.define("/physics-solvers/fluid-solver.js",function(e,t,n,r,i){var s=e("../arrays/arrays.js").arrays,o=5,u=0,a=0,f=1;n.makeFluidSolver=function(e){"use strict";var t=e.getGridWidth(),n=e.getGridHeight(),r=e.getModelOptions(),i=r.timestep,l=r.thermal_buoyancy,c=r.buoyancy_approximation,h=r.background_viscosity,p=r.model_width/e.getGridWidth(),d=r.model_height/e.getGridHeight(),v=o,m=u,g=e.getTemperatureArray(),y=e.getFluidityArray(),b=e.getUWindArray(),w=e.getVWindArray(),E=e.getArrayType(),S=s.create(t*n,0,E),x=s.create(t*n,0,E),T=.5/p,N=.5/d,C=1/(p*p),k=1/(d*d),L=t-1,A=n-1,O=t-2,M=n-2,_=function(e,n){var r=e===1,i=e===2,s=L*t,o=O*t,u,a,f,l,c,h,p;for(u=1;u<L;u+=1)f=u*t,l=f+1,c=f+A,h=f+M,n[f]=i?-n[l]:n[l],n[c]=i?-n[h]:n[h];for(a=1;a<A;a+=1)p=t+a,n[a]=r?-n[p]:n[p],n[s+a]=r?-n[o+a]:n[o+a];n[0]=.5*(n[t]+n[1]),n[s]=.5*(n[o]+n[s+1]),n[A]=.5*(n[t+A]+n[M]),n[s+A]=.5*(n[o+A]+n[s+M])},D=function(e,n){var r=0,i,s,o,u,a,f,l,c,h,p;for(o=1;o<L;o+=1){a=o*t;for(u=1;u<A;u+=1)f=a+u,c=f-t,l=f+t,p=f-1,h=f+1,y[f]||(i=b[f],s=w[f],r=0,y[c]?(r+=1,e[f]=i-e[c],n[f]=s+n[c]):y[l]&&(r+=1,e[f]=i-e[l],n[f]=s+n[l]),y[p]?(r+=1,e[f]=i+e[p],n[f]=s-n[p]):y[h]&&(r+=1,e[f]=i+e[h],n[f]=s-n[h]),r===0&&(e[f]=i,n[f]=s))}},P=function(e){var n,r,i,s,o,u,a,f;for(n=1;n<L;n+=1){i=n*t;for(r=1;r<A;r+=1)s=i+r,y[s]||(u=s-t,o=s+t,f=s-1,a=s+1,y[u]?e[s]=e[u]:y[o]&&(e[s]=e[o]),y[f]?e[s]=e[f]:y[a]&&(e[s]=e[a]))}},H=function(e,r){var i=0,s=n,o=0,u,a;for(u=r-1;u>0;u-=1){a=e*t+u;if(!y[a]){i=u;break}}for(u=r+1;u<n;u+=1){a=e*t+u;if(!y[a]){s=u;break}}for(u=i;u<s;u+=1)a=e*t+u,o+=g[a];return o/(s-i)},B=function(e){var n=m*i,r=l*i,s,o,u,h,p;switch(c){case a:s=function(e){var t=0,n=e.length,r;for(r=0;r<n;r+=1)t+=e[r];return t/n}(g);for(o=1;o<L;o+=1){h=o*t;for(u=1;u<A;u+=1)p=h+u,y[p]&&(e
[p]+=(n-r)*g[p]+r*s)}break;case f:for(o=1;o<L;o+=1){h=o*t;for(u=1;u<A;u+=1)p=h+u,y[p]&&(s=H(o,u),e[p]+=(n-r)*g[p]+r*s)}}},j=function(e,n,r,i){var s=.5/(C+k),o,u,a,f,l,c,h,p,d;for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,i[l]=(e[c]-e[h])*T+(n[p]-n[d])*N,r[l]=0)}_(0,i),_(0,r),P(i),P(r);for(o=0;o<v;o+=1)for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,r[l]=s*((r[h]+r[c])*C+(r[d]+r[p])*k-i[l]))}for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,e[l]-=(r[c]-r[h])*T,n[l]-=(r[p]-r[d])*N)}_(1,e),_(2,n)},F=function(e,n,r){var o=i*h*C,u=i*h*k,a=1/(1+2*(o+u)),f,l,c,p,d,m,g,b,w;s.copy(r,n);for(f=0;f<v;f+=1){for(l=1;l<L;l+=1){p=l*t;for(c=1;c<A;c+=1)d=p+c,y[d]&&(g=d-t,m=d+t,w=d-1,b=d+1,r[d]=(n[d]+o*(r[g]+r[m])+u*(r[w]+r[b]))*a)}_(e,r)}},I=function(e,n,r){var o=.5*i/p,u=.5*i/d,a,f,l,c,h,v,m,g;for(a=1;a<L;a+=1){l=a*t;for(f=1;f<A;f+=1)c=l+f,y[c]&&(v=c-t,h=c+t,g=c-1,m=c+1,r[c]=n[c]-o*(S[h]*n[h]-S[v]*n[v])-u*(x[m]*n[m]-x[g]*n[g]))}_(e,r);for(a=1;a<L;a+=1){l=a*t;for(f=1;f<A;f+=1)c=l+f,y[c]&&(v=c-t,h=c+t,g=c-1,m=c+1,n[c]=.5*(n[c]+r[c])-.5*o*S[c]*(r[h]-r[v])-.5*u*x[c]*(r[m]-r[g]))}s.copy(n,r),_(e,r)},q=function(e,t,n){I(e,t,n)};return{solve:function(e,t){l!==0&&B(t),D(e,t),h>0&&(F(1,S,e),F(2,x,t),j(e,t,S,x),D(e,t)),s.copy(e,S),s.copy(t,x),q(1,S,e),q(2,x,t),j(e,t,S,x),D(e,t)}}}}),t.define("/physics-solvers-gpu/fluid-solver-gpu.js",function(t,n,r,i,s){var o=t("../arrays/arrays.js").arrays,u=10,a=0,f=0,l=1;r.makeFluidSolverGPU=function(t){"use strict";var n=energy2d.utils.gpu,r=energy2d.utils.gpu.gpgpu,i=e.glsl,s="src/lab/models/energy2d/engine/physics-solvers-gpu/fluid-solver-glsl/",o=i[s+"basic.vs.glsl"],f=i[s+"maccormack-step1.fs.glsl"],l=i[s+"maccormack-step2.fs.glsl"],c=i[s+"apply-uv-boundary.fs.glsl"],h=i[s+"apply-u0v0-boundary.fs.glsl"],p=i[s+"set-obstacle-boundary.fs.glsl"],d=i[s+"set-obstacle-velocity.fs.glsl"],v=i[s+"uv-to-u0v0.fs.glsl"],m=i[s+"conserve-step1.fs.glsl"],g=i[s+"conserve-step2.fs.glsl"],y=i[s+"conserve-step3.fs.glsl"],b=i[s+"diffuse.fs.glsl"],w=i[s+"apply-buoyancy.fs.glsl"],E=new n.Shader(o,f),S=new n.Shader(o,l),x=new n.Shader(o,c),T=new n.Shader(o,h),N=new n.Shader(o,p),C=new n.Shader(o,d),k=new n.Shader(o,v),L=new n.Shader(o,m),A=new n.Shader(o,g),O=new n.Shader(o,y),M=new n.Shader(o,b),_=new n.Shader(o,w),D=t.getSimulationTexture(0),P=t.getSimulationTexture(1),H=t.getSimulationTexture(2),B=t.getSimulationTexture(3),j=t.getGridWidth(),F=t.getGridHeight(),I=t.getModelOptions(),q=I.timestep,R=I.thermal_buoyancy,U=I.buoyancy_approximation,z=I.background_viscosity,W=I.model_width/t.getGridWidth(),X=I.model_height/t.getGridHeight(),V=u,$=a,J=.5/W,K=.5/X,Q=1/(W*W),G=1/(X*X),Y=.5/(Q+G),Z=q*z*Q,et=q*z*G,tt=1/(1+2*(Z+et)),nt=$*q,rt=R*q,it=[1/F,1/j],st=[H],ot=[P,H],ut=[D,P,H],at=[P,H,B],ft=function(){var e;e={data1_tex:0,data2_tex:1,grid:it,tx:.5*q/W,ty:.5*q/X},E.uniforms(e),S.uniforms(e),e={data2_tex:0,grid:it},x.uniforms(e),T.uniforms(e),e={data1_tex:0,data2_tex:1,grid:it},N.uniforms(e),e={data1_tex:0,data2_tex:1,data3_tex:2,grid:it},C.uniforms(e),e={data1_tex:0,data2_tex:1,grid:it,i2dx:J,i2dy:K},L.uniforms(e),O.uniforms(e),e={data1_tex:0,data2_tex:1,grid:it,s:Y,idxsq:Q,idysq:G},A.uniforms(e),e={data1_tex:0,data2_tex:1,grid:it,hx:Z,hy:et,dn:tt},M.uniforms(e),e={data0_tex:0,data1_tex:1,data2_tex:2,grid:it,g:nt,b:rt},_.uniforms(e)},lt=function(){r.executeProgram(_,ut,H)},ct=function(){r.executeProgram(E,ot,H),r.executeProgram(x,st,H),r.executeProgram(S,ot,H),r.executeProgram(x,st,H)},ht=function(){var e;r.executeProgram(L,ot,H),r.executeProgram(T,st,H),r.executeProgram(N,ot,H);for(e=0;e<V;e+=1)r.executeProgram(A,ot,H);r.executeProgram(O,ot,H),r.executeProgram(x,st,H)},pt=function(){var e;r.executeProgram(k,st,H);for(e=0;e<V;e+=1)r.executeProgram(M,ot,H),r.executeProgram(x,st,H)},dt=function(){r.executeProgram(C,at,H)},vt=function(){r.executeProgram(k,st,H)},mt={solve:function(){R!==0&&lt(),dt(),z>0&&(pt(),ht(),dt()),vt(),ct(),ht(),dt(),r.tryFinish()}};return ft(),mt}}),t.define("/physics-solvers/ray-solver.js",function(e,t,n,r,i){var s=e("../arrays/arrays.js").arrays,o=e("../photon.js").Photon;n.makeRaySolver=function(e){"use strict";var t=e.getGridWidth(),n=e.getGridHeight(),r=e.getModelOptions(),i=r.model_width,s=r.model_height,u=r.timestep,a=Math.PI-r.sun_angle,f=r.solar_ray_count,l=r.solar_power_density,c=r.solar_power_density,h=r.solar_ray_speed,p=r.photon_emission_interval,d=r.model_width/e.getGridWidth(),v=r.model_height/e.getGridHeight(),m=e.getPowerArray(),g=e.getPartsArray(),y=e.getPhotonsArray(),b=t-1,w=n-1,E=t-2,S=n-2,x=function(){var e=0;while(e<y.length)y[e]===undefined?y.splice(e,1):e+=1},T=function(){var e,t,n;for(e=0,t=y.length;e<t;e+=1)y[e].isContained(0,i,0,s)||(y[e]=undefined);x()},N=function(e,t){var n,r,i;for(n=0,r=g.length;n<r;n+=1)if(g[n].contains(e,t))return!0;return!1},C=function(e,t){var n=Math.floor(i/e),r=Math.floor(s/t),u,f,l;if(a>=0&&a<.5*Math.PI){f=0;for(l=1;l<=n;l+=1)u=e*l,N(u,f)||y.push(new o(u,f,c,h,a));u=0;for(l=0;l<=r;l+=1)f=t*l,N(u,f)||y.push(new o(u,f,c,h,a))}else if(a<0&&a>=-0.5*Math.PI){f=s;for(l=1;l<=n;l+=1)u=e*l,N(u,f)||y.push(new o(u,f,c,h,a));u=0;for(l=0;l<=r;l+=1)f=s-t*l,N(u,f)||y.push(new o(u,f,c,h,a))}else if(a<Math.PI+.001&&a>=.5*Math.PI){f=0;for(l=0;l<=n;l+=1)u=i-e*l,N(u,f)||y.push(new o(u,f,c,h,a));u=i;for(l=1;l<=r;l+=1)f=t*l,N(u,f)||y.push(new o(u,f,c,h,a))}else if(a>=-Math.PI&&a<-0.5*Math.PI){f=s;for(l=0;l<=n;l+=1)u=i-e*l,N(u,f)||y.push(new o(u,f,c,h,a));u=i;for(l=1;l<=r;l+=1)f=s-t*l,N(u,f)||y.push(new o(u,f,c,h,a))}};return{solve:function(){var e=1/(u*p),t=1/d,r=1/v,i,s,o,a,f,l,c,h;for(f=0,c=y.length;f<c;f+=1){i=y[f],i.move(u);for(l=0,h=g.length;l<h;l+=1){s=g[l];if(s.reflect(i,u))break;if(s.absorb(i)){o=Math.max(Math.min(Math.round(i.x*t),b),0),a=Math.max(Math.min(Math.round(i.y*r),w),0),m[o*n+a]=i.energy*e,y[f]=undefined;break}}}x(),T()},radiate:function(){var t,n,r;for(n=0,r=g.length;n<r;n+=1)t=g[n],t.emissivity>0&&t.radiate(e)},sunShine:function(){var e,t,n;if(a<0)return;e=Math.abs(Math.sin(a)),t=Math.abs(Math.cos(a)),n=e*s<t*i?s/t:i/e,n/=f,C(n/e,n/t)}}}}),t.define("/photon.js",function(e,t,n,r,i){var s=e("./utils/math.js").hypot,o=e("./utils/shape.js").Line,u=e("./utils/shape.js").Rectangle,a=n.Photon=function(e,t,n,r,i){"use strict";this.x=e,this.y=t,this.energy=n,this.c=r,i!==undefined&&(this.vx=Math.cos(i)*r,this.vy=Math.sin(i)*r)};a.prototype.isContained=function(e,t,n,r){"use strict";return this.x>=e&&this.x<=t&&this.y>=n&&this.y<=r},a.prototype.move=function(e){"use strict";this.x+=this.vx*e,this.y+=this.vy*e},a.prototype.reflectFromLine=function(e,t){"use strict";var n=this.x,r=this.y,i=this.x-this.vx*t,u=this.y-this.vy*t,a=new o(n,r,i,u),f=this.vx,l=this.vy,c,h,p,d,v;return a.intersectsLine(e)?(n=e.x1,r=e.y1,i=e.x2,u=e.y2,c=1/s(n-i,r-u),h=(u-r)*c,p=(i-n)*c,d=f*p+l*h,v=l*p-f*h,this.vx=d*p+v*h,this.vy=d*h-v*p,!0):!1},a.prototype.reflectFromRectangle=function(e,t){"use strict";var n=e.x,r=e.y,i=e.x+e.width,s=e.y+e.height,o,u;o=this.vx*t,this.x-o<n?this.vx=-Math.abs(this.vx):this.x-o>i&&(this.vx=Math.abs(this.vx)),u=this.vy*t,this.y-u<r?this.vy=-Math.abs(this.vy):this.y-u>s&&(this.vy=Math.abs(this.vy))},a.prototype.reflectFromPolygon=function(e,t){"use strict";var n=new o,r,i;for(r=0,i=e.count-1;r<i;r+=1){n.x1=e.x_coords[r],n.y1=e.y_coords[r],n.x2=e.x_coords[r+1],n.y2=e.y_coords[r+1];if(this.reflectFromLine(n,t))return}n.x1=e.x_coords[e.count-1],n.y1=e.y_coords[e.count-1],n.x2=e.x_coords[0],n.y2=e.y_coords[0],this.reflectFromLine(n,t)},a.prototype.reflect=function(e,t){"use strict";return e.contains(this.x,this.y)?(e instanceof u?this.reflectFromRectangle(e,t):this.reflectFromPolygon(e.polygonize(),t),!0):!1}}),t.define("/utils/math.js",function(e,t,n,r,i){n.hypot=function(e,t){"use strict";var n;return e=Math.abs(e),t=Math.abs(t),n=Math.min(e,t),e=Math.max(e,t),t=n,e*Math.sqrt(1+t/e*(t/e))}}),t.define("/utils/shape.js",function(e,t,n,r,i){n.pointInsidePolygon=function(e,t,n,r,i){"use strict";var s=0,o,u;for(o=0,u=e-1;o<e;u=o,o+=1)n[o]>i!=n[u]>i&&r<(t[u]-t[o])*(i-n[o])/(n[u]-n[o])+t[o]&&(s=!s);return!!s};var s=n.Line=function(e,t,n,r){"use strict";this.x1=e,this.y1=t,this.x2=n,this.y2=r};s.prototype.intersectsLine=function(e){"use strict";var t,n={x:this.x1,y:this.y1},r={x:this.x2,y:this.y2},i={x:e.x1,y:e.y1},s={x:e.x2,y:e.y2},o=(s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x),u=(r.x-n.x)*(n.y-i.y)-(r.y-n.y)*(n.x-i.x),a=(s.y-i.y)*(r.x-n.x)-(s.x-i.x)*(r.y-n.y),f,l;return a!==0?(f=o/a,l=u/a,0<=f&&f<=1&&0<=l&&l<=1?t=!0:t=!1):o===0||u===0?t=!0:t=!1,t};var o=n.Polygon=function(e,t,n){"use strict";this.count=e,this.x_coords=t,this.y_coords=n};o.prototype.polygonize=function(){"use strict";return this},o.prototype.contains=function(e,t){"use strict";var n=this.x_coords,r=this.y_coords,i=this.count,s=0,o,u;for(o=0,u=i-1;o<i;u=o,o+=1)r[o]>t!=r[u]>t&&e<(n[u]-n[o])*(t-r[o])/(r[u]-r[o])+n[o]&&(s=!s);return!!s};var u=n.Rectangle=function(e,t,n,r){"use strict";this.x=e,this.y=t,this.width=n,this.height=r,this.polygon_cache=undefined};u.prototype.polygonize=function(){"use strict";var e,t,n,r;return this.polygon_cache||(e=this.x,t=this.y,n=this.width,r=this.height,this.polygon_cache=new o(4,[e,e+n,e+n,e],[t,t,t+r,t+r])),this.polygon_cache},u.prototype.contains=function(e,t){"use strict";return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};var a=function(e,t,n,r,i){"use strict";var s=new Array(i),u=new Array(i),a=2*Math.PI/i,f,l;for(l=0;l<i;l+=1)f=a*l,s[l]=e+n*Math.cos(f),u[l]=t+r*Math.sin(f);return new o(i,s,u)},f=n.Ellipse=function(e,t,n,r){"use strict";this.x=e,this.y=t,this.a=n,this.b=r,this.polygon_cache=undefined};f.prototype.POLYGON_SEGMENTS=50,f.prototype.polygonize=function(){"use strict";return this.polygon_cache||(this.polygon_cache=a(this.x,this.y,this.a*.5,this.b*.5,this.POLYGON_SEGMENTS)),this.polygon_cache},f.prototype.contains=function(e,t){"use strict";var n=e-this.x,r=t-this.y,i=this.a*.5,s=this.b*.5;return n*n/(i*i)+r*r/(s*s)<=1};var l=n.Ring=function(e,t,n,r){"use strict";this.x=e,this.y=t,this.inner=n,this.outer=r,this.polygon_cache=undefined};l.prototype.POLYGON_SEGMENTS=50,l.prototype.polygonize=function(){"use strict";return this.polygon_cache||(this.polygon_cache=a(this.x,this.y,this.outer*.5,this.outer*.5,this.POLYGON_SEGMENTS)),this.polygon_cache},l.prototype.polygonizeInner=function(){"use strict";var e,t,n,r,i,s,o,u,f,l;return this.polygon_cache_inner||(this.polygon_cache_inner=a(this.x,this.y,this.inner*.5,this.inner*.5,this.POLYGON_SEGMENTS)),this.polygon_cache_inner},l.prototype.contains=function(e,t){"use strict";var n=e-this.x,r=t-this.y,i=this.outer*.5,s=this.outer*.5,o=this.inner*.5,u=this.inner*.5;return n*n/(i*i)+r*r/(s*s)<=1&&n*n/(o*o)+r*r/(u*u)>=1}}),t.define("/part.js",function(e,t,n,r,i){var s=e("./default-config.js"),o=e("./constants.js"),u=e("./photon.js").Photon,a=e("./utils/math.js").hypot,f=e("./utils/shape.js"),l=e("./utils/shape.js").Line,c=e("./utils/shape.js").Polygon,h=e("./utils/shape.js").Rectangle,p=e("./utils/shape.js").Ellipse,d=e("./utils/shape.js").Ring,v=.5,m=20,g=100,y=Math.sin(Math.PI/6),b=Math.cos(Math.PI/6),w=Math.sin(Math.PI/3),E=Math.cos(Math.PI/3),S=n.Part=function(e){"use strict";var t,n,r;e=s.fillWithDefaultValues(e,s.DEFAULT_VALUES.part);if(e.rectangle)r=this.rectangle=e.rectangle,this.shape=new h(r.x,r.y,r.width,r.height);else if(e.ellipse)r=this.ellipse=e.ellipse,this.shape=new p(r.x,r.y,r.a,r.b);else if(e.ring)r=this.ring=e.ring,this.shape=new d(r.x,r.y,r.inner,r.outer);else{if(!e.polygon)throw new Error("Part: shape not defined.");this.polygon=e.polygon;if(typeof this.polygon.vertices=="string"){t=this.polygon.count,this.polygon.vertices=this.polygon.vertices.split(", "),this.polygon.x_coords=[],this.polygon.y_coords=[];if(t*2!==this.polygon.vertices.length)throw new Error("Part: polygon contains different vertices count than declared in the count parameter.");for(n=0;n<t;n+=1)this.polygon.x_coords[n]=this.polygon.vertices[2*n]=Number(this.polygon.vertices[2*n]),this.polygon.y_coords[n]=this.polygon.vertices[2*n+1]=Number(this.polygon.vertices[2*n+1]);this.shape=new c(t,this.polygon.x_coords,this.polygon.y_coords)}}this.thermal_conductivity=e.thermal_conductivity,this.specific_heat=e.specific_heat,this.density=e.density,this.temperature=e.temperature,this.constant_temperature=e.constant_temperature,this.power=e.power,this.wind_speed=e.wind_speed,this.wind_angle=e.wind_angle,this.transmission=e.transmission,this.reflection=e.reflection,this.absorption=e.absorption,this.emissivity=e.emissivity,this.visible=e.visible,this.filled=e.filled,this.color=e.color,this.texture=e.texture,this.label=e.label};S.prototype.getLabel=function(){"use strict";var e=this.label,t;return e==="%temperature"?t=this.temperature+" °C":e==="%density"?t=this.density+" kg/m³":e==="%specific_heat"?t=this.specific_heat+" J/(kg×°C)":e==="%thermal_conductivity"?t=this.thermal_conductivity+" W/(m×°C)":e==="%power_density"?t=this.power+" W/m³":e==="%area"?this.rectangle?t=this.rectangle.width*this.rectangle.height+" m²":this.ellipse&&(t=this.ellipse.width*this.ellipse.height*.25*Math.PI+" m²"):e==="%width"?this.rectangle?t=this.rectangle.width+" m":this.ellipse&&(t=this.ellipse.width+" m"):e==="%height"?this.rectangle?t=this.rectangle.height+" m":this.ellipse&&(t=this.ellipse.height+" m"):t=e,t},S.prototype.getGridCells=function(e,t,n,r){"use strict";var i=e-1,s=t-1,o=i/n,u=s/r,a=function(e){var n,r,a,f,l,c,h,p=[];a=Math.min(Math.max(Math.ceil(e.x*o),0),i),f=Math.min(Math.max(Math.ceil(e.y*u),0),s),l=Math.min(Math.max(Math.floor((e.x+e.width)*o),0),i),c=Math.min(Math.max(Math.floor((e.y+e.height)*u),0),s),p=new Array((l-a+1)*(c-f+1)),h=0;for(n=a;n<=l;n+=1)for(r=f;r<=c;r+=1)p[h+=1]=n*t+r;return p},l=function(e){var n=e.x*o,r=e.y*u,a=e.a*.5*o,f=e.b*.5*u,l,c,h,p,d,v,m,g,y=[];h=Math.min(Math.max(Math.ceil(n-a),0),i),p=Math.min(Math.max(Math.floor(n+a),0),i),y=[],g=0;for(c=h;c<=p;c+=1){l=Math.sqrt(1-(c-n)*(c-n)/(a*a)),v=Math.min(Math.max(Math.ceil(r-f*l),0),s),m=Math.min(Math.max(Math.floor(r+f*l),0),s);for(d=v;d<=m;d+=1)y[g+=1]=c*t+d}return y},c=function(e){var n=e.x*o,r=e.y*u,a=e.outer*.5*o,f=e.outer*.5*u,l=e.inner*.5*o,c=e.inner*.5*u,h,p,d,v,m,g,y,b,w,E,S=[];p=Math.min(Math.max(Math.ceil(n-a),0),i),d=Math.min(Math.max(Math.floor(n+a),0),i);for(h=p;h<=d;h+=1){w=Math.sqrt(1-(h-n)*(h-n)/(a*a)),m=Math.min(Math.max(Math.ceil(r-f*w),0),s),b=Math.min(Math.max(Math.floor(r+f*w),0),s);if(Math.abs(h-n)<l){w=Math.sqrt(1-(h-n)*(h-n)/(l*l)),g=Math.min(Math.max(Math.ceil(r-c*w),0),s),y=Math.min(Math.max(Math.floor(r+c*w),0),s);for(v=m;v<=g;v+=1)S[E+=1]=h*t+v;for(v=y;v<=b;v+=1)S[E+=1]=h*t+v}else for(v=m;v<=b;v+=1)S[E+=1]=h*t+v}return S},h=function(e){var n=e.count,r=e.vertices,a=new Array(n),l=new Array(n),c=Number.MAX_VALUE,h=Number.MIN_VALUE,p=Number.MAX_VALUE,d=Number.MIN_VALUE,v,m,g,y,b,w,E,S=[];for(v=0;v<n;v+=1)a[v]=r[v*2]*o,l[v]=r[v*2+1]*u,a[v]<c&&(c=a[v]),a[v]>h&&(h=a[v]),l[v]<p&&(p=l[v]),l[v]>d&&(d=l[v]);m=Math.min(Math.max(Math.round(c),0),i),b=Math.min(Math.max(Math.round(p),0),s),g=Math.min(Math.max(Math.round(h),0),i),w=Math.min(Math.max(Math.round(d),0),s),S=[],E=0;for(v=m;v<=g;v+=1)for(y=b;y<=w;y+=1)f.pointInsidePolygon(n,a,l,v,y)&&(S[E+=1]=v*t+y);return S};if(this.rectangle)return a(this.rectangle);if(this.ellipse)return l(this.ellipse);if(this.ring)return c(this.ring);if(this.polygon)return h(this.polygon);throw new Error("Part: unknown shape.")},S.prototype.contains=function(e,t){"use strict";return this.shape.contains(e,t)},S.prototype.reflect=function(e,t){"use strict";return Math.abs(this.reflection-1)<.001?e.reflect(this.shape,t):!1},S.prototype.absorb=function(e){"use strict";return Math.abs(this.absorption-1)<.001?this.shape.contains(e.x,e.y):!1},S.prototype.getIrradiance=function(e){"use strict";var t;return this.emissivity===0?0:(t=273+e,t*=t,this.emissivity*o.STEFAN_CONSTANT*g*t*t)},S.prototype.radiate=function(e){"use strict";var t=this.shape.polygonize(),n=new l,r,i;if(this.emissivity===0)return;for(r=0,i=t.count-1;r<i;r+=1)n.x1=t.x_coords[r],n.y1=t.y_coords[r],n.x2=t.x_coords[r+1],n.y2=t.y_coords[r+1],this.radiateFromLine(e,n);n.x1=t.x_coords[t.count-1],n.y1=t.y_coords[t.count-1],n.x2=t.x_coords[0],n.y2=t.y_coords[0],this.radiateFromLine(e,n)},S.prototype.radiateFromLine=function(e,t){"use strict";var n,r,i,s,o,f,l,c,h,p,d,g,S,x,T,N,C;if(this.emissivity===0)return;n=e.getModelOptions(),r=a(t.x1-t.x2,t.y1-t.y2),i=(t.x2-t.x1)/r,s=(t.y2-t.y1)/r,o=Math.max(1,Math.round(r/v)),p=n.solar_ray_speed*s,d=-n.solar_ray_speed*i;if(o===1)h=.5*r,f=t.x1+h*i,l=t.y1+h*s,h=e.getAverageTemperatureAt(f,l),h>m&&(h=e.getTemperatureAt(f,l),c=new u(f,l,this.getIrradiance(h),n.solar_ray_speed),c.vx=p,c.vy=d,e.addPhoton(c),this.constant_temperature||e.setTemperatureAt(f,l,h-c.energy/this.specific_heat));else{g=new Array(4),S=new Array(4),g[0]=p*b-d*y,S[0]=p*y+d*b,g[1]=d*y+p*b,S[1]=d*b-p*y,g[2]=p*E-d*w,S[2]=p*w+d*E,g[3]=d*w+p*E,S[3]=d*E-p*w,x=1+g.length;for(N=0;N<o;N+=1){h=(N+.5)*v,f=t.x1+h*i,l=t.y1+h*s,h=e.getAverageTemperatureAt(f,l),T=this.getIrradiance(h)/x;if(h>m){c=new u(f,l,T,n.solar_ray_speed),c.vx=p,c.vy=d,e.addPhoton(c);for(C=0;C<x-1;C+=1)c=new u(f,l,T,n.solar_ray_speed),c.vx=g[C],c.vy=S[C],e.addPhoton(c);this.constant_temperature||e.changeAverageTemperatureAt(f,l,-T*x/this.specific_heat)}}}}}),t.define("/default-config.js",function(e,t,n,r,i){var s=e("./constants.js");n.DEFAULT_VALUES={model:{use_WebGL:!1,grid_width:100,grid_height:100,model_width:10,model_height:10,timestep:1,convective:!0,background_temperature:0,background_conductivity:s.AIR_THERMAL_CONDUCTIVITY,background_specific_heat:s.AIR_SPECIFIC_HEAT,background_density:s.AIR_DENSITY,background_viscosity:s.AIR_VISCOSITY,thermal_buoyancy:25e-5,buoyancy_approximation:1,boundary:{temperature_at_border:{upper:0,lower:0,left:0,right:0}},measurement_interval:500,viewupdate_interval:100,stoptime:undefined,sunny:!1,sun_angle:1.5707964,solar_power_density:2e3,solar_ray_count:24,solar_ray_speed:.1,photon_emission_interval:20,structure:undefined},part:{thermal_conductivity:1,specific_heat:1300,density:25,transmission:0,reflection:0,absorption:1,emissivity:0,temperature:0,constant_temperature:!1,power:0,wind_speed:0,wind_angle:0,visible:!0,filled:!0,color:"gray",label:undefined,texture:undefined,uid:undefined,draggable:!0}},n.fillWithDefaultValues=function(e,t){"use strict";var n,r,i=function(e){return e===undefined?undefined:JSON.parse(JSON.stringify(e))};if(e===undefined)return i(t);r=i(e);for(n in t)t.hasOwnProperty(n)&&e[n]===undefined&&(r[n]=i(t[n]));return r}}),t.define("/constants.js",function(e,t,n,r,i){n.AIR_THERMAL_CONDUCTIVITY=.025,n.AIR_SPECIFIC_HEAT=1012,n.AIR_DENSITY=1.204,n.AIR_VISCOSITY=1568e-8,n.STEFAN_CONSTANT=5.67e-8}),t.define("/core-model.js",function(e,t,n,r,i){var s=e("./arrays/arrays.js").arrays,o=e("./physics-solvers/heat-solver.js"),u=e("./physics-solvers-gpu/heat-solver-gpu.js"),a=e("./physics-solvers/fluid-solver.js"),f=e("./physics-solvers-gpu/fluid-solver-gpu.js"),l=e("./physics-solvers/ray-solver.js"),c=e("./part.js"),h=e("./default-config.js"),p,d=function(){"use strict";try{new Float32Array}catch(e){return"regular"}return"Float32Array"}();n.makeCoreModel=function(e){"use strict";var t=function(){var t;e=h.fillWithDefaultValues(e,h.DEFAULT_VALUES.model),t=e.boundary.temperature_at_border||e.boundary.flux_at_border;if(!t)throw new Error("Core model: missing boundary settings.");if(t.upper===undefined||t.right===undefined||t.lower===undefined||t.left===undefined)throw new Error("Core model: incomplete boundary settings.");return e}(),n=t.use_WebGL,r,i=t.grid_width,v=t.grid_height,m=i*v,g=t.model_width/i,y=t.model_height/v,b=0,w,E,S,x,T,N,C,k={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},L=s.create(m,t.background_temperature,d),A=s.create(m,NaN,d),O=s.create(m,0,d),M=s.create(m,0,d),_=s.create(m,0,d),D=s.create(m,0,d),P=s.create(m,0,d),H=s.create(m,t.background_conductivity,d),B=s.create(m,t.background_specific_heat,d),j=s.create(m,t.background_density,d),F=s.create(m,!0,d),I=[],q=[],R=function(){var e=[],n,r,i;if(t.structure&&t.structure.part){n=t.structure.part,n.constructor!==Array&&(n=[n]),e=new Array(n.length);for(r=0,i=n.length;r<i;r+=1)e[r]=new c.Part(n[r])}return e}(),U=function(){if(typeof window=="undefined")throw new Error("Core model: WebGL GPGPU unavailable in the node.js environment.");p=energy2d.utils.gpu.gpgpu;try{p.init(v,i)}catch(e){n=!1,r=e.message,console.warn("WebGL initialization failed. Energy2D will use CPU solvers.");return}q[0]=p.createTexture(),q[1]=p.createTexture(),q[2]=p.createTexture(),q[3]=p.createTexture(),p.writeRGBATexture(q[0],L,L,A,H),p.writeRGBATexture(q[1],_,B,j,F),p.writeRGBATexture(q[2],O,M,O,M),p.writeRGBATexture(q[3],D,P,D,P),x=u.makeHeatSolverGPU(X),T=f.makeFluidSolverGPU(X)},z=function(){var e=t.model_width,n=t.model_height,r,s,o,u,a,f;if(!R||R.length===0)return;for(u=R.length-1;u>=0;u-=1){r=R[u],s=r.getGridCells(i,v,e,n);for(a=0,f=s.length;a<f;a+=1)o=s[a],F[o]=!1,L[o]=r.temperature,_[o]=r.power,H[o]=r.thermal_conductivity,B[o]=r.specific_heat,j[o]=r.density,r.wind_speed!==0&&(D[o]=r.wind_speed*Math.cos(r.wind_angle),P[o]=r.wind_speed*Math.sin(r.wind_angle)),r.constant_temperature&&(A[o]=r.temperature)}},W=function(){var e,t,n,r,s,o,u,a;for(r=0;r<i;r+=1){t=r*g,s=r*v;for(o=0;o<v;o+=1){n=o*y,_[s+o]=0;if(C)for(u=0,a=R.length;u<a;u+=1){e=R[u];if(e.power!==0&&e.shape.contains(t,n)){_[s+o]=e.getPower();break}}}}},X={nextStep:function(){k.start("Core model step"),n?(t.convective&&(k.start("Fluid solver GPU"),T.solve(),k.stop("Fluid solver GPU")),k.start("Heat solver GPU"),x.solve(t.convective),k.stop("Heat solver GPU")):(N&&(k.start("Ray solver CPU"),b%t.photon_emission_interval===0&&(W(),t.sunny&&S.sunShine(),S.radiate()),S.solve(),k.stop("Ray solver CPU")),t.convective&&(k.start("Fluid solver CPU"),E.solve(O,M),k.stop("Fluid solver CPU")),k.start("Heat solver CPU"),w.solve(t.convective,L,_),k.stop("Heat solver CPU")),b+=1,k.stop("Core model step")},setPerformanceTools:function(e){k=e},isWebGLActive:function(){return n},getWebGLError:function(){return r},updateTemperatureArray:function(){n&&(k.start("Read temperature texture"),p.readTexture(q[0],L),k.stop("Read temperature texture"))},updateVelocityArrays:function(){n&&(k.start("Read velocity texture"),p.readTexture(q[2],O,0),p.readTexture(q[2],M,1),k.stop("Read velocity texture"))},getIndexOfStep:function(){return b},getModelOptions:function(){return t},getTemperatureAt:function(e,t){var n=Math.max(Math.min(i-1,Math.round(e/g)),0),r=Math.max(Math.min(v-1,Math.round(t/y)),0);return L[n*v+r]},setTemperatureAt:function(e,t,n){var r=Math.max(Math.min(i-1,Math.round(e/g)),0),s=Math.max(Math.min(v-1,Math.round(t/y)),0);L[r*v+s]=n},getAverageTemperatureAt:function(e,t){var n=0,r=i-1,s=v-1,o=Math.round(e/g),u=Math.round(t/y),a,f;return a=Math.max(Math.min(r,o),0),f=Math.max(Math.min(s,u),0),n+=L[a*v+f],a=Math.max(Math.min(r,o+1),0),f=Math.max(Math.min(s,u),0),n+=L[a*v+f],a=Math.max(Math.min(r,o-1),0),f=Math.max(Math.min(s,u),0),n+=L[a*v+f],a=Math.max(Math.min(r,o),0),f=Math.max(Math.min(s,u+1),0),n+=L[a*v+f],a=Math.max(Math.min(r,o),0),f=Math.max(Math.min(s,u-1),0),n+=L[a*v+f],n*.2},changeAverageTemperatureAt:function(e,t,n){var r=i-1,s=v-1,o=Math.round(e/g),u=Math.round(t/y),a,f;n*=.2,a=Math.min(r,o),f=Math.min(s,u),a>=0&&f>=0&&(L[a*v+f]+=n),a=Math.min(r,o+1),f=Math.min(s,u),a>=0&&f>=0&&(L[a*v+f]+=n),a=Math.min(r,o-1),f=Math.min(s,u),a>=0&&f>=0&&(L[a*v+f]+=n),a=Math.min(r,o),f=Math.min(s,u+1),a>=0&&f>=0&&(L[a*v+f]+=n),a=Math.min(r,o),f=Math.min(s,u-1),a>=0&&f>=0&&(L[a*v+f]+=n)},addPhoton:function(e){I.push(e)},removePhoton:function(e){var t=I.indexOf(e);t!==-1&&I.splice(t,1)},copyTextureToArray:function(e,t){p.readTexture(e,t)},copyArrayToTexture:function(e,t){p.writeTexture(t,e)},getArrayType:function(){return d},getGridWidth:function(){return i},getGridHeight:function(){return v},getPerformanceModel:function(){return k},getTemperatureArray:function(){return L},getUVelocityArray:function(){return O},getVVelocityArray:function(){return M},getUWindArray:function(){return D},getVWindArray:function(){return P},getBoundaryTemperatureArray:function(){return A},getPowerArray:function(){return _},getConductivityArray:function(){return H},getCapacityArray:function(){return B},getDensityArray:function(){return j},getFluidityArray:function(){return F},getPhotonsArray:function(){return I},getPartsArray:function(){return R},getTemperatureTexture:function(){return q[0]},getVelocityTexture:function(){return q[2]},getSimulationTexture:function(e){return q[e]}};return N=function(){var e,n;if(t.sunny)return!0;for(e=0,n=R.length;e<n;e+=1)if(R[e].emissivity>0)return!0;return!1}(),C=function(){var e,t;for(e=0,t=R.length;e<t;e+=1)if(R[e].power>0)return!0;return!1}(),z(),w=o.makeHeatSolver(X),E=a.makeFluidSolver(X),S=l.makeRaySolver(X),n&&U(),X}}),t("/core-model.js");var n=t("./core-model.js");energy2d.namespace("energy2d.modeler"),energy2d.modeler.makeModeler=function(e){"use strict";var t=n.makeCoreModel(e);return{nextStep:function(){t.nextStep()},getWidth:function(){return t.getModelOptions().model_width},getHeight:function(){return t.getModelOptions().model_height},getTime:function(){return t.getModelOptions().timestep*t.getIndexOfStep()},isWebGLActive:t.isWebGLActive,getWebGLError:t.getWebGLError,getIndexOfStep:t.getIndexOfStep,getGridWidth:t.getGridWidth,getGridHeight:t.getGridHeight,getTemperatureArray:t.getTemperatureArray,getTemperatureTexture:t.getTemperatureTexture,getUVelocityArray:t.getUVelocityArray,getVVelocityArray:t.getVVelocityArray,getVelocityTexture:t.getVelocityTexture,getPhotonsArray:t.getPhotonsArray,getPartsArray:t.getPartsArray,updateTemperatureArray:t.updateTemperatureArray,updateVelocityArrays:t.updateVelocityArrays,setPerformanceTools:t.setPerformanceTools}},energy2d.namespace("energy2d.utils.gpu");var r;energy2d.utils.gpu.init=function(){"use strict";var e=document.createElement("canvas");try{r=e.getContext("webgl")||e.getContext("experimental-webgl")}catch(t){}if(!r)throw new Error("GL: WebGL not supported.");return energy2d.utils.gpu.init=function(){return r},energy2d.utils.gpu.gl=r,r},energy2d.utils.gpu.assertInitialized=function(){"use strict";if(!r)throw new Error("GPU: WebGL not initialized. Call energy2d.utils.gpu.init().")},energy2d.namespace("energy2d.utils.gpu"),i.prototype.compile=function(e){"use strict";var t=[],n,i,s;for(n=0,i=1e4;n<this.data.length;n+=i)t=Array.prototype.concat.apply(t,this.data.slice(n,n+i));s=this.data.length?t.length/this.data.length:0;if(s!==Math.round(s))throw new Error("Mesh: buffer elements not of consistent size, average size is "+s);this.buffer=this.buffer||r.createBuffer(),this.buffer.length=t.length,this.buffer.spacing=s,r.bindBuffer(this.target,this.buffer),r.bufferData(this.target,new this.type(t),e||r.STATIC_DRAW)},energy2d.utils.gpu.Mesh=function(e){"use strict";e=e||{},this.vertexBuffers={},this.indexBuffers={},this.addVertexBuffer("vertices","gl_Vertex"),e.coords&&this.addVertexBuffer("coords","gl_TexCoord"),e.normals&&this.addVertexBuffer("normals","gl_Normal"),e.colors&&this.addVertexBuffer("colors","gl_Color"),(e.lines===undefined||e.triangles)&&this.addIndexBuffer("triangles"),e.lines&&this.addIndexBuffer("lines")},energy2d.utils.gpu.Mesh.prototype.addVertexBuffer=function(e,t){"use strict";var n=this.vertexBuffers[t]=new i(r.ARRAY_BUFFER,Float32Array);n.name=e,this[e]=[]},energy2d.utils.gpu.Mesh.prototype.addIndexBuffer=function(e){"use strict";var t=this.indexBuffers[e]=new i(r.ELEMENT_ARRAY_BUFFER,Uint16Array);this[e]=[]},energy2d.utils.gpu.Mesh.prototype.compile=function(){"use strict";var e,t,n;for(e in this.vertexBuffers)this.vertexBuffers.hasOwnProperty(e)&&(n=this.vertexBuffers[e],n.data=this[n.name],n.compile());for(t in this.indexBuffers)this.indexBuffers.hasOwnProperty(t)&&(n=this.indexBuffers[t],n.data=this[t],n.compile())},energy2d.utils.gpu.Mesh.plane=function(e){"use strict";var t,n,r,i,s,o,u,a;e=e||{},t=new energy2d.utils.gpu.Mesh(e),n=e.detailX||e.detail||1,r=e.detailY||e.detail||1;for(s=0;s<=r;s+=1){o=s/r;for(i=0;i<=n;i+=1)u=i/n,t.vertices.push([2*u-1,2*o-1,0]),t.coords&&t.coords.push([u,o]),t.normals&&t.normals.push([0,0,1]),i<n&&s<r&&(a=i+s*(n+1),t.triangles.push([a,a+1,a+n+1]),t.triangles.push([a+n+1,a+1,a+n+2]))}return t.compile(),t},energy2d.namespace("energy2d.utils.gpu"),energy2d.utils.gpu.Shader=function(e,t){"use strict";function a(e,t){var n=r.createShader(e);r.shaderSource(n,t),r.compileShader(n);if(!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error("Shader: compile error.\n"+r.getShaderInfoLog(n)+"\nSource:\n"+t);return n}var n="    attribute vec4 gl_Vertex;    attribute vec4 gl_TexCoord;    attribute vec3 gl_Normal;    attribute vec4 gl_Color;    ",i="    precision highp float;    ",o=function(e,t){var n={},r;return r=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(t),t=r?r[1]+e+t.substr(r[1].length):e+t,s(/\bgl_\w+\b/g,e,function(e){n[e]===undefined&&(t=t.replace(new RegExp("\\b"+e+"\\b","g"),"_"+e),n[e]=!0)}),t},u={};e=o(n,e),t=o(i,t),this.program=r.createProgram(),r.attachShader(this.program,a(r.VERTEX_SHADER,e)),r.attachShader(this.program,a(r.FRAGMENT_SHADER,t)),r.linkProgram(this.program);if(!r.getProgramParameter(this.program,r.LINK_STATUS))throw new Error("Shader: link error.\n"+r.getProgramInfoLog(this.program)+"\nSource:\n"+e+"\n\n"+t);this.attributes={},this.uniformLocations={},s(/uniform\s+sampler(1D|2D|3D|Cube)\s+(\w+)\s*;/g,e+t,function(e){u[e[2]]=1}),this.isSampler=u},energy2d.utils.gpu.Shader.prototype.uniforms=function(e){"use strict";var t,n,i;r.useProgram(this.program);for(t in e)if(e.hasOwnProperty(t)){this.uniformLocations[t]===undefined&&(this.uniformLocations[t]=r.getUniformLocation(this.program,t)),n=this.uniformLocations[t];if(n===null){console.warn("Shader: name "+t+" does not correspond to an active uniform variable.");continue}i=e[t];if(o(i))switch(i.length){case 1:r.uniform1fv(n,new Float32Array(i));break;case 2:r.uniform2fv(n,new Float32Array(i));break;case 3:r.uniform3fv(n,new Float32Array(i));break;case 4:r.uniform4fv(n,new Float32Array(i));break;case 9:r.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:r.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw new Error("Shader: don't know how to load uniform \""+t+'" of length '+i.length)}else{if(!u(i))throw new Error('Shader: attempted to set uniform "'+t+'" to invalid value '+i);(this.isSampler[t]?r.uniform1i:r.uniform1f).call(r,n,i)}}return this},energy2d.utils.gpu.Shader.prototype.draw=function(e,t){"use strict";r.useProgram(this.program),this.drawBuffers(e.vertexBuffers,e.indexBuffers[t===r.LINES?"lines":"triangles"],arguments.length<2?r.TRIANGLES:t)},energy2d.utils.gpu.Shader.prototype.drawBuffers=function(e,t,n){"use strict";var i=0,s,o,u;for(s in e)if(e.hasOwnProperty(s)){o=e[s],this.attributes[s]===undefined&&(this.attributes[s]=r.getAttribLocation(this.program,s.replace(/^gl_/,"_gl_"))),u=this.attributes[s];if(u===-1||!o.buffer)continue;r.bindBuffer(r.ARRAY_BUFFER,o.buffer),r.enableVertexAttribArray(u),r.vertexAttribPointer(u,o.buffer.spacing,r.FLOAT,!1,0,0),i=o.buffer.length/o.buffer.spacing}for(s in this.attributes)this.attributes.hasOwnProperty(s)&&e[s]===undefined&&r.disableVertexAttribArray(this.attributes[s]);i&&(!t||t.buffer)&&(t?(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.buffer),r.drawElements(n,t.buffer.length,r.UNSIGNED_SHORT,0)):r.drawArrays(n,0,i))},energy2d.namespace("energy2d.utils.gpu"),energy2d.utils.gpu.Texture=function(e,t,n){"use strict";energy2d.utils.gpu.assertInitialized(),n=n||{},this.id=r.createTexture(),this.width=e,this.height=t,this.format=n.format||r.RGBA,this.type=n.type||r.UNSIGNED_BYTE,this.tex_unit=null,this.fbo=null,r.bindTexture(r.TEXTURE_2D,this.id),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n.mag_filter||n.filter||r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n.min_filter||n.filter||r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n.wrap||n.wrap_s||r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n.wrap||n.wrap_t||r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,this.format,e,t,0,this.format,this.type,null)},energy2d.utils.gpu.Texture.prototype.setAsRenderTarget=function(){"use strict";this.fbo===null?(this.fbo=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,this.id,0),r.viewport(0,0,this.width,this.height)):(r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.viewport(0,0,this.width,this.height))},energy2d.utils.gpu.Texture.prototype.bind=function(e){"use strict";this.tex_unit=
e||0,r.activeTexture(r.TEXTURE0+this.tex_unit),r.bindTexture(r.TEXTURE_2D,this.id)},energy2d.utils.gpu.Texture.prototype.unbind=function(e){"use strict";if(this.tex_unit===null)return;r.activeTexture(r.TEXTURE0+this.tex_unit),r.bindTexture(r.TEXTURE_2D,null),this.tex_unit=null},energy2d.utils.gpu.Texture.prototype.drawTo=function(e){"use strict";if(this.fbo===null)throw new Error("Texture: call setupAsRenderTarget() method first.");r.bindFramebuffer(r.FRAMEBUFFER,this.fbo),r.viewport(0,0,this.width,this.height),e(),r.bindFramebuffer(r.FRAMEBUFFER,null)},energy2d.utils.gpu.Texture.prototype.swapWith=function(e){"use strict";var t;t=e.id,e.id=this.id,this.id=t,t=e.tex_unit,e.tex_unit=this.tex_unit,this.tex_unit=t,t=e.fbo,e.fbo=this.fbo,this.fbo=t},energy2d.namespace("energy2d.utils.gpu"),energy2d.utils.gpu.gpgpu=function(){"use strict";var e=energy2d.utils.gpu,t,n,r,i,s,o,u,a,f=!1,l=!1,c,h,p="    varying vec2 coord;    void main() {      coord = gl_Vertex.xy * 0.5 + 0.5;      gl_Position = vec4(gl_Vertex.xyz, 1.0);    }",d="    uniform sampler2D texture;    uniform float channel;    varying vec2 coord;    float shift_right(float v, float amt) {      v = floor(v) + 0.5;      return floor(v / exp2(amt));    }    float shift_left(float v, float amt) {      return floor(v * exp2(amt) + 0.5);    }        float mask_last(float v, float bits) {      return mod(v, shift_left(1.0, bits));    }    float extract_bits(float num, float from, float to) {      from = floor(from + 0.5);      to = floor(to + 0.5);      return mask_last(shift_right(num, from), to - from);    }    vec4 encode_float(float val) {      if (val == 0.0)        return vec4(0, 0, 0, 0);      float sign = val > 0.0 ? 0.0 : 1.0;      val = abs(val);      float exponent = floor(log2(val));      float biased_exponent = exponent + 127.0;      float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;            float t = biased_exponent / 2.0;      float last_bit_of_biased_exponent = fract(t) * 2.0;      float remaining_bits_of_biased_exponent = floor(t);            float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;      float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;      float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;      float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;      return vec4(byte4, byte3, byte2, byte1);    }    void main() {      vec4 data = texture2D(texture, coord);      if (channel == 0.0)        gl_FragColor = encode_float(data.r);      else if (channel == 1.0)        gl_FragColor = encode_float(data.g);      else if (channel == 2.0)        gl_FragColor = encode_float(data.b);      else        gl_FragColor = encode_float(data.a);    }",v="    uniform sampler2D texture;    varying vec2 coord;    void main() {      gl_FragColor = texture2D(texture, coord);    }",m="GPGPU: call init(grid_width, grid_height) with proper dimensions first!",g=function(){t=e.init();if(!t.getExtension("OES_texture_float"))throw new Error("GPGPU: OES_texture_float is not supported!");s=new e.Texture(1,1,{type:t.FLOAT,format:t.RGBA,filter:t.LINEAR}),s.setAsRenderTarget();if(t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw t.bindFramebuffer(t.FRAMEBUFFER,null),new Error("GPGPU: FLOAT texture as render target is not supported!");t.bindFramebuffer(t.FRAMEBUFFER,null),t.disable(t.DEPTH_TEST),a=e.Mesh.plane(),c=new e.Shader(p,d),h=new e.Shader(p,v),l=!0},y=function(e,t,n,r,i){var s,o,u,a;if(e.length!==t.length||e.length!==n.length||e.length!==r.length||i.length!==e.length*4)throw new Error("GPGPU: Invalid input data length.");for(o=0,a=e.length;o<a;o+=1)u=o*4,i[u]=e[o],i[u+1]=t[o],i[u+2]=n[o],i[u+3]=r[o]};return{init:function(i,a){l||g(),n=i,r=a,s=new e.Texture(n,r,{type:t.FLOAT,format:t.RGBA,filter:t.LINEAR}),o=new e.Texture(n,r,{type:t.UNSIGNED_BYTE,format:t.RGBA,filter:t.LINEAR}),u=new Float32Array(n*r*4)},getWebGLContext:function(){return t===undefined&&g(),t},createTexture:function(){var i;return!n||!r?new Error(m):(i=new e.Texture(n,r,{type:t.FLOAT,format:t.RGBA,filter:t.LINEAR}),i)},convertToRGBA:function(e,t,i){var s,o,u,a;if(e.length!==n*r)throw new Error("GPGPU: Invalid input data length.");i===undefined?s=new Float32Array(e.length*4):s=i,t===undefined&&(t=0);for(o=0,u=e.length;o<u;o+=1)a=o*4,s[a]=s[a+1]=s[a+2]=s[a+3]=0,s[a+t]=e[o];return s},writeTexture:function(e,n){var r=this.convertToRGBA(n,0,u);t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,r)},writeRGBATexture:function(e,n,r,i,s){y(n,r,i,s,u),t.bindTexture(t.TEXTURE_2D,e.id),t.texImage2D(t.TEXTURE_2D,0,e.format,e.width,e.height,0,e.format,e.type,u)},readTexture:function(e,i,s){var u,f,l;if(!t||e.width!==n||e.height!==r)return new Error(m);s===undefined&&(s=0),u=new Uint8Array(i.buffer),e.bind(),o.setAsRenderTarget(),c.uniforms({channel:s}),c.draw(a),t.readPixels(0,0,o.width,o.height,o.format,o.type,u)},copyTexture:function(e,t){e.bind(),t.setAsRenderTarget(),h.draw(a)},executeProgram:function(e,t,n){var r,i;for(r=0,i=t.length;r<i;r+=1)t[r].bind(r);s.setAsRenderTarget(),e.draw(a);for(r=0,i=t.length;r<i;r+=1)t[r].unbind(r);n.swapWith(s)},setSynchronizationAllowed:function(e){f=e},tryFinish:function(){f&&t.finish()}}}(),energy2d.namespace("energy2d.utils.performance"),energy2d.utils.performance.makePerformanceTools=function(){"use strict";var e={id:undefined,data:undefined,parent:undefined,children:{}},t=e,n={},r=function(e){return t.children[e]||(t.children[e]={id:e,data:{sum:0,count:0,avg:0},parent:t,children:{}}),t=t.children[e],t};return{start:function(e){r(e),t.start_time=(new Date).getTime()},stop:function(e){var n=(new Date).getTime();if(t.id!==e)throw new Error("Performance: there is another active counter: "+t.name);t.data.sum+=n-t.start_time,t.data.count+=1,t.data.avg=t.data.sum/t.data.count,t=t.parent},startFPS:function(e){n[e]={start_time:(new Date).getTime(),count:0,fps:0}},updateFPS:function(e){var t=n[e],r=(new Date).getTime();if(!t)return;t.count+=1,t.fps=t.count/((r-t.start_time)/1e3)},stopFPS:function(e){delete n[e]},getTree:function(){return e},getFPSData:function(){return n}}},energy2d.namespace("energy2d.views.utils"),energy2d.views.utils.HSVToRGB=function(e,t,n){"use strict";var r,i,s,o,u,a,f,l;e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100;if(t===0)return r=i=s=n,[Math.round(r*255),Math.round(i*255),Math.round(s*255)];e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u));switch(o){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;default:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]},energy2d.views.utils.setupRGBTemperatureColorTables=function(e,t,n){"use strict";var r=energy2d.views.utils.HSVToRGB,i=[],s;for(s=0;s<256;s+=1)i=energy2d.views.utils.HSVToRGB(s,100,90),e[s]=i[0],t[s]=i[1],n[s]=i[2]},energy2d.namespace("energy2d.views.ColorPalette");var a={};a[0]=a.RAINBOW=[[0,0,128],[20,50,120],[20,100,200],[10,150,150],[120,180,50],[220,200,10],[240,160,36],[225,50,50],[230,85,110],[250,250,250],[255,255,255]],a[1]=a.IRON=[[40,20,100],[80,20,150],[150,20,150],[200,50,120],[220,80,80],[230,120,30],[240,200,20],[240,220,80],[255,255,125],[250,250,250],[255,255,255]],a[2]=a.GRAY=[[50,50,50],[75,75,75],[100,100,100],[125,125,125],[150,150,150],[175,175,175],[200,200,200],[225,225,225],[250,250,250],[255,255,255]],a[3]=a.RAINBOW2=function(){"use strict";var e=energy2d.views.utils.HSVToRGB,t=256,n=new Array(t),r;for(r=0;r<t;r+=1)n[r]=energy2d.views.utils.HSVToRGB(t-1-r,100,90);return n}(),energy2d.views.ColorPalette.getRGBArray=function(e){"use strict";return e===undefined||e==="DEFAULT"?a.RAINBOW:a[e]},energy2d.namespace("energy2d.views"),energy2d.views.makeHeatmapView=function(e){"use strict";var t=energy2d.views.ColorPalette,n="energy2d-heatmap-view",r,i,s,o,u,a,f,l,c,h,p,d=0,v=50,m=function(){r=$("<canvas />"),r.attr("id",e||n),i=r[0].getContext("2d"),window.devicePixelRatio>1&&(i.webkitBackingStorePixelRatio>1||typeof i.webkitBackingStorePixelRatio=="undefined")?s=window.devicePixelRatio:s=1},g={renderHeatmap:function(){var e,t,n,r,o,u,a,m,g,y,b,w;if(!c)throw new Error("Heatmap: bind heatmap before rendering.");i.clearRect(0,0,h,p),i.fillStyle="rgb(0,0,0)",e=l/(v-d),u=i.getImageData(0,0,h/s,p/s),a=u.data,b=0,w=4*h;for(m=0;m<h;m+=1){y=m*p,b=4*m;for(g=0;g<p;g+=1)n=e*(c[y+g]-d),t=Math.floor(n),n-=t,t<0?(t=0,n=0):t>l-1&&(t=l-1,n=1),r=f[t],o=f[t+1],a[b]=r[0]*(1-n)+o[0]*n,a[b+1]=r[1]*(1-n)+o[1]*n,a[b+2]=r[2]*(1-n)+o[2]*n,a[b+3]=255,b+=w}i.putImageData(u,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");c=e,h=t,p=n,this.setCanvasSize(h,p)},getHTMLElement:function(){return r},updateCanvasSize:function(){o=r.width(),u=r.height(),a?(r.attr("width",o),r.attr("height",u)):this.setCanvasSize(h,p)},setCanvasSize:function(e,t){r.attr("width",e/s),r.attr("height",t/s)},setHQRenderingEnabled:function(e){a=e,this.updateCanvasSize()},setMinTemperature:function(e){d=e},setMaxTemperature:function(e){v=e},setColorPalette:function(e){f=t.getRGBArray(e),l=f.length-1}};return g.setColorPalette("DEFAULT"),m(),g},energy2d.namespace("energy2d.views"),energy2d.views.makeHeatmapWebGLView=function(t){"use strict";var n=energy2d.views.ColorPalette,r=energy2d.utils.gpu,i=e.glsl,s="src/lab/views/energy2d/heatmap-webgl-glsl/",o=i[s+"basic.vs.glsl"],u=i[s+"temp-renderer.fs.glsl"],a=r.init(),f=new r.Shader(o,u),l=r.Mesh.plane({coords:!0}),c,h="energy2d-heatmap-webgl-view",p,d,v,m,g=0,y=50,b=function(){p=$(a.canvas),p.attr("id",t||h)},w=function(){a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,d,v)},E={renderHeatmap:function(){if(!m)throw new Error("Heatmap: bind heatmap texture before rendering.");(d!==p.width()||v!==p.height())&&this.updateCanvasSize(),w(),a.clear(a.COLOR_BUFFER_BIT),m.bind(0),c.bind(1),f.draw(l),c.unbind(1),m.unbind(0)},updateCanvasSize:function(){d=p.width(),v=p.height(),p.attr("width",d),p.attr("height",v)},bindHeatmapTexture:function(e){m=e},getHTMLElement:function(){return p},setMinTemperature:function(e){g=e,f.uniforms({min_temp:g})},setMaxTemperature:function(e){y=e,f.uniforms({max_temp:y})},setColorPalette:function(e){var t,i,s,o,u;t=n.getRGBArray(e),i=t.length,s=new Uint8Array(i*4);for(o=0;o<i;o+=1)u=o*4,s[u]=t[o][0],s[u+1]=t[o][1],s[u+2]=t[o][2],s[u+3]=255;c=new r.Texture(i,1,{type:a.UNSIGNED_BYTE,format:a.RGBA,filter:a.LINEAR}),a.bindTexture(a.TEXTURE_2D,c.id),a.texImage2D(a.TEXTURE_2D,0,c.format,i,1,0,c.format,c.type,s)}};return E.setColorPalette("DEFAULT"),f.uniforms({heatmap_tex:0,palette_tex:1,min_temp:g,max_temp:y}),l.coords=[[1,0],[1,1],[0,0],[0,1]],l.compile(),b(),E},energy2d.namespace("energy2d.views"),energy2d.views.makeVectormapView=function(e){"use strict";var t="energy2d-vectormap-view",n=100,r=8,i=Math.cos(.523598776),s=Math.sin(.523598776),o=4,u="rgb(175,175,175)",a,f,l,c,h,p,d,v,m,g=function(){a=$("<canvas />"),a.attr("id",e||t),f=a[0].getContext("2d")},y=function(e,t,u,a){var l=1/Math.sqrt(u*u+a*a),c=u*l,h=a*l,p=e+c*r+u*n,d=t+h*r+a*n,v=o*(c*i+h*s),m=o*(h*i-c*s);f.beginPath(),f.moveTo(e,t),f.lineTo(p,d),f.lineTo(p-v,d-m),f.moveTo(p,d),v=o*(c*i-h*s),m=o*(h*i+c*s),f.lineTo(p-v,d-m),f.stroke()},b={renderVectormap:function(){var e,t,n,r,i,s,o,g,b,w;if(!h||!p)throw new Error("Vectormap: bind vectormap before rendering.");(l!==a.width()||c!==a.height())&&this.updateCanvasSize(),e=l/d,t=c/v,f.clearRect(0,0,l,c),f.strokeStyle=u,f.lineWidth=1;for(o=1;o<d-1;o+=m){b=o*v,n=(o+.5)*e;for(g=1;g<v-1;g+=m)w=b+g,r=(g+.5)*t,i=h[w],s=p[w],i*i+s*s>1e-15&&y(n,r,i,s)}},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");h=e,p=t,d=n,v=r,m=Math.round(n/i)},getHTMLElement:function(){return a},updateCanvasSize:function(){l=a.width(),c=a.height(),a.attr("width",l),a.attr("height",c)}};return g(),b},energy2d.namespace("energy2d.views"),energy2d.views.makeVectormapWebGLView=function(t){"use strict";var n=energy2d.utils.gpu,r=e.glsl,i="src/lab/views/energy2d/vectormap-webgl-glsl/",s=r[i+"vectormap.vs.glsl"],o=r[i+"vectormap.fs.glsl"],u=n.init(),a=new n.Shader(s,o),f=new n.Mesh({coords:!0,lines:!0}),l="energy2d-vectormap-webgl-view",c=100,h=8,p=[.7,.7,.7,1],d,v,m,g,y,b,w,E=function(){var e,t,n,r,i,s,o=2/y,u=2/b,a=1/y,l=1/b;f.addVertexBuffer("origins","origin"),f.vertices=[],f.origins=[],f.coords=[],f.lines=[],r=0;for(e=1;e<y-1;e+=w)for(t=1;t<b-1;t+=w)f.vertices.push([0,0,0],[.01,0,0],[-3,2,0],[-3,-2,0]),i=[-1+(e+.5)*o,1-(t+.5)*u,0],f.origins.push(i,i,i,i),s=[(t+.5)*l,(e+.5)*a],f.coords.push(s,s,s,s),f.lines.push([r,r+1],[r+1,r+2],[r+1,r+3]),r+=4;f.compile()},S=function(){d=$(u.canvas),d.attr("id",t||l)},x=function(){u.bindFramebuffer(u.FRAMEBUFFER,null),u.viewport(0,0,v,m)},T={renderVectormap:function(){if(!g)throw new Error("Vectormap: bind heatmap texture before rendering.");(v!==d.width()||m!==d.height())&&this.updateCanvasSize(),x(),g.bind(0),a.draw(f,u.LINES),g.unbind(0)},updateCanvasSize:function(){v=d.width(),m=d.height(),d.attr("width",v),d.attr("height",m),a.uniforms({scale:[2/v,2/m]})},bindVectormapTexture:function(e,t,n,r){g=e,y=t,b=n,w=Math.round(y/r),E()},getHTMLElement:function(){return d}};return a.uniforms({vectormap_tex:0,base_length:h,vector_scale:c,color:p}),S(),T},energy2d.namespace("energy2d.views"),energy2d.views.makeSimulationDescription=function(e){"use strict";var t="energy2d-description",n="energy2d-description",r,i,s=function(){var r,s,o,u;i=$("<div />"),i.attr("id",e.id||t),i.addClass(e.class||n),r=$("<div>"+e.title+"</div>"),r.attr("class",t+"-title"),i.append(r),s=$("<div>"+e.tagline+"</div>"),s.attr("class",t+"-tagline"),i.append(s),o=$("<div>"+e.content+"</div>"),o.attr("class",t+"-content"),i.append(o),u=$("<div>"+e.footnote+"</div>"),u.attr("class",t+"-footnote"),i.append(u)},o={bindSimulationController:function(e){r=e},getHTMLElement:function(){return i}};return s(),o},energy2d.namespace("energy2d.views"),energy2d.views.makePerformanceView=function(e){"use strict";var t="energy2d-performance",n="energy2d-performance",r,i,s,o,u=function(){r=$("<div />"),s=$("<pre />"),i=$("<pre />"),r.append("<h2>FPS Counters:</h2>"),r.append(s),r.append("<h2>Stats (average time):</h2>"),r.append(i)},a=function(e,t){var n,r,s;for(n in e)if(e.hasOwnProperty(n)){r=e[n];for(s=0;s<t;s+=1)i.append("  ");i.append(r.id+": "+r.data.avg.toFixed(2)+"ms\n"),a(r.children,t+1)}},f=function(e){i.html(""),a(e.children,0)},l=function(e){var t;s.html("");for(t in e)e.hasOwnProperty(t)&&s.append(t+": "+e[t].fps.toFixed(2)+" fps")},c={bindModel:function(e){o=e},update:function(){l(o.getFPSData()),f(o.getTree())},getHTMLElement:function(){return r}};return u(),c},energy2d.namespace("energy2d.views"),energy2d.views.makeWebGLStatusView=function(e){"use strict";var t=energy2d.utils.gpu,n="energy2d-webgl-status",r,i,s,o,u,a,f=function(){r=$("<div />"),r.attr("id",e||n),r.append("<h2>WebGL status</h2>"),i=$("<p />"),r.append(i),o=$("<ul />"),r.append(o),s=$("<p />"),s.css("color","orange"),r.append(s)},l=function(){var e,n;a={};try{e=t.init(),a["WebGL context"]=!0}catch(r){a["WebGL context"]=!1;return}e.getExtension("OES_texture_float")?a["OES_texture_float extension"]=!0:a["OES_texture_float extension"]=!1,a["OES_texture_float extension"]&&(n=new t.Texture(1,1,{type:e.FLOAT,format:e.RGBA,filter:e.LINEAR}),n.setAsRenderTarget(),e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE?a["FLOAT texture as render target"]=!0:a["FLOAT texture as render target"]=!1,e.bindFramebuffer(e.FRAMEBUFFER,null))},c=function(){var e,t,n,r;i.html("Energy2D GPU solvers: "),u.isWebGLActive()?(t=$("<span>active</span>"),t.css("color","green")):(t=$("<span>inactive</span>"),t.css("color","orange")),i.append(t),o.html("");for(e in a)a.hasOwnProperty(e)&&(a[e]?(t=$("<span>available</span>"),t.css("color","green")):(t=$("<span>not available</span>"),t.css("color","red")),n=$("<li>"+e+": </li>"),n.append(t),o.append(n));s.html(""),r=u.getWebGLError(),r!==undefined&&s.append(r)},h={bindModel:function(e){u=e},updateAndRender:function(){l(),c()},getHTMLElement:function(){return r}};return f(),h},energy2d.namespace("energy2d.views"),energy2d.views.makeEnergy2DScene=function(e,t){"use strict";var n="energy2d-scene-view",r="energy2d-scene-view",i={color_palette_type:0,minimum_temperature:0,maximum_temperature:40},s,o,u,a,f,l,c=0,h=function(){l=$("<div />"),l.attr("id",e||n),l.addClass(r),l.css("position","relative"),l.append(s.getHTMLElement()),l.append(o.getHTMLElement()),l.append(a.getHTMLElement()),l.append(u.getHTMLElement()),l.append(f.getHTMLElement())},p=function(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("left","0"),t.css("top","0"),t.css("z-index",c),c+=1},d=function(e){var t=e.getHTMLElement();t.css("color","white"),t.css("font-weight","bold"),t.css("font-family","Monospace"),t.css("position","absolute"),t.css("right","0"),t.css("top","0"),t.css("z-index",c),c+=1},v={getHeatmapView:function(){return s},getVelocityView:function(){return o},getPartsView:function(){return u},getPhotonsView:function(){return a},getTimeView:function(){return f},getHTMLElement:function(){return l},setVisualizationOptions:function(e){var t;for(t in i)i.hasOwnProperty(t)&&e[t]===undefined&&(e[t]=i[t]);s.setMinTemperature(e.minimum_temperature),s.setMaxTemperature(e.maximum_temperature),s.setColorPalette(e.color_palette_type)}};return t?(s=energy2d.views.makeHeatmapWebGLView(),o=energy2d.views.makeVectormapWebGLView(),p(o)):(s=energy2d.views.makeHeatmapView(),o=energy2d.views.makeVectormapView(),p(s),p(o)),a=energy2d.views.makePhotonsView(),p(a),u=energy2d.views.makePartsView(),p(u),f=energy2d.views.makeTimeView(),d(f),h(),v},energy2d.views.makePartsView=function(e){"use strict";var t="energy2d-parts-view",n="energy2d-parts-view",r,i,s,o,u,a,f,l,c,h=[],p=function(){r=$("<canvas />"),r.attr("id",e||t),r.addClass(n),i=r[0].getContext("2d")},d=function(){i.strokeStyle="black",i.lineCap="round",i.lineJoin="round",i.lineWidth=1,i.font="12px sans-serif",i.textBaseline="middle"},v=function(){var e=8,t=8,n,r;n=$("<canvas />"),n.attr("width",e),n.attr("height",t),r=n[0].getContext("2d"),r.clearRect(0,0,e,t),r.strokeStyle="black",r.beginPath(),r.moveTo(0,0),r.lineTo(t,t),r.stroke(),h.push(n[0])},m=function(e){var t=e.x*a-1,n=e.y*f-1,r=e.width*a+2,s=e.height*f+2,o=t+.5*r,u=n+.5*s;i.beginPath(),i.moveTo(t,n),i.lineTo(t+r,n),i.lineTo(t+r,n+s),i.lineTo(t,n+s),i.lineTo(t,n),i.closePath()},g=function(e){var t=e.x_coords,n=e.y_coords,r=0,s=0,o,u;i.beginPath(),i.moveTo(t[0]*a,n[0]*f);for(o=1,u=e.count;o<u;o+=1)i.lineTo(t[o]*a,n[o]*f);i.closePath()},y=function(e){var t,n,r,s,o,u,l;if(e.rectangle)n=e.rectangle.x+.5*e.rectangle.width,r=e.rectangle.y+.5*e.rectangle.height;else if(e.ellipse)n=e.ellipse.x,r=e.ellipse.y;else if(e.ring)n=e.ring.x,r=e.ring.y;else if(e.polygon){o=e.polygon.vertices,n=r=0;for(u=0,l=e.polygon.count;u<l;u+=1)n+=o[u*2],r+=o[u*2+1];n/=l,r/=l}n*=a,r*=f,i.fillStyle="white",t=e.getLabel(),s=i.measureText(t).width,i.fillText(t,n-.5*s,r)},b=function(e){var t="gray",n;if(e.color)if(typeof e.color=="string")n=e.color;else{n=e.color.toString();while(n.length<6)n="0"+n}else e.power>0?n="FFFF00":e.power<0?n="B0C4DE":e.constant_temperature?n="rgba(0, 0, 0, 0.0)":n=t;return n},w={renderParts:function(){var e,t,n,a;if(!u)throw new Error("Parts view: bind parts array before rendering.");(s!==r.width()||o!==r.height())&&this.updateCanvasSize(),i.clearRect(0,0,s,o);for(n=0,a=u.length;n<a;n+=1){e=u[n];if(!e.visible)continue;g(e.shape.polygonize()),e.rectangle?m(e.shape):g(e.shape.polygonize()),e.filled&&(i.fillStyle=b(e),i.fill()),e.texture&&(i.fillStyle=i.createPattern(h[0],"repeat"),i.fill()),i.stroke(),e.ring&&(g(e.shape.polygonizeInner()),t=i.globalCompositeOperation,i.globalCompositeOperation="destination-out",i.fill(),i.globalCompositeOperation=t,i.stroke()),e.label&&y(e)}},bindPartsArray:function(e,t,n){u=e,l=t,c=n,a=s/l,f=o/c},getHTMLElement:function(){return r},updateCanvasSize:function(){s=r.width(),o=r.height(),a=s/l,f=o/c,r.attr("width",s),r.attr("height",o),d()}};return p(),d(),v(),w},energy2d.views.makePhotonsView=function(e){"use strict";var t="energy2d-photons-view",n="energy2d-photons-view",r=10,i,s,o,u,a,f,l,c,h,p=function(){i=$("<canvas />"),i.attr("id",e||t),i.addClass(n),s=i[0].getContext("2d")},d=function(){s.strokeStyle="rgba(255,255,255,128)",s.lineWidth=.5},v={renderPhotons:function(){var e,t,n,c,h,p;if(!a)throw new Error("Photons view: bind parts array before rendering.");(o!==i.width()||u!==i.height())&&this.updateCanvasSize(),s.clearRect(0,0,o,u);for(h=0,p=a.length;h<p;h+=1)e=a[h],t=e.x*f,n=e.y*l,c=1/Math.sqrt(e.vx*e.vx+e.vy*e.vy),s.beginPath(),s.moveTo(t,n),s.lineTo(t+r*e.vx*c,n+r*e.vy*c),s.stroke()},bindPhotonsArray:function(e,t,n){a=e,c=t,h=n,f=o/c,l=u/h},getHTMLElement:function(){return i},updateCanvasSize:function(){o=i.width(),u=i.height(),f=o/c,l=u/h,i.attr("width",o),i.attr("height",u),d()}};return p(),d(),v},energy2d.views.makeSimulationPlayerView=function(e){"use strict";var t="energy2d-simulation-player",n="energy2d-simulation-player",r,i,s=function(){var s;i=$("<div />"),i.attr("id",e||t),i.addClass(n),s=$('<button type="button" id="sim-stop">Stop</button>'),s.click(function(){r.simulationStop()}),i.append(s),s=$('<button type="button" id="sim-step">Step</button>'),s.click(function(){r.simulationStep()}),i.append(s),s=$('<button type="button" id="sim-play">Play</button>'),s.click(function(){r.simulationPlay()}),i.append(s),s=$('<button type="button" id="sim-reset">Reset</button>'),s.click(function(){r.simulationReset()}),i.append(s)},o={bindSimulationController:function(e){r=e},getHTMLElement:function(){return i}};return s(),o},energy2d.views.makeTimeView=function(e){"use strict";var t="energy2d-time",n="energy2d-time",r,i=function(){r=$("<div />"),r.attr("id",e||t),r.addClass(n),r.html("0:00:00:00")},s=function(e,t){var n=e.toString();while(n.length<t)n="0"+n;return n},o={renderTime:function(e){var t,n,i,o;e=Math.floor(e),t=e%60,e=Math.floor(e/60),n=e%60,e=Math.floor(e/60),i=e%24,e=Math.floor(e/24),o=e,r.html(o+":"+s(i,2)+":"+s(n,2)+":"+s(t,2))},getHTMLElement:function(){return r}};return i(),o},energy2d.namespace("energy2d.controllers"),energy2d.controllers.makeInteractiveController=function(e,t,n){"use strict";var r=energy2d.modeler,i=energy2d.views,s=energy2d.utils.performance,o,u,a,f,l=4,c,h,p,d,v,m,g,y,b={start:function(){},stop:function(){},startFPS:function(){},updateFPS:function(){},stopFPS:function(){}},w,E,S,x,T=function(e){return typeof ACTUAL_ROOT=="undefined"||e.charAt(0)!=="/"?e:ACTUAL_ROOT+e},N=function(e){return c=i.makeEnergy2DScene(e.id,f),h=c.getHeatmapView(),p=c.getVelocityView(),d=c.getPartsView(),v=c.getPhotonsView(),m=c.getTimeView(),c},C=function(e){return g=i.makeSimulationPlayerView(e.id),g.bindSimulationController(o),g},k=function(e){return w=i.makePerformanceView(e.id),w},L=function(e){return E=i.makeWebGLStatusView(e.id),E},A=function(e){return y=i.makeSimulationDescription(e),y.bindSimulationController(o),y},O=function(e){if(!e.type)throw new Error('Interactive controller: missing component "type" property.');switch(e.type){case"energy2d-scene-view":return N(e);case"energy2d-simulation-player":return C(e);case"energy2d-performance-view":return k(e);case"energy2d-webgl-status-view":return L(e);default:throw new Error("Interactive controller: unknow type of component.")}},M=function(){h.renderHeatmap(),p.renderVectormap(),v.renderPhotons(),m.renderTime(u.getTime()),w&&w.update()},_=function(){var e,t;b.stop("Gap between frames"),b.start("Frame (inc. "+l+" model steps)");for(e=0,t=l;e<t;e+=1)u.nextStep();b.start("Views update"),M(),b.stop("Views update"),b.stop("Frame (inc. "+l+" model steps)"),b.start("Gap between frames"),b.updateFPS("Model update and rendering")},D=function(){u=r.makeModeler(a.model),f=u.isWebGLActive()},P=function(){var r=e.components||[],i=e.description||{},s=e.layout||{},o,u,a,f,l;S=[];for(f=0,l=r.length;f<l;f+=1)o=O(r[f]),a=o.getHTMLElement(),u=s[r[f].id]||{},u.css&&a.css(u.css),u.class&&a.addClass(u.class),u.container?a.appendTo(u.container):a.appendTo(t),S.push(a);i&&(o=A(i),a=o.getHTMLElement(),a.appendTo(n),S.push(a))},H=function(){var e,t;for(e=0,t=S.length;e<t;e+=1)S[e].remove();S=[]},B=function(){var e,t;c.setVisualizationOptions(a.view),e=u.getGridWidth(),t=u.getGridHeight(),d.bindPartsArray(u.getPartsArray(),u.getWidth(),u.getHeight()),v.bindPhotonsArray(u.getPhotonsArray(),u.getWidth(),u.getHeight()),f?(h.bindHeatmapTexture(u.getTemperatureTexture()),p.bindVectormapTexture(u.getVelocityTexture(),e,t,25)):(h.bindHeatmap(u.getTemperatureArray(),e,t),p.bindVectormap(u.getUVelocityArray(),u.getVVelocityArray(),e,t,25)),w&&(b=s.makePerformanceTools(),w.bindModel(b),u.setPerformanceTools(b)),E&&(E.bindModel(u),E.updateAndRender()),M(),d.renderParts()},j=function(){$.get(T(e.model)).success(function(e){typeof e=="string"&&(e=JSON.parse(e)),a=e,D(),P(),B()}).error(function(e,t,n){throw new Error("Interactive controller: loading scene options failed - "+t)})};return o={setWebGLEnabled:function(e){o.simulationStop(),a.model.use_WebGL=e,D(),H(),P(),B()},simulationPlay:function(){x||(x=setInterval(_,0),b.start("Gap between frames"),b.startFPS("Model update and rendering"))},simulationStep:function(){x||(b.start("Gap between frames"),_(),b.stop("Gap between frames"))},simulationStop:function(){x!==undefined&&(b.stop("Gap between frames"),b.stopFPS("Model update and rendering"),clearInterval(x),x=undefined)},simulationReset:function(){o.simulationStop(),D(),B()}},j(),o}}(),function(){function e(){var e=/ (Chrome)\/(.*?) /,n=/ (Firefox)\/([0123456789ab.]+)/,r=/ Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,s=/^(Opera)\/.+? Version\/([0123456789.]+)$/,o=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,u=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,f=/.+?(Android) ([0123456789.]+).+?; (.+?)\).+? CrMo\/([0123456789.]+)/,l=/.+?(Android) ([0123456789ab.]+).+?; (.+?)\)/,c;c=navigator.userAgent.match(e);if(c&&c[1])return{browser:c[1],version:c[2],oscpu:t()};c=navigator.userAgent.match(n);if(c&&c[1])return{browser:c[1],version:c[2],oscpu:t()};c=navigator.userAgent.match(f);if(c&&c[1])return{browser:"Chrome",version:c[4],oscpu:c[1]+"/"+c[2]+"/"+c[3]};c=navigator.userAgent.match(l);if(c&&c[1])return{browser:"Android",version:c[2],oscpu:c[1]+"/"+c[2]+"/"+c[3]};c=navigator.userAgent.match(r);if(c&&c[2])return{browser:c[2],version:c[1],oscpu:t()};c=navigator.userAgent.match(i);if(c&&c[1]){var h=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:c[1],version:c[2],oscpu:windows_platform_token[h[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return c=navigator.userAgent.match(s),c&&c[1]?{browser:c[1],version:c[2],oscpu:t()}:(c=navigator.userAgent.match(o),c&&c[1]?{browser:"Mobile Safari",version:c[2],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:(c=navigator.userAgent.match(u),c&&c[1]?{browser:"Mobile Safari",version:c[2],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:(c=navigator.userAgent.match(a),c&&c[1]?{browser:"Mobile Safari",version:c[3],oscpu:c[1]+"/"+"iOS"+"/"+c[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function t(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var t=windows_feature_token[e[2]]||"32",n=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return windows_platform_token[n[1]]+"/"+t}}function n(t,n){function a(){return t.appendChild(document.createElement("tr"))}function c(e,t,n){n=n||"td",e.appendChild(document.createElement(n)).textContent=t}function h(e,t){u&&c(f,e,"th"),c(l,t)}var r=0,i,s,o=[];t.style.display="";var u=t.getElementsByTagName("tr").length===0,f=a(),l=a();s=e(),h("browser",s.browser),h("version",s.version),h("cpu/os",s.oscpu);var p=d3.time.format("%Y-%m-%d %H:%M");h("date",p(new Date));for(r=0;r<n.length;r++)i=n[r],h(i.name,i.run())}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),benchmark={},benchmark={version:"0.0.1"},benchmark.what_browser=function(){return e()},benchmark.run=function(e,t){n(e,t)},windows_platform_token={"Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},windows_feature_token={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"}}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),layout={version:"0.0.1"},layout.selection="",layout.display={},layout.canonical={width:1280,height:800},layout.regular_display=!1,layout.not_rendered=!0,layout.fontsize=!1,layout.cancelFullScreen=!1,layout.screen_factor=1,layout.checkbox_factor=1.1,layout.checkbox_scale=1.1,layout.fullScreenRender=!1,layout.canonical.width=1280,layout.canonical.height=800,layout.getDisplayProperties=function(e){if(!arguments.length)var e={};return e.screen={width:screen.width,height:screen.height},e.client={width:document.body.clientWidth,height:document.body.clientHeight},e.window={width:document.width,height:document.height},e.page={width:layout.getPageWidth(),height:layout.getPageHeight()},e.screen_factor_width=e.page.width/layout.canonical.width,e.screen_factor_height=e.page.height/layout.canonical.height,e.emsize=Math.min(e.screen_factor_width*1.1,e.screen_factor_height),e},layout.screenEqualsPage=function(){return layout.display.screen.width===layout.display.page.width||layout.display.screen.height===layout.display.page.height},layout.checkForResize=function(){(layout.display.screen.width!=screen.width||layout.display.screen.height!=screen.height||layout.display.window.width!=document.width||layout.display.window.height!=document.height)&&layout.setupScreen()},layout.views={},layout.addView=function(e,t){layout.views[e]||(layout.views[e]=[]),layout.views[e].push(t)},layout.setView=function(e,t){layout.views[e]=t},layout.setupScreen=function(e){function s(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.4,r=n*1/f,r>c*.55&&(r=c*.55,n=r*f),e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);u=(l-n)*.35,s=r*.52,e=-1;while(++e<t.potentialCharts.length)t.potentialCharts[e].resize(u,s);e=-1;while(++e<t.speedDistributionCharts.length)t.speedDistributionCharts[e].resize(u,s);o=(l-n)*.72,s=r*.76,e=-1;while(++e<t.energyCharts.length)t.energyCharts[e].resize(o,s)}function o(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.46,r=n*1/f,r>c*.7&&(r=c*.7,n=r*f);for(viewType in t)if(t.hasOwnProperty(viewType)&&t[viewType].length){e=-1;while(++e<t[viewType].length)t[viewType][e].resize(n,r)}}function u(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.7,r=n*1/f,r>c*.7&&(r=c*.7,n=r*f);for(viewType in t)if(t.hasOwnProperty(viewType)&&t[viewType].length){e=-1;while(++e<t[viewType].length)t[viewType][e].resize(n,r)}}function a(){var e,n,r,i,s,o=layout.display.page.width,u=layout.display.page.height;i=t.moleculeContainers[0].scale(),s=i[0]/i[1],n=o*.4,r=n*1/s,e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);if(t.appletContainers){e=-1;while(++e<t.appletContainers.length)t.appletContainers[e].resize(n,r)}}function f(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.46,r=n*1/f,r>c*.7&&(r=c*.7,n*r*f),e=-1;while(++e<t.moleculeContainers.length)t.moleculeContainers[e].resize(n,r);u=(l-n)*.41,s=r*.42,e=-1;while(++e<t.potentialCharts.length)t.potentialCharts[e].resize(u,s);e=-1;while(++e<t.speedDistributionCharts.length)t.speedDistributionCharts[e].resize(u,s);o=(l-n)*.86,s=r*.57,e=-1;while(++e<t.energyCharts.length)t.energyCharts[e].resize(o,s)}function l(){var e,n,r,i,s;r=Math.min(layout.display.page.height*.45,layout.display.page.width*.5),t.moleculeContainers[0].resize(r,r),i=t.moleculeContainers[0].scale(),s=i[0]/layout.display.page.width,s>.5&&(r*=.5/s,t.moleculeContainers
[0].resize(r,r)),t.thermometers[0].resize()}function c(){var e,n,r,i,s,o=document.getElementById("description-right");r=Math.min(layout.display.page.height*.65,layout.display.page.width*.5),t.moleculeContainers[0].resize(r,r),i=t.moleculeContainers[0].scale(),s=i[0]/layout.display.page.width,s>.5&&(r*=.5/s,t.moleculeContainers[0].resize(r,r)),t.thermometers[0].resize()}function h(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.7,r=n*1/f,r>c*.7&&(r=c*.7,n*r*f),t.moleculeContainers[0].resize(n,r),i=t.moleculeContainers[0].scale(),t.thermometers[0].resize()}function p(){var e,n,r,i,s,o,u,a,f,l=layout.display.page.width,c=layout.display.page.height;i=t.moleculeContainers[0].scale(),f=i[0]/i[1],a=i[0]/l,n=l*.6,r=n*1/f,r>c*.6&&(r=c*.6,n*r*f),t.moleculeContainers[0].resize(n,r)}function d(){var e=document.getElementById("description-right");e===null}var t=layout.views,n=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;e&&(layout.not_rendered=!0),layout.display=layout.getDisplayProperties(),layout.regular_display||(layout.regular_display=layout.getDisplayProperties());if(n||layout.fullScreenRender||layout.screenEqualsPage()){layout.fullScreenRender=!0,layout.screen_factor_width=layout.display.page.width/layout.canonical.width,layout.screen_factor_height=layout.display.page.height/layout.canonical.height,layout.screen_factor=layout.screen_factor_height,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor),layout.bodycss.style.fontSize=layout.screen_factor+"em",layout.not_rendered=!0;switch(layout.selection){case"simple-screen":layout.not_rendered&&p();break;case"simple-static-screen":layout.not_rendered&&p();break;case"simple-iframe":p(),d();break;case"compare-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",a(),layout.not_rendered=!1;break;default:layout.not_rendered&&f()}}else{layout.cancelFullScreen||layout.fullScreenRender?(layout.cancelFullScreen=!1,layout.fullScreenRender=!1,layout.not_rendered=!0,layout.regular_display=layout.previous_display):layout.regular_display=layout.getDisplayProperties(),layout.screen_factor_width=layout.display.page.width/layout.canonical.width,layout.screen_factor_height=layout.display.page.height/layout.canonical.height,layout.screen_factor=layout.screen_factor_height,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor);switch(layout.selection){case"simple-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",l();break;case"simple-static-screen":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",c(),layout.not_rendered=!1}break;case"simple-iframe":var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",h();break;case"full-static-screen":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",s(),layout.not_rendered=!1}break;case"compare-screen":var r=Math.min(layout.screen_factor_width*1.1,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",a();break;case"interactive":if(layout.not_rendered){var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",o(),layout.not_rendered=!1}break;case"interactive-iframe":var r=Math.min(layout.screen_factor_width*1.5,layout.screen_factor_height);layout.bodycss.style.fontSize=r+"em",u();break;default:layout.bodycss.style.fontSize=layout.screen_factor+"em",setupRegularScreen()}layout.regular_display=layout.getDisplayProperties()}layout.transform&&$("input[type=checkbox]").css(layout.transform,"scale("+layout.checkbox_factor+","+layout.checkbox_factor+")"),layout.setupTemperature(model),layout.temperature_control_checkbox&&(model.addPropertiesListener(["temperature_control"],layout.temperatureControlUpdate),layout.temperatureControlUpdate());var i=document.getElementById("benchmarks-table");i&&(i.style.display="none")},layout.getStyleForSelector=function(e){var t,n=document.styleSheets;for(var r=0;r<n.length;r++)if(n[r])try{t=n[r].rules||n[r].cssRules;if(t)for(var i=0;i<t.length;i++)if(t[i].selectorText==e)return t[i]}catch(s){}return!1},layout.getPageHeight=function(){var e;return window.innerHeight?e=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=layout.display.window.height),e},layout.getPageWidth=function(){var e;return window.innerWidth?e=window.innerWidth:document.documentElement&&document.documentElement.clientWidth?e=document.documentElement.clientWidth:document.body&&(e=window.width),e},layout.getTransformProperty=function(e){var t=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],n;if(e)while(n=t.shift())if(typeof e.style[n]!="undefined")return n;return!1};var e=document.getElementById("description-right");e!==null&&(layout.fontsize=parseInt(layout.getStyleForSelector("#description-right").style.fontSize)),layout.bodycss=layout.getStyleForSelector("body"),layout.transform=layout.getTransformProperty(document.body);if(document.querySelectorAll){var t=document.querySelector("#fullscreen");t&&(t.style.cursor="pointer",t.addEventListener("click",function(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen,n=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen,r=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;t?n?(layout.cancelFullScreen=!0,r.call(document)):(layout.cancelFullScreen=!1,t.call(e)):alert("You'll need to use a newer browser to use the\nfull-screen API.\n\nChrome v15 (beta)\nhttp://www.google.com/landing/chrome/beta/\n\nChrome v17 Canary:\nhttp://tools.google.com/dlpage/chromesxs\n\nSafari v5.1.1:\n\nFireFox v9 Aurora:\nhttps://www.mozilla.org/en-US/firefox/channel/\n\nFireFox v10 Nightly\nhttp://nightly.mozilla.org/\nOpen 'about:config' and set: full-screen-api-enabled")},!1))}}(),function(){function u(){var e=+s.value;s.type==="range"&&(o.innerText=d3.format("4.1f")(e)+" K"),model.set({temperature:e})}function a(){layout.lennard_jones_forces_checkbox.checked?model.set_lennard_jones_forces(!0):model.set_lennard_jones_forces(!1)}function f(){layout.coulomb_forces_checkbox.checked?model.set({coulomb_forces:!0}):model.set({coulomb_forces:!1})}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),views={version:"0.0.1"},layout.appletContainer=function(e,t){function x(e,t){return arguments.length?(s=t,i=e):(s=n.property("clientHeight"),i=n.property("clientWidth")),o&&(a=+o.runMwScript("mw2d:1:get %width"),f=+o.runMwScript("mw2d:1:get %height"),l=a/f,s=i*1/l*1.25),r.style.width=i+"px",r.style.height=s+"px",p=layout.screen_factor,layout.screen_factor_width&&layout.screen_factor_height&&(p=Math.min(layout.screen_factor_width,layout.screen_factor_height)),p=i/600,d={top:5,right:5,bottom:5,left:5},h=s-d.top-d.bottom,c=i-d.left-d.right,v={width:c,height:h},[i,s]}function T(){function e(){var e,n,r;r=['<applet id="'+t.appletID+'", codebase="'+t.codebase+'", code="'+t.code+'"','     width="'+t.width+'" height="'+t.height+'" MAYSCRIPT="true"','     archive="'+t.archive+'">','     MAYSCRIPT="true">'];for(e=0;e<t.params.length;e++)n=t.params[e],r.push('  <param name="'+n[0]+'" value="'+n[1]+'"/>');return r.push('  <param name="MAYSCRIPT" value="true"/>'),r.push("  Your browser is completely ignoring the applet tag!"),r.push("</applet>"),r.join("\n")}o===undefined?(u=e(),r.innerHTML=u,o=document.getElementById(t.appletID)):(o.style.width=v.width,o.style.height=v.height,o.width=v.width,o.height=v.height),T.node=r,T.scale=x,T.applet=o}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E={appletID:"mw-applet",codebase:"/jnlp",code:"org.concord.modeler.MwApplet",width:"100%",height:"100%",archive:"org/concord/modeler/mw.jar",align:"left",hspace:"5",vspace:"5",params:[["script","page:0:import /imports/legacy-mw-content/potential-tests/two-atoms-two-elements/two-atoms-two-elements.cml"]]};if(t)for(var S in E)t[S]===undefined&&(t[S]=E[S]);else t=E;return x(i,s),T.resize=function(e,t){T.scale(e,t)},r&&T(),T},layout.moleculeContainer=function(e,t){function nt(e){e&&(t=e);if(t)for(var n in tt)t[n]===undefined&&(t[n]=tt[n]);else t=tt;G=t.get_nodes,Q=G(),K=t.get_num_atoms,J.length=K(),Z=t.get_obstacles}function rt(e,f){var l=model.size(),c=l[0]/l[1];a=layout.screen_factor,d={top:t.title?40*layout.screen_factor:20,right:25,bottom:10,left:t.ylabel?60*layout.screen_factor:25};if(t.xlabel||t.model_time_label)d.bottom+=35*a;if(t.playback_controller||t.play_only_controller)d.bottom+=40*a;return arguments.length?(o=e,u=f,i=o+d.left+d.right,s=u+d.top+d.bottom,r.style.height=s+"px"):(s=n.property("clientHeight"),u=s-d.top-d.bottom,o=u*c,i=o+d.left+d.right),r.style.width=i+"px",v={width:o,height:u},q=r.offsetTop+d.top,t.playback_controller&&(L=d.left+(v.width-230*a)/2),t.play_only_controller&&(L=d.left+(v.width-140*a)/2),A=s-42*a,m=v.width,g=v.height,E=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,m]),S=E.copy(),x=Math.NaN,T=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,g]).nice(),y_flip=d3.scale.linear().domain([t.ymin,t.ymax]).nice().range([0,g]).nice(),N=T.copy(),C=Math.NaN,k=null,[i,s]}function it(){return M+O(model.getTime()/1e3)+_}function st(e){return Q[model.INDICES.ELEMENT][e]}function ot(e){return Q[model.INDICES.X][e]}function ut(e){return Q[model.INDICES.Y][e]}function at(e){return Q[model.INDICES.RADIUS][e]}function ft(e){return Q[model.INDICES.SPEED][e]}function lt(e){return Q[model.INDICES.VX][e]}function ct(e){return Q[model.INDICES.VY][e]}function ht(e){return Q[model.INDICES.AX][e]}function pt(e){return Q[model.INDICES.AY][e]}function dt(e){return Q[model.INDICES.CHARGE][e]}function vt(e){return obstacles[model.OBSTACLE_INDICES.X][e]}function mt(e){return obstacles[model.OBSTACLE_INDICES.Y][e]}function gt(e){return obstacles[model.OBSTACLE_INDICES.WIDTH][e]}function yt(e){return obstacles[model.OBSTACLE_INDICES.HEIGHT][e]}function bt(e){return"rgb("+obstacles[model.OBSTACLE_INDICES.COLOR_R][e]+","+obstacles[model.OBSTACLE_INDICES.COLOR_G][e]+","+obstacles[model.OBSTACLE_INDICES.COLOR_B][e]+")"}function wt(){function o(){d3.event&&d3.event.transform&&isNaN(x)&&isNaN(C)&&d3.event.transform(E,T);var e=E.tickFormat(10),n=T.tickFormat(10);if(t.xunits){var r=l.selectAll("g.x").data(E.ticks(10),String).attr("transform",y);r.select("text").text(e);var i=r.enter().insert("svg:g","a").attr("class","x").attr("transform",y);t.grid_lines&&i.append("svg:line").attr("stroke",w).attr("y1",0).attr("y2",v.height),i.append("svg:text").attr("y",v.height).attr("dy","1em").attr("text-anchor","middle").text(e),r.exit().remove()}if(t.xunits){var s=l.selectAll("g.y").data(T.ticks(10),String).attr("transform",b);s.select("text").text(n);var o=s.enter().insert("svg:g","a").attr("class","y").attr("transform",b).attr("background-fill","#FFEEB6");t.grid_lines&&o.append("svg:line").attr("stroke",w).attr("x1",0).attr("x2",v.width),o.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(n),t.model_time_label&&p.text(it()),s.exit().remove()}}function u(){D=l.append("svg").attr("class","container").attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),m("neg-grad","#ffefff","#fdadad","#e95e5e",D),m("pos-grad","#dfffff","#9abeff","#767fbf",D),m("green-grad","#dfffef","#75a643","#2a7216",D),m("purple-grad","#EED3F0","#D941E0","#84198A",D),m("aqua-grad","#DCF5F4","#41E0D8","#12827C",D),m("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",D),j=["green-grad","purple-grad","aqua-grad","orange-grad"]}function m(e,t,n,r,i){gradient=i.append("defs").append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),gradient.append("stop").attr("stop-color",t).attr("offset","0%"),gradient.append("stop").attr("stop-color",n).attr("offset","40%"),gradient.append("stop").attr("stop-color",r).attr("offset","80%"),gradient.append("stop").attr("stop-color",n).attr("offset","100%")}function g(){l.selectAll("circle").data(J).attr("r",function(e,t){return E(at(t))})}function S(e){e.enter().append("circle").attr("r",function(e,t){return E(at(t))}).attr("cx",function(e,t){return E(ot(t))}).attr("cy",function(e,t){return T(ut(t))}).style("cursor","crosshair").style("fill",function(e,t){return model.get("coulomb_forces")&&E(dt(t))?E(dt(t))>0?"url('#pos-grad')":"url('#neg-grad')":(element=st(t)%4,grad=j[element],"url('#"+grad+"')")}).on("mousedown",H).on("mouseout",X)}function N(e){e.enter().append("rect").attr("x",function(e,t){return E(vt(t))}).attr("y",function(e,t){return T(mt(t)+yt(t))}).attr("width",function(e,t){return E(gt(t))}).attr("height",function(e,t){return y_flip(yt(t))}).style("fill",function(e,t){return bt(t)}).style("stroke-width",.2).style("stroke","black")}function k(){O(),M()}function O(){G=t.get_nodes,Q=G(),K=t.get_num_atoms,J.length=K();var e=model.getLJCalculator()[0][0].coefficients();D.selectAll("circle").remove(),D.selectAll("g").remove(),R=D.selectAll("circle").data(J),S(R);var n=E(e.rmin*.5*1.5);model.get("mol_number")>100&&(n*=.9),U=D.selectAll("g.label").data(J),z=U.enter().append("g").attr("class","label").attr("transform",function(e,t){return"translate("+E(ot(t))+","+T(ut(t))+")"}),t.atom_mubers?z.append("text").attr("class","index").attr("font-size",n).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(e){return e.index}):z.append("text").attr("class","index").attr("font-size",n).attr("style","font-weight: bold; opacity: .7").attr("x","-0.31em").attr("y","0.31em").text(function(e,t){if(model.get("coulomb_forces")&&E(dt(t)))return E(dt(t))>0?"+":"–";return})}function M(){obstacles=Z();if(!obstacles)return;et.length=obstacles[0].length,D.selectAll("rect").remove(),Y=D.selectAll("rect").data(et),N(Y)}function _(){r.focus()}function P(e){}function H(e,t){r.focus(),F?(V.style("opacity",1e-6),V.style("display","none"),F=!1):(d3.event.shiftKey?F=t:F=!1,B(t))}function B(e){V.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.5)").style("left",E(Q[model.INDICES.X][e])+I+16+"px").style("top",T(Q[model.INDICES.Y][e])+q-30+"px").transition().duration(250),$.text(it()+"\n"+"speed: "+d3.format("+6.3e")(ft(e))+"\n"+"vx:    "+d3.format("+6.3e")(lt(e))+"\n"+"vy:    "+d3.format("+6.3e")(ct(e))+"\n"+"ax:    "+d3.format("+6.3e")(ht(e))+"\n"+"ay:    "+d3.format("+6.3e")(pt(e))+"\n")}function W(e){}function X(){typeof F!="number"&&V.style("opacity",1e-6)}function tt(){Et(),St()}function Et(){J.length=K(),Q=G(),t.model_time_label&&p.text(it()),U=n.selectAll("g.label").data(J),U.attr("transform",function(e,t){return"translate("+E(ot(t))+","+T(ut(t))+")"}),R=D.selectAll("circle").data(J),S(R),R.attr("cx",function(e,t){return E(Q[model.INDICES.X][t])}).attr("cy",function(e,t){return T(Q[model.INDICES.Y][t])}).attr("r",function(e,t){return E(Q[model.INDICES.RADIUS][t])}),typeof F=="number"&&B(F)}function St(){obstacles=Z();if(!obstacles)return;et.length=obstacles[0].length,D.selectAll("rect").remove(),Y=D.selectAll("rect").data(et),N(Y)}function xt(e){e=e?e:window.event?event:null;if(e)switch(e.keyCode){case 32:model.is_stopped()?h.action("play"):h.action("stop"),e.preventDefault();break;case 13:h.action("play"),e.preventDefault()}}function Tt(){r.onkeydown=xt}rt();if(l===undefined){f=d3.select(r).append("svg").attr("width",i).attr("height",s),l=f.append("g").attr("transform","translate("+d.left+","+d.top+")"),c=l.append("rect").attr("class","plot").attr("width",v.width).attr("height",v.height).style("fill","#EEEEEE"),t.title&&l.append("text").attr("class","title").text(t.title).attr("x",v.width/2).attr("dy","-1em").style("text-anchor","middle"),t.xlabel&&l.append("text").attr("class","xlabel").text(t.xlabel).attr("x",v.width/2).attr("y",v.height).attr("dy","2.4em").style("text-anchor","middle"),t.ylabel&&l.append("g").append("text").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+v.height/2+") rotate(-90)"),t.model_time_label&&(p=l.append("text").attr("class","model_time_label").text(it()).attr("x",v.width-100).attr("y",v.height).attr("dy","2.4em").style("text-anchor","start")),t.playback_controller&&(h=new PlaybackComponentSVG(f,model_player,L,A,a)),t.play_only_controller&&(h=new PlayOnlyComponentSVG(f,model_player,L,A,a));var e=function(){var e=model.get("temperature_control");e?d3.select("#heat_bath").style("display",""):d3.select("#heat_bath").style("display","none")};l.append("image").attr("x",5).attr("id","heat_bath").attr("y",5).attr("width",16).attr("height",16).attr("xlink:href","../../resources/heatbath.gif"),model.addPropertiesListener(["temperature_control"],e),e(),V=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),$=V.append("pre"),d3.select(r).attr("tabindex",0).on("mousedown",_),Tt(),o(),u()}else d3.select(r).select("svg").attr("width",i).attr("height",s),l.select("svg").attr("width",i).attr("height",s),l.select("rect.plot").attr("width",v.width).attr("height",v.height).style("fill","#EEEEEE"),l.select("svg.container").attr("top",0).attr("left",0).attr("width",v.width).attr("height",v.height).attr("viewBox","0 0 "+v.width+" "+v.height),t.title&&l.select("text.title").attr("x",v.width/2).attr("dy","-1em"),t.xlabel&&l.select("text.xlabel").attr("x",v.width/2).attr("y",v.height),t.ylabel&&l.select("text.ylabel").attr("transform","translate(-40 "+v.height/2+") rotate(-90)"),t.model_time_label&&p.text(it()).attr("x",v.width-100).attr("y",v.height),l.selectAll("g.x").remove(),l.selectAll("g.y").remove(),R&&(g(),R.attr("cx",function(e,t){return E(ot(t))}).attr("cy",function(e,t){return T(ut(t))}).attr("r",function(e,t){return E(at(t))}),U.attr("transform",function(e,t){return"translate("+E(ot(t))+","+T(ut(t))+")"})),Y&&Y.attr("x",function(e,t){return E(vt(t))}).attr("y",function(e,t){return T(mt(t)+yt(t))}).attr("width",function(e,t){return E(gt(t))}).attr("height",function(e,t){return y_flip(yt(t))}),(t.playback_controller||t.play_only_controller)&&h.position(L,A,a),o();wt.node=r,wt.updateMoleculeRadius=g,wt.setup_drawables=k,wt.update_drawable_positions=tt,wt.scale=rt,wt.playback_component=h,wt.options=t,wt.processOptions=nt}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=d3.format("5.2f"),M="time: ",_=" (ps)",D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J=[],K,Q,G,Y,Z,et=[],tt={title:!1,xlabel:!1,ylabel:!1,playback_controller:!1,play_only_controller:!0,model_time_label:!1,grid_lines:!1,xunits:!1,yunits:!1,atom_mubers:!1,xmin:0,xmax:10,ymin:0,ymax:10};return nt(),rt(i,s),y=function(e,t){return"translate("+E(e)+",0)"},b=function(e,t){return"translate(0,"+T(e)+")"},w=function(e,t){return e?"#ccc":"#666"},wt.resize=function(e,t){wt.scale(e,t),wt(),wt.setup_drawables()},wt.reset=function(e){wt.processOptions(e),wt(),wt.setup_drawables(),wt.updateMoleculeRadius()},r&&wt(),wt},layout.potentialChart=function(e,t,n){function A(){var e,n,r,i,s,o;T=t.getLJCalculator()[0][0],N.coefficients=T.coefficients(),e=N.coefficients.sigma,n=N.coefficients.epsilon,r=N.coefficients.rmin,N.xmax=e*3,N.xmin=Math.floor(e/2),N.ymax=.4,N.ymin=Math.ceil(n*1)-1,N.variables[0].x=r,N.variables[0].y=n,N.variables[1].x=e,N.variables[1].y=0,C.length=0;for(s=e*.5;s<N.xmax*3;s+=.001)i=-T.potential(s,0,0),Math.abs(i)<100&&C.push([s,i])}function O(e,t){s=e,o=t,i.style.width=s+"px",i.style.height=o+"px",u={top:n.title?40:20,right:35,bottom:n.xlabel?56:30,left:n.ylabel?60:25},width=s-u.left-u.right,height=o-u.top-u.bottom,a={width:width,height:height},f=a.width,l=a.height,d=d3.scale.linear().domain([N.xmin,N.xmax]).range([0,f]),m=d3.scale.linear().domain([N.ymax,N.ymin]).range([0,l]),v=Math.NaN,g=Math.NaN,b=null}function M(){function e(){d3.event&&d3.event.transform&&isNaN(v)&&isNaN(g)&&d3.event.transform(x,y);var t=d.tickFormat(5),n=m.tickFormat(5),r=E.selectAll("g.x").data(d.ticks(5),String).attr("transform",c);r.select("text").text(t);var i=r.enter().insert("g","a").attr("class","x").attr("transform",c);i.append("line").attr("stroke",p).attr("y1",0).attr("y2",a.height),i.append("text").attr("y",a.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(t).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(E[0][0]);v=d.invert(t[0])}),r.exit().remove();var s=E.selectAll("g.y").data(m.ticks(10),String).attr("transform",h);s.select("text").text(n);var o=s.enter().insert("g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");o.append("line").attr("stroke",p).attr("x1",0).attr("x2",a.width),o.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(n).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(E[0][0]);g=m.invert(t[1])}),s.exit().remove(),S.call(d3.behavior.zoom().x(d).y(m).scaleExtent([1,8]).on("zoom",e)),f()}function f(){var e=E.selectAll("circle").data(N.variables,function(e){return e}),t=E.select("path").attr("d",line(C)),n=d.domain()[1]-d.domain()[0];e.enter().append("circle").attr("class",function(e){return e===w?"selected":null}).attr("cx",function(e){return d(e.x)}).attr("cy",function(e){return m(e.y)}).style("cursor",function(e){return e.cursorStyle}).attr("r",8).on("mousedown",function(e){e.coefficient=="epsilon"?e.x=N.coefficients.rmin:e.y=0,coefficient_selected=w=e,f()}),e.attr("class",function(e){return e===coefficient_selected?"selected":null}).attr("cx",function(e){return d(e.x)}).attr("cy",function(e){return m(e.y)}),e.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function l(){r.style("cursor","move")}function b(){var r=d3.svg.mouse(E[0][0]),s,o,u,l=d3.event.changedTouches;if(w){i.onselectstart=function(){return!1};var c=d3.svg.mouse(E.node()),h,p;w.coefficient=="epsilon"?(h=N.coefficients.rmin,p=m.invert(Math.max(0,Math.min(a.height,c[1]))),p>n.epsilon_max&&(p=n.epsilon_max),p<n.epsilon_min&&(p=n.epsilon_min),t.set({epsilon:p})):(p=0,h=d.invert(Math.max(0,Math.min(a.width,c[0]))),h<n.sigma_min&&(h=n.sigma_min),h>n.sigma_max&&(h=n.sigma_max),t.set({sigma:h})),w.x=h,w.y=p,f()}isNaN(v)||(d3.select("body").style("cursor","ew-resize"),d.domain(grapher.axis.axisProcessDrag(v,d.invert(r[0]),d.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(d3.select("body").style("cursor","ns-resize"),m.domain(grapher.axis.axisProcessDrag(g,m.invert(r[1]),m.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation())}function T(){isNaN(v)||(i.onselectstart=function(){return!0},e(),v=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(e(),g=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),w=null}O(s,o),E===undefined?(E=d3.select(i).append("svg").attr("width",s).attr("height",o).append("svg:g").attr("transform","translate("+u.left+","+u.top+")"),S=E.append("rect").attr("class","plot").attr("width",a.width).attr("height",a.height).style("fill","#EEEEEE").attr("pointer-events","all"),S.call(d3.behavior.zoom().x(d).y(m).scaleExtent([1,8]).on("zoom",e)),E.append("svg").attr("class","linebox").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height).append("path").attr("class","line").attr("d",line(C)),n.title&&E.append("text").attr("class","title").text(n.title).attr("x",a.width/2).attr("dy","-1em").style("text-anchor","middle"),n.xlabel&&E.append("text").attr("class","xlabel").text(n.xlabel).attr("x",a.width/2).attr("y",a.height).attr("dy","2.4em").style("text-anchor","middle"),n.ylabel&&E.append("g").append("text").attr("class","ylabel").text(n.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+a.height/2+") rotate(-90)"),E.on("mousemove",b).on("mouseup",T),e()):(d3.select(i).select("svg").attr("width",s).attr("height",o),E.select("svg").attr("width",s).attr("height",o),E.select("rect.plot").attr("width",a.width).attr("height",a.height).style("fill","#EEEEEE"),E.select("svg.container").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height),E.select("svg.linebox").attr("top",0).attr("left",0).attr("width",a.width).attr("height",a.height).attr("viewBox","0 0 "+a.width+" "+a.height),n.title&&E.select("text.title").attr("x",a.width/2).attr("dy","-1em"),n.xlabel&&E.select("text.xlabel").attr("x",a.width/2).attr("y",a.height),n.ylabel&&E.select("text.ylabel").attr("transform","translate(-40 "+a.height/2+") rotate(-90)"),E.selectAll("g.x").remove(),E.selectAll("g.y").remove(),d3.select(this).on("mousemove.drag",b).on("touchmove.drag",b).on("mouseup.drag",T).on("touchend.drag",T),e()),r.on("mousemove",function(t){document.onselectstart=function(){return!0};var n=d3.svg.mouse(E[0][0]);isNaN(v)||(d.domain(grapher.axis.axisProcessDrag(v,d.invert(n[0]),d.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(m.domain(grapher.axis.axisProcessDrag(g,m.invert(n[0]),m.domain())),e(),d3.event.preventDefault(),d3.event.stopPropagation())}).on("mouseup",function(t){document.onselectstart=function(){return!0},isNaN(v)||(e(),v=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(g)||(e(),g=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),M.node=i,M.scale=O,M.updateLJData=A,M.update=f,M.redraw=e}var r=d3.select(e),i=r.node(),s=r.property("clientWidth"),o=r.property("clientHeight"),u,a,f,l,c,h,p,d=d3.scale.linear(),v,m=d3.scale.linear(),g,b,w,E,S,T,N={},C=[],k={title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy"};if(n)for(var L in k)n[L]===undefined&&(n[L]=k[L]);else n=k;return N.variables=[],N.variables[0]={coefficient:"epsilon",cursorStyle:"ns-resize"},N.variables[1]={coefficient:"sigma",cursorStyle:"ew-resize"},A(),w=!1,coefficient_selected=N.variables[0],O(s,o),c=function(e,t){return"translate("+d(e)+",0)"},h=function(e,t){return"translate(0,"+m(e)+")"},p=function(e,t){return Math.abs(e)>1e-4?"#ccc":"#666"},line=d3.svg.line().x(function(e,t){return d(C[t][0])}).y(function(e,t){return m(C[t][1])}),M.resize=function(e,t){M.scale(e,t),M()},M.ljUpdate=function(){M.updateLJData(),M.redraw()},i&&M(),M},layout.speedDistributionChart=function(e,t){function H(){O=model.get_speed(),t.xmax=d3.max(O),t.xmin=d3.min(O),t.quantile=d3.quantile(O,.1),T=t.ymax,p=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,a]),m=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,f])}function B(){if(O.length>2){try{_=d3.layout.histogram().frequency(!1).bins(p.ticks(60))(O)}catch(e){return}w=(u.width-_.length)/_.length,S=(t.xmax-t.xmin)/_.length,N=d3.max(_,function(e){return e.y})}}function j(e,n){i=e,s=n,r.style.width=i+"px",r.style.height=s+"px",o={top:t.title?40:20,right:35,bottom:t.xlabel?56:30,left:t.ylabel?60:25},width=i-o.left-o.right,height=s-o.top-o.bottom,u={width:width,height:height},a=u.width,f=u.height,p=d3.scale.linear().domain([t.xmin,t.xmax]).range([0,a]),m=d3.scale.linear().domain([t.ymax,t.ymin]).nice().range([0,f]).nice(),H(),B()}function F(){function e(){d3.event&&d3.event.transform&&isNaN(v)&&isNaN(b)&&d3.event.transform(x,y);var e=m.tickFormat(10),t=C.selectAll("g.y").data(m.ticks(5),String).attr("transform",c);t.select("text").text(e);var r=t.enter().insert("g","a").attr("class","y").attr("transform",c).attr("background-fill","#FFEEB6");r.append("line").attr("stroke",h).attr("x1",0).attr("x2",u.width),r.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(e).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown",function(e){var t=d3.svg.mouse(C[0][0]);b=y.invert(t[1])}),t.exit().remove(),n()}function n(){H();if(O.length>2){kde=science.stats.kde().sample(O),p.domain([t.xmin,t.xmax]);try{_=d3.layout.histogram().frequency(!0).bins(p.ticks(60))(O)}catch(e){return}w=(u.width-_.length)/_.length,S=(t.xmax-t.xmin)/_.length,N=d3.max(_,function(e){return e.y}),C.selectAll("g.bar").remove(),L=C.selectAll("g.bar").data(_),L.enter().append("g").attr("class","bar").attr("transform",function(e,t){return"translate("+p(e.x)+","+(f-m(T-e.y))+")"}).append("rect").attr("class","bar").attr("fill","steelblue").attr("width",w).attr("height",function(e){return m(T-e.y)})}}j(i,s),C===undefined?(C=d3.select(r).append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+o.left+","+o.top+")"),k=C.append("rect").attr("class","plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE"),t.title&&C.append("text").attr("class","title").text(t.title).attr("x",u.width/2).attr("dy","-1em").style("text-anchor","middle"),t.xlabel&&C.append("text").attr("class","xlabel").text(t.xlabel).attr("x",u.width/2).attr("y",u.height).attr("dy","2.4em").style("text-anchor","middle"),t.ylabel&&C.append("g").append("text").attr("class","ylabel").text(t.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),e()):(d3.select(r).select("svg").attr("width",i).attr("height",s),C.select("rect.plot").attr("width",u.width).attr("height",u.height).style("fill","#EEEEEE"),t.title&&C.select("text.title").attr("x",u.width/2).attr("dy","-1em"),t.xlabel&&C.select("text.xlabel").attr("x",u.width/2).attr("y",u.height),t.ylabel&&C.select("text.ylabel").attr("transform","translate(-40 "+u.height/2+") rotate(-90)"),C.selectAll("g.x").remove(),C.selectAll("g.y").remove(),e()),F.node=r,F.scale=j,F.update=n,F.redraw=e}var n=d3.select(e),r=n.node(),i=n.property("clientWidth"),s=n.property("clientHeight"),o,u,a,f,l,c,h,p,d,v,m,g,b,w,E,S,T,N,C,k,L,A,O,M,_,D={title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01};if(t)for(var P in D)t[P]===undefined&&(t[P]=D[P]);else t=D;return j(i,s),l=function(e,t){return"translate("+p(e)+",0)"},c=function(e,t){return"translate(0,"+m(e)+")"},h=function(e,t){return e?"#ccc":"#666"},F.resize=function(e,t){F.scale(e,t),F()},r&&F(),F};var e=document.getElementById("start-benchmarks"),t=document.getElementById("benchmarks-table"),n=[{name:"molecules",run:function(){return model.get_num_atoms()}},{name:"temperature",run:function(){return model.get("temperature")}},{name:"100 Steps (steps/s)",run:function(){controller.modelStop();var e=+Date.now(),t=-1;while(t++<100)model.tick(1,{dontDispatchTickEvent:!0});return elapsed=Date.now()-e,d3.format("5.1f")(100/elapsed*1e3)}},{name:"100 Steps w/graphics",run:function(){controller.modelStop();var e=+Date.now(),t=-1;while(t++<100)model.tick();return elapsed=Date.now()-e,d3.format("5.1f")(100/elapsed*1e3)}}];e&&(e.onclick=function(){benchmark.run(t,n)}),layout.datatable_visible=!1;var r=document.getElementById("toggle-datatable"),i=document.getElementById("datatable-table");layout.hide_datatable=function(){i&&(i.style.display="none")},layout.render_datatable=function(e){function h(){return i.getElementsByTagName("tr").length==0}function p(e){e=e||"data";var t=i.appendChild(document.createElement("tr"));return t.className=e,t}function d(e,t,n,r){n=n||"td",r=r||1;var i=e.appendChild(document.createElement(n));i.textContent=t,r>1&&(i.colSpan=r)}function v(e,t,n){n=n||"td";var r;r=-1;while(++r<t.length)d(e,t[r])}function m(e,t,r){r=r||"td";var i=e.getElementsByTagName(r),s=0;if(i.length>0){i[0].textContent=t;while(++s<i.length)i[s].textContent=c[s](n[model.INDICES[u[s]]][t])}s--;while(++s<u.length)d(e,c[s](n[model.INDICES[u[s]]][t]))}function g(e,t){h()&&d(p("title"),e,"th"),d(results_row,t)}function y(e,t,n){n=n||1;var r;r=-1;while(++r<t.length)d(e,t[r],"th",n)}function b(e){var t=-1,n=o.length;while(++t<e)t>=o.length&&p();while(--n>=t)i.removeChild(o[t]);return i.getElementsByClassName("data")}function w(e,t){var n=-1;while(++n<t.length)d(e,t[n])}function E(e,t,n,r){var i;i=-1;while(++i<r.length)w(t[i],r[i])}i.style.display="";var t,n=model.get_nodes()
,r=[],s=i.getElementsByClassName("title"),o=i.getElementsByClassName("data"),u=["PX","PY","X","Y","VX","VY","AX","AY","SPEED","CHARGE","RADIUS","ELEMENT"],a=d3.format(" 2d"),f=d3.format(" 1.1f"),l=d3.format(" 3.4f"),c=[l,l,l,l,l,l,l,l,l,f,l,a];r.length=n[0].length,e=e||!1;if(s.length==0){var S=p("title");y(S,u),o=b(r.length)}e&&(o=b(model.get_num_atoms())),t=-1;while(++t<r.length)m(o[t],t)},r&&(r.onclick=function(){layout.datatable_visible?(layout.datatable_visible=!1,r.textContent="Show Data Table",i.style.display="none"):(layout.datatable_visible=!0,r.textContent="Hide Data Table",layout.render_datatable(),i.style.display="")});var s=document.getElementById("select-temperature"),o=document.createElement("span");layout.setupTemperature=function(e){if(s){if(Modernizr.inputtypes.range){var t=document.createElement("input");t.type="range",t.min="0",t.max="1000",t.step="20",t.value=e.get("temperature"),s.parentNode.replaceChild(t,s),t.id="select-temperature",s=t,o.id="select-temperature-display",o.innerText=t.value+" K",s.parentNode.appendChild(o),s=document.getElementById("select-temperature")}s.onchange=u}},layout.temperature_control_checkbox=document.getElementById("temperature-control-checkbox"),layout.temperatureControlHandler=function(){layout.temperature_control_checkbox.checked?model.set({temperature_control:!0}):model.set({temperature_control:!1})},layout.temperatureControlUpdate=function(){var e=model.get("temperature_control");layout.temperature_control_checkbox.checked=e,s.disabled=!e,o.hidden=!e},layout.temperature_control_checkbox&&(layout.temperature_control_checkbox.onchange=layout.temperatureControlHandler),layout.lennard_jones_forces_checkbox=document.getElementById("lennard-jones-forces-checkbox"),layout.lennard_jones_forces_checkbox&&(layout.lennard_jones_forces_checkbox.onchange=a),layout.coulomb_forces_checkbox=document.getElementById("coulomb-forces-checkbox"),layout.coulomb_forces_checkbox&&(layout.coulomb_forces_checkbox.onchange=f);var l=document.getElementById("stats");layout.displayStats=function(){var e=model.ke(),t=model.pe(),n=e+t;l&&(l.textContent="Time: "+d3.format("5.2f")(model.getTime()/1e3)+" (ps), "+"KE: "+d3.format("1.4f")(e)+", "+"PE: "+d3.format("1.4f")(t)+", "+"TE: "+d3.format("1.4f")(n)+", "+"Pressure: "+d3.format("6.3f")(model.pressure())+", "+"Rate: "+d3.format("5.1f")(model.get_rate())+" (steps/s)")},layout.heatCoolButtons=function(e,t,n,r,i,s){var o=new ButtonComponent(e,"circlesmall-plus"),u=new ButtonComponent(t,"circlesmall-minus");o.add_action(function(){var n=i.get("temperature");n<r?($(e).removeClass("inactive"),$(t).removeClass("inactive"),n=Math.floor(n*2)/2+100,i.set({temperature:n}),typeof s=="function"&&s(n)):$(e).addClass("inactive")}),u.add_action(function(){var r=i.get("temperature");r>n?($(e).removeClass("inactive"),$(t).removeClass("inactive"),r=Math.floor(r*2)/2-100,i.set({temperature:r}),typeof s=="function"&&s(r)):$(t).addClass("inactive")})}}(),function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p=Object.prototype.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},v=function(e,t){return function(){return e.apply(t,arguments)}};h=typeof exports!="undefined"&&exports!==null?exports:this,n=function(){function e(e){this.dom_id=e,this.dom_id?this.dom_element=$(this.dom_id):this.dom_element=$("<div>"),this.dom_element.addClass("component")}return e}(),t=function(e){function t(e,n,r){this.dom_id=e,this.name=n!=null?n:"play",this.actions=r!=null?r:[],t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button").addClass(this.name).addClass("up"),this.state="up",this.init_mouse_handlers()}return d(t,e),t.prototype.set_state=function(e){return this.dom_element.removeClass(this.state),this.state=e,this.dom_element.addClass(this.state)},t.prototype.init_mouse_handlers=function(){var e,t=this;return e=this,this.dom_element.mousedown(function(t){return e.set_state("down"),e.start_down_ticker()}),this.dom_element.mouseup(function(){return clearInterval(t.ticker),e.set_state("up"),e.do_action()}),this.dom_element.mouseleave(function(){return clearInterval(t.ticker),e.set_state("up")})},t.prototype.add_action=function(e){return this.actions.push(e)},t.prototype.do_action=function(){var e,t,n,r,i;r=this.actions,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e());return i},t.prototype.start_down_ticker=function(){var e;return e=this,this.ticker_count=0,this.ticker=setInterval(function(){e.do_action(),e.ticker_count+=1,e.ticker_count>4&&e.do_action();if(e.ticker_count>8)return e.do_action(),e.do_action()},250)},t}(n),h.ButtonComponent=t,c=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id,"toggle"),this.buttons=[];for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r);this.button_index=0,this.enable_button(0)}return d(t,e),t.prototype.add_button=function(e){var t,n;e.dom_element.remove(),e.dom_element.css("margin","0px"),this.dom_element.append(e.dom_element),this.buttons.push(e),this.add_width(e.dom_element),this.add_height(e.dom_element),n=this,t=this.buttons.length-1;if(t!==this.button_index)return this.disable_button(t)},t.prototype.add_width=function(e){var t,n;n=this.dom_element.width(),t=e.outerWidth(!0);if(n<t)return this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t.prototype.disable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.addClass("hidden")},t.prototype.enable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.removeClass("hidden")},t.prototype.set_active=function(e){return this.disable_button(this.button_index),this.button_index=e,this.button_index=this.button_index%this.buttons.length,this.enable_button(this.button_index)},t.prototype.enable_next_button=function(){return this.set_active(this.button_index+1)},t.prototype.current_button=function(){return this.button_index<this.buttons.length?this.buttons[this.button_index]:null},t.prototype.do_action=function(){if(this.current_button())return this.current_button().do_action(),this.enable_next_button()},t}(t),h.ToggleButtonComponent=c,e=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button_bar"),this.buttons=[],this.dom_element.width("1px"),this.dom_element.height("1px");for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r)}return d(t,e),t.prototype.add_button=function(e){var t;return t=e.dom_element,this.dom_element.append(t),this.add_width(t),this.add_height(t),this.buttons.push(e)},t.prototype.add_width=function(e){var t;return t=this.dom_element.width(),t+=e.outerWidth(!0),this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t}(n),h.ButtonBarComponent=e,o=function(e){function n(e,r,i){var s,o,u,a,f,l=this;this.dom_id=e,this.playable=r,i==null&&(i=!0),n.__super__.constructor.call(this,this.dom_id),a=new t(null,"play"),a.add_action(function(){return l.playable.play()}),u=new t(null,"pause"),u.add_action(function(){return l.playable.stop()}),this.toggle=new c(null,[a,u]),this.play_index=0,this.stop_index=1,f=new t(null,"reset"),f.add_action(function(){return l.playable.seek(1),l.play()}),this.add_button(f),i||(o=new t(null,"forward"),o.add_action(function(){return l.playable.forward(),l.stop()}),this.add_button(o)),this.add_button(this.toggle),i||(s=new t(null,"back"),s.add_action(function(){return l.playable.back(),l.stop()}),this.add_button(s)),this.play()}return d(n,e),n.prototype.stop=function(){return this.toggle.set_active(this.play_index)},n.prototype.play=function(){return this.toggle.set_active(this.stop_index)},n}(e),h.PlaybackBarComponent=o,r=function(){function e(e,t){var n=this;this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.dom_element=$(this.dom_id),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.step=this.dom_element.attr("data-stop")||.01,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.label_id=this.dom_element.attr("data-label-id"),this.orientation=this.dom_element.attr("data-orientation")||"horizontal",this.dom_element.slider(),this.update_options(),this.dom_element.bind("slide",function(e,t){console.log("slider value: "+t.value),n.update_label(t.value);if(n.value_changed_function)return n.value_changed_function(t.value)}),this.update_label(this.value)}return e.prototype.set_max=function(e){return this.max=e,this.update_options()},e.prototype.set_min=function(e){return this.min=e,this.update_options()},e.prototype.update_options=function(){var e;return e={orientation:this.orientation,min:this.min,max:this.max,value:this.value,step:this.step,range:"min"},this.dom_element.slider("option",e)},e.prototype.update_label=function(e){if(this.label_id)return $(this.label_id).text(""+this.label+" "+e)},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.JSliderComponent=r,s=function(){function e(e,t,n,r,i){this.svg_element=e,this.playable=t!=null?t:null,this.offsets={play:1,stop:1},this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=this;o=this.group.append("svg:g"),c=this.offset(e),o.attr("class","component playbacksvgbutton").attr("x",c).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),s=o.append("rect"),s.attr("class","bg").attr("x",this.offset(e)/1.2).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(p=0,v=n.length;p<v;p++){f=n[p],r=o.append(t),r.attr("class",""+e+" button-art"),l="";for(d=0,m=f.length;d<m;d++)a=f[d],c=this.offset(e)+a.x*this.unit_width,h=this.vertical_padding/.75+a.y*this.unit_width,l+=" "+c+","+h,r.attr("points",l);e==="stop"&&(i=o.append("rect"),i.attr("class","pause-center").attr("x",c+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return u=o.append("rect"),u.attr("class","highlight").attr("x",this.offset(e)/1.2+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),o.on("click",function(){return g.action(e)}),o},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_pause_button=function(){var e;return e=[[{x:.5,y:.5},{x:.5,y:0},{x:.5,y:1},{x:0,y:1},{x:0,y:0}]],this.pause=this.make_button("pause","svg:polygon",e)},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_play_button(),this.init_stop_button(),this.playable.playing?this.hide(this.play):this.hide(this.stop)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlayOnlyComponentSVG=s,h.ModelPlayer=i,i=function(){function e(e,t){this.model=e,arguments.length>1?this.playing=t:this.playing=!0}return e.prototype.play=function(){return this.model.resume(),this.playing=!0},e.prototype.stop=function(){return this.model.stop(),this.playing=!1},e.prototype.forward=function(){return this.stop(),this.model.stepForward()},e.prototype.back=function(){return this.stop(),this.model.stepBack()},e.prototype.seek=function(e){return this.stop(),this.model.seek(e)},e}(),u=function(){function e(e,t){this.dom_id=e!=null?e:"#playback",this.playable=t!=null?t:null,this.dom_element=d3.select(this.dom_id).attr("class","component playback"),this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=parseInt(this.dom_element.style("width")),this.height=parseInt(this.dom_element.style("height")),this.unit_width=this.width/9,this.height<this.unit_width&&(this.height=this.unit_width+2,this.dom_element.style("height",this.height+"px")),this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d=this;i=this.svg.append("svg:g"),a=this.offset(e),i.attr("x",a).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(l=0,h=n.length;l<h;l++){o=n[l],r=i.append(t),r.attr("class",""+e+" button-art"),u="";for(c=0,p=o.length;c<p;c++)s=o[c],a=this.offset(e)+s.x*this.unit_width,f=this.vertical_padding+s.y*this.unit_width,u+=" "+a+","+f,r.attr("points",u)}return i.on("click",function(){return d.action(e)}),i},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_reset_button=function(){var e;return e=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",e)},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_back_button=function(){var e;return e=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",e)},e.prototype.init_forward_button=function(){var e;return e=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",e)},e.prototype.init_view=function(){return this.svg=this.dom_element.append("svg:svg").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlaybackComponent=u,h.ModelPlayer=i,a=function(){function e(e,t,n,r,i){this.svg_element=e,this.playable=t!=null?t:null,this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return e.prototype.offset=function(e){return this.offsets[e]*this.unit_width*2+this.unit_width},e.prototype.make_button=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=this;o=this.group.append("svg:g"),h=this.offset(e),o.attr("class","component playbacksvgbutton").attr("x",c).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),s=o.append("rect"),s.attr("class","bg").attr("x",h).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(d=0,m=n.length;d<m;d++){f=n[d],r=o.append(t),r.attr("class",""+e+" button-art"),l="";for(v=0,g=f.length;v<g;v++)a=f[v],c=h+8+a.x*this.unit_width,p=this.vertical_padding/.75+a.y*this.unit_width,l+=" "+c+","+p,r.attr("points",l);e==="stop"&&(i=o.append("rect"),i.attr("class","pause-center").attr("x",c+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return u=o.append("rect"),u.attr("class","highlight").attr("x",h+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),o.on("click",function(){return y.action(e)}),o},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_reset_button=function(){var e;return e=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",e)},e.prototype.init_play_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",e)},e.prototype.init_stop_button=function(){var e;return e=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",e)},e.prototype.init_pause_button=function(){var e;return e=[[{x:.5,y:.5},{x:.5,y:0},{x:.5,y:1},{x:0,y:1},{x:0,y:0}]],this.pause=this.make_button("pause","svg:polygon",e)},e.prototype.init_back_button=function(){var e;return e=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",e)},e.prototype.init_forward_button=function(){var e;return e=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",e)},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_back_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.playable.playing?this.hide(this.play):this.hide(this.stop)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.PlaybackComponentSVG=a,h.ModelPlayer=i,f=function(){function e(e,t,n,r,i){this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.min=n,this.max=r,this.value=i,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return e.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},e.prototype.init_view=function(){var e;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(e=this.height/4,this.y1=this.y2=e,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},e.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},e.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},e.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/4,this.update_handle()},e.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},e.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},e.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},e.prototype.set_scaled_value=function(e){return this.value=(e-this.min)/this.domain,this.handle_x=e/this.domain*this.width,this.update()},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.update_label=function(){var e;return this.label?(e=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+e)):this.text_label.hide()},e.prototype.handle_mousedown=function(e){var t=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(e){return t.handle_mouseup(e)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(e){return t.handle_drag(e)}),this.handle_drag(e)},e.prototype.handle_drag=function(e){var t,n,r,i;return this.dragging?(document.onselectstart=function(){return!1},r=e.pageX-this.slider_well.position().left,i=e.pageY-this.slider_well.position().top,this.horizontal_orientation()?(t=this.width-this.handle_width/4,n=this.handle_width/4,this.handle_x=r,this.handle_x<n&&(this.handle_x=n),this.handle_x>t&&(this.handle_x=t),this.value=this.handle_x/this.width):(this.handle_y=e.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},e.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},e.prototype.init_mouse_handlers=function(){var e=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(t){return e.handle_mousedown(t)})},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.SliderComponent=f,l=function(){function e(e,t,n,r){this.dom_id=e!=null?e:"#thermometer",this.min=n,this.max=r,this.resize=v(this.resize,this),this.dom_element=typeof this.dom_id=="string"?$(this.dom_id):this.dom_id,this.dom_element.addClass("thermometer"),this.samples=[],this.samples.push(t),this.value=t,this.first_sample=!0,this.last_draw_time=(new Date).getTime(),this.sample_interval_ms=250,this.last_draw_time-=this.sample_interval_ms,this.init_view()}return e.prototype.init_view=function(){var e;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.init_thermometer_fill(),d3.select("#therm_text").attr("class","therm_text")},e.prototype.init_thermometer_fill=function(){return this.thermometer_fill=$("<div>").addClass("thermometer_fill"),this.dom_element.append(this.thermometer_fill),this.redraw()},e.prototype.resize=function(){var e;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.redraw()},e.prototype.set_scaled_value=function(e){var t;return t=this.value,t*=this.max-this.min,t+=this.min,t},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.time_to_redraw=function(){var e;return e=(new Date).getTime(),e>this.last_draw_time+this.sample_interval_ms},e.prototype.add_value=function(e){this.samples.push(e),this.value=e;if(this.time_to_redraw()||this.first_sample)return this.first_sample=!1,this.redraw(),this.samples=[]},e.prototype.get_avg=function(){var e,t,n,r,i;if(this.samples.length>0){t=0,i=this.samples;for(n=0,r=i.length;n<r;n++)e=i[n],t+=e;return this.value=t/this.samples.length}return this.value},e.prototype.scaled_display_value=function(){return this.get_avg()/(this.max-this.min)*this.height},e.prototype.redraw=function(){var e,t;return this.width=this.dom_element.width(),this.height=this.dom_element.height(),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,t=this.scaled_display_value(),this.thermometer_fill.css("bottom",""+(t-this.height)+"px"),this.thermometer_fill.height(""+t+"px"),this.last_draw_time=(new Date).getTime(),d3.select("#therm_text").text("Temperature")},e}(),h=typeof exports!="undefined"&&exports!==null?exports:this,h.Thermometer=l}.call(this),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers={version:"0.0.1"},controllers.modelController=function(e,t,n){function m(){v.update_drawable_positions()}function g(){i=n.layoutStyle,s=n.autostart,o=t.elements,u=t.atoms,a=t.mol_number,f=t.temperature_control,l=t.temperature,c=t.width,h=t.height,p=t.radialBonds,d=t.obstacles}function y(){g(),model=modeler.model({elements:o,temperature:l,temperature_control:f,width:c,height:h});if(u)model.createNewAtoms(u);else{if(!a)throw new Error("ModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms(a),model.relax()}p&&model.createRadialBonds(p),d&&model.createObstacles(d)}function b(){layout.selection=i,model_player=new ModelPlayer(model,!1),v=layout.moleculeContainer(e,{xmax:c,ymax:h,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),v.updateMoleculeRadius(),v.setup_drawables(),layout.addView("moleculeContainers",v),layout.setupScreen()}function w(){v.reset({xmax:c,ymax:h,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),layout.setupScreen(!0)}function E(){model.resetTime(),model.stop(),model.on("tick",m)}function S(e){y(),E(),e?b():w()}function x(e,r){t=e,n=r,S(!1)}function N(){layout.setupScreen()}var r={},i,s,o,u,a,f,l,c,h,p,d,v;if(typeof DEVELOPMENT=="undefined")try{S(!0)}catch(T){throw alert(T),new Error(T)}else S(!0);return document.onwebkitfullscreenchange=N,window.onresize=N,r.reload=x,r},controllers.interactivesController=function(e,t,n){function a(e){var t={layoutStyle:n};$.get(e).done(function(e){e=typeof e=="string"?JSON.parse(e):e,i?i.reload(e,t):(i=controllers.modelController("#molecule-container",e,t),v())})}function f(e){switch(e.type){case"button":return c(e);case"thermometer":return h(e)}}function l(e){var t,n,r,i,s;n={addAtom:function(){return model.addRandomAtom.apply(model,arguments)},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},console:window.console},r=[],i=[];for(t in n)n.hasOwnProperty(t)&&(r.push(t),i.push(n[t]));return s="'use strict';"+e,function(){var t,n,o,u;n=[];for(t in window)window.hasOwnProperty(t)&&r.indexOf(t)<0&&n.push(t);o=r.concat(n).concat(s);try{u=Function.apply(null,o)}catch(a){alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+e)}try{u.apply(null,i)}catch(a){alert("Error running script: "+a.toString())}}}function c(e){var t,n;return t=$("<button>").attr("id",e.id).html(e.text),typeof e.action=="string"?n=e.action:n=e.action.join("\n"),t.click(l(n)),t}function h(e){function i(){n.add_value(model.get("temperature"))}var t=$("<div>").attr("id",e.id),n=new Thermometer(t,0,e.min,e.max),r=$("<div>").css("padding-bottom","4em").append(t).append($("<div>").text("Thermometer"));return p(["temperature"],i),d(function(){n.resize(),i()}),layout.addView("thermometers",n),r}function p(e,t){typeof model!="undefined"?model.addPropertiesListener(e,t):o.push([e,t])}function d(e){typeof model!="undefined"?e():u.push(e)}function v(){var e,t;while(o.length>0)e=o.pop(),model.addPropertiesListener(e[0],e[1]);while(u.length>0)t=u.pop()()}function m(t,n){var r,i={},o,u,l,c,h,p,d,v;e=t,s=$(n),s.children().length===0?(h=$('<div class="top" id="top"/>'),h.append('<div id="molecule-container"/>'),p=$('<div id="right"/>'),h.append(p),s.append(h),s.append('<div class="bottom" id="bottom"/>')):($("#bottom").html(""),$("#right").html(""),s.append('<div id="bottom"/>')),e.model&&a(e.model),r=e.components;for(d=0,v=r.length;d<v;d++)o=f(r[d]),i[r[d].id]=o;if(e.layout)for(l in e.layout)if(e.layout.hasOwnProperty(l)){u=e.layout[l];for(d=0,v=u.length;d<v;d++)c=u[d],i[c]&&($("#"+l).append(i[c]),delete i[c])}for(c in i)i.hasOwnProperty(c)&&$("#bottom").append(i[c])}typeof n=="undefined"&&(n="interactive");var r={},i,s,o=[],u=[];return m(e,t),r.loadInteractive=m,r},controllers.compareModelsController=function(e,t,n,r,i){function I(){function r(e){E.update_drawable_positions()}function i(){model=modeler.model({elements:l,model_listener:r,temperature:d,lennard_jones_forces:!0,coulomb_forces:v,temperature_control:p,width:m,height:g});if(c)model.createNewAtoms(c);else{if(!h)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:h,relax:!0})}y&&model.createRadialBonds(y),b&&model.createObstacles(b)}function u(){layout.selection=s,model_player=new ModelPlayer(model,o),E=layout.moleculeContainer(e,{playback_controller:!1,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,xmax:m,ymax:g,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),E.updateMoleculeRadius(),E.setup_drawables(),_=M(),_?O={params:[["script","page:0:import /imports/legacy-mw-content/"+_]]}:O={},A=layout.appletContainer
(t,O),layout.addView("moleculeContainers",E),layout.addView("appletContainers",A),layout.setupScreen()}function a(){model.stop()}function f(){model.on("tick",r),model.resume()}function S(){model.stop(),model.stepBack()}function T(){model.stop(),model.stepForward()}function N(){model.stop(),i(),k(),r()}function k(){w=model.get_nodes(),model.resetTime(),a(),model.on("tick",r),x=model.stepCounter()}function L(){return F=document.location.hash,F.length>0?F.substr(1,F.length):!1}function M(){var e=L();return e?j[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function q(){var e=L();e?B.value=e.replace("/imports/legacy-mw-content/",""):B.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function R(){var e,t,n,r,i;j={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],j[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function U(){R(),d3.select(B).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),q()}function z(e){return A.applet.runMwScript(e)}function W(){var e=$(B).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");C=t+n,document.location.hash="#"+C}function X(){M()&&(O={params:[["script","page:0:import "+M()]]},A=layout.appletContainer(t,O),z("page:0:set frank false"),layout.setView("appletContainers",[A]),layout.setupScreen())}function V(){layout.setupScreen()}function J(){U(),i(),k(),u(),q()}B=document.getElementById(n),D=document.getElementById("start"),D.onclick=function(){z("mw2d:1:run"),f()},P=document.getElementById("stop"),P.onclick=function(){z("mw2d:1:stop"),a()},H=document.getElementById("reset"),H.onclick=function(){z("mw2d:1:reset"),N()},B.onchange=W,document.onwebkitfullscreenchange=V,window.onresize=V;if(typeof DEVELOPMENT=="undefined")try{J()}catch(K){throw alert(K),new Error(K)}else J();I.runMWScript=z}var s=i.layoutStyle,o=i.autostart,u=i.maximum_model_steps,a=i.lj_epsilon_max,f=i.lj_epsilon_min,l=r.elements,c=r.atoms,h=r.mol_number,p=r.temperature_control,d=r.temperature,v=r.coulomb_forces,m=r.width,g=r.height,y=r.radialBonds,b=r.obstacles,w,E,S,x,T,N,C,k,L,A,O={},M,_,D,P,H,B,j,F;return I(),I}}(),function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),controllers.simpleModelController=function(e,t,n){function T(){function x(){r=n.layoutStyle,i=n.autostart,s=n.maximum_model_steps,o=n.lj_epsilon_max,u=n.lj_epsilon_min,a=t.elements,f=t.atoms,l=t.mol_number,c=t.temperature_control,h=t.temperature,p=t.coulomb_forces,d=t.width,v=t.height,m=t.radialBonds,g=t.obstacles}function N(){model=modeler.model({elements:a,model_listener:w,temperature:h,lennard_jones_forces:!0,coulomb_forces:p,temperature_control:c,width:d,height:v});if(f)model.createNewAtoms(f);else{if(!l)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:l,relax:!0})}m&&model.createRadialBonds(m),g&&model.createObstacles(g)}function C(){layout.selection=r,model_player=new ModelPlayer(model,i),b=layout.moleculeContainer(e,{xmax:d,ymax:v,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),b.updateMoleculeRadius(),b.setup_drawables(),S=new Thermometer("#thermometer",model.temperature(),200,4e3),model.addPropertiesListener(["temperature"],L),S.resize(),L(),layout.heatCoolButtons("#heat_button","#cool_button",0,3800,model,function(e){S.add_value(e)}),model.addPropertiesListener(["coulomb_forces"],k),k(),layout.addView("moleculeContainers",b),layout.addView("thermometers",S),layout.setupScreen()}function k(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),b.setup_drawables()}function L(){S.add_value(model.get("temperature"))}function A(){model.stop()}function O(){model.on("tick",w),(!Number(s)||model.stepCounter()<s)&&model.resume()}function M(){A(),model.stepBack()}function _(){(!Number(s)||model.stepCounter()<s)&&model.stepForward()}function D(){y=model.get_nodes(),model.resetTime(),A(),model.on("tick",w),E=model.stepCounter()}function P(){layout.setupScreen(),S.resize(),L()}function H(e){x(),N(),D(),e?C():j()}function j(){layout.setupScreen(!0)}function F(e,r){t=e,n=r,H(!1)}w=function(e){b.update_drawable_positions(),E>=model.stepCounter()&&A()},document.onwebkitfullscreenchange=P,window.onresize=P;if(typeof DEVELOPMENT=="undefined")try{H(!0)}catch(B){throw alert(B),new Error(B)}else H(!0);i&&O(),T.updateLayout=j,T.reload=F}var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;return T(),T},controllers.complexModelController=function(e,t,n,r,s,o){function R(){function s(e){var t=model.ke(),n=model.pe(),r=t+n;F.update(),T.update_drawable_positions(),model.isNewStep()?(M[0].push(t),M[1].push(n),M[2].push(r),A.add_points([t,n,r])):A.update(model.stepCounter()),C>=f&&O(),layout.displayStats(),layout.datatable_visible&&layout.render_datatable()}function o(e){var t=model.stepCounter();if(e)for(i=0,len=M.length;i<len;i++)M[i].length=t;else ke=model.ke(),pe=model.pe(),te=ke+pe,M=[[ke],[pe],[te]]}function N(){model=modeler.model({elements:d,model_listener:s,temperature:y,lennard_jones_forces:!0,coulomb_forces:w,temperature_control:b,width:E,height:S});if(v)model.createNewAtoms(v),m&&model.createRadialBonds(m),x&&model.createObstacles(x);else{if(!g)throw new Error("simpleModelController: tried to create a model without atoms or mol_number.");model.createNewAtoms({num:g,relax:!0})}}function k(){function i(){$(layout.coulomb_forces_checkbox).attr("checked",model.get("coulomb_forces")),T.setup_drawables()}function s(){g=+P.value,V(),I.checked=!1,f()}function f(){A.change_yaxis(H[g]),j.redraw(),F.redraw()}layout.selection=u,model_player=new ModelPlayer(model,a),T=layout.moleculeContainer(e,{title:"Simple Molecules",xlabel:"X position (nm)",ylabel:"Y position (nm)",playback_controller:!0,play_only_controller:!1,model_time_label:!0,grid_lines:!0,xunits:!0,yunits:!0,atom_mubers:!1,xmin:0,xmax:E,ymin:0,ymax:S,get_nodes:function(){return model.get_nodes()},get_num_atoms:function(){return model.get_num_atoms()},get_obstacles:function(){return model.get_obstacles()}}),model.addPropertiesListener(["sigma"],T.updateMoleculeRadius),o(),A=grapher.realTimeGraph(t,{title:"Energy of the System (KE:red, PE:green, TE:blue)",xlabel:"Model Time (ps)",xmin:0,xmax:100,sample:.1,ylabel:"eV",ymin:-5,ymax:5,dataset:M}),A.new_data(M),model.on("play",function(){var e,t;A.number_of_points()&&model.stepCounter()<A.number_of_points()&&(o(model.stepCounter()),A.new_data(M)),A.show_canvas()}),model.on("stop",function(){}),model.on("seek",function(){modelsteps=model.stepCounter(),modelsteps>0?(o(modelsteps),A.new_data(M)):(o(),A.new_data(M))}),F=layout.speedDistributionChart(r,{title:"Distribution of Speeds",xlabel:null,ylabel:"Count",xmax:2,xmin:0,ymax:15,ymin:0,quantile:.01}),j=layout.potentialChart(n,model,{title:"Lennard-Jones potential",xlabel:"Radius",ylabel:"Potential Energy",epsilon_max:l,epsilon_min:c,epsilon:d[0].epsilon,sigma_max:h,sigma_min:p,sigma:d[0].sigma}),model.addPropertiesListener(["epsilon"],j.ljUpdate),model.addPropertiesListener(["sigma"],j.ljUpdate),model.addPropertiesListener(["coulomb_forces"],i),i(),layout.addView("moleculeContainers",T),layout.addView("potentialCharts",j),layout.addView("speedDistributionCharts",F),layout.addView("energyCharts",A),_=document.getElementById("model-controls"),_&&(D=_.getElementsByTagName("input"),_.onchange=modelController),P=document.getElementById("select-molecule-number"),I=document.getElementById("radio-randomize-pos-vel"),checkbox_thermalize=document.getElementById("checkbox-thermalize"),H={2:2,5:12.5,10:5,20:10,50:120,100:250,200:1e3,500:5e3},B={2:2,5:2,10:5,20:5,50:10,100:15,200:20,500:40},P.onchange=s,I.onclick=s,P.value=g}function L(){q=model.get_nodes(),model.resetTime(),o(),T.setup_drawables(),T.updateMoleculeRadius(),layout.setupScreen(),C=model.stepCounter(),P.value=model.get_num_atoms(),O(),model.on("tick",s)}function O(){model.stop(),T.playback_component.action("stop"),_&&(D[0].checked=!0)}function U(){model.stop(),model.stepCounter()<f?(model.stepForward(),_&&(D[0].checked=!0)):_&&(D[0].checked=!1)}function z(){model.on("tick",s),model.stepCounter()<f?(A.show_canvas(),model.resume(),_&&(D[0].checked=!0)):_&&(D[0].checked=!1)}function W(){O(),model.stepBack(),A.showMarker(model.stepCounter())}function X(){model.stepCounter()<f?model.stepForward():_&&(D[0].checked=!0)}function V(){var e=!checkbox_thermalize.checked;g=+P.value,model.createNewAtoms(g,e),L(),T.update_drawable_positions(),C=model.stepCounter(),layout.displayStats(),layout.datatable_visible?layout.render_datatable(!0):layout.hide_datatable(),o(),A.new_data(M),_&&(D[0].checked=!0)}function J(){layout.setupScreen()}function K(){N(),k(),L()}document.onwebkitfullscreenchange=J,window.onresize=J;if(typeof DEVELOPMENT=="undefined")try{K()}catch(Q){throw alert(Q),new Error(Q)}else K();a&&z(),R.modelListener=s,R.modelGo=z,R.modelStop=O,R.modelReset=V,R.resetEnergyData=o,R.energyGraph=A,R.moleculeContainer=T}var u=o.layoutStyle,a=o.autostart,f=o.maximum_model_steps,l=o.lj_epsilon_max,c=o.lj_epsilon_min,h=2,p=.1,d=s.elements,v=s.atoms,m=s.radialBonds,g=s.mol_number,y=s.temperature,b=s.temperature_control,w=s.coulomb_forces,E=s.width,S=s.height,m=s.radialBonds,x=s.obstacles,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,P,I,q;return R(),R}}();