(function(){var e,t,n;(function(r){function c(e,t){var n=t&&t.split("/"),r=o.map,i=r&&r["*"]||{},s,u,a,f,l,c,h,p,d,v;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(p=0;v=e[p];p++)if(v===".")e.splice(p,1),p-=1;else if(v===".."){if(p===1&&(e[2]===".."||e[0]===".."))return!0;p>0&&(e.splice(p-1,2),p-=2)}e=e.join("/")}if((n||i)&&r){s=e.split("/");for(p=s.length;p>0;p-=1){u=s.slice(0,p).join("/");if(n)for(d=n.length;d>0;d-=1){a=r[n.slice(0,d).join("/")];if(a){a=a[u];if(a){f=a,l=p;break}}}if(f)break;!c&&i&&i[u]&&(c=i[u],h=p)}!f&&c&&(f=c,l=h),f&&(s.splice(0,l,f),e=s.join("/"))}return e}function h(e,t){return function(){return l.apply(r,a.call(arguments,0).concat([e,t]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){i[e]=t}}function v(e){if(s.hasOwnProperty(e)){var t=s[e];delete s[e],u[e]=!0,f.apply(r,t)}if(!i.hasOwnProperty(e))throw new Error("No "+e);return i[e]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return o&&o.config&&o.config[e]||{}}}var i={},s={},o={},u={},a=[].slice,f,l;f=function(e,t,n,o){var a=[],f,l,c,p,y,b;o=o||e;if(typeof n=="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(b=0;b<t.length;b++){y=m(t[b],o),c=y.f;if(c==="require")a[b]=h(e);else if(c==="exports")a[b]=i[e]={},f=!0;else if(c==="module")l=a[b]={id:e,uri:"",exports:i[e],config:g(e)};else if(i.hasOwnProperty(c)||s.hasOwnProperty(c))a[b]=v(c);else if(y.p)y.p.load(y.n,h(o,!0),d(c),{}),a[b]=i[c];else if(!u[c])throw new Error(e+" missing "+c)}p=n.apply(i[e],a);if(e)if(l&&l.exports!==r&&l.exports!==i[e])i[e]=l.exports;else if(p!==r||!f)i[e]=p}else e&&(i[e]=n)},e=t=l=function(e,t,n,i){return typeof e=="string"?v(m(e,t).f):(e.splice||(o=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),l)},l.config=function(e){return o=e,l},n=function(e,t,n){t.splice||(n=t,t=[]),s[e]=[e,t,n]},n.amd={jQuery:!0}})(),n("../vendor/almond/almond",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=r.unshift,l=i.toString,c=i.hasOwnProperty,h=r.forEach,p=r.map,d=r.reduce,v=r.reduceRight,m=r.filter,g=r.every,y=r.some,b=r.indexOf,w=r.lastIndexOf,E=Array.isArray,S=Object.keys,x=s.bind,T=function(e){if(e instanceof T)return e;if(!(this instanceof T))return new T(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=T),exports._=T):e._=T,T.VERSION="1.4.2";var N=T.each=T.forEach=function(e,t,r){if(e==null)return;if(h&&e.forEach===h)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(T.has(e,o)&&t.call(r,e[o],o,e)===n)return};T.map=T.collect=function(e,t,n){var r=[];return e==null?r:p&&e.map===p?e.map(t,n):(N(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)},T.reduce=T.foldl=T.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduce===d)return r&&(t=T.bind(t,r)),i?e.reduce(t,n):e.reduce(t);N(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.reduceRight=T.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduceRight===v)return r&&(t=T.bind(t,r)),arguments.length>2?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=T.keys(e);s=o.length}N(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},T.find=T.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},T.filter=T.select=function(e,t,n){var r=[];return e==null?r:m&&e.filter===m?e.filter(t,n):(N(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},T.every=T.all=function(e,t,r){t||(t=T.identity);var i=!0;return e==null?i:g&&e.every===g?e.every(t,r):(N(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=T.some=T.any=function(e,t,r){t||(t=T.identity);var i=!1;return e==null?i:y&&e.some===y?e.some(t,r):(N(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};T.contains=T.include=function(e,t){return e==null?!1:b&&e.indexOf===b?e.indexOf(t)!=-1:C(e,function(e){return e===t})},T.invoke=function(e,t){var n=u.call(arguments,2);return T.map(e,function(e){return(T.isFunction(t)?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,function(e){return e[t]})},T.where=function(e,t){return T.isEmpty(t)?[]:T.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&T.isEmpty(e))return-Infinity;var r={computed:-Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&T.isEmpty(e))return Infinity;var r={computed:Infinity};return N(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},T.shuffle=function(e){var t,n=0,r=[];return N(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return T.isFunction(e)?e:function(t){return t[e]}};T.sortBy=function(e,t,n){var r=k(t);return T.pluck(T.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t);return N(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};T.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(T.has(e,t)?e[t]:e[t]=[]).push(n)})},T.countBy=function(e,t,n){return L(e,t,n,function(e,t,n){T.has(e,t)||(e[t]=0),e[t]++})},T.sortedIndex=function(e,t,n,r){n=n==null?T.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},T.toArray=function(e){return e?e.length===+e.length?u.call(e):T.values(e):[]},T.size=function(e){return e==null?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},T.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},T.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},T.rest=T.tail=T.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},T.compact=function(e){return T.filter(e,function(e){return!!e})};var A=function(e,t,n){return N(e,function(e){T.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};T.flatten=function(e,t){return A(e,t,[])},T.without=function(e){return T.difference(e,u.call(arguments,1))},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var i=n?T.map(e,n,r):e,s=[],o=[];return N(i,function(n,r){if(t?!r||o[o.length-1]!==n:!T.contains(o,n))o.push(n),s.push(e[r])}),s},T.union=function(){return T.uniq(a.apply(r,arguments))},T.intersection=function(e){var t=u.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.indexOf(t,e)>=0})})},T.difference=function(e){var t=a.apply(r,u.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){var e=u.call(arguments),t=T.max(T.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=T.pluck(e,""+r);return n},T.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};T.bind=function(t,n){var r,i;if(t.bind===x&&x)return x.apply(t,u.call(arguments,1));if(!T.isFunction(t))throw new TypeError;return i=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=t.prototype;var e=new O,s=t.apply(e,i.concat(u.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(u.call(arguments)))}},T.bindAll=function(e){var t=u.call(arguments,1);return t.length==0&&(t=T.functions(e)),N(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(u.call(arguments,1)))},T.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},T.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},T.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},T.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},T.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},T.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)T.has(e,n)&&(t[t.length]=n);return t},T.values=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push(e[n]);return t},T.pairs=function(e){var t=[];for(var n in e)T.has(e,n)&&t.push([n,e[n]]);return t},T.invert=function(e){var t={};for(var n in e)T.has(e,n)&&(t[e[n]]=n);return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return N(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)T.contains(n,i)||(t[i]=e[i]);return t},T.defaults=function(e){return N(u.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var i=l.call(e);if(i!=l.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=M(e[o],t[o],n,r)))break}else{var a=e.constructor,f=t.constructor;if(a!==f&&!(T.isFunction(a)&&a instanceof a&&T.isFunction(f)&&f instanceof f))return!1;for(var c in e)if(T.has(e,c)){o++;if(!(u=T.has(t,c)&&M(e[c],t[c],n,r)))break}if(u){for(c in t)if(T.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(e==null)return!0;if(T.isArray(e)||T.isString(e))return e.length===0;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!!e&&e.nodeType===1},T.isArray=E||function(e){return l.call(e)=="[object Array]"},T.isObject=function(e){return e===Object(e)},N(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!!e&&!!T.has(e,"callee")}),typeof /./!="function"&&(T.isFunction=function(e){return typeof e=="function"}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||l.call(e)=="[object Boolean]"},T.isNull=function(e){return e===null},T.isUndefined=function(e){return e===void 0},T.has=function(e,t){return c.call(e,t)},T.noConflict=function(){return e._=t,this},T.identity=function(e){return e},T.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},T.random=function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=T.invert(_.escape);var D={escape:new RegExp("["+T.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(_.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),T.result=function(e,t){if(e==null)return null;var n=e[t];return T.isFunction(n)?n.call(e):n},T.mixin=function(e){N(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(T,e))}})};var P=0;T.uniqueId=function(e){var t=P++;return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){n=T.defaults({},n,T.templateSettings);var r=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),s+=n?"'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?"'+\n((__t=("+r+"))==null?'':__t)+\n'":o?"';\n"+o+"\n__p+='":"",i=u+t.length}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,T);var a=function(e){return o.call(this,e,T)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},T.chain=function(e){return T(e).chain()};var F=function(e){return this._chain?T(e).chain():e};T.mixin(T),N(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),N(["concat","join","slice"],function(e){var t=r[e];T.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),n("underscore",function(e){return function(){return e._}}(this)),function(){var e=this,n=e.Backbone,r=Array.prototype,i=r.push,s=r.slice,o=r.splice,u;typeof exports!="undefined"?u=exports:u=e.Backbone={},u.VERSION="0.9.2";var a=e._;!a&&typeof t!="undefined"&&(a=t("underscore")),u.$=e.jQuery||e.Zepto||e.ender,u.noConflict=function(){return e.Backbone=n,this},u.emulateHTTP=!1,u.emulateJSON=!1;var f=/\s+/,l=u.Events={on:function(e,t,n){var r,i,s;if(!t)return this;e=e.split(f),r=this._callbacks||(this._callbacks={});while(i=e.shift())s=r[i]||(r[i]=[]),s.push(t,n);return this},off:function(e,t,n){var r,i,s,o;if(!(i=this._callbacks))return this;if(!(e||t||n))return delete this._callbacks,this;e=e?e.split(f):a.keys(i);while(r=e.shift()){if(!(s=i[r])||!t&&!n){delete i[r];continue}for(o=s.length-2;o>=0;o-=2)t&&s[o]!==t||n&&s[o+1]!==n||s.splice(o,2)}return this},trigger:function(e){var t,n,r,i,s,o,u,a;if(!(n=this._callbacks))return this;a=[],e=e.split(f);for(i=1,s=arguments.length;i<s;i++)a[i-1]=arguments[i];while(t=e.shift()){if(u=n.all)u=u.slice();if(r=n[t])r=r.slice();if(r)for(i=0,s=r.length;i<s;i+=2)r[i].apply(r[i+1]||this,a);if(u){o=[t].concat(a);for(i=0,s=u.length;i<s;i+=2)u[i].apply(u[i+1]||this,o)}}return this}};l.bind=l.on,l.unbind=l.off;var c=u.Model=function(e,t){var n,r=e||{};t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=a.uniqueId("c"),this.changed={},this._changes={},this._pending={},t&&t.parse&&(r=this.parse(r));if(n=a.result(this,"defaults"))r=a.extend({},n,r);this.set(r,{silent:!0}),this.changed={},this._changes={},this._pending={},this._previousAttributes=a.clone(this.attributes),this.initialize.apply(this,arguments)};a.extend(c.prototype,l,{changed:null,_changes:null,_pending:null,_changing:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return a.clone(this.attributes)},sync:function(){return u.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=a.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i;if(e==null)return this;a.isObject(e)?(i=e,n=t):(i={})[e]=t;var s=n&&n.silent,o=n&&n.unset;i instanceof c&&(i=i.attributes);if(o)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=this._changing,f=this.attributes,l=this._escapedAttributes,h=this._previousAttributes||{};for(r in i){t=i[r];if(!a.isEqual(f[r],t)||o&&a.has(f,r))delete l[r],this._changes[r]=!0;o?delete f[r]:f[r]=t,!a.isEqual(h[r],t)||a.has(f,r)!==a.has(h,r)?(this.changed[r]=t,s||(this._pending[r]=!0)):(delete this.changed[r],delete this._pending[r],u||delete this._changes[r]),u&&a.isEqual(f[r],u[r])&&delete this._changes[r]}return s||this.change(n),this},unset:function(e,t){return t=a.extend({},t,{unset:!0}),this.set(e,null,t)},clear:function(e){return e=a.extend({},e,{unset:!0}),this.set(a.clone(this.attributes),e)},fetch:function(e){e=e?a.clone(e):{};var t=this,n=e.success;return e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r,e)},this.sync("read",this,e)},save:function(e,t,n){var r,i,s;e==null||a.isObject(e)?(r=e,n=t):e!=null&&((r={})[e]=t),n=n?a.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;i=a.clone(this.attributes)}var o=a.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?o:n))return!1;if(!r&&!this._validate(null,n))return!1;var u=this,f=n.success;n.success=function(e,t,i){s=!0;var o=u.parse(e,i);n.wait&&(o=a.extend(r||{},o));if(!u.set(o,n))return!1;f&&f(u,e,n)};var l=this.sync(this.isNew()?"create":"update",this,n);return!s&&n.wait&&(this.clear(o),this.set(i,o)),l},destroy:function(e){e=e?a.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e)};if(this.isNew())return e.success(),!1;var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||O();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){var t=this._changing,n=this._changing={};for(var r in this._changes)this._pending[r]=!0;var i=this._changes;this._changes={};var s=[];for(var r in i)n[r]=this.get(r),s.push(r);for(var o=0,u=s.length;o<u;o++)this.trigger("change:"+s[o],this,n[s[o]],e);if(t)return this;while(!a.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._changes[r])continue;delete this.changed[r]}this._previousAttributes=a.clone(this.attributes)}return this._changing=null,this},hasChanged:function(e){return e==null?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?a.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(a.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return a.clone(this._previousAttributes)},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(t&&t.silent||!this.validate)return!0;e=a.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error&&t.error(this,n,t),this.trigger("error",this,n,t),!1):!0}});var h=u.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&(t.parse&&(e=this.parse(e)),this.reset(e,{silent:!0,parse:t.parse}))};a.extend(h.prototype,l,{model:c,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return u.sync.apply(this,arguments)},add:function(e,t){var n,r,s,u,f,l=t&&t.at;e=a.isArray(e)?e.slice():[e];for(n=0,s=e.length;n<s;n++){if(e[n]=this._prepareModel(e[n],t))continue;throw new Error("Can't add an invalid model to a collection")}for(n=e.length-1;n>=0;n--){u=e[n],f=u.id!=null&&this._byId[u.id];if(f||this._byCid[u.cid]){t&&t.merge&&f&&f.set(u,t),e.splice(n,1);continue}u.on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u)}this.length+=e.length,r=[l!=null?l:this.models.length,0],i.apply(r,e),o.apply(this.models,r),this.comparator&&l==null&&this.sort({silent:!0});if(t&&t.silent)return this;while(u=e.shift())u.trigger("add",u,this,t);return this},remove:function(e,t){var n,r,i,s;t||(t={}),e=a.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){s=this.getByCid(e[n])||this.get(e[n]);if(!s)continue;delete this._byId[s.id],delete this._byCid[s.cid],i=this.indexOf(s),this.models.splice(i,1),this.length--,t.silent||(t.index=i,s.trigger("remove",s,this,t)),this._removeReference(s)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return a.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),(!e||!e.silent)&&this.trigger("reset",this,e),this},pluck:function(e){return a.invoke(this.models,"get",e)},reset:function(e,t){for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return this._reset(),e&&this.add(e,a.extend({silent:!0},t)),(!t||!t.silent)&&this.trigger("reset",this,t),this},fetch:function(e){e=e?a.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e),n&&n(t,r,e)},this.sync("read",this,e)},create:function(e,t){var n=this;t=t?a.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return a(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(e instanceof c)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(n.attributes,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var p=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];a.each(p,function(e){h.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),a[e].apply(a,t)}});var d=["groupBy","countBy","sortBy"];a.each(d,function(e){h.prototype[e]=function(t,n){var r=a.isFunction(t)?t:function(e){return e.get(t)};return a[e](this.models,r,n)}});var v=u.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},m=/\((.*?)\)/g,g=/:\w+/g,y=/\*\w+/g,b=/[-{}[\]+?.,\\^$|#\s]/g;a.extend(v.prototype,l,{initialize:function(){},route:function(e,t,n){return a.isRegExp(e)||(e=this._routeToRegExp(e)),n||(n=this[t]),u.history.route(e,a.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i),this.trigger.apply(this,["route:"+t].concat(i)),u.history.trigger("route",this,t,i)},this)),this},navigate:function(e,t){return u.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=a.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(b,"\\$&").replace(m,"(?:$1)?").replace(g,"([^/]+)").replace(y,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var w=u.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/,S=/^\/+|\/+$/g,x=/msie [\w.]+/,T=/\/$/;w.started=!1,a.extend(w.prototype,l,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(T,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return decodeURIComponent(e.replace(E,""))},start:function(e){if(w.started)throw new Error("Backbone.history has already been started");w.started=!0,this.options=a.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=x.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(S,"/"),r&&this._wantsHashChange&&(this.iframe=u.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?u.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?u.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search));if(!this.options.silent)return this.loadUrl()},stop:function(){u.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),w.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=a.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return n},navigate:function(e,t){if(!w.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),u.history=new w;var N=u.View=function(e){this.cid=a.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},C=/^(\S+)\s*(.*)$/,k=["model","collection","el","id","attributes","className","tagName"];a.extend(N.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},dispose:function(){return this.undelegateEvents(),this.model&&this.model.off&&this.model.off(null,null,this),this.collection&&this.collection.off&&this.collection.off(null,null,this),this},remove:function(){return this.dispose(),this.$el.remove(),this},make:function(e,t,n){var r=document.createElement(e);return t&&u.$(r).attr(t),n!=null&&u.$(r).html(n),r},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof u.$?e:u.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=a.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];a.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(C),i=r[1],s=r[2];n=a.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.bind(i,n):this.$el.delegate(s,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=a.extend({},this.options,e)),a.extend(this,a.pick(e,k)),this.options=e},_ensureElement:function(){if(!this.el){var e=a.extend({},a.result(this,"attributes"));this.id&&(e.id=a.result(this,"id")),this.className&&(e["class"]=a.result(this,"className")),this.setElement(this.make(a.result(this,"tagName"),e),!1)}else this.setElement(a.result(this,"el"),!1)}});var L={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};u.sync=function(e,t,n){var r=L[e];a.defaults(n||(n={}),{emulateHTTP:u.emulateHTTP,emulateJSON:u.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=a.result(t,"url")||O()),!n.data&&t&&(e==="create"||e==="update")&&(i.contentType="application/json",i.data=JSON.stringify(t)),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var o=n.success;n.success=function(e,r,i){o&&o(e,r,i),t.trigger("sync",t,e,n)};var f=n.error;return n.error=function(e,r,i){f&&f(t,e,n),t.trigger("error",t,e,n)},u.ajax(a.extend(i,n))},u.ajax=function(){return u.$.ajax.apply(u.$,arguments)};var A=function(e,t){var n=this,r;e&&a.has(e,"constructor")?r=e.constructor:r=function(){n.apply(this,arguments)},a.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&a.extend(r.prototype,e),r.__super__=n.prototype,r};c.extend=
h.extend=v.extend=N.extend=w.extend=A;var O=function(){throw new Error('A "url" property or function must be specified')}}.call(this),n("backbone",["underscore"],function(e){return function(){return e.Backbone}}(this)),n("grapher/bar-graph/bar-graph-model",["require","backbone"],function(e){var t=e("backbone"),n=t.Model.extend({defaults:{value:0,minValue:0,maxValue:10,width:150,height:500,title:"",barColor:"green",fillColor:"white",textColor:"#555",ticks:10,tickSubdivide:1,displayLabels:!0,labelFormat:"0.1f"}});return n}),n("grapher/bar-graph/bar-graph-view",["require","backbone"],function(e){var t=e("backbone"),n={padding:{left:10,top:10,right:10,bottom:10}},r=function(e){return e.node().getBBox().width},i=function(e){return e.node().getBBox().height},s=500,o=function(e){var t=e/s;return t<.6&&(t=.6),function(e){return e*t}},u=function(e,t){var n=[],r={},i,s;for(i=0,s=t.length;i<s;i++)n[i]=t[i].value,r[n[i]]=t[i].label;e.tickValues(n).tickFormat(function(e){return r[e]})},a=t.View.extend({tagName:"div",className:"bar-graph",initialize:function(){this.vis=d3.select(this.el).append("svg"),this.fill=this.vis.append("rect"),this.bar=this.vis.append("rect"),this.title=this.vis.append("text"),this.axisContainer=this.vis.append("g"),this.yScale=d3.scale.linear(),this.heightScale=d3.scale.linear(),this.yAxis=d3.svg.axis(),this.model.on("change",this.modelChanged,this)},render:function(){var e=this.model.toJSON(),t=o(e.height),s=t(n.padding.left),a=t(n.padding.top),f=t(n.padding.bottom),l=t(n.padding.right);this.vis.attr({width:e.width,height:e.height}).style({"font-size":t(15)+"px"}),this.yScale.domain([e.minValue,e.maxValue]).range([e.height-a,f]),this.heightScale.domain([e.minValue,e.maxValue]).range([0,e.height-a-f]),e.title!==undefined&&(this.title.text(e.title).style({"font-size":"140%","text-anchor":"middle",fill:e.textColor}),l+=i(this.title),this.title.attr("transform","translate("+(e.width-l)+", "+e.height/2+") rotate(90)")),this.yAxis.scale(this.yScale).tickSubdivide(e.tickSubdivide).tickSize(t(10),t(5),t(10)).orient("right"),typeof e.ticks=="number"?this.yAxis.ticks(e.ticks).tickFormat(d3.format(e.labelFormat)):u(this.yAxis,e.ticks),this.axisContainer.call(this.yAxis),this.axisContainer.style({stroke:e.textColor,"stroke-width":t(2),fill:"none"}),this.axisContainer.selectAll("text").style({fill:e.textColor,"stroke-width":0,"font-size":e.displayLabels?"100%":0}),e.ticks===0&&this.axisContainer.selectAll("*").remove(),l+=r(this.axisContainer)+t(7),this.axisContainer.attr("transform","translate("+(e.width-l)+", 0)"),l+=t(5),this.fill.attr({width:e.width-s-l,height:this.heightScale(e.maxValue),x:s,y:this.yScale(e.maxValue)}).style({fill:e.fillColor}),this.bar.attr({width:e.width-s-l,x:s}).style({fill:e.barColor}),this.updateBar()},updateBar:function(){var e=this.model.get("value");this.bar.attr("height",this.heightScale(e)).attr("y",this.yScale(e))},getParentHeight:function(){return this.$el.parent().height()},getParentWidth:function(){return this.$el.parent().width()},modelChanged:function(){var e=this.model.changedAttributes(),t=0,n;for(n in e)if(e.hasOwnProperty(n)){t++;if(t>1){this.render();return}}e.value!==undefined?this.updateBar():this.render()}});return a}),n("common/controllers/bar-graph-controller",["require","grapher/bar-graph/bar-graph-model","grapher/bar-graph/bar-graph-view"],function(e){var t=e("grapher/bar-graph/bar-graph-model"),n=e("grapher/bar-graph/bar-graph-view");return function(r){var i,s=new t(r.options),o=new n({model:s,id:r.id}),u=r.input1,a=function(){s.set({value:model.get(u)})};return i={modelLoadedCallback:function(){u&&model.addPropertiesListener([u],a),o.render(),a()},getViewContainer:function(){return o.$el},resize:function(e,t){e===undefined&&(e=o.getParentWidth()),t===undefined&&(t=o.getParentHeight()),s.set({width:e,height:t})}},i}}),n("grapher/core/axis",["require"],function(e){return{axisProcessDrag:function(e,t,n){var r,i,s=n,o=0,u=n[0],a=n[1],f=a-u;if(t!==0)if(u>=0&&a>u)o=u,r=e-o,i=r*.2+o,t>i&&(change=r/(t-o),f=a-o,s=[u,u+f*change]);else if(u<0&&a>0){o=0,r=e-o,i=r*.2+o;if(e>=0&&t>i||e<0&&t<i)change=r/(t-o),s=[u*change,a*change]}else u<0&&a<0&&(o=a,r=e-o,i=r*.2+o,t<i&&(change=r/(t-o),f=u-o,s=[a+f*change,a]));return s}}}),n("grapher/core/real-time-graph",["require","grapher/core/axis"],function(e){var t=e("grapher/core/axis");return function(n,r,s){function nt(e){if(e)for(var t in tt)e[t]===undefined&&(e[t]=tt[t]);else e=tt;return e.axisShift<1&&(e.axisShift=1),e}function rt(){a<=q.icon?(q.category="icon",q.value=0):a<=q.tiny?(q.category="tiny",q.value=1):a<=q.small?(q.category="small",q.value=2):a<=q.medium?(q.category="medium",q.value=3):a<=q.large?(q.category="large",q.value=4):(q.category="extralarge",q.value=5)}function it(e,t){arguments.length?(a=e,u.style.width=a+"px",t?(f=t,u.style.height=f+"px"):(u.style.height="100%",t=o.property("clientHeight"),f=t,u.style.height=f+"px")):(a=o.property("clientWidth"),f=o.property("clientHeight")),rt(),j=parseFloat($("#viz").css("font-size")||$("body").css("font-size"))/10}function st(e,t,n){e&&(o=d3.select(e),u=o.node(),a=o.property("clientWidth"),f=o.property("clientHeight"));if(t||!r)r=nt(t),newOptions=undefined;v!==undefined&&(v.remove(),v=undefined),Y!==undefined&&($(Y).remove(),Y=undefined),G=r.sample,r.dataChange?H="ns-resize":H="crosshair",it(),r.xrange=r.xmax-r.xmin,r.yrange=r.ymax-r.ymin,J=[];switch(q.value){case 0:k={top:4,right:4,bottom:4,left:4};break;case 1:k={top:8,right:8,bottom:8,left:8};break;case 2:k={top:r.title?25:15,right:15,bottom:20,left:30};break;case 3:k={top:r.title?30:20,right:30,bottom:r.xlabel?60:10,left:r.ylabel?70:45};break;default:k={top:r.title?40:20,right:30,bottom:r.xlabel?60:10,left:r.ylabel?70:45}}if(Object.prototype.toString.call(r.dataset[0])==="[object Array]"){for(var i=0;i<r.dataset.length;i++)J.push(ot(r.dataset[i],0,G));V=J[0]}else V=ot(r.dataset,0),J=[V];Object.prototype.toString.call(r.title)==="[object Array]"?X=r.title:X=[r.title],X.reverse(),q.value>2?k.top+=(X.length-1)*q.value/3*q.value/3*j*22:X=[X[0]],L={width:a-k.left-k.right,height:f-k.top-k.bottom},A=d3.scale[r.xscale]().domain([r.xmin,r.xmax]).range([0,L.width]),r.xscale==="pow"&&A.exponent(r.xscaleExponent),O=d3.scale[r.yscale]().domain([r.ymin,r.ymax]).nice().range([L.height,0]).nice(),r.yscale==="pow"&&O.exponent(r.yscaleExponent),p=d3.format(r.xFormatter),d=d3.format(r.yFormatter),M=d3.svg.line().x(function(e,t){return A(V[t].x)}).y(function(e,t){return O(V[t].y)}),R=Math.NaN,U=Math.NaN,z=null}function ot(e,t,n){var r=0,i=t||0,s=e.length,o=[];n=n||1;for(r=0;r<s;r++)o.push({x:(r+i)*n,y:e[r]});return o}function ut(){return V?V.length:!1}function at(){function e(e){s=e,e?C.text(e):C.text("")}function n(){var e=m.selectAll("g.x").data(A.ticks(r.xTicCount),String).attr("transform",c),t=e.enter().insert("g","a").attr("class","x").attr("transform",c);t.append("line").attr("stroke",l).attr("y1",0).attr("y2",L.height),q.value>1&&t.append("text").attr("class","axis").style("font-size",q.value/2.7*100+"%").attr("y",L.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(p).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",N).on("touchstart.drag",N),e.exit().remove();var s=m.selectAll("g.y").data(O.ticks(r.yTicCount),String).attr("transform",h),o=s.enter().insert("g","a").attr("class","y").attr("transform",h).attr("background-fill","#FFEEB6");o.append("line").attr("stroke",l).attr("x1",0).attr("x2",L.width),q.value>1&&o.append("text").attr("class","axis").style("font-size",q.value/2.7*100+"%").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(d).on("mouseover",function(e){d3.select(this).style("font-weight","bold")}).on("mouseout",function(e){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",H).on("touchstart.drag",H),s.exit().remove(),g.call(d3.behavior.zoom().x(A).y(O).on("zoom",n)),i()}function i(e){wt(e);if(at.selectable_points){var t=m.selectAll("circle").data(V,function(e){return e});t.enter().append("circle").attr("class",function(e){return e===W?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}).attr("r",1).on("mousedown",function(e){W=z=e,i()}),t.attr("class",function(e){return e===W?"selected":null}).attr("cx",function(e){return x(e.x)}).attr("cy",function(e){return y(e.y)}),t.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function T(){d3.event.preventDefault(),g.style("cursor","move");if(d3.event.altKey){var e=d3.svg.mouse(m[0][0]);R=A.invert(e[0]),U=O.invert(e[1]),z=!1,d3.event.stopPropagation()}}function N(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(m[0][0]);R=A.invert(t[0])}function H(e){document.onselectstart=function(){return!1},d3.event.preventDefault();var t=d3.svg.mouse(m[0][0]);U=O.invert(t[1])}function B(){var e=d3.svg.mouse(m[0][0]),r,i,s,o=d3.event.changedTouches;document.onselectstart=function(){return!0},d3.event.preventDefault(),isNaN(R)||(d3.select("body").style("cursor","ew-resize"),A.domain(t.axisProcessDrag(R,A.invert(e[0]),A.domain())),n(),d3.event.stopPropagation()),isNaN(U)||(d3.select("body").style("cursor","ns-resize"),O.domain(t.axisProcessDrag(U,O.invert(e[1]),O.domain())),n(),d3.event.stopPropagation())}function F(){d3.select("body").style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(R)||(n(),R=Math.NaN),isNaN(U)||(n(),U=Math.NaN),z=null}function I(e){K={x:V[e].x,y:V[e].y}}function $(e){var t,s=A.domain(),o=Math.round(s[0]/G),u=Math.round(s[1]/G),a=Math.max(0,o),f=s[1]-s[0],l=f*.9,c;typeof e!="number"&&(e=V.length),c=e*G,_?(_=P(),_?n():i(e)):c>s[0]+l?(P=tt(l*.9,r.axisShift),_=P(),n()):c<s[1]-l&&e<V.length&&o>0?(P=tt(l*.9,r.axisShift,-1),_=P(),n()):c<s[0]?(P=tt(l*.1,1,-1),_=P(),n()):i(e)}function tt(e,t,n){var r=A.domain()[0],i=A.domain()[1],s=1/t,o=0;return function(){var t;return n=n||1,o+=s,t=e*D(o),n>0?(A.domain([r+t,i+t]),A.domain()[0]<r+e):(A.domain([r-t,i-t]),A.domain()[0]>r-e)}}function nt(e){if(V.length===0)return;K=!1;var t=V.length,n=t*G,r={x:n,y:e},i,s;V.push(r)}function rt(e){if(V.length===0)return;nt(e),$()}function ft(e){if(V.length===0)return;K=!1;var t=V.length,n=t*G,r=n-G,i={x:n,y:e},s=A.call(self,r,r),o=O.call(self,V[t-1].y,t-1),u,a;V.push(i),u=A.call(self,n,n),a=O.call(self,e,n),Z.beginPath(),Z.moveTo(s,o),Z.lineTo(u,a),Z.stroke()}function lt(e){for(var t=0;t<J.length;t++)V=J[t],nt(e[t]);$()}function ct(e){for(var t=0;t<J.length;t++)V=J[t],ht(t),ft(e[t])}function ht(e,t){var n=t?.4:1;switch(e){case 0:Z.strokeStyle="rgba(160,00,0,"+n+")";break;case 1:Z.strokeStyle="rgba(44,160,0,"+n+")";break;case 2:Z.strokeStyle="rgba(44,0,160,"+n+")"}}function pt(e,t){var n=t?.4:1;switch(e){case 0:Z.fillStyle="rgba(160,00,0,"+n+")";break;case 1:Z.fillStyle="rgba(44,160,0,"+n+")";break;case 2:Z.fillStyle="rgba(44,0,160,"+n+")"}}function dt(e){var t;J=[];if(Object.prototype.toString.call(e)==="[object Array]")for(t=0;t<e.length;t++)V=ot(e[t],0,G),J.push(V);else V=ot(r.dataset,0,G),J=[V];$()}function vt(e){x=d3.scale[r.xscale]().domain([0,e]).range([0,L.width]),at.xmax=e,x_tics_scale=d3.scale[r.xscale]().domain([at.xmin*at.sample,at.xmax*at.sample]).range([0,L.width]),i(),n()}function mt(e){y=d3.scale[r.yscale]().domain([e,0]).range([0,L.height]),at.ymax=e,i(),n()}function gt(){Y.width=Y.width,Z.fillStyle="rgba(0,255,0, 0.05)",Z.fillRect(0,0,Y.width,Y.height),Z.strokeStyle="rgba(255,65,0, 1.0)"}function yt(){m.select("path.line").remove(),Y.style.zIndex=100}function bt(){Y.style.zIndex=-100,i()}function wt(e){var t,n,i,s,o,u=O(1e-5),a=r.lines,f=r.bars,l=2*Math.PI,c=J[0].length,h=J.length,p=Math.round(A.domain()[0]/G),d=Math.round(A.domain()[1]/G),v=Math.max(0,p);typeof e=="undefined"?s=c:e===c-1?s=c-1:s=e,gt(),Z.fillRect(0,0,Y.width,Y.height);if(V.length===0||p>=V.length)return;if(a)for(t=0;t<h;t++){V=J[t],lengthX=v*G,px=A(lengthX),i=O(V[v].y),ht(t),Z.beginPath(),Z.moveTo(px,i),o=s-1;for(n=v+1;n<o;n++)lengthX=n*G,px=A(lengthX),i=O(V[n].y),Z.lineTo(px,i);Z.stroke(),o=V.length-1;if(n<o){ht(t,!0);for(;n<o;n++)lengthX=n*G,px=A(lengthX),i=O(V[n].y),Z.lineTo(px,i);Z.stroke()}}else if(f)for(t=0;t<h;t++){V=J[t],ht(t),o=s-1;for(n=v;n<o;n++){lengthX=n*G,px=A(lengthX),i=O(V[n].y);if(i===0)continue;Z.beginPath(),Z.moveTo(px,u),Z.lineTo(px,i),Z.stroke()}o=V.length-1;if(n<o){ht(t,!0);for(;n<o;n++)lengthX=n*G,px=A(lengthX),i=O(V[n].y),Z.beginPath(),Z.moveTo(px,u),Z.lineTo(px,i),Z.stroke()}}else for(t=0;t<h;t++){V=J[t],lengthX=0,pt(t),ht(t,!0),o=s-1;for(n=0;n<o;n++)px=A(lengthX),i=O(V[n].y),Z.arc(px,i,1,0,l,!1),Z.fill(),lengthX+=G;o=V.length-1;if(n<o){pt(t,!0),ht(t,!0);for(;n<o;n++)px=A(lengthX),i=O(V[n].y),Z.arc(px,i,1,0,l,!1),Z.fill(),lengthX+=G}}}function Et(){Y||(Y=Y||document.createElement("canvas"),u.appendChild(Y)),Y.style.zIndex=-100,xt(Y)}function St(){xt(Y),wt()}function xt(e){et.rect=g.node(),et.width=et.rect.width.baseVal.value,et.height=et.rect.height.baseVal.value,et.left=et.rect.getCTM().e,et.top=et.rect.getCTM().f,e.style.position="absolute",e.width=et.width,e.height=et.height,e.style.width=et.width+"px",e.style.height=et.height+"px",e.offsetLeft=et.left,e.offsetTop=et.top,e.style.left=et.left+"px",e.style.top=et.top+"px",e.style.border="solid 1px red",e.style.pointerEvents="none",e.className+="canvas-overlay",Z=Y.getContext("2d"),Z.globalCompositeOperation="source-over",Z.lineWidth=1,Z.fillStyle="rgba(0,255,0, 0.05)",Z.fillRect(0,0,e.width,Y.height),Z.strokeStyle="rgba(255,65,0, 1.0)",Y.style.border="solid 1px red"}it(),v===undefined?(v=o.append("svg").attr("width",a).attr("height",f),m=v.append("g").attr("transform","translate("+k.left+","+k.top+")"),g=m.append("rect").attr("class","plot").attr("width",L.width).attr("height",L.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",T).on("touchstart",T),g.call(d3.behavior.zoom().x(A).y(O).on("zoom",n)),b=m.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",L.width).attr("height",L.height).attr("viewBox","0 0 "+L.width+" "+L.height).append("path").attr("class","line").attr("d",M(V)),Q=b.append("path").attr("class","marker"),r.title&&q.value>1&&(w=m.selectAll("text").data(X,function(e){return e}),w.enter().append("text").attr("class","title").style("font-size",q.value/3.2*100+"%").text(function(e){return e}).attr("x",L.width/2).attr("dy",function(e,t){return-0.5+ -1*q.value/2.8*t*j+"em"}).style("text-anchor","middle")),r.xlabel&&q.value>2&&(E=m.append("text").attr("class","axis").style("font-size",q.value/2.6*100+"%").attr("class","xlabel").text(r.xlabel).attr("x",L.width/2).attr("y",L.height).attr("dy","2.4em").style("text-anchor","middle")),r.ylabel&&q.value>2&&(S=m.append("g").append("text").attr("class","axis").style("font-size",q.value/2.6*100+"%").attr("class","ylabel").text(r.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+L.height/2+") rotate(-90)")),C=m.append("text").attr("class","graph-notification").text(s).attr("x",L.width/2).attr("y",L.height/2).style("text-anchor","middle"),d3.select(u).on("mousemove.drag",B).on("touchmove.drag",B).on("mouseup.drag",F).on("touchend.drag",F),Et(),yt()):(m.attr("width",a).attr("height",f),g.attr("width",L.width).attr("height",L.height).style("fill","#EEEEEE"),b.attr("top",0).attr("left",0).attr("width",L.width).attr("height",L.height).attr("viewBox","0 0 "+L.width+" "+L.height),r.title&&q.value>1&&w.each(function(e,t){d3.select(this).attr("x",L.width/2),d3.select(this).attr("dy",function(e,t){return 1.4*t-X.length+"em"})}),r.xlabel&&q.value>1&&E.attr("x",L.width/2).attr("y",L.height),r.ylabel&&q.value>1&&S.attr("transform","translate(-40 "+L.height/2+") rotate(-90)"),C.attr("x",L.width/2).attr("y",L.height/2),m.selectAll("g.x").remove(),m.selectAll("g.y").remove(),St()),n(),at.node=u,at.scale=it,at.update=i,at.updateOrRescale=$,at.redraw=n,at.initialize=st,at.notify=e,at.number_of_points=ut,at.new_data=dt,at.add_point=rt,at.add_points=lt,at.add_canvas_point=ft,at.add_canvas_points=ct,at.initialize_canvas=Et,at.show_canvas=yt,at.hide_canvas=bt,at.clear_canvas=gt,at.update_canvas=wt,at.showMarker=I,at.change_xaxis=vt,at.change_yaxis=mt}var o,u,a,f,l=function(e){return e?"#ccc":"#666"},c=function(e){return"translate("+A(e)+",0)"},h=function(e){return"translate(0,"+O(e)+")"},p,d,v,m,g,b,w,E,S,T,N,C,k,L,A,O,M,_=!1,D=d3.ease("cubic"),P,H,B,j,F,I,q={category:"medium",value:3,icon:120,tiny:240,small:480,medium:960,large:1920},R=Math.NaN,U=Math.NaN,z=null,W=null,X=[],V,J,K,Q,G,Y,Z,et={},tt={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xscale:"linear",yscale:"linear",xTicCount:10,yTicCount:10,xscaleExponent:.5,yscaleExponent:.5,xFormatter:"3.2r",yFormatter:"3.2r",axisShift:10,xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1,points:!1,sample:1,lines:!0,bars:!1};return st(n,r,s),at.add_data=function(e){if(!arguments.length)return V;var t=A.domain(),n=t[1]-t[0],r=n*.8,s;i;if(e instanceof Array&&e.length>0)if(e[0]instanceof Array)for(i=0;i<e.length;i++)V.push(e[i]);else{if(e.length!==2)throw new Error("invalid argument to graph.add_data() "+e+" length should === 2.");V.push(e)}return updateOrRescale(),at},at.reset=function(e,t,n){return arguments.length?at.initialize(e,t,n):at.initialize(),at(),at},at.resize=function(e,t){return at.scale(e,t),at.initialize(),at(),at},u&&at(),at}}),n("common/controllers/graph-controller",["require","grapher/core/real-time-graph"],function(e){var t=e("grapher/core/real-time-graph"),n={title:"Graph",xlabel:"Model Time (ps)",xmin:0,xmax:20,ylabel:"",ymin:0,ymax:10},r={title:"title",xlabel:"xlabel",xmin:"xmin",xmax:"xmax",ylabel:"ylabel",ymin:"ymin",ymax:"ymax"};return function(i){function l(){return model.get("viewRefreshInterval")*model.get("timeStep")/1e3}function c(){var e=[],t,n;for(t=0,n=a.length;t<n;t++)e.push(model.get(a[t]));return e}function h(){var e,t,s={sample:l()};for(e in r)r.hasOwnProperty(e)&&(t=r[e],s[t]=i[e]!=null?i[e]:n[e]);return s}function p(){var e=c(),t;for(t=0;t<e.length;t++)f[t]=[e[t]];o.new_data(f)}function d(){var e=c(),t;for(t=0;t<e.length;t++)f[t].push(e[t]);o.add_points(e)}function v(){var e;for(e=0;e<a.length;e++)f[e].length=model.stepCounter()+1;o.new_data(f)}function m(){o.updateOrRescale(model.stepCounter()),o.showMarker(model.stepCounter())}function g(){o.reset("#"+i.id,h())}function y(){model.on("tick.graphController",d),model.on("stepBack.graphController",m),model.on("stepForward.graphController",m),model.on("seek.graphController",m),model.on("reset.graphController",function(){g(),p()}),model.on("play.pressureGraph",function(){o.number_of_points()&&model.stepCounter()<o.number_of_points()&&v(),o.show_canvas()}),model.on("invalidation.graphController",v),model.addPropertiesListener(["viewRefreshInterval","timeStep"],function(){g(),p()})}var s=$("<div>").attr("id",i.id).addClass("properties-graph"),o,u,a,f=[];return a=i.properties.slice(),u={modelLoadedCallback:function(){o?g():o=new t("#"+i.id,h()),p(),y()},getView:function(){return o},getViewContainer:function(){return s}}}}),n("lab.config",["require"],function(e){return{sharing:!0,home:"http://lab.concord.org",homeInteractivePath:"/examples/interactives/interactive.html",homeEmbeddablePath:"/examples/interactives/embeddable.html",utmCampaign:null,logging:!0,tracing:!1}}),n("common/console",["require","lab.config"],function(e){var t=e("lab.config"),n,r,i=function(){};return typeof console=="undefined"&&(console={},window&&(window.console=console)),r=console,r.log===undefined&&(r.log=i),r.info===undefined&&(r.info=i),r.warn===undefined&&(r.warn=i),r.error===undefined&&(r.error=i),r.time===undefined&&(r.time=i),r.timeEnd===undefined&&(r.timeEnd=i),n={log:function(){t.logging&&r.log.apply(r,arguments)},info:function(){t.logging&&r.info.apply(r,arguments)},warn:function(){t.logging&&r.warn.apply(r,arguments)},error:function(){t.logging&&r.error.apply(r,arguments)},time:function(){t.tracing&&r.time.apply(r,arguments)},timeEnd:function(){t.tracing&&r.timeEnd.apply(r,arguments)}},n}),n("common/dg-exporter",["require","common/console"],function(e){var t=e("common/console");return{gameName:"Next Gen MW",parentCollectionName:"Parameters",childCollectionName:"Time Series",nMetadataLabels:0,metadataLabelPositions:{},mockDGController:{doCommand:function(e){return t.log("action: ",e.action),t.log("args: ",e.args),{caseID:0}}},getDGGameController:function(){return!window.parent||!window.parent.DG?this.mockDGController:window.parent.DG.currGameController},doCommand:function(e,t){var n=this.getDGGameController();return n.doCommand({action:e,args:t})},exportData:function(e,t,n,r){var i,s,o,u=[],a=[],f=[],l,c,h;for(h=0;h<t.length;h++)i=e[h],s=t[h],this.metadataLabelPositions[i]==null&&(this.metadataLabelPositions[i]=this.nMetadataLabels++),o=this.metadataLabelPositions[i],u[o]={name:i},a[o]=s;for(h=0;h<n.length;h++)f.push({name:n[h]});this.doCommand("initGame",{name:this.gameName}),this.doCommand("createCollection",{name:this.parentCollectionName,attrs:[{name:"Number of Readings"}].concat(u),childAttrName:"contents"}),this.doCommand("createCollection",{name:this.childCollectionName,attrs:f}),c=[r.length].concat(a),l=this.doCommand("openCase",{collection:this.parentCollectionName,values:c}),this.doCommand("createCases",{collection:this.childCollectionName,values:r,parent:l.caseID,log:!1}),this.doCommand("closeCase",{collection:this.parentCollectionName,values:c,caseID:l.caseID})}}}),n("common/controllers/dg-export-controller",["require","common/dg-exporter"],function(e){var t=e("common/dg-exporter");return function(n){function u(){var e=[],t,n;for(t=0,n=i.length;t<n;t++)e.push(model.get(i[t]));return e}function a(){s=[u()]}function f(){s.push(u())}function l(){s.length=model.stepCounter()+1}function c(){model.on("tick.dgExportController",f),model.on("reset.dgExportController",a),model.on("play.dgExportController",l),model.on("invalidation.dgExportController",l)}function h(e){var t=model.getPropertyDescription(e),n="";return t.label&&t.label.length>0?n+=t.label:n+=e,t.units&&t.units.length>0&&(n+=" (",n+=t.units,n+=")"),n}var r=n.parameters.slice(),i=["timeInPs"].concat(n.outputs.slice()),s,o;return o={modelLoadedCallback:function(){model.defineOutput("timeInPs",{label:"Time",units:"ps"},function(){return model.get("time")/1e3}),a(),c()},exportData:function(){var e=[],n=[],o=[],u;for(u=0;u<r.length;u++)e[u]=h(r[u]),n[u]=model.get(r[u]);for(u=0;u<i.length;u++)o[u]=h(i[u]);t.exportData(e,n,o,s)}}}}),n("common/controllers/scripting-api",["require"],function(e){return function(t,n){var r=function(){function e(e){return typeof e=="number"&&parseFloat(e)===parseInt(e,10)}function n(e){return typeof e=="object"&&e.slice===Array.prototype.slice}function r(e){return Math.floor(Math.random()*e)}function i(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function s(e,t){var n=[],s;for(s=0;s<t;s++)n[s]=s;for(s=0;s<e;s++)i(n,s,s+r(t-s));return n.length=e,n}return{isInteger:e,isArray:n,randomInteger:r,swapElementsOfArray:i,choose:s,deg2rad:Math.PI/180,rad2deg:180/Math.PI,format:d3.format,get:function(){return model.get.apply(model,arguments)},set:function(){return model.set.apply(model,arguments)},loadModel:function(n,r){model.stop(),t.loadModel(n),typeof r=="function"&&t.pushOnLoadScript(r)},onPropertyChange:function(t,n){model.addPropertiesListener([t],function(){n(model.get(t))})},start:function(){model.start()},stop:function(){model.stop()},reset:function(){model.stop(),t.modelController.reload()},tick:function(){model.tick()},getTime:function(){return model.get("time")},repaint:function(){t.getModelController().repaint()},exportData:function(){var n=t.getDGExportController();if(!n)throw new Error("No exports have been specified.");n.exportData()},Math:Math,"undefined":undefined,alert:alert,console:window.console!==null?window.console:{log:function(){},error:function(){},warn:function(){},dir:function(){}}}}(),i={freeze:function(){Object.freeze(r)},extend:function(e){jQuery.extend(r,new e(r))},exposeScriptingAPI:function(){window.script=$.extend({},r),window.script.run=function(e,t){var n,r=[],s=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),s.push(t[n]));return i.makeFunctionInScriptContext.apply(null,r.concat(e)).apply(null,s)}},makeFunctionInScriptContext:function(){function u(){var t=Object.getOwnPropertyNames(window),n,r,i,s;for(r=0,i=t.length;r<i;r++)n=t[r],e.hasOwnProperty(n)||(s=function(e){return function(){throw new ReferenceError(e+" is not defined")}}(n),Object.defineProperty(e,n,{set:s,get:s}))}var e={},t=Array.prototype.slice.call(arguments,0,arguments.length-1),n=arguments[arguments.length-1],i,s,o;typeof n!="string"&&(n=n.join("      \n")),i="with (shadowedGlobals) {\n  with (scriptingAPI) {\n    return function("+t.join(",")+") {\n"+"      'use "+"strict';\n"+"      "+n+"\n"+"    };\n"+"  }\n"+"}";try{s=new Function("shadowedGlobals","scriptingAPI","scriptSource",i),o=s(e,r,n)}catch(a){return alert('Error compiling script: "'+a.toString()+'"\nScript:\n\n'+n),function(){throw new Error("Cannot run a script that could not be compiled")}}return function(){u();try{return o.apply(null,Array.prototype.slice.call(arguments))}catch(e){alert('Error running script: "'+e.toString()+'"\nScript:\n\n'+n)}}}};return i}}),n("common/controllers/button-controller",[],function(){return function(t,n){var r,i;return r=$("<button>").attr("id",t.id).html(t.text),r.addClass("component"),r.click(n.makeFunctionInScriptContext(t.action)),i={getViewContainer:function(){return r}},i}}),n("common/controllers/checkbox-controller",[],function(){return function(t,n){var r=t.property,i=t.onClick,s,o,u,a=function(){var e=model.get(r);e?s.attr("checked",!0):s.attr("checked",!1)};return s=$('<input type="checkbox">').attr("id",t.id),o=$("<label>").append(t.text).append(s),o.addClass("interactive-checkbox"),i&&(i=n.makeFunctionInScriptContext("value",i)),s.click(function(){var e=!1,t;$(this).is(":checked")&&(e=!0),r!==undefined&&(t={},t[r]=e,model.set(t)),i!==undefined&&i(e)}),u={modelLoadedCallback:function(){r!==undefined&&(model.addPropertiesListener([r],a),a())},getViewContainer:function(){return o}},u}}),n("common/controllers/radio-controller",[],function(){return function(t,n,r){var i,s,o,u=t.options||[],a=t.id,f,l,c,h;i=$("<div>").attr("id",a),i.addClass("component");for(c=0,h=u.length;c<h;c++)l=u[c],s=$("<input>").attr("type","radio").attr("name",a),l.disabled&&s.attr("disabled",l.disabled),l.selected&&s.attr("checked",l.selected),o=$("<span>").append(s).append(l.text),i.append(o).append("<br/>"),s.change(function(e){return function(){e.action?n.makeFunctionInScriptContext(e.action)():e.loadModel&&(model.stop(),r.loadModel(e.loadModel))}}(l));return f={getViewContainer:function(){return i}},f}}),n("common/controllers/slider-controller",[],function(){return function(t,n){var r=t.min,i=t.max,s=t.steps,o=t.action,u=t.property,a=t.initialValue,f=t.title||"",l=t.labels||[],c=t.displayValue,h,p,d,v,m,g,y,b,w,E=function(){var e=model.get(u);g.slider("value",e),c&&y.text(c(e))};r===undefined&&(r=0),i===undefined&&(i=10),s===undefined&&(s=10),v=$('<p class="title">'+f+"</p>"),b=$('<div class="container">'),g=$('<div class="html-slider">'),b.append(g),g.slider({min:r,max:i,step:(i-r)/s}),y=g.find(".ui-slider-handle"),d=$('<div class="interactive-slider">').append(v).append(b);for(h=0;h<l.length;h++)p=l[h],m=$('<p class="label">'+p.label+"</p>"),m.css("left",(p.value-r)/(i-r)*100+"%"),b.append(m);return o&&(o=n.makeFunctionInScriptContext("value",o),g.bind("slide",function(e,t){o(t.value),c&&y.text(c(t.value))})),u&&g.bind("slide",function(e,t){var n={};n[u]=t.value,model&&model.set(n),c&&y.text(c(t.value))}),c&&(c=n.makeFunctionInScriptContext("value",c)),w={modelLoadedCallback:function(){var e;u&&model.addPropertiesListener([u],E),a!==undefined&&a!==null?(o&&(g.slider("value",a),o(a),c&&y.text(c(a))),u&&(e={},e.propertyName=a,model.set(e))):u&&E()},getViewContainer:function(){return d}},w}}),n("common/controllers/pulldown-controller",[],function(){return function(t,n,r){var i,s,o=t.options||[],u,a,f,l;i=$("<select>").attr("id",t.id),i.addClass("component");for(f=0,l=o.length;f<l;f++)u=o[f],s=$("<option>").html(u.text),u.disabled&&s.attr("disabled",u.disabled),u.selected&&s.attr("selected",u.selected),i.append(s);return i.change(function(){var e=$(this).prop("selectedIndex"),i=t.options[e].action;i?n.makeFunctionInScriptContext(i)():t.options[e].loadModel&&(model.stop(),r.loadModel(t.options[e].loadModel))}),a={getViewContainer:function(){return i}},a}}),n("common/controllers/numeric-output-controller",[],function(){return function(t,n){var r=t.property,i=t.label,s=t.units,o=t.displayValue,u,a,f,l,c,h,p=function(){var e=model.get(r);o?f.text(o(e)):f.text(e)};return a=$('<span class="label"></span>'),f=$('<span class="value"></span>'),l=$('<span class="units"></span>'),i&&a.html(i),s&&l.html(s),u=$('<div class="numeric-output">').attr("id",t.id).append(a).append(f).append(l),o&&(o=n.makeFunctionInScriptContext("value",o)),h={modelLoadedCallback:function(){r&&(c=model.getPropertyDescription(r),c&&(i||a.html(c.label),s||l.html(c.units)),p(),model.addPropertiesListener([r],p))},getViewContainer:function(){return u}},h}}),n("common/parent-message-controller",[],function(){function r(e,t){try{window.parent.postMessage(e,t)}catch(n){window.parent.postMessage(JSON.stringify(e),t)}}function i(t){r(t,e)}function s(e){r(e,"*")}function o(e,n){t[e]=n}function u(){t={}}function a(){return Object.keys(t)}function f(){if(window.parent===window)return;s({type:"hello",origin:document.location.href.match(/(.*?\/\/.*?)\//)[1]}),window.addEventListener("message",function(n){if(n.source!==window.parent)return;var r=n.data;typeof r=="string"&&(r=JSON.parse(r)),e||r.type==="hello"&&(e=r.origin),n.origin===e&&t[r.type]&&t[r.type](r)},!1)}var e,t={},n;return n={initialize:f,getListenerNames:a,addListener:o,removeAllListeners:u,post:i}}),n("common/controllers/parent-message-api",["require","common/parent-message-controller"],function(e){var t=e("common/parent-message-controller");return function(e,n,r){function i(n){t.post({type:"propertyValue",name:n,value:e.get(n)})}t.removeAllListeners(),t.addListener("setFocus",function(e){n&&n.setFocus&&n.setFocus()}),t.addListener("loadInteractive",function(e){r&&r.loadInteractive&&r.loadInteractive(e.data)}),t.addListener("loadModel",function(e){r&&r.loadModel&&r.loadModel(e.data.modelId,e.data.modelObject)}),t.addListener("runBenchmarks",function(){var e;r&&r.getModelController&&(e=r.getModelController(),benchmark.bench(e.benchmarks,function(n){console.log(n),t.post({type:"returnBenchmarks",values:{results:n,benchmarks:e.benchmarks}},function(){},function(){})}))}),t.addListener("listenForDispatchEvent",function(n){var r=n.eventName,i=n.properties,s={},o=0,u=null;e.on(r,function(){if(i)for(o=0;o<i.length;o++)u=i[o],s[u]=e.get(u);t.post({type:r,values:s})})}),t.addListener("get",function(e){i(e.propertyName)}),t.addListener("observe",function(t){e.addPropertiesListener(t.propertyName,function(){i(t.propertyName)}),i(t.propertyName)}),t.addListener("set",function(t){var n={};n[t.propertyName]=t.propertyValue,e.set(n)}),t.addListener("tick",function(t){e.tick(t.numTimes)}),t.addListener("play",function(t){e.resume()}),t.initialize()}}),n("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};n("cs!common/components/thermometer",["require"],function(t){var n;return n=function(){function t(t,n,r,i){this.dom_selector=t!=null?t:"#thermometer",this.value=n,this.min=r,this.max=i,this.resize=e(this.resize,this),this.dom_element=typeof this.dom_selector=="string"?$(this.dom_selector):this.dom_selector,this.dom_element.addClass("thermometer"),this.thermometer_fill=$("<div>").addClass("thermometer_fill"),this.dom_element.append(this.thermometer_fill),this.redraw()}return t.prototype.add_value=function(e){return this.value=e,this.redraw()},t.prototype.scaled_value=function(){return(this.value-this.min)/(this.max-this.min)},t.prototype.resize=function(){return this.redraw()},t.prototype.redraw=function(){return this.thermometer_fill.height(""+this.scaled_value()*this.dom_element.height()+"px")},t}()})}.call(this),n("common/controllers/thermometer-controller",["require","cs!common/components/thermometer"],function(e){var t=e("cs!common/components/thermometer");return function(n){var r=$("<div>").attr("id",n.id),i=n.reading,s="K",o=0,u=1,a=0,f=!!n.labelIsReading,l=f?"":"Thermometer",c=$('<p class="label">').text(l).width("6em"),h=$('<div class="interactive-thermometer">').append(r).append(c),p=new t(r,null,n
.min,n.max),d,v=function(e){e=u*e+o,c.text(e.toFixed(a)+" "+s)},m=function(){var e=model.get("targetTemperature");p.add_value(e),f&&v(e)};return i&&(i.units!==undefined&&(s=i.units),i.offset!==undefined&&(o=i.offset),i.scale!==undefined&&(u=i.scale),i.digits!==undefined&&(a=i.digits)),d={modelLoadedCallback:function(){model.addPropertiesListener("targetTemperature",function(){m()}),p.resize(),m()},getViewContainer:function(){return h},getView:function(){return p}},d}}),n("common/layout/layout",["require"],function(e){var t={version:"0.0.1"};return t.selection="",t.display={},t.canonical={width:1280,height:800},t.regular_display=!1,t.not_rendered=!0,t.fontsize=!1,t.cancelFullScreen=!1,t.screen_factor=1,t.checkbox_factor=1.1,t.checkbox_scale=1.1,t.fullScreenRender=!1,t.canonical.width=1280,t.canonical.height=800,t.getDisplayProperties=function(e){return arguments.length||(e={}),e.screen={width:screen.width,height:screen.height},e.client={width:document.body.clientWidth,height:document.body.clientHeight},e.window={width:$(window).width(),height:$(window).height()},e.page={width:t.getPageWidth(),height:t.getPageHeight()},e.screen_factor_width=e.window.width/t.canonical.width,e.screen_factor_height=e.window.height/t.canonical.height,e.emsize=Math.max(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setBodyEmsize=function(e){var n,r=$("button.component"),i;t.display||(t.display=t.getDisplayProperties()),n=Math.max(t.display.screen_factor_width*1.2,t.display.screen_factor_height*1.2),e&&(n*=e),$("body").css("font-size",n+"em"),n<=.5?(i=.7/n,r.css("font-size",i+"em")):r.css("font-size","")},t.getVizProperties=function(e){var n=$("#viz");return arguments.length||(e={}),e.width=n.width(),e.height=n.height(),e.screen_factor_width=e.width/t.canonical.width,e.screen_factor_height=e.height/t.canonical.height,e.emsize=Math.min(e.screen_factor_width*1.1,e.screen_factor_height),e},t.setVizEmsize=function(){var e,n=$("#viz");t.vis||(t.vis=t.getVizProperties()),e=Math.min(t.viz.screen_factor_width*1.2,t.viz.screen_factor_height*1.2),n.css("font-size",e+"em")},t.screenEqualsPage=function(){return t.display.screen.width===t.display.page.width||t.display.screen.height===t.display.page.height},t.checkForResize=function(){(t.display.screen.width!==screen.width||t.display.screen.height!==screen.height||t.display.window.width!==document.width||t.display.window.height!==document.height)&&t.setupScreen()},t.views={},t.addView=function(e,n){t.views[e]||(t.views[e]=[]),t.views[e].push(n)},t.setView=function(e,n){t.views[e]=n},t.setupScreen=function(e){function s(){var e,t,i,s,o,u,a,f=.85,l=.0015,c={},h=$(window).width(),p=$(window).height(),d=$("#model-container").width(),i;s=r.moleculeContainers[0].scale(),o=s[2]/s[3],u=.85,modelWidthPaddingFactor=s[0]/s[2]-1.05,u-=modelWidthPaddingFactor,modelHeightPaddingFactor=s[1]/s[3]-1.05,f-=modelHeightPaddingFactor,r.thermometers&&(u-=.05),r.energyGraphs&&(u-=.35),n<=.5&&(l*=.5/n),r.bottomItems=$("#bottom").children().length,r.bottomItems&&(f-=$("#bottom").height()*l),t=h*u,i=t/o,i>p*f&&(i=p*f,t=i*o),c.moleculeContainers=[t,i],r.energyGraphs&&(c.energyGraphs=[h*.4]),r.moleculeContainers[0].resize(t,i),i=$("#model-container").height(),$("#rightwide").height(i),r.barGraphs&&(c.barGraphs=[35+i*.22]);for(viewType in r){if(viewType==="moleculeContainers")continue;if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)c[viewType]?r[viewType][e].resize(c[viewType][0],c[viewType][1]):r[viewType][e].resize()}}}function o(){var e,t,i,s,o,u,a,f=.85,l=.0015,c={},h=$("#content").width(),p=$("#content").height(),i;s=r.moleculeContainers[0].scale(),o=s[2]/s[3],u=.85,modelWidthPaddingFactor=s[0]/s[2]-1.05,u-=modelWidthPaddingFactor,modelHeightPaddingFactor=s[1]/s[3]-1.05,f-=modelHeightPaddingFactor,r.thermometers&&(u-=.05),r.barGraphs&&(u-=.15),r.energyGraphs&&(u-=.35),n<=.5&&(l*=.5/n),r.bottomItems=$("#bottom").children().length,r.bottomItems&&(f-=$("#bottom").height()*l),t=h*u,i=t/o,i>p*f&&(i=p*f,t=i*o),c.moleculeContainers=[t,i],r.energyGraphs&&(c.energyGraphs=[h*.4]),r.moleculeContainers[0].resize(t,i),i=$("#model-container").height(),$("#rightwide").height(i),r.barGraphs&&(c.barGraphs=[35+i*.22]);for(viewType in r){if(viewType==="moleculeContainers")continue;if(r.hasOwnProperty(viewType)&&r[viewType].length){e=-1;while(++e<r[viewType].length)c[viewType]?r[viewType][e].resize(c[viewType][0],c[viewType][1]):r[viewType][e].resize()}}}function u(){var e,n,i,s,o,u=t.display.page.width,a=t.display.page.height;s=r.moleculeContainers[0].scale(),o=s[0]/s[1],n=u*.4,i=n*1/o,e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);if(r.appletContainers){e=-1;while(++e<r.appletContainers.length)r.appletContainers[e].resize(n,i)}}function a(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.46,i=n*1/l,i>h*.7&&(i=h*.7,n=i*l),e=-1;while(++e<r.moleculeContainers.length)r.moleculeContainers[e].resize(n,i);a=(c-n)*.41,o=i*.42,e=-1;while(++e<r.potentialCharts.length)r.potentialCharts[e].resize(a,o);e=-1;while(++e<r.speedDistributionCharts.length)r.speedDistributionCharts[e].resize(a,o);u=(c-n)*.86,o=i*.57,e=-1;while(++e<r.energyCharts.length)r.energyCharts[e].resize(u,o)}function f(){var e,n,i,s,o,u,a,f,l,c=t.display.page.width,h=t.display.page.height;s=r.moleculeContainers[0].scale(),l=s[0]/s[1],f=s[0]/c,n=c*.6,i=n*1/l,i>h*.6&&(i=h*.6,n=i*l),r.moleculeContainers[0].resize(n,i)}var n,r=t.views,i=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;e&&e.forceRender&&(t.not_rendered=!0),t.display=t.getDisplayProperties(),t.viz=t.getVizProperties(),t.regular_display||(t.regular_display=t.getDisplayProperties());if(i||t.fullScreenRender||t.screenEqualsPage()){t.fullScreenRender=!0,t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor),$("body").css("font-size",t.screen_factor+"em"),t.not_rendered=!0;switch(t.selection){case"simple-screen":t.not_rendered&&f();break;case"simple-static-screen":t.not_rendered&&f();break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),u(),t.not_rendered=!1;break;default:t.not_rendered&&a()}}else{t.cancelFullScreen||t.fullScreenRender?(t.cancelFullScreen=!1,t.fullScreenRender=!1,t.not_rendered=!0,t.regular_display=t.previous_display):t.regular_display=t.getDisplayProperties(),t.screen_factor_width=t.display.page.width/t.canonical.width,t.screen_factor_height=t.display.page.height/t.canonical.height,t.screen_factor=t.screen_factor_height,t.checkbox_factor=Math.max(.8,t.checkbox_scale*t.screen_factor);switch(t.selection){case"full-static-screen":t.not_rendered&&(n=Math.min(t.screen_factor_width*1.5,t.screen_factor_height),$("body").css("font-size",n+"em"),regularScreen(),t.not_rendered=!1);break;case"compare-screen":n=Math.min(t.screen_factor_width*1.1,t.screen_factor_height),$("body").css("font-size",n+"em"),u();break;case"interactive":t.not_rendered&&(t.setVizEmsize(),setupInteractiveScreen(),t.not_rendered=!1);break;case"interactive-iframe":t.setBodyEmsize(),s();break;case"interactive-author-iframe":t.setBodyEmsize(.7),o();break;default:t.setVizEmsize(),setupRegularScreen()}t.regular_display=t.getDisplayProperties()}},t.getPageHeight=function(){return $(document).height()},t.getPageWidth=function(){return $(document).width()},t}),n("common/layout/interactive-layout",["require","common/layout/layout"],function(e){function n(e,t){var n=$(".interactive-thermometer p.label").outerHeight(!0);$(".interactive-thermometer").height(t),t=$(".interactive-thermometer").height(),$(".interactive-thermometer .thermometer").height(t-n),e.redraw()}var t=e("common/layout/layout");return function(){var r,i,s,o,u,a,f,l,c={},h,p=$("#content").width();l=t.views,i=$(l.moleculeContainers[0].outerNode).width(),s=$(l.moleculeContainers[0].outerNode).height(),a=i/s,f=.6,l.energyGraphs&&(f=.5),o=p*f,u=o/a,c.moleculeContainers=[o,u],l.energyGraphs&&(c.energyGraphs=[p*.45,u]),l.barGraphs&&(c.barGraphs=[35+u*.22,u]);for(h in l)if(l.hasOwnProperty(h)&&l[h].length){r=-1;while(++r<l[h].length)c[h]?l[h][r].resize(c[h][0],c[h][1]):l[h][r].resize()}s=$(l.moleculeContainers[0].outerNode).height(),t.views.thermometers&&n(t.views.thermometers[0],.8*s),l.energyGraphs&&$(l.moleculeContainers[0].outerNode).css("top",5)}}),n("arrays/index",["require","exports","module"],function(e,t,n){var r={};r.version="0.0.1",r.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,r.typed=function(){try{return new Float64Array(0),!0}catch(e){return!1}}(),r.create=function(e,t,n){n||(r.webgl||r.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var i,s;if(n==="regular")i=new Array(e);else switch(n){case"Float64Array":i=new Float64Array(e);break;case"Float32Array":i=new Float32Array(e);break;case"Int32Array":i=new Int32Array(e);break;case"Int16Array":i=new Int16Array(e);break;case"Int8Array":i=new Int8Array(e);break;case"Uint32Array":i=new Uint32Array(e);break;case"Uint16Array":i=new Uint16Array(e);break;case"Uint8Array":i=new Uint8Array(e);break;case"Uint8ClampedArray":i=new Uint8ClampedArray(e);break;default:throw new Error("arrays: couldn't understand array type \""+n+'".')}s=-1;while(++s<e)i[s]=t;return i},r.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor&&Object.prototype.toString.call(e)==="[object Array]")return e.__proto__.constructor;switch(e.constructor){case Array:return Array;case Float32Array:return Float32Array;case Uint8Array:return Uint8Array;case Float64Array:return Float64Array;case Int32Array:return Int32Array;case Int16Array:return Int16Array;case Int8Array:return Int8Array;case Uint32Array:return Uint32Array;case Uint16Array:return Uint16Array;case Uint8ClampedArray:return Uint8ClampedArray;default:throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e)}},r.copy=function(e,t){var n=e.length,i=-1;while(++i<n)t[i]=e[i];return r.constructor_function(t)===Array&&(t.length=n),t},r.clone=function(e){var t,n=e.length,i,s;s=r.constructor_function(e);if(s===Array){i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i}if(e.buffer.slice)return i=new s(e.buffer.slice(0)),i;i=new s(n);for(t=0;t<n;t++)i[t]=e[t];return i},r.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},r.max=function(e){return Math.max.apply(Math,e)},r.min=function(e){return Math.min.apply(Math,e)},r.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},r.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},r.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},r.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},r.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r},r.extend=function(e,t){var n,i,s;i=r.constructor_function(e);if(i===Array){s=e.length,e.length=t;for(;s<t;s++)e[s]=0;return e}return n=new i(t),n.set(e.subarray(0,t)),n},r.remove=function(e,t){var n=r.constructor_function(e),i;if(n!==Array)throw new Error("arrays.remove for typed arrays not implemented yet.");return i=e.slice(t+1),e.length=t,Array.prototype.push.apply(e,i),e},r.isArray=function(e){try{return r.constructor_function(e),!0}catch(t){return!1}};for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}),n("arrays",["arrays/index"],function(e){return e}),n("common/array-types",["require","arrays"],function(e){var t=e("arrays"),n=function(){if(typeof navigator=="undefined")return!0;var e=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,t=navigator.userAgent.match(e);return!t||!t[3]}(),r=t.typed&&n;return{"float":r?"Float32Array":"regular",int16:r?"Int16Array":"regular",int8:r?"Int8Array":"regular",uint16:r?"Uint16Array":"regular",uint8:r?"Uint8Array":"regular"}}),n("md2d/models/engine/constants/units",["require","exports","module"],function(e,t,n){var r=1.66054e-27,i=1.602177e-19,s=i,o=1e-15,u=1e-9,a=10,f=1e3,l={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},c,h,p;t.unit=c={FEMTOSECOND:{name:"femtosecond",value:1,type:l.TIME},SECOND:{name:"second",value:o,type:l.TIME},NANOMETER:{name:"nanometer",value:1,type:l.LENGTH},ANGSTROM:{name:"Angstrom",value:1*a,type:l.LENGTH},METER:{name:"meter",value:1*u,type:l.LENGTH},DALTON:{name:"Dalton",value:1,type:l.MASS},GRAM:{name:"gram",value:1*r*f,type:l.MASS},KILOGRAM:{name:"kilogram",value:1*r,type:l.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:l.ENERGY},JOULE:{name:"Joule",value:r*u*u*(1/o)*(1/o),type:l.ENERGY},EV:{name:"electron volt",value:r*u*u*(1/o)*(1/o)*(1/s),type:l.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:l.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*s,type:l.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:l.CHARGE},COULOMB:{name:"Coulomb",value:i,type:l.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:l.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:l.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:l.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:l.FORCE},NEWTON:{name:"Newton",value:1*r*u*(1/o)*(1/o),type:l.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*r*u*u*(1/o)*(1/o)*(1/s),type:l.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:l.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*u*(1/o),type:l.VELOCITY}},t.ratio=h=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},t.convert=p=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*h(r,{per:n})}}),n("md2d/models/engine/constants/index",["require","exports","module","./units"],function(e,t,n){var r=e("./units"),i=r.unit,s=r.ratio,o=r.convert,u={ELEMENTARY_CHARGE:{value:1,unit:i.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:i.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:i.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:s(i.DALTON,{per:i.GRAM}),unit:i.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:i.FARADS_PER_METER}},a,f;u.COULOMB_CONSTANT={value:1/(4*Math.PI*u.PERMITTIVITY_OF_FREE_SPACE.value),unit:i.METERS_PER_FARAD},t.unit=i,t.ratio=s,t.convert=o;for(a in u)u.hasOwnProperty(a)&&(f=u[a],t[a]=function(e){return{as:function(t){return r.convert(e.value,{from:e.unit,to:t})}}}(f))}),n("md2d/models/aminoacids-props",[],function(){return[{fullName:"Alanine",abbreviation:"Ala",symbol:"A",molWeight:89.09,charge:0,hydrophobicityRB:2.15,pK:0,surface:115,volume:88.6,solubility:16.65,hydrophobicity:1,property:"Total aliphatic; hydrophobic"},{fullName:"Arginine",abbreviation:"Arg",symbol:"R",molWeight:174.2,charge:1,hydrophobicityRB:2.23,pK:12,surface:225,volume:173.4,solubility:15,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Asparagine",abbreviation:"Asn",symbol:"N",molWeight:132.12,charge:0,hydrophobicityRB:1.05,pK:0,surface:160,volume:114.1,solubility:3.53,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Asparticacid",abbreviation:"Asp",symbol:"D",molWeight:133.1,charge:-1,hydrophobicityRB:1.13,pK:4.4,surface:150,volume:111.1,solubility:.778,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Cysteine",abbreviation:"Cys",symbol:"C",molWeight:121.15,charge:0,hydrophobicityRB:1.2,pK:8.5,surface:135,volume:108.5,solubility:1e3,hydrophobicity:1,property:"Polar side chains; semipolar"},{fullName:"Glutamine",abbreviation:"Gln",symbol:"Q",molWeight:146.15,charge:0,hydrophobicityRB:1.65,pK:0,surface:180,volume:143.8,solubility:2.5,hydrophobicity:-1,property:"Strongly polar"},{fullName:"Glutamicacid",abbreviation:"Glu",symbol:"E",molWeight:147.13,charge:-1,hydrophobicityRB:1.73,pK:4.4,surface:190,volume:138.4,solubility:.864,hydrophobicity:-2,property:"Acidic side chains; strongly polar; anionic"},{fullName:"Glycine",abbreviation:"Gly",symbol:"G",molWeight:75.07,charge:0,hydrophobicityRB:1.18,pK:0,surface:75,volume:60.1,solubility:24.99,hydrophobicity:1,property:"Semipolar"},{fullName:"Histidine",abbreviation:"His",symbol:"H",molWeight:155.16,charge:1,hydrophobicityRB:2.45,pK:6.5,surface:195,volume:153.2,solubility:4.19,hydrophobicity:-2,property:"Basic side chains; strongly polar; cationic"},{fullName:"Isoleucine",abbreviation:"Ile",symbol:"I",molWeight:131.17,charge:0,hydrophobicityRB:3.88,pK:0,surface:175,volume:166.7,solubility:4.117,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Leucine",abbreviation:"Leu",symbol:"L",molWeight:131.17,charge:0,hydrophobicityRB:4.1,pK:10,surface:170,volume:166.7,solubility:2.426,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"},{fullName:"Lysine",abbreviation:"Lys",symbol:"K",molWeight:146.19,charge:1,hydrophobicityRB:3.05,pK:0,surface:200,volume:168.6,solubility:1e3,hydrophobicity:-2,property:"Acidic side chains; strongly polar; cationic"},{fullName:"Methionine",abbreviation:"Met",symbol:"M",molWeight:149.21,charge:0,hydrophobicityRB:3.43,pK:0,surface:185,volume:162.9,solubility:3.81,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Phenylalanine",abbreviation:"Phe",symbol:"F",molWeight:165.19,charge:0,hydrophobicityRB:3.46,pK:0,surface:210,volume:189.9,solubility:2.965,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Proline",abbreviation:"Pro",symbol:"P",molWeight:115.13,charge:0,hydrophobicityRB:3.1,pK:0,surface:145,volume:112.7,solubility:162.3,hydrophobicity:1,property:"Totally alyphatic"},{fullName:"Serine",abbreviation:"Ser",symbol:"S",molWeight:105.09,charge:0,hydrophobicityRB:1.4,pK:0,surface:115,volume:89,solubility:5.023,hydrophobicity:-1,property:"Semipolar"},{fullName:"Threonine",abbreviation:"Thr",symbol:"T",molWeight:119.12,charge:0,hydrophobicityRB:2.25,pK:0,surface:140,volume:116.1,solubility:1e3,hydrophobicity:-1,property:"Semipolar"},{fullName:"Tryptophan",abbreviation:"Trp",symbol:"W",molWeight:204.23,charge:0,hydrophobicityRB:4.11,pK:0,surface:255,volume:227.8,solubility:1.136,hydrophobicity:2,property:"Totally aromatic"},{fullName:"Tyrosine",abbreviation:"Tyr",symbol:"Y",molWeight:181.19,charge:0,hydrophobicityRB:2.81,pK:10,surface:230,volume:193.6,solubility:.045,hydrophobicity:1,property:"Hydrophobic; total aromatic"},{fullName:"Valine",abbreviation:"Val",symbol:"V",molWeight:117.15,charge:0,hydrophobicityRB:3.38,pK:0,surface:155,volume:140,solubility:8.85,hydrophobicity:1,property:"Branched chain aliphatic; hydrophobic"}]}),function(){n("cs!md2d/models/aminoacids-helper",["require","md2d/models/aminoacids-props"],function(e){var t,n,r;return r=e("md2d/models/aminoacids-props"),t=5,n={UUU:"Phe",UUC:"Phe",UUA:"Leu",UUG:"Leu",CUU:"Leu",CUC:"Leu",CUA:"Leu",CUG:"Leu",AUU:"Ile",AUC:"Ile",AUA:"Ile",AUG:"Met",GUU:"Val",GUC:"Val",GUA:"Val",GUG:"Val",UCU:"Ser",UCC:"Ser",UCA:"Ser",UCG:"Ser",AGU:"Ser",AGC:"Ser",CCU:"Pro",CCC:"Pro",CCA:"Pro",CCG:"Pro",ACU:"Thr",ACC:"Thr",ACA:"Thr",ACG:"Thr",GCU:"Ala",GCC:"Ala",GCA:"Ala",GCG:"Ala",UAU:"Tyr",UAC:"Tyr",CAU:"His",CAC:"His",CAA:"Gln",CAG:"Gln",AAU:"Asn",AAC:"Asn",AAA:"Lys",AAG:"Lys",GAU:"Asp",GAC:"Asp",GAA:"Glu",GAG:"Glu",UGU:"Cys",UGC:"Cys",UGG:"Trp",CGU:"Arg",CGC:"Arg",CGA:"Arg",CGG:"Arg",AGA:"Arg",AGG:"Arg",GGU:"Gly",GGC:"Gly",GGA:"Gly",GGG:"Gly",UAA:"STOP",UAG:"STOP",UGA:"STOP"},{firstElementID:t,lastElementID:t+r.length-1,cysteineElement:9,abbrToElement:function(e){var t,n,i,s;for(n=i=0,s=r.length;i<s;n=++i){t=r[n];if(t.abbreviation===e)return n+this.firstElementID}},getAminoAcidByElement:function(e){return r[e-this.firstElementID]},isAminoAcid:function(e){return e>=this.firstElementID&&e<=this.lastElementID},getPolarAminoAcids:function(){var e,t,n,r,i;r=["Asn","Gln","Ser","Thr"],i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(this.abbrToElement(e));return i},codonToAbbr:function(e){return n[e]}}})}.call(this),n("md2d/models/engine/math/distributions",["require","exports","module"],function(e,t,n){t.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),n("md2d/models/engine/math/utils",["require","exports","module"],function(e,t,n){t.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(s){return r-=n[t]||0,r+=s,n[t]=s,++t===e&&(t=0),n.length===e?r/e:NaN}}}),n("md2d/models/engine/math/minimizer",["require","exports","module","common/console"],function(e,t,n){var r=e("common/console");t.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var i=n.precision,s=n.bounds,o=n.maxiter||1e3,u=n.stopval||-Infinity,a=n.maxstep||.01,f=n.eps||.01,l=t.length,c,h,p,d,v,m,g,y,b,w;m=a*a,c=[];for(b=0;b<l;b++)c[b]=t[b];h=e.apply(null,c),p=h[0],v=h[1],y=0;do{if(p<=u)break;if(y>o)return r.log("maxiter reached"),{error:"maxiter reached",f:p,iter:o,x:c};g=0;for(b=0;b<l;b++)g+=v[b]*v[b];if(f*f*g>m){w=Math.sqrt(m/g)/f;for(b=0;b<l;b++)v[b]=w*v[b]}for(b=0;b<l;b++)c[b]-=f*v[b],s&&c[b]<s[b][0]&&(c[b]=s[b][0]),s&&c[b]>s[b][1]&&(c[b]=s[b][1]);d=p,h=e.apply(null,c),p=h[0],v=h[1],y++}while(Math.abs(p-d)>i);return[p,c]}}),n("md2d/models/engine/math/index",["require","exports","module","./distributions","./utils","./minimizer"],function(e,t,n){t.normal=e("./distributions").normal,t.getWindowedAverager=e("./utils").getWindowedAverager,t.minimize=e("./minimizer").minimize}),n("md2d/models/engine/potentials/coulomb",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=.346,o=r.COULOMB_CONSTANT.as(r.unit.METERS_PER_FARAD),u=r.ratio(i.NANOMETER,{per:i.METER}),a=Math.pow(r.ratio(i.COULOMB,{per:i.ELEMENTARY_CHARGE}),2),f=r.ratio(i.EV,{per:i.JOULE}),l=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON}),c=s*o*a*u*f,h=s*o*a*u*u*l,p=t.potential=function(e,t,n,r,i){return i&&r>1&&e<1.2&&(r=1+(r-1)/(1+Math.exp(-12*e+7))),c*(t*n/e)/r},d=t.forceFromSquaredDistance=function(e,t,n,r,i){var s=Math.sqrt(e);return i&&r>1&&s<1.2&&(r=1+(r-1)/(1+Math.exp(-12*s+7))),-h*(t*n/e)/r},v=t.forceOverDistanceFromSquaredDistance=function(e,t,n,r,i){return d(e,t,n,r,i)/Math.sqrt(e)},m=t.force=function(e,t,n,r,i){return d(e*e,t,n,r,i)}}),n("md2d/models/engine/potentials/lennard-jones",["require","exports","module","../constants/index"],function(e,t,n){var r=e("../constants/index"),i=r.unit,s=r.ratio(i.NANOMETER,{per:i.METER}),o=r.ratio(i.MW_FORCE_UNIT,{per:i.NEWTON});t.pairwiseEpsilon=function(e,t){return.5*(e+t)},t.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},t.rmin=function(e){return Math.pow(2,1/6)*e},t.radius=function(e){return.5*e},t.newLJCalculator=function(e,n){var u,a,f,l,c,h,p,d=!1,v=function(e,v){u=e,a=v,f=t.rmin(a),u!=null&&a!=null&&(l=4*u*Math.pow(a,12),c=4*u*Math.pow(a,6),h=12*r.convert(l,{from:i.EV,to:i.JOULE})*s*o,p=6*r.convert(c,{from:i.EV,to:i.JOULE})*s*o),d&&typeof n=="function"&&n(m(),this)},m=function(){return{epsilon:u,sigma:a,rmin:f}},g=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},y=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},b;return g(e.epsilon),y(e.sigma),v(e.epsilon,e.sigma),d=!0,b={getCoefficients:m,setEpsilon:function(e){g(e),v(e,a)},setSigma:function(e){y(e),v(u,e)},potentialFromSquaredDistance:function(e){return e?l*Math.pow(e,-6)-c*Math.pow(e,-3):-Infinity},potential:function(e){return b.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*b.forceOverDistanceFromSquaredDistance(e*e)}}}}),n("md2d/models/engine/potentials/index",["require","exports","module","./coulomb","./lennard-jones"],function(e,t,n){t.coulomb=e("./coulomb"),t.lennardJones=e("./lennard-jones")}),n("md2d/models/metadata",[],function(){return{mainProperties:{type:{defaultValue:"md2d",immutable:!0},width:{defaultValue:10,immutable:!0},height:{defaultValue:10,immutable:!0},lennardJonesForces:{defaultValue:!0},coulombForces:{defaultValue:!0},temperatureControl:{defaultValue:!1},targetTemperature:{defaultValue:300},modelSampleRate:{defaultValue:"default"},gravitationalField:{defaultValue:!1},timeStep:{defaultValue:1},dielectricConstant:{defaultValue:1},realisticDielectricEffect:{defaultValue:!0},solventForceFactor:{defaultValue:1.25},solventForceType:{defaultValue:0},additionalSolventForceMult:{defaultValue:4},additionalSolventForceThreshold:{defaultValue:10},polarAAEpsilon:{defaultValue:-2},viscosity:{defaultValue:1},viewRefreshInterval:{defaultValue:50}},modelViewProperties:{backgroundColor:{defaultValue:"#eeeeee"},showClock:{defaultValue:!0},keShading:{defaultValue:!1},chargeShading:{defaultValue:!1},useThreeLetterCode:{defaultValue:!0},aminoAcidColorScheme:{defaultValue:"hydrophobicity"},showChargeSymbols:{defaultValue:!0},showVDWLines:{defaultValue:!1},VDWLinesCutoff:{defaultValue:"medium"},showVelocityVectors:{defaultValue:!1},showForceVectors:{defaultValue:!1},showAtomTrace:{defaultValue:!1},atomTraceId:{defaultValue:0},images:{},textBoxes:{}},atom:{x:{required:!0},y:{required:!0},element:{defaultValue:0},vx:{defaultValue:0},vy:{defaultValue:0},ax:{defaultValue:0,serialize:!1},ay:{defaultValue:0,serialize:!1},charge:{defaultValue:0},friction:{defaultValue:0},visible:{defaultValue:1},pinned:{defaultValue:0},marked:{defaultValue:0},draggable:{defaultValue:0},radius:{readOnly:!0,serialize:!1},px:{readOnly:!0,serialize:!1},py:{readOnly:!0,serialize:!1},speed:{readOnly:!0,serialize:!1}},element:{id:{defaultValue:0,immutable:!0},mass:{defaultValue:120},sigma:{defaultValue:.3},epsilon:{defaultValue:-0.1},radius:{readOnly:!0}},pairwiseLJProperties:{element1:{defaultValue:0},element2:{defaultValue:0},sigma:{},epsilon:{}},obstacle:{width:{required:!0},height:{required:!0},x:{defaultValue:0},y:{defaultValue:0},mass:{defaultValue:Infinity},vx:{defaultValue:0},vy:{defaultValue:0},externalFx:{defaultValue:0},externalFy:{defaultValue:0},friction:{defaultValue:0},westProbe:{defaultValue:!1},westProbeValue:{readOnly:!0},northProbe:{defaultValue:!1},northProbeValue:{readOnly:!0},eastProbe:{defaultValue:!1},eastProbeValue:{readOnly:!0},southProbe:{defaultValue:!1},southProbeValue:{readOnly:!0},colorR:{defaultValue:128},colorG:{defaultValue:128},colorB:{defaultValue:128},visible:{defaultValue:!0}},radialBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},length:{required:!0},strength:{required:!0},type:{defaultValue:101}},angularBond:{atom1:{defaultValue:0},atom2:{defaultValue:0},atom3:{defaultValue:0},strength:{required:!0},angle:{required:!0}},restraint:{atomIndex:{required:!0},k:{defaultValue:2e3},x0:{defaultValue:0},y0:{defaultValue:0}},geneticProperties:{DNA:{defaultValue:""},x:{defaultValue:.01},y:{defaultValue:.01},height:{defaultValue:.12},DNAComplement:{readOnly:!0},mRNA:{readOnly:!0}},textBox:{text:{defaultValue:""},x:{defaultValue:0},y:{defaultValue:0},layer:{defaultValue:1},width:{},frame:{},color:{},backgroundColor:{},hostType:{},hostIndex:{},textAlign:{}}}}),n("common/validator",[],function(){function e(e,t){this.prop=e,this.message=t}e.prototype=new Error,e.prototype.constructor=e;var t=function(e,t){var n={},r;for(r in t)t.hasOwnProperty(r)&&(e[r]===undefined||e[r]===null?n[r]=t[r]:n[r]=e[r]);return n};return{validate:function(t,n,r){var i={},s,o;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(s in n)if(n.hasOwnProperty(s)){o=t[s];if(o!==undefined){if(o.readOnly===!0)throw new e(s,"Properties set tries to overwrite read-only property "+s);if(!r&&o.immutable===!0)throw new e(s,"Properties set tries to overwrite immutable property "+s);i[s]=n[s]}}return i},validateCompleteness:function(n,r){var i={},s,o;if(arguments.length<2)throw new Error("Incorrect usage. Provide metadata and hash which should be validated.");for(s in n)if(n.hasOwnProperty(s)){o=n[s];if(r[s]===undefined||r[s]===null){if(o.required===!0)throw new e(s,"Properties set is missing required property "+s);typeof o.defaultValue=="object"?i[s]=t({},o.defaultValue):o.defaultValue!==undefined&&(i[s]=o.defaultValue)}else typeof r[s]=="object"&&typeof o.defaultValue=="object"?i[s]=t(r[s],o.defaultValue):i[s]=r[s]}return this.validate(n,i,!0)},ValidationError:e}}),function(){var e={}.hasOwnProperty;n("cs!md2d/models/engine/pairwise-lj-properties",["require","md2d/models/metadata","common/validator"],function(t){var n,r,i;return r=t("md2d/models/metadata"),i=t("common/validator"),n=function(){function t(e){this._engine=e,this._data={}}return t.prototype.registerChangeHooks=function(e,t){return this._changePreHook=e,this._changePostHook=t},t.prototype.set=function(t,n,s){var o;s=i.validate(r.pairwiseLJProperties,s),this._changePreHook(),this._data[t]==null&&(this._data[t]={}),this._data[n]==null&&(this._data[n]={}),this._data[t][n]==null&&(this._data[t][n]=this._data[n][t]={});for(o in s){if(!e.call(s,o))continue;this._data[t][n][o]=s[o]}return this._engine.setPairwiseLJProperties(t,n),this._changePostHook()},t.prototype.remove=function(e,t){return this._changePreHook(),delete this._data[e][t],delete this._data[t][e],this._engine.setPairwiseLJProperties(e,t),this._changePostHook()},t.prototype.get=function(e,t){return this._data[e]&&this._data[e][t]?this._data[e][t]:void 0},t.prototype.deserialize=function(e){var t,n,s,o,u;for(o=0,u=e.length;o<u;o++)s=e[o],s=i.validateCompleteness(r.pairwiseLJProperties,s),t=s.element1,n=s.element2,delete s.element1,delete s.element2,this.set(t,n,s)},t.prototype.clone=function(){return $.extend(!0,{},this._data)},t.prototype.restore=function(t){var n,r,i,s;this._data=t,s=this._data;for(r in s){if(!e.call(s,r))continue;n=s[r];for(i in n){if(!e.call(n,i))continue;r<i&&this._engine.setPairwiseLJProperties(r,i)}}},t}()})}.call(this),n("md2d/models/engine/genetic-properties",["require","common/validator","md2d/models/metadata","cs!md2d/models/aminoacids-helper"],function(e){var t=e("common/validator"),n=e("md2d/models/metadata"),r=e("cs!md2d/models/aminoacids-helper"),i=t.ValidationError;return function(){var s,o,u,a,f=d3.dispatch("change"),l=function(){var e=a.DNA.replace(/A/g,"t").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g");a.DNAComplement=e.toUpperCase()},c=function(e){if(e.DNA){e.DNA=e.DNA.toUpperCase();if(e.DNA.search(/[^AGTC]/)!==-1)throw new i("DNA","DNA code on sense strand can be defined using only A, G, T or C characters.")}return e},h=function(e){o(),e=t.validateCompleteness(n.geneticProperties,e),e=c(e),a=e,l(),u(),f.change()},p=function(e){var r;o(),e=t.validate(n.geneticProperties,e),e=c(e);for(r in e)e.hasOwnProperty(r)&&(a[r]=e[r]);e.DNA&&(l(),delete a.mRNA),u(),f.change()};return s={registerChangeHooks:function(e,t){o=e,u=t},set:function(e){a===undefined?h(e):p(e)},get:function(){return a},deserialize:function(e){h(e)},validate:function(e){var r={valid:!0};try{e=t.validate(n.geneticProperties,e),c(e)}catch(i){r.valid=!1,r.errors={},r.errors[i.prop]=i.message}return r},on:function(e,t){f.on(e,t)},transcribeDNA:function(){o();var e=a.DNAComplement.replace(/A/g,"u").replace(/G/g,"c").replace(/T/g,"a").replace(/C/g,"g");a.mRNA=e.toUpperCase(),u(),f.change()},translate:function(){var e=[],t,n,i,o;a.mRNA===undefined&&s.transcribeDNA(),t=a.mRNA;for(i=0,o=t.length;i+3<=o;i+=3){n=r.codonToAbbr(t.substr(i,3));if(n==="STOP"||n===undefined)return e;e.push(n)}return e}},s}}),n("md2d/models/engine/clone-restore-wrapper",["require","arrays"],function(e){var t=e("arrays");return function(n){return{clone:function(){var e={},r;for(r in n)n.hasOwnProperty(r)&&(e[r]=t.clone(n[r]));return e},restore:function(e){var r;for(r in n)n.hasOwnProperty
(r)&&t.copy(e[r],n[r])}}}}),n("md2d/models/engine/cell-list",[],function(){return function(t,n,r){var i,s,o,u,a,f=function(){var e;s=Math.ceil(t/r),o=Math.ceil(n/r),u=s*o,a=new Array(u);for(e=0;e<u;e++)a[e]=[]};return f(),i={reinitialize:function(e){e!==r&&(r=e,f())},addToCell:function(e,t,n){var i=Math.floor(n/r)*s+Math.floor(t/r);a[i].push(e)},getCell:function(e){return a[e]},getRowsNum:function(){return o},getColsNum:function(){return s},getNeighboringCells:function(e,t){var n=e*s+t,r=[];return t+1<s&&e+1<o&&r.push(a[n+s+1]),t+1<s&&r.push(a[n+1]),t+1<s&&e-1>=0&&r.push(a[n-s+1]),e-1>=0&&r.push(a[n-s]),r},clear:function(){var e;for(e=0;e<u;e++)a[e].length=0}},i}}),n("md2d/models/engine/neighbor-list",["require","arrays","common/array-types"],function(e){var t=e("arrays"),n=e("common/array-types");return function(r,i){var s,o,u,a,f,l,c,h,p,d,v=function(){o=r+10,u=0,a=o*(o-1)/2,d=!0,f=t.create(a,0,n.int16),l=t.create(o,-1,n.int16),c=t.create(o,-1,n.int16),h=t.create(o,Infinity,n.float),p=t.create(o,Infinity,n.float)};return v(),s={reinitialize:function(e,t){r=e,i=t,d=!0,r>o&&v()},clear:function(){var e;u=0;for(e=0;e<r;e++)l[e]=c[e]=-1},getList:function(){return f},markNeighbors:function(e,t){l[e]<0&&(l[e]=u),f[u]=t,u++,c[e]=u},getStartIdxFor:function(e){return l[e]},getEndIdxFor:function(e){return c[e]},saveAtomPosition:function(e,t,n){h[e]=t,p[e]=n},invalidate:function(){d=!0},shouldUpdate:function(e,t){var n=-Infinity,s=-Infinity,o;if(d)return d=!1,!0;for(o=0;o<r;o++)Math.abs(e[o]-h[o])>n&&(n=Math.abs(e[o]-h[o])),Math.abs(t[o]-p[o])>s&&(s=Math.abs(t[o]-p[o]));return Math.sqrt(n*n+s*s)>i}},s}}),n("md2d/models/engine/md2d",["require","exports","module","arrays","common/array-types","common/console","./constants/index","cs!md2d/models/aminoacids-helper","./math/index","./potentials/index","./potentials/index","cs!./pairwise-lj-properties","./genetic-properties","./clone-restore-wrapper","./cell-list","./neighbor-list"],function(e,t,n){var r=e("arrays"),i=e("common/array-types"),s=e("common/console"),o=e("./constants/index"),u=o.unit,a=e("cs!md2d/models/aminoacids-helper"),f=e("./math/index"),l=e("./potentials/index").coulomb,c=e("./potentials/index").lennardJones,h=e("cs!./pairwise-lj-properties"),p=e("./genetic-properties"),d=e("./clone-restore-wrapper"),v=e("./cell-list"),m=e("./neighbor-list"),g=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),y=.34,b=39.95,w=o.convert(b,{from:u.DALTON,to:u.KILOGRAM}),E=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),S=function(e,t,n,r){return e*r-t*n},x=function(e,t){return e*e+t*t},T=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/E},N=function(e,t){var n=2*t,r=e*E,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},C=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")};t.createEngine=function(){var e,t=!1,n=!1,g=1,y=!0,b=0,w=1,E=25,N=3,k=!0,L=!1,A=1.67,O=!1,M=!1,_,D=.001,P=[10,10],H,B=0,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt=0,it,st,ot,ut,at,ft=0,lt=[],ct,ht,pt,dt,vt,mt,gt,yt,bt,wt=0,Et,St,xt,Tt,Nt,Ct=0,kt,Lt,At,Ot,Mt,_t,Dt=0,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on=0,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn=0,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn=2,_n=[],Dn=2.5,Pn=[],Hn=[],Bn=!1,jn=[],Fn=[],In=function(){Kn(0),Qn(0),Zn(0),Gn(0),Yn(0),er(0),tr(0),nr(0),ct=new h(e),un=new p,bt=[],yt=e.radialBondResults=[]},qn=function(){throw new Error("md2d: Don't change the epsilon or sigma parameters of the LJ calculator being used by MD2D. Use the setElementProperties method instead.")},Rn=function(e,t){var n=st[e],r=st[t],i=ot[e],s=ot[t],o=ct.get(e,t),u,a;o&&o.epsilon!==undefined?u=o.epsilon:u=c.pairwiseEpsilon(n,r),o&&o.sigma!==undefined?a=o.sigma:a=c.pairwiseSigma(i,s),_n[e][t]=_n[t][e]=Mn*a*Mn*a,Pn[e][t]=Pn[t][e]=Dn*a*Dn*a,Hn[e][t]=Hn[t][e]=c.newLJCalculator({epsilon:u,sigma:a},qn)},Un=function(){var e=0,t,n,r,i;for(r=0;r<ft;r++)for(i=0;i<=r;i++)lt[r]&&lt[i]&&(t=ct.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(ot[r],ot[i]),Dn*n>e&&(e=Dn*n));return e||Math.max(P[0],P[1])},zn=function(){var e=Infinity,t,n,r,i;for(r=0;r<ft;r++)for(i=0;i<=r;i++)lt[r]&&lt[i]&&(t=ct.get(r,i),t&&t.sigma!==undefined?n=t.sigma:n=c.pairwiseSigma(ot[r],ot[i]),(Dn-Mn)*n<e&&(e=(Dn-Mn)*n));return e},Wn=function(){yn===undefined?yn=new v(P[0],P[1],Un()):yn.reinitialize(Un())},Xn=function(){bn===undefined?bn=new m(rt,zn()):bn.reinitialize(rt,zn())},Vn=function(){var e,t,n;bt=[];for(e=0;e<wt;e++)t=ht[e],n=pt[e],bt[t]=bt[t]||[],bt[t][n]=!0,bt[n]=bt[n]||[],bt[n][t]=!0},$n=function(e,t){var n,i;if(Array.isArray(e))for(n=0,i=e.length;n<i;n++)r.isArray(e[n])&&(e[n]=r.extend(e[n],t));else for(n in e)e.hasOwnProperty(n)&&r.isArray(e[n])&&(e[n]=r.extend(e[n],t))},Jn={atoms:function(){I=nt.radius,q=nt.px,R=nt.py,U=nt.x,z=nt.y,W=nt.vx,X=nt.vy,V=nt.speed,$=nt.ax,J=nt.ay,K=nt.charge,G=nt.friction,Q=nt.element,Y=nt.pinned,Z=nt.mass,et=nt.hydrophobicity,tt=nt.visited},radialBonds:function(){ht=gt.atom1,pt=gt.atom2,dt=gt.length,vt=gt.strength,mt=gt.type},restraints:function(){Et=Nt.atomIndex,St=Nt.k,xt=Nt.x0,Tt=Nt.y0},angularBonds:function(){kt=_t.atom1,Lt=_t.atom2,At=_t.atom3,Ot=_t.angle,Mt=_t.strength},elements:function(){it=at.mass,st=at.epsilon,ot=at.sigma,ut=at.radius},obstacles:function(){Pt=sn.x,Ht=sn.y,Bt=sn.width,jt=sn.height,zt=sn.mass,Ft=sn.vx,It=sn.vy,qt=sn.externalFx,Rt=sn.externalFy,Ut=sn.friction,Wt=sn.westProbe,Xt=sn.northProbe,Vt=sn.eastProbe,$t=sn.southProbe,en=sn.westProbeValue,tn=sn.northProbeValue,nn=sn.eastProbeValue,rn=sn.southProbeValue,Yt=sn.xPrev,Zt=sn.yPrev,Jt=sn.colorR,Kt=sn.colorG,Qt=sn.colorB,Gt=sn.visible},springForces:function(){hn=mn[0],pn=mn[1],dn=mn[2],vn=mn[3]},vdwPairs:function(){ln=an.atom1,cn=an.atom2}},Kn=function(t){at=e.elements={},at.mass=r.create(t,0,i.float),at.epsilon=r.create(t,0,i.float),at.sigma=r.create(t,0,i.float),at.radius=r.create(t,0,i.float),Jn.elements()},Qn=function(t){nt=e.atoms={},nt.radius=r.create(t,0,i.float),nt.px=r.create(t,0,i.float),nt.py=r.create(t,0,i.float),nt.x=r.create(t,0,i.float),nt.y=r.create(t,0,i.float),nt.vx=r.create(t,0,i.float),nt.vy=r.create(t,0,i.float),nt.speed=r.create(t,0,i.float),nt.ax=r.create(t,0,i.float),nt.ay=r.create(t,0,i.float),nt.charge=r.create(t,0,i.float),nt.friction=r.create(t,0,i.float),nt.element=r.create(t,0,i.uint8),nt.pinned=r.create(t,0,i.uint8),nt.mass=r.create(t,0,i.float),nt.hydrophobicity=r.create(t,0,i.int8),nt.visited=r.create(t,0,i.uint8),nt.marked=r.create(t,0,i.uint8),nt.visible=r.create(t,0,i.uint8),nt.draggable=r.create(t,0,i.uint8),Jn.atoms()},Gn=function(t){gt=e.radialBonds={},gt.atom1=r.create(t,0,i.uint16),gt.atom2=r.create(t,0,i.uint16),gt.length=r.create(t,0,i.float),gt.strength=r.create(t,0,i.float),gt.type=r.create(t,0,i.uint8),Jn.radialBonds()},Yn=function(t){Nt=e.restraints={},Nt.atomIndex=r.create(t,0,i.uint16),Nt.k=r.create(t,0,i.float),Nt.x0=r.create(t,0,i.float),Nt.y0=r.create(t,0,i.float),Jn.restraints()},Zn=function(t){_t=e.angularBonds={},_t.atom1=r.create(t,0,i.uint16),_t.atom2=r.create(t,0,i.uint16),_t.atom3=r.create(t,0,i.uint16),_t.angle=r.create(t,0,i.float),_t.strength=r.create(t,0,i.float),Jn.angularBonds()},er=function(t){an=e.vdwPairs={},an.count=0,an.atom1=r.create(t,0,i.uint16),an.atom2=r.create(t,0,i.uint16)},tr=function(t){mn=e.springForces=[],mn[0]=r.create(t,0,i.uint16),mn[1]=r.create(t,0,i.float),mn[2]=r.create(t,0,i.float),mn[3]=r.create(t,0,i.float),Jn.springForces()},nr=function(t){sn=e.obstacles={},sn.x=r.create(t,0,i.float),sn.y=r.create(t,0,i.float),sn.width=r.create(t,0,i.float),sn.height=r.create(t,0,i.float),sn.mass=r.create(t,0,i.float),sn.vx=r.create(t,0,i.float),sn.vy=r.create(t,0,i.float),sn.externalFx=r.create(t,0,i.float),sn.externalFy=r.create(t,0,i.float),sn.friction=r.create(t,0,i.float),sn.westProbe=r.create(t,0,i.uint8),sn.northProbe=r.create(t,0,i.uint8),sn.eastProbe=r.create(t,0,i.uint8),sn.southProbe=r.create(t,0,i.uint8),sn.westProbeValue=r.create(t,0,i.float),sn.northProbeValue=r.create(t,0,i.float),sn.eastProbeValue=r.create(t,0,i.float),sn.southProbeValue=r.create(t,0,i.float),sn.xPrev=r.create(t,0,i.float),sn.yPrev=r.create(t,0,i.float),sn.colorR=r.create(t,0,i.float),sn.colorG=r.create(t,0,i.float),sn.colorB=r.create(t,0,i.float),sn.visible=r.create(t,0,i.uint8),Jn.obstacles()},rr,ir=function(){return n&&Bn?1e3:1e3},sr=function(){M=!0,rr=f.getWindowedAverager(ir())},or=function(){var e=0,t;for(t=0;t<rt;t++)e+=Z[t]*(W[t]*W[t]+X[t]*X[t]);for(t=0;t<on;t++)zt[t]!==Infinity&&(e+=zt[t]*(Ft[t]*Ft[t]+It[t]*It[t]));return T(e/2,rt)},ur=function(e,t,n){W[e]+=t,X[e]+=n,q[e]=W[e]*Z[e],R[e]=X[e]*Z[e]},ar=function(e,t){W[e]-=t*(z[e]-Sn),X[e]+=t*(U[e]-En),q[e]=W[e]*Z[e],R[e]=X[e]*Z[e]},fr=function(){for(var e=0;e<rt;e++)ur(e,-Nn,-Cn),ar(e,-An)},lr=function(){var t=0,n=0,r=0,i=0,s=e.getTotalMass(),o;for(o=0;o<rt;o++)t+=U[o],n+=z[o],r+=q[o],i+=R[o];En=t/rt,Sn=n/rt,xn=r,Tn=i,Nn=r/s,Cn=i/s},cr=function(){var e=0,t=0,n,r;for(r=0;r<rt;r++)n=Z[r],e+=n*S(U[r]-En,z[r]-Sn,W[r]-Nn,X[r]-Cn),t+=n*x(U[r]-En,z[r]-Sn);kn=e,Ln=t,An=kn/Ln},hr=function(){lr(),cr()},pr=function(e){var t=0,n=0,r=P[0],i=P[1],s=r-Bt[e],o=i-jt[e];if(Pt[e]<t){while(Pt[e]<t-r)Pt[e]+=r;Pt[e]=t+(t-Pt[e]),Ft[e]*=-1}else if(Pt[e]>s){while(Pt[e]>s+r)Pt[e]-=r;Pt[e]=s-(Pt[e]-s),Ft[e]*=-1}if(Ht[e]<n){while(Ht[e]<n-i)Ht[e]+=i;Ht[e]=n+(n-Ht[e]),It[e]*=-1}else if(Ht[e]>o){while(Ht[e]>o+r)Ht[e]-=r;Ht[e]=o-(Ht[e]-o),It[e]*=-1}},dr=function(e){var t=I[e],n=t,r=t,i=P[0],s=P[1],o=i-t,u=s-t;if(U[e]<n){while(U[e]<n-i)U[e]+=i;U[e]=n+(n-U[e]),W[e]*=-1,q[e]*=-1}else if(U[e]>o){while(U[e]>o+i)U[e]-=i;U[e]=o-(U[e]-o),W[e]*=-1,q[e]*=-1}if(z[e]<r){while(z[e]<r-s)z[e]+=s;z[e]=r+(r-z[e]),X[e]*=-1,R[e]*=-1}else if(z[e]>u){while(z[e]>u+s)z[e]-=s;z[e]=u-(z[e]-u),X[e]*=-1,R[e]*=-1}},vr=function(e,t,n,r){if(on<1)return;var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;i=I[e],s=U[e],o=z[e];for(u=0;u<on;u++)a=Pt[u]-i,f=Pt[u]+Bt[u]+i,l=Ht[u]+jt[u]+i,c=Ht[u]-i,h=Yt[u]-i,p=Yt[u]+Bt[u]+i,d=Zt[u]+jt[u]+i,v=Zt[u]-i,x=0,s>a&&s<f&&o>c&&o<l&&(t<=h?(U[e]=a-(s-a),x=1):t>=p?(U[e]=f+(f-s),x=2):n<=v?(z[e]=c-(o-c),x=-1):n>=d&&(z[e]=l+(l-o),x=-2)),E=zt[u],x!==0&&(E!==Infinity?(w=Z[e],S=E+w,x>0?(m=W[e],y=Ft[u],W[e]=(m*(w-E)+2*E*y)/S,Ft[u]=(y*(E-w)+2*q[e])/S):(g=X[e],b=It[u],X[e]=(g*(w-E)+2*E*b)/S,It[u]=(b*(E-w)+2*R[e])/S)):x>0?W[e]*=-1:X[e]*=-1,r&&(Wt[u]&&x===1?en[u]+=Z[e]*((m?m:-W[e])-W[e]):Vt[u]&&x===2?nn[u]+=Z[e]*(W[e]-(m?m:-W[e])):$t[u]&&x===-1?rn[u]+=Z[e]*((g?g:-X[e])-X[e]):Xt[u]&&x===-2&&(tn[u]+=Z[e]*(X[e]-(g?g:-X[e])))))},mr=function(e,t){if(bt&&bt[e]&&bt[e][t])return;var n=Q[e],r=Q[t],i=U[t]-U[e],s=z[t]-z[e],o=i*i+s*s,u,a,f;wn&&o<Pn[n][r]&&bn.markNeighbors(e,t),o<_n[n][r]&&(u=Hn[n][r].forceOverDistanceFromSquaredDistance(o),a=u*i,f=u*s,$[e]+=a,J[e]+=f,$[t]-=a,J[t]-=f)},gr=function(){if(!k)return;wn?(s.time("cell lists"),yr(),s.timeEnd("cell lists")):(s.time("neighbor list"),br(),s.timeEnd("neighbor list"))},yr=function(){var e=yn.getRowsNum(),t=yn.getColsNum(),n,r,i,s,o,u,a,f,l,c,h,p,d,v;for(n=0;n<e;n++){i=n*t;for(r=0;r<t;r++){s=i+r,o=yn.getCell(s),v=yn.getNeighboringCells(n,r);for(a=0,c=o.length;a<c;a++){l=o[a];for(f=0;f<a;f++)mr(l,o[f]);for(p=0,d=v.length;p<d;p++){u=v[p];for(f=0,h=u.length;f<h;f++)mr(l,u[f])}}}}},br=function(){var e=bn.getList(),t,n,r,i;for(t=0;t<rt;t++)for(r=bn.getStartIdxFor(t),i=bn.getEndIdxFor(t);r<i;r++)n=e[r],mr(t,n)},wr=function(){if(!n||!Bn)return;var e,t,r,i,s,o,u,a,f,c,h,p,d;for(e=0,r=jn.length;e<r;e++){h=jn[e],c=K[h],d=bt&&bt[h];for(t=0;t<e;t++){p=jn[t];if(d&&d[p])continue;i=U[p]-U[h],s=z[p]-z[h],o=i*i+s*s,u=l.forceOverDistanceFromSquaredDistance(o,c,K[p],g,y),a=u*i,f=u*s,$[h]+=a,J[h]+=f,$[p]-=a,J[p]-=f}}},Er=function(){if(!H)return;var e,t;for(e=0;e<rt;e++)t=H*G[e],$[e]+=-W[e]*t,J[e]+=-X[e]*t},Sr=function(){if(wt<1)return;var e,t,n,r,i,s,a,f,l,c,h,p;for(e=0;e<wt;e++)t=ht[e],n=pt[e],r=U[n]-U[t],i=z[n]-z[t],s=r*r+i*i,a=Math.sqrt(s),f=vt[e],l=dt[e],c=o.convert(f*(a-l),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/a,h=c*r,p=c*i,$[t]+=h,J[t]+=p,$[n]-=h,J[n]-=p},xr=function(){if(Dt<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;for(e=0;e<Dt;e++)t=kt[e],n=Lt[e],r=At[e],v=Ot[e],d=Mt[e],i=U[t]-U[r],a=U[n]-U[r],s=z[t]-z[r],f=z[n]-z[r],l=i*i+s*s,c=a*a+f*f,h=Math.sqrt(l),p=Math.sqrt(c),g=(i*a+s*f)/(h*p),g>1?g=1:g<-1&&(g=-1),y=Math.sqrt(1-g*g),m=Math.acos(g),y<1e-4&&(y=1e-4),x=o.convert(d*(m-v)/(y*h),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/p,T=i*a+s*f,b=x*(a-T*i/l),w=x*(f-T*s/l),E=x*(i-T*a/c),S=x*(s-T*f/c),$[t]+=b,J[t]+=w,$[n]+=E,J[n]+=S,$[r]-=b+E,J[r]-=w+S},Tr=function(){if(Ct<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<Ct;e++){c=Et[e],t=xt[e]-U[c],n=Tt[e]-z[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=St[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,$[c]+=f,J[c]+=l}},Nr=function(){if(gn<1)return;var e,t,n,r,i,s,a,f,l,c;for(e=0;e<gn;e++){c=hn[e],t=pn[e]-U[c],n=dn[e]-z[c];if(t===0&&n===0)continue;i=t*t+n*n,r=Math.sqrt(i),s=vn[e],a=o.convert(s*r,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/r,f=a*t,l=a*n,$[c]+=f,J[c]+=l}},Cr=function(e){var t=0,n=0,r=0,i,s,o,u;for(o=0,u=e.length;o<u;o++)i=e[o],s=Z[i],t+=U[i]*s,n+=z[i]*s,r+=s;return t/=r,n/=r,{x:t,y:n}},kr=function(){if(b===0||w===0)return;var t,n,r,i,s,o,u,a,f,l,c,h,p;for(c=0;c<rt;c++)tt[c]=0;i=6e-5*b*w;for(c=0;c<rt;c++){if(tt[c]===1)continue;t=e.getMoleculeAtoms(c),t.push(c),r=Cr(t);for(h=0,p=t.length;h<p;h++)n=t[h],tt[n]=1,et[n]!==0&&(s=U[n]-r.x,o=z[n]-r.y,u=Math.sqrt(s*s+o*o),l=et[n]*i,l>0&&u<N&&(l*=(1-E)*u/N+E),a=l*s/u,f=l*o/u,$[n]-=a,J[n]-=f)}},Lr=function(){if(!O)return;var e;for(e=0;e<rt;e++)J[e]-=O},Ar=function(){var e=a.cysteineElement,t,n;Fn.length=0;for(n=0;n<rt;n++)Q[n]===e&&Fn.push(n);for(n=0;n<wt;n++)Q[ht[n]]===e&&Q[pt[n]]===e&&(t=Fn.indexOf(ht[n]),t!==-1&&r.remove(Fn,t),t=Fn.indexOf(pt[n]),t!==-1&&r.remove(Fn,t))},Or=function(){var e,t;if(rt===0)return;for(e=0;e<rt;e++)$[e]=J[e]=0;wn=bn.shouldUpdate(U,z);if(wn){yn.clear(),bn.clear();for(e=0;e<rt;e++)yn.addToCell(e,U[e],z[e]),bn.saveAtomPosition(e,U[e],z[e])}s.time("short-range forces"),gr(),s.timeEnd("short-range forces"),s.time("long-range forces"),wr(),s.timeEnd("long-range forces"),Sr(),xr(),Tr(),Nr(),Er(),kr();for(e=0;e<rt;e++)t=1/Z[e],$[e]*=t,J[e]*=t;Lr()},Mr=function(){var e,t;for(e=0;e<rt;e++)t=Z[e],W[e]+=.5*$[e]*j,q[e]=t*W[e],X[e]+=.5*J[e]*j,R[e]=t*X[e]},_r=function(){var e=P[0]*100,t=P[1]*100,n,r,i;for(i=0;i<rt;i++){n=U[i],r=z[i],U[i]+=W[i]*j,z[i]+=X[i]*j;if(isNaN(U[i])||isNaN(z[i])||Math.abs(U[i])>e||Math.abs(z[i])>t)throw new Error("Model has diverged!");dr(i),vr(i,n,r,!0)}},Dr=function(){var e;for(e=0;e<rt;e++)Y[e]&&(W[e]=X[e]=$[e]=J[e]=0)},Pr=function(){var e;for(e=0;e<rt;e++)V[e]=Math.sqrt(W[e]*W[e]+X[e]*X[e])},Hr=function(){var e,t,n,r,i,s,o,u;for(u=0;u<on;u++){if(zt[u]===Infinity)continue;n=Ft[u],r=It[u],s=qt[u],o=Rt[u];if(n||r||s||o||O)i=H*Ut[u],e=s-i*n,t=o-i*r-O,Yt[u]=Pt[u],Zt[u]=Ht[u],Pt[u]+=n*j+.5*e*F,Ht[u]+=r*j+.5*t*F,Ft[u]+=e*j,It[u]+=t*j,pr(u)}},Br=function(){var t,n,r,i,s,o,u,a;for(o=0;o<rt;o++)tt[o]=0;for(o=0;o<rt;o++){if(tt[o]===1)continue;t=e.getMoleculeAtoms(o);if(t.length===0)continue;t.push(o),r=i=s=0;for(u=0,a=t.length;u<a;u++)n=t[u],tt[n]=1,r+=W[n]*Z[n],i+=X[n]*Z[n],s+=Z[n];s=1/s;for(u=0,a=t.length;u<a;u++)n=t[u],W[n]-=r*s,X[n]-=i*s,q[n]=W[n]*Z[n],R[n]=X[n]*Z[n]}},jr=function(e,t){var n,r;e==null&&(e=_),On=or(),M&&Math.abs(rr(On)-e)<=e*D&&(M=!1);if(t||L||M&&On>0){n=Math.sqrt(e/On);for(r=0;r<rt;r++)W[r]*=n,X[r]*=n,q[r]*=n,R[r]*=n;for(r=0;r<on;r++)Ft[r]*=n,It[r]*=n;On=e}},Fr=function(){var t,n,i,s,o,u,a,f;for(u=0,f=Fn.length;u<f;u++){t=Fn[u];for(a=u+1;a<f;a++)n=Fn[a],i=U[t]-U[n],s=z[t]-z[n],o=i*i+s*s,o<.07&&(e.addRadialBond({atom1:t,atom2:n,length:Math.sqrt(o),strength:1e4,type:109}),r.remove(Fn,u),r.remove(Fn,a),f=Fn.length,t=Fn[u],a=u+1)}},Ir=function(){var e;for(e=0;e<on;e++)Xt[e]&&(tn[e]=0),$t[e]&&(rn[e]=0),Vt[e]&&(nn[e]=0),Wt[e]&&(en[e]=0)},qr=function(e){var t,n;t=13888.89/e;for(n=0;n<on;n++)Xt[n]&&(tn[n]*=t/Bt[n]),$t[n]&&(rn[n]*=t/Bt[n]),Vt[n]&&(nn[n]*=t/jt[n]),Wt[n]&&(en[n]*=t/jt[n])};return e={useCoulombInteraction:function(e){n=!!e},useLennardJonesInteraction:function(e){k=!!e},useThermostat:function(e){L=!!e},setVDWLinesRatio:function(e){typeof e=="number"&&e!==0&&(A=e)},setGravitationalField:function(e){typeof e=="number"&&e!==0?O=e:O=!1},setTargetTemperature:function(e){C(e),_=e},setDielectricConstant:function(e){g=e},setRealisticDielectricEffect:function(e){y=e},setSolventForceType:function(e){b=e},setSolventForceFactor:function(e){w=e},setAdditionalSolventForceMult:function(e){E=e},setAdditionalSolventForceThreshold:function(e){N=e},setTime:function(e){B=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;P=[n,r],t=!0},getSize:function(){return[P[0],P[1]]},getLJCalculator:function(){return Hn},setAtomProperties:function(t,n){var r=a.cysteineElement,i,s,o,u,f;if(n.element!==undefined){if(n.element<0||n.element>=ft)throw new Error("md2d: Unknown element "+n.element+", an atom can't be created.");if(Q[t]===r&&n.element!==r)for(f=0;f<wt;f++)if((ht[f]===t||pt[f]===t)&&mt[f]===109){e.removeRadialBond(f);break}lt[n.element]=!0,n.mass=it[n.element],n.radius=ut[n.element],a.isAminoAcid(n.element)&&(u=a.getAminoAcidByElement(n.element),n.charge=u.charge,n.hydrophobicity=u.hydrophobicity)}!K[t]&&n.charge?jn.push(t):K[t]&&n.charge===0&&(s=jn.indexOf(t),o=jn.slice(s+1),jn.length=s,Array.prototype.push.apply(jn,o)),Bn=!!jn.length;for(i in n)n.hasOwnProperty(i)&&(nt[i][t]=n[i]);q[t]=W[t]*Z[t],R[t]=X[t]*Z[t],V[t]=Math.sqrt(W[t]*W[t]+X[t]*X[t])},setRadialBondProperties:function(e,t){var n,r,i;r=ht[e],i=pt[e],bt[r]&&bt[r][i]&&(bt[r][i]=!1),bt[i]&&bt[i][r]&&(bt[i][r]=!1);for(n in t)t.hasOwnProperty(n)&&(gt[n][e]=t[n],yt[e][n]=t[n]);r=ht[e],i=pt[e],bt[r]||(bt[r]=[]),bt[r][i]=!0,bt[i]||(bt[i]=[]),bt[i][r]=!0},setAngularBondProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(_t[n][e]=t[n])},setRestraintProperties:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(Nt[n][e]=t[n])},setElementProperties:function(e,t){var n,r;if(t.mass!=null&&t.mass!==it[e]){it[e]=t.mass;for(n=0;n<rt;n++)Q[n]===e&&(Z[n]=t.mass)}if(t.sigma!=null){ot[e]=t.sigma,r=c.radius(t.sigma);if(ut[e]!==r){ut[e]=r;for(n=0;n<rt;n++)Q[n]===e&&(I[n]=r)}}t.epsilon!=null&&(st[e]=t.epsilon);for(n=0;n<ft;n++)Rn(e,n);Wn(),Xn()},setPairwiseLJProperties:function(e,t){Rn(e,t),Wn(),Xn()},setObstacleProperties:function(t,n){var r;if(!e.canPlaceObstacle(n.x,n.y,n.width,n.height,t))throw new Error("Obstacle can't be placed at "+n.x+", "+n.y);n.x!==undefined&&(n.xPrev=n.x),n.y!==undefined&&(n.yPrev=n.y),typeof n.mass=="string"&&(n.mass=parseFloat(n.mass));for(r in n)n.hasOwnProperty(r)&&(sn[r][t]=n[r])},addAtom:function(t){rt+1>nt.x.length&&($n(nt,rt+10),Jn.atoms()),t.ax=t.ay=0,rt++,e.setAtomProperties(rt-1,t),Wn(),Xn()},removeAtom:function(t){var n,i,s,o,u,a;if(t>=rt)throw new Error("Atom "+t+" doesn't exist, so it can't be removed.");n=0;while(n<wt)ht[n]===t||pt[n]===t?e.removeRadialBond(n):n++;n=jn.indexOf(t),n!==-1&&r.remove(jn,n);for(n=t;n<rt;n++)for(s in nt)nt.hasOwnProperty(s)&&(n===rt-1?nt[s][n]=0:nt[s][n]=nt[s][n+1]);rt--,a=[jn,ht,pt,kt,Lt,At];for(o=0;o<a.length;o++){u=a[o];for(n=0,i=u.length;n<i;n++)u[n]>t&&u[n]--}for(n=0,i=yt.length;n<i;n++)yt[n].atom1>t&&yt[n].atom1--,yt[n].atom2>t&&yt[n].atom2--;Vn(),Wn(),Xn(),bn.invalidate(),Or()},addElement:function(e){var t;ft>=st.length&&($n(at,ft+10),Jn.elements()),it[ft]=e.mass,st[ft]=e.epsilon,ot[ft]=e.sigma,ut[ft]=c.radius(e.sigma),Hn[ft]=[],_n[ft]=[],Pn[ft]=[];for(t=0;t<=ft;t++)Rn(ft,t);ft++},addRadialBond:function(t){wt+1>ht.length&&($n(gt,wt+10),Jn.radialBonds()),wt++,yt[wt-1]={idx:wt-1},e.setRadialBondProperties(wt-1,t)},removeRadialBond:function(t){var n,i,s,o;if(t>=wt)throw new Error("Radial bond "+t+" doesn't exist, so it can't be removed.");s=ht[t],o=pt[t],n=0;while(n<Dt)At[n]===s||At[n]===o?e.removeAngularBond(n):n++;for(n=t;n<wt;n++)for(i in gt)gt.hasOwnProperty(i)&&(n===wt-1?gt[i][n]=0:gt[i][n]=gt[i][n+1]);wt--,r.remove(yt,t),Vn()},addRestraint:function(t){Ct+1>Nt.atomIndex.length&&($n(Nt,Ct+10),Jn.restraints()),Ct++,e.setRestraintProperties(Ct-1,t)},addAngularBond:function(t){Dt+1>_t.atom1.length&&($n(_t,Dt+10),Jn.angularBonds()),Dt++,e.setAngularBondProperties(Dt-1,t)},removeAngularBond:function(e){var t,n;if(e>=Dt)throw new Error("Angular bond "+e+" doesn't exist, so it can't be removed.");for(t=e;t<Dt;t++)for(n in _t)_t.hasOwnProperty(n)&&(t===Dt-1?_t[n][t]=0:_t[n][t]=_t[n][t+1]);Dt--},addSpringForce:function(e,t,n,r){return gn+1>mn[0].length&&($n(mn,gn+1),Jn.springForces()),hn[gn]=e,pn[gn]=t,dn[gn]=n,vn[gn]=r,gn++},updateSpringForce:function(e,t,n){pn[e]=t,dn[e]=n},removeSpringForce:function(e){if(e>=gn)return;gn--},springForceAtomIndex:function(e){return hn[e]},addObstacle:function(t){if(!e.canPlaceObstacle(t.x,t.y,t.width,t.height))throw new Error("Obstacle can't be placed at "+t.x+", "+t.y+".");on+1>sn.x.length&&($n(sn,on+1),Jn.obstacles()),on++,e.setObstacleProperties(on-1,t)},removeObstacle:function(e){var t,n;if(e>=on)throw new Error("Obstacle "+e+" doesn't exist, so it can't be removed.");on--;for(t=e;t<on;t++)for(n in sn)sn.hasOwnProperty(n)&&(sn[n][t]=sn[n][t+1]);$n(sn,on),Jn.obstacles()},atomInBounds:function(e,t,n){var r=I[n],i;if(e<r||e>P[0]-r||t<r||t>P[1]-r)return!1;for(i=0;i<on;i++)if(e>Pt[i]-r&&e<Pt[i]+Bt[i]+r&&t>Ht[i]-r&&t<Ht[i]+jt[i]+r)return!1;return!0},canPlaceAtom:function(t,n,r,i){var s,o,u;return e.atomInBounds(n,r,i)?(typeof i=="number"&&(s=U[i],o=z[i],U[i]=z[i]=Infinity),u=e.newPotentialCalculator(t,0,!1)(n,r),typeof i=="number"&&(U[i]=s,z[i]=o),u<=0):!1},canPlaceObstacle:function(e,t,n,r,i){var s=e+n,o=t+r,u,a,f,l,c,h;if(e<0||s>P[0]||t<0||o>P[0])return!1;for(h=0;h<rt;h++){c=I[h];if(U[h]>e-c&&U[h]<s+c&&z[h]>t-c&&z[h]<o+c)return!1}for(h=0;h<on;h++){if(i!==undefined&&i===h)continue;u=Pt[h],a=Ht[h],f=u+Bt[h],l=a+jt[h];if(s>u&&e<f&&o>a&&t<l)return!1}return!0},setupAtomsRandomly:function(t){var n=t.temperature||100,r=Math.floor(Math.sqrt(rt)),i=Math.ceil(rt/r),s,o,u,a,l,c,h,p;C(n),l=P[0]/(1+i),a=P[1]/(1+r),s=-1;for(o=1;o<=r;o++)for(u=1;u<=i;u++){s++;if(s===rt)break;c=f.normal(1,.25),h=2*Math.random()*Math.PI,p={element:Math.floor(Math.random()*t.userElements),x:u*l,y:o*a,vx:c*Math.cos(h),vy:c*Math.sin(h),charge:2*(s%2)-1},e.setAtomProperties(s,p)}hr(),fr(),jr(n,!0)},generateProtein:function(t,n){var r=P[0],i=P[1],s=0,o=0,u=a.lastElementID-a.firstElementID+1,f,l,c,h,p,d=.6,v=function(e){return e>i-d||e<d?.1:.02-Math.random()*.04},m=.3,g=function(e,t){return t===0?e>.5*P[1]?-0.1:.1:c>i-m||c<m?0:t},y=function(){return Math.floor(u*Math.random())+a.firstElementID};t!==undefined&&(n=t.length);while(rt>0)e.removeAtom(rt-1);l=.1,c=.1,h=t?a.abbrToElement(t[0]):y(),e.addAtom({x:l,y:c,element:h,visible:!0}),e.minimizeEnergy();for(f=1;f<n;f++){l=U[rt-1],c=z[rt-1],s=v(c),o=g(c,o),l+=s,c+=o;if(l>r-.1)return f;h=t?a.abbrToElement(t[f]):y(),e.addAtom({x:l,y:c,element:h,visible:!0}),p=(I[rt-1]+I[rt-2])*1.25,e.addRadialBond({atom1:rt-1,atom2:rt-2,length:p,strength:1e4}),e.minimizeEnergy()}s=(r-l)/2;for(f=0;f<rt;f++)U[f]+=s;return f},getVdwPairsArray:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v=A*A;fn=0;for(e=0;e<rt;e++){c=Q[e],u=ot[c],a=ot[c],s=U[e],o=z[e];for(t=e+1;t<rt;t++){if(wt!==0&&bt[e]&&bt[e][t])continue;h=Q[t],f=ot[h],l=ot[h],K[e]*K[t]<=0&&(n=U[t]-s,r=z[t]-o,i=n*n+r*r,p=.5*(u+f),p*=p,d=a*l,i<p*v&&d>0&&(fn+1>an.atom1.length&&($n(an,(fn+1)*2),Jn.vdwPairs()),ln[fn]=e,cn[fn]=t,fn++))}}return an.count=fn,an},relaxToTemperature:function(t){t!=null&&(_=t),C(_),sr();while(M)e.integrate()},integrate:function(e,t){var n,r,i=B;e===undefined&&(e=100),t===undefined&&(t=1),j=t,F=j*j,Ar(),B===0&&Or(),n=Math.floor(e/j),Ir();for(r=1;r<=n;r++)B=i+r*j,Mr(),_r(),Or(),Dr(),Mr(),Pr(),Hr(),jr(),b!==0&&Br();qr(e),Fr()},minimizeEnergy:function(){var e=.001,t=1e-4,n=3e3,r,i,s,o,u,a;Or(),r=0;for(u=0;u<rt;u++)r<Math.abs($[u])&&(r=Math.abs($[u])),r<Math.abs(J[u])&&(r=Math.abs(J[u]));a=0;while(r>t&&a<n){a++,i=e/r;for(u=0;u<rt;u++)s=U[u],o=z[u],U[u]+=$[u]*i,z[u]+=J[u]*i,dr(u),vr(u,s,o,!1);Or(),r=0;for(u=0;u<rt;u++)r<Math.abs($[u])&&(r=Math.abs($[u])),r<Math.abs(J[u])&&(r=Math.abs(J[u]))}},getTotalMass:function(){var e=0,t;for(t=0;t<rt;t++)e+=Z[t];return e},getRadiusOfElement:function(e){return ut[e]},getNumberOfAtoms:function(){return rt},getNumberOfElements:function(){return ft},getNumberOfObstacles:function(){return on},getNumberOfRadialBonds:function(){return wt},getNumberOfAngularBonds:function(){return Dt},computeOutputState:function(e){var t,r,i,s,a,f,c,h,p,d,v,m,b,w,E,S,x,N,C,L,A,M,_,D;D=0,_=0;for(t=0;t<rt;t++){O&&(M=Z[t]*O*z[t],D+=o.convert(M,{from:u.MW_ENERGY_UNIT,to:u.EV})),_+=.5*Z[t]*(W[t]*W[t]+X[t]*X[t]);for(r=t+1;r<rt;r++)h=U[r]-U[t],p=z[r]-z[t],S=h*h+p*p,k&&(D-=Hn[Q[t]][Q[r]].potentialFromSquaredDistance(S)),n&&Bn&&(D+=l.potential(Math.sqrt(S),K[t],K[r],g,y))}for(t=0;t<wt;t++)i=ht[t],s=pt[t],f=Q[i],c=Q[s],h=U[s]-U[i],p=z[s]-z[i],S=h*h+p*p,C=vt[t],L=Math.sqrt(S)-dt[t],D+=.5*C*L*L,k&&(D+=Hn[f][c].potentialFromSquaredDistance(S)),n&&K[i]&&K[s]&&(D-=l.potential(Math.sqrt(S),K[i],K[s],g,y)),yt[t].x1=U[i],yt[t].y1=z[i],yt[t].x2=U[s],yt[t].y2=z[s];for(t=0;t<Dt;t++)i=kt[t],s=Lt[t],a=At[t],d=U[i]-U[a],m=U[s]-U[a],v=z[i]-z[a],b=z[s]-z[a],x=Math.sqrt(d*d+v*v),N=Math.sqrt(m*m+b*b),w=(d*m+v*b)/(x*N),w>1?w=1:w<-1&&(w=-1),E=Math.acos(w),A=E-Ot[t],D+=.5*Mt[t]*A*A;for(t=0;t<Ct;t++)i=Et[t],f=Q[i],h=xt[t]-U[i],p=Tt[t]-z[i],S=h*h+p*p,C=St[t],L=Math.sqrt(S),D+=.5*C*L*L;for(t=0;t<on;t++)zt[t]!==Infinity&&(O&&(M=zt[t]*O*Ht[t],D+=o.convert(M,{from:u.MW_ENERGY_UNIT,to:u.EV})),_+=.5*zt[t]*(Ft[t]*Ft[t]+It[t]*It[t]));On=T(_,rt),e.time=B,e.PE=D,e.KE=o.convert(_,{from:u.MW_ENERGY_UNIT,to:u.EV}),e.temperature=On,e.pCM=[xn,Tn],e.CM=[En,Sn],e.vCM=[Nn,Cn],e.omega_CM=An},newPotentialCalculator:function(e,t,r){return function(i,s){var a=0,f=0,c=0,h,p,d=Hn[e],v,m,b,w,E,S,x;for(v=0;v<rt;v++)m=i-U[v],b=s-z[v],w=m*m+b*b,S=0,k&&(x=d[Q[v]],a+=-x.potentialFromSquaredDistance(w,e,Q[v]),r&&(S+=x.forceOverDistanceFromSquaredDistance(w))),n&&Bn&&t&&(E=Math.sqrt(w),a+=-l.potential(E,t,K[v],g,y),r&&(S+=l.forceOverDistanceFromSquaredDistance(w,t,K[v],g,y))),S&&(f+=S*m,c+=S*b);return r?(h=o.convert(f,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[a,[h,p]]):a}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=ut[t],u=f.minimize(s,[n,r],{bounds:[[o,P[0]-o],[o,P[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=ut[t],a=f.minimize(o,[n,r],{bounds:[[u,P[0]-u],[u,P[1]-u]],stopval:1e-4,precision:1e-6});return a.error?!1:a[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t=[],n=this.getBondedAtoms(e),r=this.depth,i,s,o;this.depth++;for(i=0,s=n.length;i<s;i++)o=n[i],~this.atomsInMolecule.indexOf(o)||(t=t.concat(this.getMoleculeAtoms(o)));return r===0?(this.depth=0,this.atomsInMolecule=[]):t.push(e),t},getBondedAtoms:function(e){var t=[],n,r;if(gt)for(n=0,r=wt;n<r;n++)ht[n]===e&&t.push(pt[n]),pt[n]===e&&t.push(ht[n]);return t},getAtomKineticEnergy:function(e){var t=.5*Z[e]*(W[e]*W[e]+X[e]*X[e]);return o.convert(t,{from:u.MW_ENERGY_UNIT,to:u.EV})},getAtomNeighbors:function(e){var t=[],n=bn.getList(),r,i;for(r=bn.getStartIdxFor(e),i=bn.getEndIdxFor(e);r<i;r++)t.push(n[r]);return t},getNeighborList:function(){return bn},setViscosity:function(e){H=e},getState:function(){return[new d(at),new d(nt),new d(sn),new d(gt),new d(_t),new d(Nt),new d(mn),ct,{clone:function(){return B},restore:function(t){e.setTime(t)}}]}},In(),e.pairwiseLJProperties=ct,e.geneticProperties=un,e}}),n("md2d/models/tick-history",[],function(){return function(t,n,r){function l(){return{input:{},state:[],parameters:{}}}function c(){o=[],u={length:0,maxSize:r,index:-1,counter:-1,startCounter:0}}function h(e){var r,i,s,o,u;for(r=0;r<t.input.length;r++)i=t.input[r],e.input[i]=n.get(i);o=t.parameters;for(u in o)o.hasOwnProperty(u)&&o[u].isDefined&&(e.parameters[u]=n.get(u));s=t.state;for(r=0;r<s.length;r++)e.state[r]=s[r].clone()}function p(){var e=l(),t;h(e),o[u.index+1]=e,o.length>u.maxSize?(o.splice(0,1),u.startCounter++):u.index++,u.counter=u.index+u.startCounter;for(t=0;t<f.length;t++)f[t].push();d(),u.length=o.length}function d(){var e;o.length=u.index+1,u.length=o.length;for(e=0;e<f.length;e++)f[e].invalidate(u.index)}function v(e){var n,r;t.restoreProperties(e.input),t.restoreParameters(e.parameters),r=e.state;for(n=0;n<r.length;n++)t.state[n].restore(r[n]);for(n=0;n<f.length;n++)f[n].extract(u.index)}function m(e){if(e<0)throw new Error("TickHistory: extract index ["+e+"] less than 0");if(e>=o.length)throw new Error("TickHistory: extract index ["+e+"] greater than list.length: "+o.length);return e}var i={},s,o,u,a=1e3,f=[];return i.isEmpty=function(){return u.index===0},i.push=function(){p()},i.returnTick=function(e){var t;return typeof e=="number"?t=e:t=u.index,m(t),o[t]},i.extract=function(e){var t;typeof e=="number"?t=e:t=u.index,m(t),v(o[t])},i.restoreInitialState=function(){c(),v(s),p()},i.reset=c,i.decrementExtract=function(){u.counter>u.startCounter&&(u.index--,u.counter--,v(o[u.index]))},i.incrementExtract=function(){u.index++,u.counter++,v(o[u.index])},i.seekExtract=function(e){e<u.startCounter&&(e=u.startCounter),e>=u.startCounter+u.length&&(e=u.startCounter+u.length-1),u.counter=e,u.index=e-u.startCounter,v(o[u.index])},i.invalidateFollowingState=d,i.get=function(e){return u[e]},i.set=function(e,t){return u[e]=t},i.registerExternalObject=function(e){e.setHistoryLength(u.maxSize),f.push(e)},r==null&&(r=a),s=l(),h(s),c(),p(),i}}),function(){n("cs!md2d/models/running-average-filter",["require"],function(e){var t;return t=function(){function e(e){this.periodLength=e,this._value=[],this._time=[],this._idx=-1,this._maxBufferLength=this.periodLength}return e.prototype.addSample=function(e,t){var n;if(this._time[this._idx]===e){this._value[this._idx]=t;return}if(this._time[this._idx]>e)throw new Error("RunningAverageFilter: cannot add sample with @_time less than previous sample.");this._idx++,this._value.push(t),this._time.push(e),n=[];while(this._value.length>this._maxBufferLength)this._time.shift(),this._value.shift(),n.push(this._idx--);return n},e.prototype.calculate=function(){var e,t,n,r,i,s;t=Math.max(this._time[this._idx]-this.periodLength,0),s=0,i=0,e=this._idx;while(e>0&&this._time[e-1]>=t)r=this._time[e]-this._time[e-1],i+=r,s+=r*(this._value[e-1]+this._value[e])/2,e--;return e>0&&this._time[e]>t&&this._time[e-1]<t&&(r=this._time[e]-t,i+=r,n=this._value[e-1]+(this._value[e]-this._value[e-1])*(t-this._time[e-1])/(this._time[e]-this._time[e-1]),s+=r*(this._value[e]+n)/2),i?s/i:this._value[0]||0},e.prototype.getCurrentBufferLength=function(){return this._value.length},e.prototype.setMaxBufferLength=function(e){return this._maxBufferLength=e},e.prototype.getCurrentTime=function(){return this._time[this._idx]},e.prototype.getCurrentStep=function(){return this._idx},e.prototype.setCurrentStep=function(e){if(e<-1||e>=this._value.length)throw new Error("RunningAverageFilter: cannot seek, location outside available range.");return this._idx=e},e.prototype.invalidate=function(e){return this._value.length=e+1,this._time.length=e+1},e}()})}.call(this),function(){n("cs!md2d/models/solvent",["require"],function(e){var t,n;return n={vacuum:{forceType:0,dielectricConstant:1,color:"#eee"},oil:{forceType:-1,dielectricConstant:10,color:"#f5f1dd"},water:{forceType:1,dielectricConstant:80,color:"#a5d9da"}},t=function(){function e(e){var t,r,i;this.type=e,r=n[this.type];if(r==null)throw new Error("Solvent: unknown type. Use 'vacuum', 'oil' or 'water'.");for(t in r)i=r[t],this[t]=i}return e}()})}.call(this),n("common/serialize",["require","arrays"],function(e){var t=e("arrays");return function(n,r,i){var s={},o,u;for(o in n)n.hasOwnProperty(o)&&r[o]!==undefined&&n[o].serialize!==!1&&(u=r[o],s[o]=i!==undefined?t.extend(u,i):t.clone(u));return s}}),n("md2d/models/modeler",["require","arrays","common/console","md2d/models/engine/md2d","md2d/models/metadata","md2d/models/tick-history","cs!md2d/models/running-average-filter","cs!md2d/models/solvent","common/serialize","common/validator","md2d/models/aminoacids-props","cs!md2d/models/aminoacids-helper","md2d/models/engine/constants/units","underscore"],function(e){var t=e("arrays"),n=e("common/console"),r=e("md2d/models/engine/md2d"),i=e("md2d/models/metadata"),s=e("md2d/models/tick-history"),o=e("cs!md2d/models/running-average-filter"
),u=e("cs!md2d/models/solvent"),a=e("common/serialize"),f=e("common/validator"),l=e("md2d/models/aminoacids-props"),c=e("cs!md2d/models/aminoacids-helper"),h=e("md2d/models/engine/constants/units"),p=e("underscore");return function(d){function V(e){e=p.uniq(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function J(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],I[t]&&(r=r.concat(I[t]));I.all&&(r=r.concat(I.all)),V(r)}function K(e){var t,n=[],r;for(t in e)if(e.hasOwnProperty(t)){if(U[t])throw new Error('Attempt to restore output property "'+t+'".');r=e[t],q[t]!==r&&(q["set_"+t]?q["set_"+t](r):q[t]=r,n.push(t))}J(n)}function Q(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&(q[t]!==e[t]||!X[t].isDefined)&&(q[t]=e[t],X[t].isDefined=!0,n.push(t));for(t in X)X.hasOwnProperty(t)&&!e.hasOwnProperty(t)&&(X[t].isDefined=!1,q[t]=undefined);J(n)}function G(){var e,t=0,n=v.get_num_atoms();e=-1;while(++e<n)t+=C.atoms.speed[e];return t/n}function Y(e,t){var r=v.get("timeStep"),i=C.getNumberOfRadialBonds(),s,o;return b||(s=Date.now(),S?(o=s-S,x.push(o),x.splice(0,x.length-128)):S=s),n.time("integration"),C.integrate(v.get("viewRefreshInterval")*r,r),n.timeEnd("integration"),n.time("reading model state"),tt(),n.timeEnd("reading model state"),n.time("tick history push"),N.push(),n.timeEnd("tick history push"),E=!0,t||m.tick(),i<C.getNumberOfRadialBonds()&&m.addRadialBond(),b}function Z(){var e,t,n=0,r=x.length;e=-1;while(++e<r)n+=x[e];return t=n/r,t?1/t*1e3:0}function et(e){var t,n=[];for(t in e)if(e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null){if(U[t])throw new Error('Attempt to set read-only output property "'+t+'".');q["set_"+t]?q["set_"+t](e[t]):q[t]=e[t],n.push(t)}J(n)}function tt(){var e,t,n;ot();for(e=0;e<R.length;e++)U[R[e]].hasCachedValue=!1;for(e=0;e<z.length;e++)W[z[e]].addSample();for(e=0;e<R.length;e++)if(n=I[R[e]])for(t=0;t<n.length;t++)n[t]()}function nt(){it()}function rt(){st(),N&&N.invalidateFollowingState(),m.invalidation()}function it(){var e,t,n,r;for(e=0;e<R.length;e++)t=R[e],(r=I[t])&&r.length>0&&(n=U[t],n.previousValue=n.hasCachedValue?n.cachedValue:n.calculate())}function st(){var e,t,n,r,i,s=[];ot();for(e=0;e<R.length;e++)n=U[R[e]],n.hasCachedValue=!1;for(e=0;e<z.length;e++)W[z[e]].addSample();for(e=0;e<R.length;e++){r=R[e],n=U[r];if((i=I[r])&&i.length>0){n.hasCachedValue||(n.cachedValue=n.calculate(),n.hasCachedValue=!0);if(n.cachedValue!==n.previousValue)for(t=0;t<i.length;t++)s.push(i[t])}n.previousValue=null}for(e=0;e<s.length;e++)s[e]()}function ot(){var e,t,n,r;C.computeOutputState(T),ut();for(e=0,n=v.get_num_atoms();e<n;e++){for(t in L)L.hasOwnProperty(t)&&(H[e][t]=L[t][e]);c.isAminoAcid(L.element[e])&&(r=c.getAminoAcidByElement(L.element[e]),H[e].symbol=r.symbol,H[e].label=r.abbreviation)}}function ut(){var e=function(){return c.isAminoAcid(this.element)},t,n;H||(H=[]);for(t=H.length,n=v.get_num_atoms();t<n;t++)H[t]||(H[t]={idx:t,isAminoAcid:e})}function at(){var e,t,n,r;for(n=C.getNumberOfElements();n<=c.lastElementID;n++)v.addElement({id:n});for(n=0,r=l.length;n<r;n++)e=18*Math.pow(l[n].volume/l[0].volume,.3333333333333),t=h.convert(e/10,{from:h.unit.ANGSTROM,to:h.unit.NANOMETER}),C.setElementProperties(c.firstElementID+n,{mass:l[n].molWeight,sigma:t})}var v={},m=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek","addAtom","removeAtom","addRadialBond","removeRadialBond","removeAngularBond","invalidation","textBoxesChanged"),g={"short":1.33,medium:1.67,"long":2},y=1e3,b=!0,w=!1,E=!1,S,x=[],T,N,C,k,L,A,O,M,D,P,H,B,j,F,I={},q={set_targetTemperature:function(e){this.targetTemperature=e,C&&C.setTargetTemperature(e)},set_temperatureControl:function(e){this.temperatureControl=e,C&&C.useThermostat(e)},set_lennardJonesForces:function(e){this.lennardJonesForces=e,C&&C.useLennardJonesInteraction(e)},set_coulombForces:function(e){this.coulombForces=e,C&&C.useCoulombInteraction(e)},set_solventForceType:function(e){this.solventForceType=e,C&&C.setSolventForceType(e)},set_solventForceFactor:function(e){this.solventForceFactor=e,C&&C.setSolventForceFactor(e)},set_additionalSolventForceMult:function(e){this.additionalSolventForceMult=e,C&&C.setAdditionalSolventForceMult(e)},set_additionalSolventForceThreshold:function(e){this.additionalSolventForceThreshold=e,C&&C.setAdditionalSolventForceThreshold(e)},set_dielectricConstant:function(e){this.dielectricConstant=e,C&&C.setDielectricConstant(e)},set_realisticDielectricEffect:function(e){this.realisticDielectricEffect=e,C&&C.setRealisticDielectricEffect(e)},set_VDWLinesCutoff:function(e){var t;this.VDWLinesCutoff=e,t=g[e],t&&C&&C.setVDWLinesRatio(t)},set_gravitationalField:function(e){this.gravitationalField=e,C&&C.setGravitationalField(e)},set_modelSampleRate:function(e){this.modelSampleRate=e,b||v.restart()},set_timeStep:function(e){this.timeStep=e},set_viscosity:function(e){this.viscosity=e,C&&C.setViscosity(e)},set_polarAAEpsilon:function(e){var t,n,r,i,s,o;this.polarAAEpsilon=e;if(C){t=c.getPolarAminoAcids();for(i=0,o=t.length;i<o;i++){n=t[i];for(s=i+1;s<o;s++)r=t[s],C.pairwiseLJProperties.set(n,r,{epsilon:e})}}}},R=[],U={},z=[],W={},X={};return v.getStats=function(){return{time:v.get("time"),speed:G(),ke:v.get("kineticEnergy"),temperature:v.get("temperature"),current_step:N.get("counter"),steps:N.get("length")-1}},v.getStatsHistory=function(e){var t,n,r,i,s,o,u=[];n=N.get("length"),arguments.length?r=Math.max(n-e,0):r=0,u.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(t=r;t<n;t++)i=N.returnTick(t),o=i.output.PE,s=i.output.KE,u.push(i.output.time+"	"+o+"	"+s+"	"+(o+s));return u.join("\n")},v.stepCounter=function(){return N.get("counter")},v.stepStartCounter=function(){return N.get("startCounter")},v.steps=function(){return N.get("length")},v.isNewStep=function(){return E},v.seek=function(e){return arguments.length||(e=0),b=!0,E=!1,N.seekExtract(e),tt(),m.seek(),N.get("counter")},v.stepBack=function(e){arguments.length||(e=1);var t,n;b=!0,E=!1,t=-1;while(++t<e)n=N.get("index"),n>0&&(N.decrementExtract(),tt(),m.stepBack());return N.get("counter")},v.stepForward=function(e){arguments.length||(e=1);var t,n,r;b=!0,t=-1;while(++t<e)n=N.get("index"),r=N.get("length"),n<r-1?(N.incrementExtract(),tt(),m.stepForward()):Y();return N.get("counter")},v.initializeEngine=function(){C=r.createEngine(),C.setSize([v.get("width"),v.get("height")]),C.useLennardJonesInteraction(v.get("lennardJonesForces")),C.useCoulombInteraction(v.get("coulombForces")),C.useThermostat(v.get("temperatureControl")),C.setViscosity(v.get("viscosity")),C.setVDWLinesRatio(g[v.get("VDWLinesCutoff")]),C.setGravitationalField(v.get("gravitationalField")),C.setTargetTemperature(v.get("targetTemperature")),C.setDielectricConstant(v.get("dielectricConstant")),C.setRealisticDielectricEffect(v.get("realisticDielectricEffect")),C.setSolventForceType(v.get("solventForceType")),C.setSolventForceFactor(v.get("solventForceFactor")),C.setAdditionalSolventForceMult(v.get("additionalSolventForceMult")),C.setAdditionalSolventForceThreshold(v.get("additionalSolventForceThreshold")),C.pairwiseLJProperties.registerChangeHooks(nt,rt),C.geneticProperties.registerChangeHooks(nt,rt),window.state=T={},L=C.atoms,A=C.elements,M=C.radialBonds,B=C.radialBondResults,D=C.angularBonds,P=C.restraints,O=C.obstacles},v.createElements=function(e){var t={},n,r;for(n=0,r=e.length;n<r;n++)t[e[n].id]=e[n];for(n=C.getNumberOfElements();n<c.firstElementID;n++)t[n]?v.addElement(t[n]):v.addElement({id:n});return v},v.createNewAtoms=function(e){return v.initializeEngine(),v.createElements(k),v.createAtoms(e),v},v.createAtoms=function(e){var t={supressCheck:!0,deserialization:!0},n,r,i,s;nt(),typeof e=="number"?r=e:e.num!=null?r=e.num:e.x&&(r=e.x.length);if(e.x&&e.y)for(n=0;n<r;n++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][n]);v.addAtom(s,t)}else{for(n=0;n<r;n++)s={x:0,y:0},v.addAtom(s,t);C.setupAtomsRandomly({temperature:v.get("targetTemperature"),userElements:k.length}),e.relax&&C.relaxToTemperature()}return rt(),m.reset(),v},v.createRadialBonds=function(e){var t={deserialization:!0},n=e.strength.length,r,i,s;nt();for(r=0;r<n;r++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][r]);v.addRadialBond(s,t)}return rt(),v},v.createAngularBonds=function(e){var t={deserialization:!0},n=e.strength.length,r,i,s;nt();for(r=0;r<n;r++){s={};for(i in e)e.hasOwnProperty(i)&&(s[i]=e[i][r]);v.addAngularBond(s,t)}return rt(),v},v.createRestraints=function(e){var t=e.atomIndex.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);v.addRestraint(i)}return v},v.createObstacles=function(e){var t=e.x.length,n,r,i;for(n=0;n<t;n++){i={};for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r][n]);v.addObstacle(i)}return v},v.reset=function(){v.resetTime(),N.restoreInitialState(),m.reset()},v.resetTime=function(){C.setTime(0)},v.getTotalMass=function(){return C.getTotalMass()},v.getAtomKineticEnergy=function(e){return C.getAtomKineticEnergy(e)},v.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*k.length)),t==null&&(t=0);var n=v.size(),r=C.getRadiusOfElement(e),i,s,o,u=0,a=10;do{i=Math.random()*n[0]-2*r,s=Math.random()*n[1]-2*r,o=C.findMinimumPELocation(e,i,s,0,0,t);if(o&&v.addAtom({element:e,x:o[0],y:o[1],charge:t}))return!0}while(++u<a);return!1},v.addAtom=function(e,t){var n=v.size(),r;return t=t||{},e=f.validateCompleteness(i.atom,e),r=C.getRadiusOfElement(e.element),e.x<r&&(e.x=r),e.x>n[0]-r&&(e.x=n[0]-r),e.y<r&&(e.y=r),e.y>n[1]-r&&(e.y=n[1]-r),!t.supressCheck&&!C.canPlaceAtom(e.element,e.x,e.y)?!1:(t.deserialization||nt(),C.addAtom(e),t.deserialization||rt(),t.supressEvent||m.addAtom(),!0)},v.removeAtom=function(e,t){var n=C.getNumberOfRadialBonds(),r=C.getNumberOfAngularBonds();t=t||{},nt(),C.removeAtom(e),H.length=0,rt(),t.supressEvent||(m.removeAtom(),C.getNumberOfRadialBonds()!==n&&m.removeRadialBond(),C.getNumberOfAngularBonds()!==r&&m.removeAngularBond())},v.addElement=function(e){e=f.validateCompleteness(i.element,e),C.addElement(e)},v.addObstacle=function(e){var t;e.color!==undefined&&e.colorR===undefined&&(e.colorR=e.color[0],e.colorG=e.color[1],e.colorB=e.color[2]),t=f.validateCompleteness(i.obstacle,e),nt(),C.addObstacle(t),rt()},v.removeObstacle=function(e){nt(),C.removeObstacle(e),rt()},v.addRadialBond=function(e,t){e=f.validateCompleteness(i.radialBond,e),(!t||!t.deserialization)&&nt(),C.addRadialBond(e),(!t||!t.deserialization)&&rt(),m.addRadialBond()},v.removeRadialBond=function(e){nt(),C.removeRadialBond(e),nt(),m.removeRadialBond()},v.addAngularBond=function(e,t){e=f.validateCompleteness(i.angularBond,e),(!t||!t.deserialization)&&nt(),C.addAngularBond(e),(!t||!t.deserialization)&&rt()},v.removeAngularBond=function(e){nt(),C.removeAngularBond(e),rt(),m.removeAngularBond()},v.addRestraint=function(e){e=f.validateCompleteness(i.restraint,e),nt(),C.addRestraint(e),rt()},v.getMoleculeBoundingBox=function(e){var t,n,r,i,s,o=-Infinity,u=Infinity,a=Infinity,f=-Infinity,l,c;t=C.getMoleculeAtoms(e),t.push(e);for(n=0;n<t.length;n++)r=L.x[t[n]],i=L.y[t[n]],s=L.radius[t[n]],r-s<u&&(u=r-s),r+s>f&&(f=r+s),i-s<a&&(a=i-s),i+s>o&&(o=i+s);return l=L.x[e],c=L.y[e],{top:o-c,left:u-l,bottom:a-c,right:f-l}},v.setAtomProperties=function(e,t,n,r){var s,o,u,a,l,c,h;t=f.validate(i.atom,t);if(r){s=C.getMoleculeAtoms(e);if(s.length>0){o=typeof t.x=="number"?t.x-L.x[e]:0,u=typeof t.y=="number"?t.y-L.y[e]:0;for(c=0,h=s.length;c<h;c++){a=L.x[s[c]]+o,l=L.y[s[c]]+u;if(!v.setAtomProperties(s[c],{x:a,y:l},n,!1))return!1}}}if(n){var p=typeof t.x=="number"?t.x:L.x[e],d=typeof t.y=="number"?t.y:L.y[e],m=typeof t.element=="number"?t.y:L.element[e];if(!C.canPlaceAtom(m,p,d,e))return!1}return nt(),C.setAtomProperties(e,t),rt(),!0},v.getAtomProperties=function(e){var t=i.atom,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=L[r][e]);return n},v.setElementProperties=function(e,t){t=f.validate(i.element,t);if(c.isAminoAcid(e))throw new Error("Elements: elements with ID "+e+" cannot be edited, as they define amino acids.");nt(),C.setElementProperties(e,t),rt()},v.getElementProperties=function(e){var t=i.element,n={},r;for(r in t)r==="id"?n.id=e:t.hasOwnProperty(r)&&(n[r]=A[r][e]);return n},v.setObstacleProperties=function(e,t){t=f.validate(i.obstacle,t),nt(),C.setObstacleProperties(e,t),rt()},v.getObstacleProperties=function(e){var t=i.obstacle,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=O[r][e]);return n},v.setRadialBondProperties=function(e,t){t=f.validate(i.radialBond,t),nt(),C.setRadialBondProperties(e,t),rt()},v.getRadialBondProperties=function(e){var t=i.radialBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=M[r][e]);return n},v.setRestraintProperties=function(e,t){t=f.validate(i.restraint,t),nt(),C.setRestraintProperties(e,t),rt()},v.getRestraintProperties=function(e){var t=i.restraint,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=P[r][e]);return n},v.setAngularBondProperties=function(e,t){t=f.validate(i.angularBond,t),nt(),C.setAngularBondProperties(e,t),rt()},v.getAngularBondProperties=function(e){var t=i.angularBond,n={},r;for(r in t)t.hasOwnProperty(r)&&(n[r]=D[r][e]);return n},v.setSolvent=function(e){var t=new u(e),n={solventForceType:t.forceType,dielectricConstant:t.dielectricConstant,backgroundColor:t.color};v.set(n)},v.addSpringForce=function(e,t,n,r){return r==null&&(r=500),C.addSpringForce(e,t,n,r)},v.updateSpringForce=function(e,t,n){C.updateSpringForce(e,t,n)},v.removeSpringForce=function(e){C.removeSpringForce(e)},v.addTextBox=function(e){e=f.validateCompleteness(i.textBox,e),q.textBoxes.push(e),m.textBoxesChanged()},v.removeTextBox=function(e){var t=q.textBoxes;if(!(e>=0&&e<t.length))throw new Error('Text box "'+e+'" does not exist, so it cannot be removed.');q.textBoxes=t.slice(0,e).concat(t.slice(e+1)),m.textBoxesChanged()},v.setTextBoxProperties=function(e,t){var n=q.textBoxes[e];if(!n)throw new Error('Text box "'+e+'" does not exist, so it cannot have properties set.');t=f.validate(i.textBox,t);for(prop in t)n[prop]=t[prop];m.textBoxesChanged()},v.liveDragStart=function(e,t,n){t==null&&(t=L.x[e]),n==null&&(n=L.y[e]),F=v.getAtomProperties(e).friction,v.setAtomProperties(e,{friction:v.LIVE_DRAG_FRICTION}),j=v.addSpringForce(e,t,n,500)},v.liveDrag=function(e,t){v.updateSpringForce(j,e,t)},v.liveDragEnd=function(){var e=C.springForceAtomIndex(j);v.setAtomProperties(e,{friction:F}),v.removeSpringForce(j)},v.get_speed=function(){return t.copy(C.atoms.speed,[])},v.get_rate=function(){return Z()},v.is_stopped=function(){return b},v.get_atoms=function(){return L},v.get_results=function(){return H},v.get_radial_bond_results=function(){return B},v.get_num_atoms=function(){return C.getNumberOfAtoms()},v.get_obstacles=function(){return O},v.getNumberOfElements=function(){return C.getNumberOfElements()},v.getNumberOfObstacles=function(){return C.getNumberOfObstacles()},v.getNumberOfRadialBonds=function(){return C.getNumberOfRadialBonds()},v.getNumberOfAngularBonds=function(){return C.getNumberOfAngularBonds()},v.get_radial_bonds=function(){return M},v.get_restraints=function(){return P},v.getPairwiseLJProperties=function(){return C.pairwiseLJProperties},v.getGeneticProperties=function(){return C.geneticProperties},v.get_vdw_pairs=function(){return C.getVdwPairsArray()},v.on=function(e,t){return m.on(e,t),v},v.tickInPlace=function(){return m.tick(),v},v.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)Y(null,n);return v},v.relax=function(){return C.relaxToTemperature(),v},v.minimizeEnergy=function(){return nt(),C.minimizeEnergy(),rt(),v},v.generateProtein=function(e,t){var n;return nt(),n=C.generateProtein(e,t),H.length=0,rt(),m.addAtom(),n},v.start=function(){return v.resume()},v.restart=function(){w=!0},v.resume=function(){return n.time("gap between frames"),v.timer(function(t){return n.timeEnd("gap between frames"),b?!0:w?(setTimeout(v.resume,0),!0):(Y(t,!1),n.time("gap between frames"),!1)}),w=!1,b&&(b=!1,m.play()),v},v.timer=function(e){var t,n=v.get("modelSampleRate");n==="default"?d3.timer(e):t=window.setInterval(function(){e()&&window.clearInterval(t)},1e3/n)},v.stop=function(){return b=!0,m.stop(),v},v.ave_ke=function(){return T.KE/v.get_num_atoms()},v.ave_pe=function(){return T.PE/v.get_num_atoms()},v.speed=function(){return G()},v.size=function(e){return arguments.length?(C.setSize(e),v):C.getSize()},v.set=function(e){f.validate(i.mainProperties,e),f.validate(i.modelViewProperties,e),C&&nt(),et(e),C&&rt()},v.get=function(e){var t;if(q.hasOwnProperty(e))return q[e];if(t=U[e])return t.hasCachedValue?t.cachedValue:(t.hasCachedValue=!0,t.cachedValue=t.calculate(),t.cachedValue)},v.addPropertiesListener=function(e,t){function r(e){I[e]||(I[e]=[]),I[e].push(t)}var n;if(typeof e=="string")r(e);else for(n=0;n<e.length;n++)r(e[n])},v.defineOutput=function(e,t,n){R.push(e),U[e]={description:t,calculate:n,hasCachedValue:!1,previousValue:null}},v.defineFilteredOutput=function(e,t,n,r,i){var s,u;if(r!=="RunningAverage")throw new Error("FilteredOutput: unknown filter type "+r+".");s=new o(i),u=v.get(n);if(u===undefined||isNaN(Number(u)))throw new Error("FilteredOutput: property is not a valid numeric value or it is undefined.");s.addSample(v.get("time"),u),z.push(e),W[e]={addSample:function(){s.addSample(v.get("time"),v.get(n))}},N.registerExternalObject({push:function(){},extract:function(e){s.setCurrentStep(e)},invalidate:function(e){s.invalidate(e)},setHistoryLength:function(e){s.setMaxBufferLength(e)}}),t.property=n,t.type=r,t.period=i,v.defineOutput(e,t,function(){return s.calculate()})},v.defineParameter=function(e,t,n){X[e]={description:t,setter:n,isDefined:!1},q["set_"+e]=function(t){q[e]=t,X[e].isDefined=!0,X[e].setter.call(v,t)}},v.getPropertyDescription=function(e){var t=U[e]||X[e];if(t)return p.extend({},t.description)},v.serialize=function(e){var t=$.extend({},q);return e&&(t.atoms=a(i.atom,L,C.getNumberOfAtoms())),k&&(t.editableElements=k),t.width=v.get("width"),t.height=v.get("height"),t},v.LIVE_DRAG_FRICTION=10,v.defineOutput("time",{label:"Time",units:"fs"},function(){return T.time}),v.defineOutput("kineticEnergy",{label:"Kinetic Energy",units:"eV"},function(){return T.KE}),v.defineOutput("potentialEnergy",{label:"Potential Energy",units:"eV"},function(){return T.PE}),v.defineOutput("totalEnergy",{label:"Total Energy",units:"eV"},function(){return T.KE+T.PE}),v.defineOutput("temperature",{label:"Temperature",units:"K"},function(){return T.temperature}),et(f.validateCompleteness(i.mainProperties,d)),et(f.validateCompleteness(i.modelViewProperties,d.viewOptions||{})),v.initializeEngine(),d.elements?k=d.elements:k=[{}],v.createElements(k),at(),v.set({polarAAEpsilon:v.get("polarAAEpsilon")}),d.atoms?v.createAtoms(d.atoms):d.mol_number&&(v.createAtoms(d.mol_number),d.relax&&v.relax()),d.radialBonds&&v.createRadialBonds(d.radialBonds),d.angularBonds&&v.createAngularBonds(d.angularBonds),d.restraints&&v.createRestraints(d.restraints),d.obstacles&&v.createObstacles(d.obstacles),d.pairwiseLJProperties&&C.pairwiseLJProperties.deserialize(d.pairwiseLJProperties),d.geneticProperties&&C.geneticProperties.deserialize(d.geneticProperties),N=new s({input:["targetTemperature","lennardJonesForces","coulombForces","temperatureControl","keShading","chargeShading","showVDWLines","showVelocityVectors","showForceVectors","showClock","viewRefreshInterval","timeStep","viscosity","gravitationalField"],restoreProperties:K,parameters:X,restoreParameters:Q,state:C.getState()},v,y),E=!0,tt(),v}}),function(){n("cs!common/components/model_controller_component",["require","common/console"],function(e){var t,n;return n=e("common/console"),t=function(){function e(e,t,n,r,i){var s=this;this.svg_element=e,this.playable=t!=null?t:null,this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view(),this.setup_buttons(),this.playable.isPlaying()?this.hide(this.play):this.hide(this.stop),model.on("play",function(){return s.update_ui()}),model.on("stop",function(){return s.update_ui()})}return e.prototype.offset=function(e){return e*this.unit_width*2+this.unit_width},e.prototype.setup_buttons=function(){},e.prototype.make_button=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this;t=e.action,u=e.offset,h=e.type,f=e.point_set,h==null&&(h="svg:polyline"),f==null&&(f=this.icon_shapes[t]),u=this.offset(u),s=this.group.append("svg:g"),s.attr("class","component playbacksvgbutton").attr("x",u).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),i=s.append("rect"),i.attr("class","bg").attr("x",u).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(v=0,g=f.length;v<g;v++){l=f[v],n=s.append(h),n.attr("class",""+t+" button-art"),c="";for(m=0,y=l.length;m<y;m++)a=l[m],p=u+10+a.x*this.unit_width,d=this.vertical_padding/.75+a.y*this.unit_width,c+=" "+p+","+d,n.attr("points",c);t==="stop"&&(r=s.append("rect"),r.attr("class","pause-center").attr("x",p+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return o=s.append("rect"),o.attr("class","highlight").attr("x",u+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),s.on("click",function(){return b.action(t)}),s},e.prototype.action=function(e){n.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"seek":this.playable.seek(1);break;case"reset":this.playable.reset();break;default:n.log("cant find action for "+e)}else n.log("no @playable defined");return this.update_ui()},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component model-controller playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.isPlaying()?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e.prototype.icon_shapes={play:[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],stop:[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],reset:[[{x:1,y:0},{x:.3,y:.5},{x:1,y:1}],[{x:0,y:0},{x:.3,y:0},{x:.3,y:1},{x:0,y:1},{x:0,y:0}]],back:[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],forward:[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]]},e}()})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/play_reset_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.play=this.make_button({action:"play",offset:1}),this.stop=this.make_button({action:"stop",offset:1})},n}(n)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/play_only_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.play=this.make_button({action:"play",offset:0}),this.stop=this.make_button({action:"stop",offset:0})},n}(n)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};n("cs!common/components/playback_svg",["require","cs!common/components/model_controller_component"],function(e){var n,r;return n=e("cs!common/components/model_controller_component"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.back=this.make_button({action:"back",offset:1}),this.play=this.make_button({action:"play",offset:2}),this.stop=this.make_button({action:"stop",offset:2}),this.forward=this.make_button({action:"forward",offset:3})},n}(n)})}.call(this),function(){n("cs!md2d/views/aminoacid-context-menu",["require","cs!md2d/models/aminoacids-helper"],function(e){var t,n,r,i,s,o,u,a,f,l;return f=e("cs!md2d/models/aminoacids-helper"),o="aminoacids-menu",i="hydrophobic",r="hydrophobic-category",n="hydrophilic",t="hydrophilic-category",a="pos-charge",u="neg-charge",s="marked",l=function(e,s){var o;return o={show:s?"slideDown":"show",hide:s?"slideUp":"hide"},e==="hydrophobic"?($("."+i)[o.show](),$("."+n)[o.hide](),$("."+r).addClass("expanded"),$("."+t).removeClass("expanded")):($("."+i)[o.hide](),$("."+n)[o.show](),$("."+r).removeClass("expanded"),$("."+t).addClass("expanded"))},{register:function(e,c,h){return $.contextMenu("destroy",h),$.contextMenu({selector:h,className:o,animation:{show:"show",hide:"hide"},callback:function(t,n){var r,i,o;return o=d3.select(n.$trigger[0]).datum(),i=f.getAminoAcidByElement(o.element).abbreviation,n.items[i].$node.removeClass(s),r=f.abbrToElement(t),e.setAtomProperties(o.idx,{element:r}),c.setupDrawables()},position:function(e,t,n){var r,i,s,o,u,a,f;r=$(window);if(!t&&!n){e.determinePosition.call(this,e.$menu);return}return t==="maintain"&&n==="maintain"?o=e.$menu.position():(a=e.$trigger.parents().andSelf().filter(function(){return $(this).css("position")==="fixed"}).length,a&&(n-=r.scrollTop(),t-=r.scrollLeft()),o={top:n,left:t}),i=r.scrollTop()+r.height(),u=r.scrollLeft()+r.width(),s=e.$menu[0].scrollHeight,f=e.$menu[0].scrollWidth,o.top+s>i&&(o.top-=s),o.left+f>u&&(o.left-=f),o.left+=1,e.$menu.css(o)},events:{show:function(e){var t,n,r;return r=d3.select(e.$trigger[0]).datum(),n=f.getAminoAcidByElement(r.element).abbreviation,t=e.items[n].$node,t.addClass(s),t.hasClass(i)?l("hydrophobic"):l("hydrophilic"),!0},hide:function(e){var t,n;return n=d3.select(e.$trigger[0]).datum(),t=f.getAminoAcidByElement(n.element).abbreviation,e.items[t].$node.removeClass(s),!0}},items:{Hydrophobic:{name:"Hydrophobic",className:""+r,callback:function(){return l("hydrophobic",!0),!1}},Gly:{name:"Glycine",className:""+i},Ala:{name:"Alanine",className:""+i},Val:{name:"Valine",className:""+i},Leu:{name:"Leucine",className:""+i},Ile:{name:"Isoleucine",className:""+i},Phe:{name:"Phenylalanine",className:""+i},Pro:{name:"Proline",className:""+i},Trp:{name:"Tryptophan",className:""+i},Met:{name:"Methionine",className:""+i},Cys:{name:"Cysteine",className:""+i},Tyr:{name:"Tyrosine",className:""+i},Hydrophilic:{name:"Hydrophilic",className:""+t,callback:function(){return l("hydrophilic",!0),!1}},Asn:{name:"Asparagine",className:""+n},Gln:{name:"Glutamine",className:""+n},Ser:{name:"Serine",className:""+n},Thr:{name:"Threonine",className:""+n},Asp:{name:"Asparticacid",className:""+n+" "+u},Glu:{name:"Glutamicacid",className:""+n+" "+u},Lys:{name:"Lysine",className:""+n+" "+a},Arg:{name:"Arginine",className:""+n+" "+a},His:{name:"Histidine",className:""+n+" "+a}}}),l("hydrophobic")}}})}.call(this),n("md2d/views/genetic-renderer",["require"],function(e){return function(t,n,r){var i,s,o,u=function(){s=n.nm2px,o=n.nm2pxInv,r.getGeneticProperties().on("change",i.setup)},a=function(e,t,n,r){n+="px",e.append("text").text(t).attr({"class":"shadow",dy:r}).style({"stroke-width":s(.01),"font-size":n}),e.append("text").text(t).attr({"class":"front",dy:r}).style("font-size",n)};return i={setup:function(){var e=r.getGeneticProperties().get(),n,i;if(e===undefined)return;t.selectAll("g.dna").remove(),n=t.append("g").attr({"class":"dna",transform:"translate("+s(e.x)+","+o(e.y)+")"}),i=s(e.height),a(n,e.DNA,i,-i),a(n,e.DNAComplement,i,0),e.mRNA!==undefined&&a(n,e.mRNA,i,-2.5*i)}},u(),i}}),n("md2d/views/meta-view-options",[],function(){return{fit_to_parent:{defaultValue:!1},title:{defaultValue:!1},xlabel:{defaultValue:!1},ylabel:{defaultValue:!1},controlButtons:{defaultValue:"play"},grid_lines:{defaultValue:!1},xunits:{defaultValue:!1},yunits:{defaultValue:!1},atom_mubers:{defaultValue:!1},enableAtomTooltips:{defaultValue:!1},enableKeyboardHandlers:{defaultValue:!0},atomTraceColor:{defaultValue:"#6913c5"},interactiveUrl:{defaultValue:""},velocityVectors:{defaultValue:{color:"#000",width:.01,length:2}},forceVectors:{defaultValue:{color:"#169C30",width:.01,length:2}},textBoxes:{},images:{},imageMapping:{}}}),function(){n("cs!common/layout/wrap-svg-text",["require"],function(e){var t,n;return t="http://www.w3.org/2000/svg",n=window.wrapSVGText=function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;f=/-/gi,a=function(){var t;t=[];while(d=f.exec(e))t.push(d.index);return t}(),w=e.split(/[\s-]/),u=0,o=0,p=1,y=0,r===-1&&(r=Infinity);for(l=E=0,S=w.length;E<S;l=++E)b=w[l],u+=b.length+1,o>r||l===0?(l>0&&(v=g.firstChild.nodeValue,v.length>w[l-1].length+1?(c=v.slice(v.length-w[l-1].length-1),g.firstChild.nodeValue=v.slice(0,v.length-w[l-1].length-1)):v.length===w[l-1].length+1&&(g.firstChild.nodeValue=v.slice(0,v.length-1)),y=Math.max(g.getComputedTextLength(),y),p++),g=document.createElementNS(t,"tspan"),g.setAttributeNS(null,"x",i),g.setAttributeNS(null,"dy",l===0?0:s),m=document.createTextNode(h),g.appendChild(m),n.appendChild(g),~a.indexOf(u-1)?h=b+"-":h=b+" ",l&&c&&(h=c+h)):~a.indexOf(u-1)?h+=b+"-":h+=b+" ",g.firstChild.nodeValue=h,o=g.getComputedTextLength(),l&&l===w.length-1&&o>r&&(v=g.firstChild.nodeValue,g.firstChild.nodeValue=v.slice(0,v.length-w[l].length-1),g=document.createElementNS(t,"tspan"),g.setAttributeNS(null,"x",i),g.setAttributeNS(null,"dy",s),m=document.createTextNode(w[l]),g.appendChild(m),n.appendChild(g),p++);return y===0&&(y=n.childNodes[0].getComputedTextLength()),{lines:p,width:y}}})}.call(this),n("md2d/views/molecule-container",["require","common/console","cs!common/components/play_reset_svg","cs!common/components/play_only_svg","cs!common/components/playback_svg","cs!md2d/views/aminoacid-context-menu","md2d/views/genetic-renderer","md2d/views/meta-view-options","common/layout/layout","cs!common/layout/wrap-svg-text","common/validator"],function(e){var t=e("common/console"),n=e("cs!common/components/play_reset_svg"),r=e("cs!common/components/play_only_svg"),i=e("cs!common/components/playback_svg"),s=e("cs!md2d/views/aminoacid-context-menu"),o=e("md2d/views/genetic-renderer"),u=e("md2d/views/meta-view-options"),a=e("common/layout/layout"),f=e("cs!common/layout/wrap-svg-text"),l=e("common/validator"),c={STANDARD_STICK:101,LONG_SPRING:102,BOND_SOLID_LINE:103,GHOST:104,UNICOLOR_STICK:105,SHORT_SPRING:106,DOUBLE_BOND:107,TRIPLE_BOND:108,DISULPHIDE_BOND:109};return function(h,p,d){function $t(e,t){p=e||p,d=t||d,lt=d.get_results(),Wt=l.validateCompleteness(u,p),Pt=Wt.images||[],Wt.imageMapping=Wt.imageMapping||{},Wt.interactiveUrl&&(jt=Wt.interactiveUrl,Ft=ACTUAL_ROOT+jt.slice(0,jt.lastIndexOf("/")+1)),Nt=Wt.velocityVectors.color,Ct=Wt.velocityVectors.width,kt=Wt.velocityVectors.length,At=Wt.forceVectors.color,Ot=Wt.forceVectors.width,Mt=Wt.forceVectors.length,Rt=Wt.atomTraceColor}function Jt(e,t){var n=d.size(),r=n[0]/n[1];x=a.screen_factor,A={top:Wt.title?40*a.screen_factor:20,right:25,bottom:10,left:Wt.ylabel?60*a.screen_factor:25},Wt.xlabel&&(A.bottom+=35*x),Wt.controlButtons?A.bottom+=40*x:A.bottom+=15*x,Wt.fit_to_parent?(b=500,E=b-A.left-A.right,S=E/r,w=S+A.top+A.bottom):arguments.length?(E=e,S=t,b=E+A.left+A.right,w=S+A.top+A.bottom,g.style.height=w+"px",g.style.width=b+"px"):(w=m.property("clientHeight"),S=w-A.top-A.bottom,E=S*r,b=E+A.left+A.right,g.style.width=b+"px"),O={width:E,height:S},M={width:n[0],height:n[1]},it=g.offsetTop+A.top,rt=g.offsetLeft+A.left;switch(
Wt.controlButtons){case"play":H=A.left+(O.width-75*x)/2;break;case"play_reset":H=A.left+(O.width-140*x)/2;break;case"play_reset_step":H=A.left+(O.width-230*x)/2;break;default:H=A.left+(O.width-230*x)/2}return B=w-42*x,q=d3.scale.linear().domain([0,M.width]).range([0,O.width]),R=d3.scale.linear().domain([M.height,0]).range([0,O.height]),_=null,[b,w,E,S]}function Kt(){return F+j(d.get("time"))+I}function Qt(e,t,n,r,i){return d.setAtomProperties(e,{x:t,y:n},r,i)}function Gt(e){return"rgb("+dt.colorR[e]+","+dt.colorG[e]+","+dt.colorB[e]+")"}function Yt(){var e=function(e){return"translate("+q(e)+",0)"},t=function(e){return"translate(0,"+R(e)+")"},n=function(e){return e?"#ccc":"#666"},r=q.tickFormat(10),i=R.tickFormat(10);d3.event&&d3.event.transform&&d3.event.transform(q,R);if(Wt.xunits){var s=N.selectAll("g.x").data(q.ticks(10),String).attr("transform",e);s.select("text").text(r);var o=s.enter().insert("svg:g","a").attr("class","x").attr("transform",e);Wt.grid_lines&&o.append("svg:line").attr("stroke",n).attr("y1",0).attr("y2",O.height),o.append("svg:text").attr("y",O.height).attr("dy","1em").attr("text-anchor","middle").text(r),s.exit().remove()}if(Wt.xunits){var u=N.selectAll("g.y").data(R.ticks(10),String).attr("transform",t);u.select("text").text(i);var a=u.enter().insert("svg:g","a").attr("class","y").attr("transform",t).attr("background-fill","#FFEEB6");Wt.grid_lines&&a.append("svg:line").attr("stroke",n).attr("x1",0).attr("x2",O.width),a.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(i),wt&&L.text(Kt()),u.exit().remove()}}function Zt(){var e=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#F2F2F2","#FF8080"]),t=d3.scale.linear().interpolate(d3.interpolateRgb).range(["#A4A4A4","#FF2020"]),n,r,i;en("neg-grad","#ffefff","#fdadad","#e95e5e",z),en("pos-grad","#dfffff","#9abeff","#767fbf",z),en("neutral-grad","#FFFFFF","#f2f2f2","#A4A4A4",z),en("mark-grad","#fceabb","#fccd4d","#f8b500",z),en("green-grad","#dfffef","#75a643","#2a7216",z),en("purple-grad","#EED3F0","#D941E0","#84198A",z),en("aqua-grad","#DCF5F4","#41E0D8","#12827C",z),en("orange-grad","#F0E6D1","#E0A21B","#AD7F1C",z);for(i=0;i<Z;i++)n="ke-shading-"+i,r=i/Z,en(n,"#FFFFFF",e(r),t(r),z),Y[i]="url(#"+n+")";G=["url(#green-grad)","url(#purple-grad)","url(#aqua-grad)","url(#orange-grad)"]}function en(e,t,n,r,i){var s=i.append("defs").append("radialGradient").attr("id",e).attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%");s.append("stop").attr("stop-color",t).attr("offset","0%"),s.append("stop").attr("stop-color",n).attr("offset","40%"),s.append("stop").attr("stop-color",r).attr("offset","80%"),s.append("stop").attr("stop-color",n).attr("offset","100%"),tt["url(#"+e+")"]=r}function tn(e,t){var n=z.append("defs").append("marker").attr("id","Triangle-"+t).attr("viewBox","0 0 10 10").attr("refX","0").attr("refY","5").attr("markerUnits","strokeWidth").attr("markerWidth","4").attr("markerHeight","3").attr("orient","auto").attr("stroke",e).attr("fill",e);n.append("path").attr("d","M 0 0 L 10 5 L 0 10 z")}function nn(e){var t,n,r;if(e.marked)return"url(#mark-grad)";if(St)return t=d.getAtomKineticEnergy(e.idx),n=Math.min(5*t,1),Y[Math.round(n*(Z-1))];if(Et)return r=e.charge,r===0?"url(#neutral-grad)":r>0?"url(#pos-grad)":"url(#neg-grad)";if(!e.isAminoAcid())return G[e.element%4];switch(d.get("aminoAcidColorScheme")){case"none":return"url(#neutral-grad)";case"hydrophobicity":return e.hydrophobicity>0?"url(#orange-grad)":"url(#green-grad)";case"charge":if(e.charge===0)return"url(#neutral-grad)";return e.charge>0?"url(#pos-grad)":"url(#neg-grad)";case"chargeAndHydro":if(e.charge<-0.000001)return"url(#neg-grad)";if(e.charge>1e-6)return"url(#pos-grad)";return e.hydrophobicity>0?"url(#orange-grad)":"url(#green-grad)";default:throw new Error("MoleculeContainer: unknown amino acid color scheme.")}}function rn(e){return vn(e)?"#888":tt[et[e.atom1]]}function sn(e){return vn(e)?"#888":tt[et[e.atom2]]}function on(){var e="1%";N.append("image").attr({id:"heat-bath",x:e,width:"3%",height:"3%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/heatbath.gif"}),N.append("image").attr({id:"ke-gradient",x:e,width:"12%",height:"12%",preserveAspectRatio:"xMinYMin","xlink:href":"../../resources/ke-gradient.png"})}function un(){var e=d.get("temperatureControl"),t,n,r=0,i=1;e?(r+=i,t=d3.select("#heat-bath").attr("y",r+"%").style("display",""),n=t.attr("height"),n=Number(n.substring(0,n.length-1)),r+=n):d3.select("#heat-bath").style("display","none"),St?(r+=i,d3.select("#ke-gradient").attr("y",r+"%").style("display","")):d3.select("#ke-gradient").style("display","none")}function an(){N.selectAll("circle").data(lt).attr("r",function(e){return q(e.radius)})}function fn(){st.enter().append("circle").attr({"class":function(e){return e.isAminoAcid()?"draggable amino-acid":"draggable"},r:function(e){return q(e.radius)},cx:function(e){return q(e.x)},cy:function(e){return R(e.y)}}).style({"fill-opacity":function(e){return e.visible},fill:function(e,t){return et[t]}}).on("mousedown",Fn).on("mouseover",jn).on("mouseout",qn).call(d3.behavior.drag().on("dragstart",Yn).on("drag",nr).on("dragend",ir))}function ln(e,t,n,r,i){e.enter().append("path").attr({"class":"vector-"+i,"marker-end":"url(#Triangle-"+i+")",d:t}).style({"stroke-width":n,stroke:r,fill:"none"})}function cn(){Ut.enter().append("path").attr({"class":"atomTrace",d:Jn}).style({"stroke-width":q(.01),stroke:Rt,fill:"none","stroke-dasharray":"6, 6"})}function hn(){var e=pt.enter().append("g");e.attr("class","obstacle").attr("transform",function(e,t){return"translate("+q(dt.x[t])+" "+R(dt.y[t]+dt.height[t])+")"}),e.append("rect").attr({"class":"obstacle-shape",x:0,y:0,width:function(e,t){return q(dt.width[t])},height:function(e,t){return q(dt.height[t])}}).style({fill:function(e,t){return dt.visible[t]?Gt(t):"rgba(128,128,128, 0)"},"stroke-width":function(e,t){return dt.visible[t]?.2:0},stroke:function(e,t){return dt.visible[t]?Gt(t):"rgba(128,128,128, 0)"}}),e.each(function(e,t){if(!dt.externalFx[t]&&!dt.externalFy[t])return;var n=d3.select(this),r=dt.height[t],i=dt.width[t],s=dt.externalFx[t],o=dt.externalFy[t],u=.06,a=.06,f,l;s&&(f=(r-2*a)/Math.round((r-2*a)/.2),l=d3.range(a,r,f),n.selectAll("path.obstacle-force-hor").data(l).enter().append("path").attr({"class":"obstacle-force-hor",d:function(e){return s<0?"M "+q(i+u+a)+","+q(e)+" L "+q(i+a)+","+q(e):"M "+q(-u-a)+","+q(e)+" L "+q(-a)+","+q(e)}})),o&&(f=(i-2*a)/Math.round((i-2*a)/.2),l=d3.range(a,i,f),n.selectAll("path.obstacle-force-vert").data(l).enter().append("path").attr({"class":"obstacle-force-vert",d:function(e){return o<0?"M "+q(e)+","+q(-u-a)+" L "+q(e)+","+q(-a):"M "+q(e)+","+q(r+u+a)+" L "+q(e)+","+q(r+a)}})),n.selectAll("path.obstacle-force-hor, path.obstacle-force-vert").attr({"marker-end":"url(#Triangle-"+Vt+")"}).style({"stroke-width":q(Ot),stroke:At,fill:"none"})})}function pn(){mt.enter().append("path").attr("d",function(e){return dn(e,1)}).classed("radialbond1",!0).classed("disulphideBond",function(e){return e.type===c.DISULPHIDE_BOND}).style("stroke-width",function(e){return vn(e)?Math.log(e.strength)/4+q(.005):q(Math.min(lt[e.atom1].radius,lt[e.atom2].radius))*.75}).style("stroke",rn).style("fill","none"),gt.enter().append("path").attr("d",function(e){return dn(e,2)}).classed("radialbond2",!0).classed("disulphideBond",function(e){return e.type===c.DISULPHIDE_BOND}).style("stroke-width",function(e){return vn(e)?Math.log(e.strength)/4+q(.005):q(Math.min(lt[e.atom1].radius,lt[e.atom2].radius))*.75}).style("stroke",sn).style("fill","none")}function dn(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;u=q(e.x1),f=R(e.y1),a=q(e.x2),l=R(e.y2),s=a-u,o=l-f,E=e.strength,w=Math.sqrt(s*s+o*o)/q(.01),S=Math.floor(e.length*24),x=w/S,y=s/w,b=o/w,T=y*x,N=b*x,C=y*S,k=b*S,c=q(lt[e.atom1].radius)*y,h=q(lt[e.atom2].radius)*y,d=q(lt[e.atom1].radius)*b,v=q(lt[e.atom2].radius)*b,p=c-h,m=d-v;if(vn(e)){g="M "+u+","+f+" ";for(i=0;i<S;i++)i%2===0?(n=u+(i+.5)*T-.5*k,r=f+(i+.5)*N+.5*C):(n=u+(i+.5)*T+.5*k,r=f+(i+.5)*N-.5*C),g+=" L "+n+","+r;return g+=" L "+a+","+l}return t===1?"M "+u+","+f+" L "+(a+u+p)/2+" , "+(l+f+m)/2:"M "+(a+u+p)/2+" , "+(l+f+m)/2+" L "+a+","+l}function vn(e){return e.type===c.SHORT_SPRING}function mn(){bt.attr({x1:function(e){return q(lt[e[0]].x)},y1:function(e){return R(lt[e[0]].y)},x2:function(e){return q(lt[e[1]].x)},y2:function(e){return R(lt[e[1]].y)}}),bt.enter().append("line").attr({"class":"attractionforce",x1:function(e){return q(lt[e[0]].x)},y1:function(e){return R(lt[e[0]].y)},x2:function(e){return q(lt[e[1]].x)},y2:function(e){return R(lt[e[1]].y)}}).style({"stroke-width":q(.02),"stroke-dasharray":q(.03)+" "+q(.02)}),bt.exit().remove()}function gn(e){return Ft+(Wt.imageMapping[e.imageUri]||e.imageUri)}function yn(){var e=[],t,n,r,i,s,o,u,a,f;J.selectAll("image").remove(),V.selectAll("image").remove();if(!Pt)return;for(f=0;f<Pt.length;f++)e[f]=new Image,e[f].src=gn(Pt[f]),e[f].onload=function(f){return function(){J.selectAll("image.image_attach"+f).remove(),V.selectAll("image.image_attach"+f).remove(),r=lt[Pt[f].imageHostIndex],i=Pt[f].imageHostType,s=Pt[f].imageLayer,o=q(Pt[f].imageX),u=R(Pt[f].imageY),Ht[f]=[.01*e[f].width,.01*e[f].height],n=q(Ht[f][0]),t=q(Ht[f][1]),a=s===1?J:V,a.append("image").attr("x",function(){return i===""?o:q(r.x)-n/2}).attr("y",function(){return i===""?u:R(r.y)-t/2}).attr("class","image_attach"+f+" draggable").attr("xlink:href",e[f].src).attr("width",n).attr("height",t).attr("pointer-events","none")}}(f)}function bn(e,t){var n,r,i,s;return e.hostType?e.hostType==="Atom"?(n=lt[e.hostIndex].x,r=lt[e.hostIndex].y):(n=dt.x[e.hostIndex]+dt.width[e.hostIndex]/2,r=dt.y[e.hostIndex]+dt.height[e.hostIndex]/2):(n=e.x,r=e.y),i=n-.1,s=r+.15,[q(n),R(r),q(i),R(s)]}function wn(){var e=[Q,K],t;t=function(t){var n=e[t-1];layerTextBoxes=Bt.filter(function(e){return e.layer==t}),n.selectAll("g.textBoxWrapper rect").data(layerTextBoxes.filter(function(e){return e.frame})).attr({x:function(e,t){return bn(e,t)[2]},y:function(e,t){return bn(e,t)[3]}}),n.selectAll("g.textBoxWrapper text").data(layerTextBoxes).attr({y:function(e,t){return $(this).find("tspan").attr("x",bn(e,t)[0]),bn(e,t)[1]}})},t(1),t(2)}function En(){var e,n,r;Bt=d.get("textBoxes")||[],e=d.size(),n=[Q,K],r=function(r){var i=n[r-1],s,o,u;i.selectAll("g.textBoxWrapper").remove(),o=Bt.filter(function(e){return e.layer==r}),u=i.selectAll("g.textBoxWrapper").data(o),s=u.enter().append("svg:g").attr("class","textBoxWrapper"),s.filter(function(e){return e.frame}).append("rect").attr({"class":function(e,t){return"textBoxFrame text-"+t},style:function(e){var t=e.backgroundColor||"white";return"fill:"+t+";opacity:1.0;fill-opacity:1;stroke:#000000;stroke-width:0.5;stroke-opacity:1"},width:0,height:0,rx:function(e){return e.frame=="rounded rectangle"?8:0},ry:function(e){return e.frame=="rounded rectangle"?10:0},x:function(e,t){return bn(e,t)[2]},y:function(e,t){return bn(e,t)[3]}}),s.append("text").attr({"class":function(){return"textBox"+(AUTHORING?" draggable":"")},"x-data":function(e,t){return bn(e,t)[0]},y:function(e,t){return bn(e,t)[1]},"width-data":function(e){return q(e.width)},width:q(e[0]),height:q(e[1]),"xml:space":"preserve","font-family":"'Open Sans', sans-serif","font-size":q(.12),fill:function(e){return e.color||"black"},"text-data":function(e){return e.text},"text-anchor":function(e){var t=e.textAlign||"left";return t==="center"&&(t="middle"),t},"has-host":function(e){return!!e.hostType}}).call(d3.behavior.drag().on("drag",rr).on("dragend",function(e){t.log('"x": '+e.x+","),t.log('"y": '+e.y+",")})),u.exit().remove()},r(1),r(2),$(".textBox").each(function(){var e=this.getAttributeNS(null,"text-data"),t=this.getAttributeNS(null,"x-data"),n=this.getAttributeNS(null,"width-data")||-1,r=q(.16),i=this.getAttributeNS(null,"has-host"),s=this.getAttributeNS(null,"text-anchor"),o,u,a,r;while(this.firstChild)this.removeChild(this.firstChild);o=f(e,this,n,t,r),this.parentNode.childElementCount>1&&(u=this.parentNode.childNodes[0],u.setAttributeNS(null,"width",o.width+q(.2)),u.setAttributeNS(null,"height",o.lines*r+q(.06))),s==="middle"&&(a=o.width/2,$(this).attr("transform","translate("+a+",0)")),i==="true"&&(a=-o.width/2,r=(o.lines-1)*r/-2+4.5,$(this.parentNode).attr("transform","translate("+a+","+r+")"))})}function Sn(){N.selectAll(".modelTimeLabel").remove(),wt=d.get("showClock"),wt&&(L=N.append("text").attr("class","modelTimeLabel").text(Kt()).attr("x",q(0)+5).attr("y",R(0)-5).style("text-anchor","start"))}function xn(){Tn(),kn(),An(),Nn(),Ln(),Cn(),U.setup(),Mn(),_n(),Sn(),un(),yn(),En()}function Tn(){C.style("fill",d.get("backgroundColor"))}function Nn(){var e,t;Et=d.get("chargeShading"),St=d.get("keShading"),et.length=lt.length;for(e=0,t=lt.length;e<t;e++)et[e]=nn(lt[e])}function Cn(){var e=lt.length<=100?1:.9,t=d.get("showChargeSymbols"),n=d.get("useThreeLetterCode");z.selectAll("circle").remove(),z.selectAll("g.label").remove(),st=z.selectAll("circle").data(lt),fn(),ot=z.selectAll("g.label").data(lt),ut=ot.enter().append("g").attr("class","label").attr("transform",function(e){return"translate("+q(e.x)+","+R(e.y)+")"}),ut.each(function(r){var i=d3.select(this),s,o;if(Wt.atom_mubers)i.append("text").text(r.idx).style("font-size",q(1.6*e*r.radius)+"px");else if(n&&r.label)i.append("text").text(r.label).attr("class","shadow").style("font-size",q(r.radius)+"px"),i.append("text").text(r.label).style("font-size",q(r.radius)+"px");else if(!n&&r.symbol)i.append("text").text(r.symbol).attr("class","shadow").style("font-size",q(1.4*r.radius)+"px"),i.append("text").text(r.symbol).style("font-size",q(1.4*r.radius)+"px");else if(t){if(r.charge>0)s="+";else{if(!(r.charge<0))return;s="-"}i.append("text").text(s).style("font-size",q(1.6*r.radius)+"px")}o=i.selectAll("text"),o.node()&&(o.attr("pointer-events","none").style({"font-weight":"bold",opacity:.7}),o.attr({x:-o.node().getComputedTextLength()/2,y:"0.31em"})),i.select("text.shadow").style({stroke:"#fff","stroke-width":.15*q(r.radius),"stroke-opacity":.7})})}function kn(){dt=d.get_obstacles(),z.selectAll("g.obstacle").remove(),dt&&(vt.length=dt.x.length,pt=z.selectAll("g.obstacle").data(vt),hn())}function Ln(){W.selectAll("path.radialbond1").remove(),W.selectAll("path.radialbond2").remove(),ct=d.get_radial_bonds(),ht=d.get_radial_bond_results(),ht&&(mt=W.selectAll("path.radialbond1").data(ht),gt=W.selectAll("path.radialbond2").data(ht),pn())}function An(){X.selectAll("line.attractionforce").remove(),On(),xt=d.get("showVDWLines"),xt&&(bt=X.selectAll("line.attractionforce").data(yt),mn())}function On(){var e=d.get_vdw_pairs();for(var t=0;t<e.count;t++)yt[t]=[e.atom1[t],e.atom2[t]];yt.splice(e.count)}function Mn(){z.selectAll("path.vector-"+Xt).remove(),z.selectAll("path.vector-"+Vt).remove(),Tt=d.get("showVelocityVectors"),Lt=d.get("showForceVectors"),Tt&&(_t=z.selectAll("path.vector-"+Xt).data(lt),ln(_t,zn,Xn,Nt,Xt)),Lt&&(Dt=z.selectAll("path.vector-"+Vt).data(lt),ln(Dt,Wn,Vn,At,Vt))}function _n(){z.selectAll("path.atomTrace").remove(),zt="",It=d.get("showAtomTrace"),qt=d.get("atomTraceId"),It&&(Ut=z.selectAll("path.atomTrace").data([lt[qt]]),cn())}function Dn(){On(),bt=X.selectAll("line.attractionforce").data(yt),mn()}function Pn(){Hn()}function Hn(){Wt.enableKeyboardHandlers&&g.focus()}function Bn(){if(!Wt.enableKeyboardHandlers)return;$(g).keydown(function(e){var t=e.keycode||e.which;switch(t){case 13:e.preventDefault(),model_player.isPlaying()||model_player.play();break;case 32:e.preventDefault(),model_player.isPlaying()?model_player.stop():model_player.play();break;case 37:e.preventDefault(),model_player.isPlaying()?model_player.stop():model_player.back();break;case 39:e.preventDefault(),model_player.isPlaying()?model_player.stop():model_player.forward()}})}function jn(e,t){Wt.enableAtomTooltips&&In(t)}function Fn(e,t){g.focus(),Wt.enableAtomTooltips&&(nt!==!1?(at.style("opacity",1e-6),at.style("display","none"),nt=!1):(d3.event.shiftKey?nt=t:nt=!1,In(t)))}function In(e){at.style("opacity",1).style("display","inline").style("background","rgba(100%, 100%, 100%, 0.7)").style("left",q(lt[e].x)+rt+60+"px").style("top",R(lt[e].y)+it-30+"px").style("zIndex",100).transition().duration(250),ft.text("atom: "+e+"\n"+"time: "+Kt()+"\n"+"speed: "+d3.format("+6.3e")(lt[e].speed)+"\n"+"vx:    "+d3.format("+6.3e")(lt[e].vx)+"\n"+"vy:    "+d3.format("+6.3e")(lt[e].vy)+"\n"+"ax:    "+d3.format("+6.3e")(lt[e].ax)+"\n"+"ay:    "+d3.format("+6.3e")(lt[e].ay)+"\n")}function qn(){!nt&&nt!==0&&at.style("opacity",1e-6).style(NaN)}function Rn(){t.time("view update"),dt&&pt.attr("transform",function(e,t){return"translate("+q(dt.x[t])+" "+R(dt.y[t]+dt.height[t])+")"}),xt&&Dn(),St&&Nn(),ht&&Qn(),Un(),Tt&&$n(_t,zn,Xn),Lt&&$n(Dt,Wn,Vn),It&&Kn(),Pt&&Pt.length!==0&&Gn(),Bt&&Bt.length>0&&wn(),t.timeEnd("view update")}function Un(){wt&&L.text(Kt()),st.attr({cx:function(e){return q(e.x)},cy:function(e){return R(e.y)}}),St&&st.style("fill",function(e,t){return et[t]}),ot.attr("transform",function(e){return"translate("+q(e.x)+","+R(e.y)+")"}),(nt===0||nt>0)&&In(nt)}function zn(e){var t=q(e.x),n=R(e.y),r="M "+t+","+n,i=kt*100;return r+" L "+(t+q(e.vx*i))+","+(n-q(e.vy*i))}function Wn(e){var t=q(e.x),n=R(e.y),r=e.mass,i=Mt*100,s="M "+t+","+n;return s+" L "+(t+q(e.ax*r*i))+","+(n-q(e.ay*r*i))}function Xn(e){return Math.abs(e.vx)+Math.abs(e.vy)>1e-6?q(Ct):0}function Vn(e){return Math.abs(e.ax)+Math.abs(e.ay)>1e-8?q(Ot):0}function $n(e,t,n){e.attr({d:t}).style({"stroke-width":n})}function Jn(e){var t=Math.floor(q(e.x)*100)/100,n=Math.floor(R(e.y)*100)/100,r,i;return zt?(zt+=t+","+n+" ",zt.length>4e3&&(r=zt.indexOf("L"),i=zt.indexOf(" "),zt="M"+zt.slice(r+1,i)+"L"+zt.slice(i+1)),zt):(zt="M"+t+","+n+"L","M "+t+","+n)}function Kn(){Ut.attr({d:Jn})}function Qn(){mt.attr("d",function(e){return dn(e,1)}),gt.attr("d",function(e){return dn(e,2)}),St&&(mt.style("stroke",rn),gt.style("stroke",sn))}function Gn(){var e,t,n,r,i,s,o,u,a,f;e=Pt.length;for(f=0;f<e;f++){if(!Ht||!Ht[f])continue;r=lt[Pt[f].imageHostIndex],i=Pt[f].imageHostType,o=q(Pt[f].imageX),u=R(Pt[f].imageY),s=Pt[f].imageLayer,n=q(Ht[f][0]),t=q(Ht[f][1]),a=s===1?J:V,a.selectAll("image.image_attach"+f).attr("x",function(){return i===""?o:q(r.x)-n/2}).attr("y",function(){return i===""?u:R(r.y)-t/2})}}function Yn(e,t){d.is_stopped()?D=[e.x,e.y]:e.draggable&&d.liveDragStart(t)}function Zn(e,t,n){return n.left+e<0&&(e=0-n.left),n.right+e>M.width&&(e=M.width-n.right),n.bottom+t<0&&(t=0-n.bottom),n.top+t>M.height&&(t=M.height-n.top),{x:e,y:t}}function er(e,t,n){return e<t?t:e>n?n:e}function tr(e,t){return{x:er(e,0,M.width),y:er(t,0,M.height)}}function nr(e,t){var n=q.invert(d3.event.x),r=R.invert(d3.event.y),i;d.is_stopped()?(i=Zn(n,r,d.getMoleculeBoundingBox(t)),Qt(t,i.x,i.y,!1,!0),Rn()):e.draggable&&(i=tr(n,r),d.liveDrag(i.x,i.y))}function rr(e,t){var n=q.invert(d3.event.dx),r=q.invert(d3.event.dy);if(!AUTHORING||!d.is_stopped())return;e.x=e.x+n,e.y=e.y-r,wn()}function ir(e,t){d.is_stopped()?(Qt(t,e.x,e.y,!0,!0)||(alert("You can't drop the atom there"),Qt(t,D[0],D[1],!1,!0)),Rn()):e.draggable&&d.liveDragEnd()}function sr(){Jt(),d.addPropertiesListener(["temperatureControl"],un),d.addPropertiesListener(["keShading","chargeShading","showChargeSymbols","useThreeLetterCode","showVDWLines","VDWLinesCutoff","showVelocityVectors","showForceVectors","showAtomTrace","atomTraceId","aminoAcidColorScheme","showClock","backgroundColor"],xn),d.on("addAtom",xn),d.on("removeAtom",xn),d.on("addRadialBond",Ln),d.on("removeRadialBond",Ln),d.on("textBoxesChanged",En),s.register(d,v,'[class~="amino-acid"]'),N===undefined?(Wt.fit_to_parent?(y=d3.select(h),m=y.append("div").attr("class","positioning-container").append("div").attr("class","molecules-view-aspect-container").attr("style","padding-top: "+Math.round(w/b*100)+"%").append("div").attr("class","molecules-view-svg-container"),g=m.node(),T=d3.select(g).append("svg").attr("viewBox","0 0 "+b+" "+w).attr("preserveAspectRatio","xMinYMin meet")):(y=m,T=d3.select(g).append("svg").attr("width",b).attr("height",w)),N=T.append("g").attr("class","molecule-container-vis").attr("transform","translate("+A.left+","+A.top+")"),C=N.append("rect").attr("class","plot").attr("width",O.width).attr("height",O.height),Wt.title&&N.append("text").attr("class","title").text(Wt.title).attr("x",O.width/2).attr("dy","-1em").style("text-anchor","middle"),Wt.xlabel&&N.append("text").attr("class","xlabel").text(Wt.xlabel).attr("x",O.width/2).attr("y",O.height).attr("dy","2.4em").style("text-anchor","middle"),Wt.ylabel&&N.append("g").append("text").attr("class","ylabel").text(Wt.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+O.height/2+") rotate(-90)"),at=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),ft=at.append("pre"),Wt.enableKeyboardHandlers&&d3.select(g).attr("tabindex",0).on("mousedown",Pn),V=N.append("g").attr("class","image-container-below"),K=N.append("g").attr("class","text-container-below"),W=N.append("g").attr("class","radial-bonds-container"),X=N.append("g").attr("class","vdw-lines-container"),z=N.append("g").attr("class","main-container"),J=N.append("g").attr("class","image-container-top"),Q=N.append("g").attr("class","text-container-top"),Bn(),Yt(),Zt(),on(),tn(Nt,Xt),tn(At,Vt)):(Wt.fit_to_parent||d3.select(g).select("svg").attr("width",b).attr("height",w),N.select("svg").attr("width",b).attr("height",w),N.select("rect.plot").attr("width",O.width).attr("height",O.height),Wt.title&&N.select("text.title").attr("x",O.width/2).attr("dy","-1em"),Wt.xlabel&&N.select("text.xlabel").attr("x",O.width/2).attr("y",O.height),Wt.ylabel&&N.select("text.ylabel").attr("transform","translate(-40 "+O.height/2+") rotate(-90)"),wt&&L.text(Kt()).attr("x",10).attr("y",O.height-35),N.selectAll("g.x").remove(),N.selectAll("g.y").remove(),Wt.playback_controller&&k.position(H,B,x),tn(Nt,Xt),tn(At,Vt),Yt()),d3.select(".model-controller").remove();switch(Wt.controlButtons){case"play":k=new r(T,model_player,H,B,x);break;case"play_reset":k=new n(T,model_player,H,B,x);break;case"play_reset_step":k=new i(T,model_player,H,B,x);break;default:k=null}U=new o(z,v,d)}var v={},m=d3.select(h),g=m.node(),y,b=m.property("clientWidth"),w=m.property("clientHeight"),E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=d3.format("5.0f"),F="",I=" (fs)",q,R,U,z,W,X,V,J,K,Q,G,Y=[],Z=25,et=[],tt={},nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt=[],mt,gt,yt=[],bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht=[],Bt=[],jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt="velocity",Vt="force";return v={processOptions:$t,setupDrawables:xn,updateMoleculeRadius:an,updateDrawablePositions:Rn,setFocus:Hn,scale:Jt,resize:function(e,t){Wt.fit_to_parent?y.style("width",e+"px"):v.scale(e,t),v.processOptions(),sr(),v.setupDrawables()},reset:function(e,t){v.processOptions(e,t),sr(),v.setupDrawables(),v.updateMoleculeRadius()},nm2px:function(e){return q(e)},nm2pxInv:function(e){return R(e)}},$t(),sr(),v.node=g,v.outerNode=y.node(),v}}),function(){n("cs!common/components/model_player",["require"],function(e){var t;return t=function(){function e(e){this.model=e}return e.prototype.play=function(){return this.model.resume()},e.prototype.stop=function(){return this.model.stop()},e.prototype.forward=function(){return this.stop(),this.model.stepForward()},e.prototype.back=function(){return this.stop(),this.model.stepBack()},e.prototype.seek=function(e){return this.stop(),this.model.seek(e)},e.prototype.reset=function(){return this.model.reset()},e.prototype.isPlaying=function(){return!this.model.is_stopped()},e}()})}.call(this),n("md2d/benchmarks/benchmarks",["require"],function(e){return function(t){var n=[{name:"commit",numeric:!1,run:function(e){var t="<a href='"+Lab.version.repo.commit.url+"' class='opens-in-new-window' target='_blank'>"+Lab.version.repo.commit.short_sha+"</a>";Lab.version.repo.dirty&&(t+=" <i>dirty</i>"),e(t)}},{name:"atoms",numeric:!0,run:function(e){e(model.get_num_atoms())}},{name:"temperature",numeric:!0,formatter:d3.format("5.1f"),run:function(e){e(model.get("temperature"))}},{name:"just graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var n,r,i;model.stop(),r=+Date.now(),i=-1;while(i++<100)t.moleculeContainer.updateDrawablePositions();n=Date.now()-r,e(100/n*1e3)}},{name:"model (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),n=+Date.now(),r=-1;while(r++<100)model.tick(1,{dontDispatchTickEvent:!0});t=Date.now()-n,e(100/t*1e3)}},{name:"model+graphics (steps/s)",numeric:!0,formatter:d3.format("5.1f"),run:function(e){var t,n,r;model.stop(),t=+Date.now(),r=-1;while(r++<100)model.tick();n=Date.now()-t,e(100/n*1e3)}},{name:"fps",numeric:!0,formatter:d3.format("5.1f"),run:function(e){model.start(),setTimeout(function(){model.stop();var t=model.get("time");setTimeout(function(){model.start(),setTimeout(function(){model.stop();var n=model.get("time")-t;e(n/(model.get("viewRefreshInterval")*model.get("timeStep"))/2)},2e3)},100)},1e3)}},{name:"interactive",numeric:!1,run:function(e){e(window.location.pathname+window.location.hash)}}];return n}}),n("md2d/controllers/model-controller",["require","md2d/models/modeler","md2d/views/molecule-container","cs!common/components/model_player","md2d/benchmarks/benchmarks"],function(e){var t=e("md2d/models/modeler"),n=e("md2d/views/molecule-container"),r=e("cs!common/components/model_player"),i=e("md2d/benchmarks/benchmarks");return function(s,o,u,a){function m(){d.updateDrawablePositions()}function g(){var e=function(t,n){var r;for(r in t)n[r]===undefined?n[r]=t[r]:typeof n[r]=="object"&&!(n[r]instanceof Array)&&(n[r]=e(t[r],n[r]));return n};h=$.extend(!0,{},u),h=e(o.viewOptions||{},h),c=$.extend(!0,{},a),c=e(o||{},c),c.viewOptions=h}function y(){p=new i(f)}function b(){g(),model=new t(c),model.resetTime(),model.on("tick",m)}function w(){model_player=new r(v,!1),model_player.forward=function(){model.stepForward(),model.isNewStep()||d.updateDrawablePositions()},model_player.back=function(){model.stepBack(),d.updateDrawablePositions()},d=new n(s,h,model),d.updateMoleculeRadius(),d.setupDrawables()}function E(){d.reset(h,model),d.updateMoleculeRadius(),d.setupDrawables()}function S(e,t,n){o=e||o,u=t||u,a=n||a,b(),E(),l.modelReset()}function x(){d.setupDrawables()}var f={},l=d3.dispatch("modelReset"),c,h,p,d,v={resume:function(){model.resume()},stop:function(){model.stop()},reset:function(){model.stop(),model.reset&&model.reset(),S(o,u)},is_stopped:function(){return model.is_stopped()}};if(typeof DEVELOPMENT=="undefined")try{b()}catch(T){throw alert(T),new Error(T)}else b();return y(),w(),l.modelReset(),f.on=function(e,t){l.on(e,t)},f.reload=S,f.repaint=x,f.moleculeContainer=d,f.benchmarks=p,f}}),n("md2d/views/dna-edit-dialog",[],function(){return function(){var t,n,r,i,s,o=function(){n=$("<div></div>"),r=$('<input type="text" id="dna-sequence-input" size="45"></input>'),r.appendTo(n),i=$('<p class="error"></p>'),i.appendTo(n),n.dialog({dialogClass:"dna-edit-dialog",title:"DNA Code on Sense Strand",autoOpen:!1,width:"30em",modal:!0,buttons:{Apply:function(){model.getGeneticProperties().set({DNA:r.val()}),$(this).dialog("close")}}}),s=$(".dna-edit-dialog button:contains('Apply')"),r.on("input",function(){var e={DNA:r.val()},t;t=model.getGeneticProperties().validate(e),t.valid===!1?(s.button("disable"),i.text(t.errors.DNA)):(s.button("enable"),i.text(""))})};return t={open:function(){i.text(""),s.removeAttr("disabled"),r.val(model.getGeneticProperties().get().DNA),n.dialog("open")}},o(),t}}),n("md2d/controllers/scripting-api",["require","md2d/views/dna-edit-dialog"],function(e){var t=e("md2d/views/dna-edit-dialog");return function(n){var r=new t;return{getNumberOfAtoms:function(){return model.get_num_atoms()},getNumberOfObstacles:function(){return model.getNumberOfObstacles()},getNumberOfElements:function(){return model.getNumberOfElements()},getNumberOfRadialBonds:function(){return model.getNumberOfRadialBonds()},getNumberOfAngularBonds:function(){return model.getNumberOfAngularBonds()},addAtom:function(t,n){return n&&n.supressRepaint&&(n.supressEvent=!0),model.addAtom(t,n)},removeAtom:function(t,n){n&&n.supressRepaint&&(n.supressEvent=!0,delete n.supressRepaint);try{model.removeAtom(t,n)}catch(r){if(!n||!n.silent)throw r}},removeRadialBond:function(t,r){try{model.removeRadialBond(t)}catch(i){if(!r||!r.silent)throw i}n.repaint()},removeAngularBond:function(t,r){try{model.removeAngularBond(t)}catch(i){if(!r||!r.silent)throw i}n.repaint()},addRandomAtom:function(){return model.addRandomAtom.apply(model,arguments)},adjustTemperature:function(t){model.set({targetTemperature:t*model.get("temperature")})},limitHighTemperature:function(t){model.get("targetTemperature")>t&&model.set({targetTemperature:t})},randomAtoms:function(t){var r=model.get_num_atoms();t===null&&(t=1+n.randomInteger(r-1));if(!n.isInteger(t))throw new Error("randomAtoms: number of atoms requested, "+t+", is not an integer.");if(t<0)throw new Error("randomAtoms: number of atoms requested, "+t+", was less be greater than zero.");return t>r&&(t=r),n.choose(t,r)},markAtoms:function i(){var e,t;if(arguments.length===0)return;if(n.isArray(arguments[0]))return i.apply(null,arguments[0]);n.unmarkAllAtoms();for(e=0,t=arguments.length;e<t;e++)model.setAtomProperties(arguments[e],{marked:1});n.repaint()},unmarkAllAtoms:function(){for(var t=0,r=model.get_num_atoms();t<r;t++)model.setAtomProperties(t,{marked:0});n.repaint()},traceAtom:function(t){if(t===null)return;model.set({atomTraceId:t}),model.set({showAtomTrace:!0})},untraceAtom:function(){model.set({showAtomTrace:!1})},setAtomProperties:function(t,r,i,s,o){model.setAtomProperties(t,r,i,s),(!o||!o.supressRepaint)&&n.repaint()},getAtomProperties:function(t){return model.getAtomProperties(t)},setElementProperties:function(t,r){model.setElementProperties(t,r),n.repaint()},setPairwiseLJProperties:function(t,n,r){model.getPairwiseLJProperties().set(t,n,r)},getElementProperties:function(t){return model.getElementProperties(t)},addObstacle:function(t,r){try{model.addObstacle(t)}catch(i){if(!r||!r.silent)throw i}n.repaint()},setObstacleProperties:function(t,r){model.setObstacleProperties(t,r),n.repaint()},getObstacleProperties:function(t){return model.getObstacleProperties(t)},removeObstacle:function(t,r){try{model.removeObstacle(t)}catch(i){if(!r||!r.silent)throw i}n.repaint()},setRadialBondProperties:function(t,r){model.setRadialBondProperties(t,r),n.repaint()},getRadialBondProperties:function(t){return model.getRadialBondProperties(t)},setAngularBondProperties:function(t,r){model.setAngularBondProperties(t,r),n.repaint()},getAngularBondProperties:function(t){return model.getAngularBondProperties(t)},setGeneticProperties:function(t){model.getGeneticProperties().set(t)},getGeneticProperties:function(){return model.getGeneticProperties().get()},openDNADialog:function(){r.open()},transcribe:function(){model.getGeneticProperties().transcribeDNA()},translate:function(){var t=model.getGeneticProperties().translate();model.generateProtein(t)},generateRandomProtein:function(e){var t=model.generateProtein(undefined,e);if(t!==e)throw new Error("Generated protein was truncated due to limited area of the model. Only"+t+" amino acids were generated.")},setSolvent:function(t){model.setSolvent(t)},pe:function(){return model.get("potentialEnergy")},ke:function(){return model.get("kineticEnergy")},atomsKe:function(t){var n=0,r;for(r=0;r<t.length;r++)n+=model.getAtomKineticEnergy(t[r]);return n},minimizeEnergy:function(){model.minimizeEnergy(),n.repaint()},addTextBox:function(e){model.addTextBox(e)},removeTextBox:function(e){model.removeTextBox(e)},setTextBoxProperties:function(e,t){model.setTextBoxProperties(e,t)}}}}),n("common/controllers/interactives-controller",["require","common/controllers/bar-graph-controller","common/controllers/graph-controller","common/controllers/dg-export-controller","common/controllers/scripting-api","common/controllers/button-controller","common/controllers/checkbox-controller","common/controllers/radio-controller","common/controllers/slider-controller","common/controllers/pulldown-controller","common/controllers/numeric-output-controller","common/controllers/parent-message-api","common/controllers/thermometer-controller","common/layout/layout","common/layout/interactive-layout","md2d/controllers/model-controller","md2d/controllers/scripting-api"],function(e){var t=e("common/controllers/bar-graph-controller"),n=e("common/controllers/graph-controller"),r=e("common/controllers/dg-export-controller"),i=e("common/controllers/scripting-api"),s=e("common/controllers/button-controller"),o=e("common/controllers/checkbox-controller"),u=e("common/controllers/radio-controller"),a=e("common/controllers/slider-controller"
),f=e("common/controllers/pulldown-controller"),l=e("common/controllers/numeric-output-controller"),c=e("common/controllers/parent-message-api"),h=e("common/controllers/thermometer-controller"),p=e("common/layout/layout"),d=e("common/layout/interactive-layout"),v=e("md2d/controllers/model-controller"),m=e("md2d/controllers/scripting-api"),g={button:s,checkbox:o,pulldown:f,radio:u,thermometer:h,barGraph:t,graph:n,slider:a,numericOutput:l};return function(t,n,s,o){function k(e){if(h[e])return h[e];throw new Error("No model found with id "+e)}function L(e,t){function s(e){e.type=e.type||"md2d";if(a)a.reload(e,r,i);else{switch(e.type){case"md2d":a=new v("#model-container",e,r,i),S.extend(m),S.exposeScriptingAPI();break;case"a-different-model-type":}M(),a.on("modelReset",M),u.modelController=a}}var n=k(e),r,i;u.currentModel=n,n.viewOptions?r=$.extend(!0,{},n.viewOptions):r={controlButtons:"play"},r.fit_to_parent=!o,r.interactiveUrl=n.url,w=[],n.onLoad&&w.push(S.makeFunctionInScriptContext(O(n.onLoad))),n.modelOptions&&(i=$.extend(!0,{},n.modelOptions)),t?s(t):$.get(ACTUAL_ROOT+n.url).done(function(e){e=typeof e=="string"?JSON.parse(e):e,s(e)})}function A(e){var t=e.type,n=new g[t](e,S,u);return E[t]===undefined&&(E[t]=[]),E[t].push(n),n}function O(e){return typeof e=="string"?e:e.join("\n")}function M(){var e,n;P(u.currentModel.parameters,t.parameters),D("basic",u.currentModel.outputs,t.outputs),D("filtered",u.currentModel.filteredOutputs,t.filteredOutputs);for(e=0;e<b.length;e++)b[e]();N=new c(model,a.moleculeContainer,u),p.addView("moleculeContainers",a.moleculeContainer),E.thermometer&&p.addView("thermometers",E.thermometer[0].getView()),E.graph&&p.addView("energyGraphs",E.graph[0].getView()),E.barGraph&&p.addView("barGraphs",E.barGraph[0]),$(window).unbind("resize"),o?(p.selection=o,p.setupScreen(),C||(p.setupScreen(),C=!0),$(window).on("resize",p.setupScreen)):(d(),$(window).on("resize",d));for(e=0;e<y.length;e++)n=y[e],model.addPropertiesListener(n[0],n[1]);for(e=0;e<w.length;e++)w[e]();for(e=0;e<s.length;e++)s[e]()}function _(e,n){var i,s,o={},u,a,c,p,d,v,m,g,y,w,E,S,x;b=[],t=e,n&&(f=$(n)),f.children().length===0?(m=$('<div class="interactive-top" id="top"/>'),m.append('<div class="interactive-top" id="model-container"/>'),t.layout&&t.layout.right!==undefined&&(g=$('<div class="interactive-top" id="right"/>'),m.append(g)),t.layout&&t.layout.rightwide&&(y=$('<div id="rightwide"/>'),m.append(y)),f.append(m),f.append('<div class="interactive-bottom" id="bottom"/>')):(w=$("#bottom"),g=$("#right"),y=$("#rightwide"),w.html(""),g&&g.empty(),y&&y.empty());if(t.models!==null&&t.models.length>0){l=t.models;for(E=0,x=l.length;E<x;E++)i=l[E],i.id=i.id||"model"+E,h[i.id]=i;L(l[0].id)}s=t.components||[];for(E=0,x=s.length;E<x;E++)u=A(s[E]),u.modelLoadedCallback&&b.push(u.modelLoadedCallback),o[s[E].id]=u;t.exports&&(T=new r(t.exports),b.push(T.modelLoadedCallback));if(t.layout)for(d in t.layout)if(t.layout.hasOwnProperty(d)){a=t.layout[d];if(typeof a=="string")$("#"+d).html(a);else{Object.prototype.toString.call(a[0])!=="[object Array]"&&(a=[a]);for(E=0;E<a.length;E++){p=a[E],c=$('<div class="interactive-'+d+'-row"/>'),$("#"+d).append(c);for(S=0;S<p.length;S++)v=p[S],o[v]&&(c.append(o[v].getViewContainer()),delete o[v])}}}$("#bottom.row").length===0&&(c=$('<div class="interactive-'+d+'-row"/>'),$("#bottom").append(c));for(v in o)o.hasOwnProperty(v)&&($("#interactive-container #"+v).length>0?$("#interactive-container #"+v).append(o[v].getViewContainer()):c.append(o[v].getViewContainer()))}function D(e,t,n){function o(e){if(!e)return;for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}if(!t&&!n)return;var r={},i,s;o(n),o(t);for(i in r)if(r.hasOwnProperty(i)){s=r[i];switch(e){case"basic":model.defineOutput(s.name,{label:s.label,units:s.units},S.makeFunctionInScriptContext(O(s.value)));break;case"filtered":model.defineFilteredOutput(s.name,{label:s.label,units:s.units},s.property,s.type,s.period)}}}function P(e,t){if(!e&&!t)return;var n,r,i=(t||[]).concat(e||[]),s={};for(n=0;n<i.length;n++)r=i[n],model.defineParameter(r.name,{label:r.label,units:r.units},S.makeFunctionInScriptContext("value",O(r.onChange))),r.initialValue!==undefined&&(s[r.name]=r.initialValue);model.set(s)}s=s||[];var u={},a,f,l=[],h={},y=[],b=[],w=[],E={},S,x,T,N,C=!1;return u={getDGExportController:function(){return T},getModelController:function(){return a},pushOnLoadScript:function(e){w.push(e)},loadInteractive:_,loadModel:L},S=new i(u,x),S.exposeScriptingAPI(),_(t,n),u}}),n("md2d/views/applet-container",["require","common/layout/layout"],function(e){var t=e("common/layout/layout");return function(n,r){function N(e,n){return arguments.length?(u=n,o=e):(u=i.property("clientHeight"),o=i.property("clientWidth")),a&&(l=+a.runMwScript("mw2d:1:get %width"),c=+a.runMwScript("mw2d:1:get %height"),h=l/c,u=o*1/h*1.25),s.style.width=o+"px",s.style.height=u+"px",v=t.screen_factor,t.screen_factor_width&&t.screen_factor_height&&(v=Math.min(t.screen_factor_width,t.screen_factor_height)),v=o/600,m={top:5,right:5,bottom:5,left:5},d=u-m.top-m.bottom,p=o-m.left-m.right,g={width:p,height:d},[o,u]}function C(){function e(){var e,t,n;n=['<applet id="'+r.appletID+'", codebase="'+r.codebase+'", code="'+r.code+'"','     width="'+r.width+'" height="'+r.height+'" MAYSCRIPT="true"','     archive="'+r.archive+'">','     MAYSCRIPT="true">'];for(e=0;e<r.params.length;e++)t=r.params[e],n.push('  <param name="'+t[0]+'" value="'+t[1]+'"/>');return n.push('  <param name="MAYSCRIPT" value="true"/>'),n.push("  Your browser is completely ignoring the applet tag!"),n.push("</applet>"),n.join("\n")}a===undefined?(f=e(),s.innerHTML=f,a=document.getElementById(r.appletID)):(a.style.width=g.width,a.style.height=g.height,a.width=g.width,a.height=g.height),C.node=s,C.scale=N,C.applet=a}var i=d3.select(n),s=i.node(),o=i.property("clientWidth"),u=i.property("clientHeight"),a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x={appletID:"mw-applet",codebase:"/jnlp",code:"org.concord.modeler.MwApplet",width:"100%",height:"100%",archive:"org/concord/modeler/unsigned/mw.jar",align:"left",hspace:"5",vspace:"5",params:[["script","page:0:import /imports/legacy-mw-content/potential-tests/two-atoms-two-elements/two-atoms-two-elements.cml"]]};if(r)for(var T in x)r[T]===undefined&&(r[T]=x[T]);else r=x;return N(o,u),C.resize=function(e,t){C.scale(e,t)},s&&C(),C}}),function(){n("cs!common/components/slider",["require"],function(e){var t;return t=function(){function e(e,t,n,r,i){this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.min=n,this.max=r,this.value=i,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return e.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},e.prototype.init_view=function(){var e;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(e=this.height/4,this.y1=this.y2=e,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},e.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},e.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},e.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/4,this.update_handle()},e.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},e.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},e.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},e.prototype.set_scaled_value=function(e){return this.value=(e-this.min)/this.domain,this.handle_x=e/this.domain*this.width,this.update()},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.update_label=function(){var e;return this.label?(e=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+e)):this.text_label.hide()},e.prototype.handle_mousedown=function(e){var t=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(e){return t.handle_mouseup(e)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(e){return t.handle_drag(e)}),this.handle_drag(e)},e.prototype.handle_drag=function(e){var t,n,r,i;return this.dragging?(document.onselectstart=function(){return!1},r=e.pageX-this.slider_well.position().left,i=e.pageY-this.slider_well.position().top,this.horizontal_orientation()?(t=this.width-this.handle_width/4,n=this.handle_width/4,this.handle_x=r,this.handle_x<n&&(this.handle_x=n),this.handle_x>t&&(this.handle_x=t),this.value=this.handle_x/this.width):(this.handle_y=e.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},e.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},e.prototype.init_mouse_handlers=function(){var e=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(t){return e.handle_mousedown(t)})},e}()})}.call(this),n("md2d/controllers/compare-models-controller",["require","md2d/models/modeler","md2d/views/applet-container","md2d/views/molecule-container","cs!common/components/model_player","cs!common/components/thermometer","cs!common/components/slider","common/layout/layout"],function(e){var t=e("md2d/models/modeler"),n=e("md2d/views/applet-container"),r=e("md2d/views/molecule-container"),i=e("cs!common/components/model_player"),s=e("cs!common/components/thermometer"),o=e("cs!common/components/slider"),u=e("common/layout/layout");return function(s,o,a,f,l){function st(){function e(e){q.updateDrawablePositions()}function p(){controlButtons=l.controlButtons,modelTimeLabel=l.modelTimeLabel,enableAtomTooltips=l.enableAtomTooltips||!1,fit_to_parent=l.fit_to_parent,interactiveUrl=l.interactiveUrl,m=f.elements,g=f.atoms,y=f.mol_number,b=f.lennardJonesForces,w=f.coulombForces,E=f.temperatureControl,S=f.targetTemperature,x=f.width,T=f.height,N=f.keShading,C=f.chargeShading,k=f.showVDWLines,VDWLinesCutoff=f.VDWLinesCutoff,L=f.showClock,A=f.viewRefreshInterval,O=f.timeStep,M=f.radialBonds,_=f.angularBonds,D=f.restraints,P=f.obstacles,H=f.viscosity,B=f.gravitationalField,j=f.images,F=f.textBoxes}function d(){p(),model=new t({elements:m,targetTemperature:S,lennardJonesForces:b,coulombForces:w,temperatureControl:E,width:x,height:T,keShading:N,chargeShading:C,showVDWLines:k,VDWLinesCutoff:VDWLinesCutoff,showClock:L,viewRefreshInterval:A,timeStep:O,viscosity:H,gravitationalField:B,images:j,atoms:g,mol_number:y,relax:!!y,radialBonds:M,angularBonds:_,restraints:D,obstacles:P})}function v(){return{model:model,fit_to_parent:fit_to_parent,xmax:x,ymax:T,keShading:N,chargeShading:C,enableAtomTooltips:enableAtomTooltips,images:j,interactiveUrl:interactiveUrl,textBoxes:F,get_results:function(){return model.get_results()},get_radial_bond_results:function(){return model.get_radial_bond_results()},get_radial_bonds:function(){return model.get_radial_bonds()},get_obstacles:function(){return model.get_obstacles()},get_vdw_pairs:function(){return model.get_vdw_pairs()},set_atom_properties:function(){return model.setAtomProperties.apply(model,arguments)},is_stopped:function(){return model.is_stopped()},controlButtons:controlButtons,modelTimeLabel:modelTimeLabel}}function R(){u.selection=c,model_player=new i(model,h),q=new r(s,v()),q.updateMoleculeRadius(),q.setupDrawables(),Y=at(),Y?Q={params:[["script","page:0:import /imports/legacy-mw-content/"+Y]]}:Q={},K=new n(o,Q),u.addView("moleculeContainers",q),u.addView("appletContainers",K),u.setupScreen()}function z(){model.stop()}function W(){model.on("tick",e),model.resume()}function V(){model.stop(),model.stepBack()}function J(){model.stop(),model.stepForward()}function G(){model.stop(),d(),ot(),e()}function ot(){I=model.get_atoms(),model.resetTime(),z(),model.on("tick",e),U=model.stepCounter()}function ut(){return it=document.location.hash,it.length>0?it.substr(1,it.length):!1}function at(){var e=ut();return e?rt[e.replace("/imports/legacy-mw-content/","")].cmlPath:!1}function ft(){var e=ut();e?nt.value=e.replace("/imports/legacy-mw-content/",""):nt.value="two-atoms-two-elements/two-atoms-two-elements$0.json"}function lt(){var e,t,n,r,i;rt={};for(e=0;e<modelList.length;e++){r=modelList[e],i=r.section;for(t=0;t<r.content.length;t++)n=r.content[t],rt[n.json]={name:n.name,jsonPath:n.json,cmlPath:n.cml}}}function ct(){lt(),d3.select(nt).selectAll("optgroup").data(modelList).enter().append("optgroup").attr("label",function(e){return e.section}).selectAll("option").data(function(e){return e.content}).enter().append("option").text(function(e){return e.name}).attr("value",function(e){return e.json}).attr("data-cml-path",function(e){return e.cml}),ft()}function ht(e){return K.applet.runMwScript(e)}function pt(){var e=$(nt).find("option:selected"),t="/imports/legacy-mw-content/",n=e.attr("value");X=t+n,document.location.hash="#"+X}function dt(){at()&&(Q={params:[["script","page:0:import "+at()]]},K=new n(o,Q),ht("page:0:set frank false"),u.setView("appletContainers",[K]),u.setupScreen())}function vt(){u.setupScreen()}function mt(){ct(),d(),ot(),R(),ft()}nt=document.getElementById(a),Z=document.getElementById("start"),Z.onclick=function(){ht("mw2d:1:run"),W()},et=document.getElementById("stop"),et.onclick=function(){ht("mw2d:1:stop"),z()},tt=document.getElementById("reset"),tt.onclick=function(){ht("mw2d:1:reset"),G()},nt.onchange=pt,document.onwebkitfullscreenchange=vt,window.onresize=vt;if(typeof DEVELOPMENT=="undefined")try{mt()}catch(gt){throw alert(gt),new Error(gt)}else mt();st.runMWScript=ht}var c=l.layoutStyle,h=l.autostart,p=l.maximum_model_steps,d=l.lj_epsilon_max,v=l.lj_epsilon_min,m=f.elements,g=f.atoms,y=f.mol_number,b=f.lennardJonesForces,w=f.coulombForces,E=f.temperatureControl,S=f.targetTemperature,x=f.width,T=f.height,N=f.keShading,C=f.chargeShading,k=f.showVDWLines,L=f.showClock,A=f.viewRefreshInterval,O=f.timeStep,M=f.radialBonds,_=f.angularBonds,D=f.restraints,P=f.obstacles,H=f.viscosity,B=f.gravitationalField,j=f.images,F=f.textBoxes,I,q,R,U,z,W,X,V,J,K,Q={},G,Y,Z,et,tt,nt,rt,it;return st(),st}}),n("common/benchmark/benchmark",["require"],function(e){function i(){var e=/ (Chrome)\/(.*?) /,t=/ (Firefox)\/([0123456789ab.]+)/,r=/ AppleWebKit\/([0123456789.+]+) \(KHTML, like Gecko\) Version\/([0123456789.]+) (Safari)\/([0123456789.]+)/,i=/ (MSIE) ([0123456789.]+);/,o=/^(Opera)\/.+? Version\/([0123456789.]+)$/,u=/.+?\((iPhone); CPU.+?OS .+?Version\/([0123456789._]+)/,a=/.+?\((iPad); CPU.+?OS .+?Version\/([0123456789._]+)/,f=/.+?\((iPod); CPU (iPhone.+?) like.+?Version\/([0123456789ab._]+)/,l=/.+?(Android) ([0123456789.]+).*?; (.+?)\).+? Chrome\/([0123456789.]+)/,c=/.+?(Android.+?\)).+? Firefox\/([0123456789.]+)/,h=/.+?(Android) ([0123456789ab.]+).*?; (.+?)\)/,p;p=navigator.userAgent.match(e);if(p&&p[1])return{browser:p[1],version:p[2],oscpu:s()};p=navigator.userAgent.match(t);if(p&&p[1]){var d=navigator.buildID,v="";return d&&d.length>=8&&(v="("+d.slice(0,4)+"-"+d.slice(4,6)+"-"+d.slice(6,8)+")"),{browser:p[1],version:p[2]+" "+v,oscpu:s()}}p=navigator.userAgent.match(l);if(p&&p[1])return{browser:"Chrome",version:p[4],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(c);if(p&&p[1])return{browser:"Firefox",version:p[2],oscpu:p[1]};p=navigator.userAgent.match(h);if(p&&p[1])return{browser:"Android",version:p[2],oscpu:p[1]+"/"+p[2]+"/"+p[3]};p=navigator.userAgent.match(r);if(p&&p[3])return{browser:p[3],version:p[2]+"/"+p[1],oscpu:s()};p=navigator.userAgent.match(i);if(p&&p[1]){var m=navigator.userAgent.match(/\(.*?(Windows.+?); (.+?)[;)].*/);return{browser:p[1],version:p[2],oscpu:n[m[1]]+"/"+navigator.cpuClass+"/"+navigator.platform}}return p=navigator.userAgent.match(o),p&&p[1]?{browser:p[1],version:p[2],oscpu:s()}:(p=navigator.userAgent.match(u),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(a),p&&p[1]?{browser:"Mobile Safari",version:p[2],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:(p=navigator.userAgent.match(f),p&&p[1]?{browser:"Mobile Safari",version:p[3],oscpu:p[1]+"/"+"iOS"+"/"+p[2]}:{browser:"",version:navigator.appVersion,oscpu:""})))}function s(){var e=navigator.userAgent.match(/\((.+?)[;)] (.+?)[;)].*/);if(!e)return"na";if(e[1]==="Macintosh")return e[2];if(e[1].match(/^Windows/)){var t=r[e[2]]||"32",i=navigator.userAgent.match(/\(.*?(Windows NT.+?)[;)]/);return n[i[1]]+"/"+t}}function o(e,t,n){function v(t){var n=e.getElementsByTagName("tr")[0],r=n.appendChild(document.createElement("th"));r.innerHTML=t,l[t]=f++}function m(t){t=t||0;var n=e.appendChild(document.createElement("tr")),r;for(r=0;r<t;r++)n.appendChild(document.createElement("td"));return n}function g(e,t,n){var r;n=n||o,r=n.getElementsByTagName("td")[l[e]],typeof t=="string"&&t.slice(0,1)==="<"?r.innerHTML=t:r.textContent=t}function y(){function m(e){return Math.floor(e)==e}var e,n,r,i,s=d.length,o,u,a=average_row.getElementsByTagName("td"),f,c,h,p=d3.format("5.1f"),v=d3.format("f");for(e=0;e<t.length;e++){r=t[e],u=l[r.name];if(r.numeric===!1)i=d[2],o=i.getElementsByTagName("td")[u],a[u].innerHTML=o.innerHTML;else{f=0;for(n=2;n<s;n++)i=d[n],o=i.getElementsByTagName("td")[u],f+=+o.textContent;c=f/(s-2),r.formatter?c=r.formatter(c):m(c)?c=v(f/(s-2)):c=p(f/(s-2)),a[u].textContent=c}}}var r=0,i,s,o,u,a,f=0,l={},c,h,p,d=e.getElementsByTagName("tr");e.style.display="";if(d.length===0){m(),v("browser"),v("version"),v("cpu/os"),v("date");for(r=0;r<t.length;r++)v(t[r].name);average_row=m(f),average_row.className="average"}else{c=d[0],h=c.getElementsByTagName("th");for(r=0,p=h.length;r<p;r++)l[h[r].innerHTML]=f++}o=m(f),o.className="sample";for(r=0;r<4;r++)u=n[r],g(u[0],u[1]),g(u[0],u[1],average_row);for(r=4;r<n.length;r++)u=n[r],g(u[0],u[1]);y()}function u(e,t,n,r){var s,o,u=[],a=i(),f=d3.time.format("%Y-%m-%d %H:%M");u.push(["browser",a.browser]),u.push(["version",a.version]),u.push(["cpu/os",a.oscpu]),u.push(["date",f(new Date)]),o=0,n&&n();for(s=0;s<e.length;s++)(function(n){n.run(function(i){n.formatter?u.push([n.name,n.formatter(i)]):u.push([n.name,i]),++o===e.length&&(r&&r(),t&&t(u))})})(e[s]),r!==undefined;return u}function a(e,t,n,r,i){var s;return u(e,function(r){o(t,e,r),n(r)},r,i),s}var t="0.0.1",n={"Windows NT 6.2":"Windows 8","Windows NT 6.1":"Windows 7","Windows NT 6.0":"Windows Vista","Windows NT 5.2":"Windows Server 2003; Windows XP x64 Edition","Windows NT 5.1":"Windows XP","Windows NT 5.01":"Windows 2000, Service Pack 1 (SP1)","Windows NT 5.0":"Windows 2000","Windows NT 4.0":"Microsoft Windows NT 4.0"},r={WOW64:"64/32","Win64; IA64":"64","Win64; x64":"64"};return{version:t,what_browser:function(){return i()},run:function(e,t,n,r,i){a(e,t,n,r,i)},bench:function(e,t,n,r){return u(e,t,n,r)},renderToTable:function(e,t,n){o(e,t,n)}}}),n("md2d/public-api",["require","common/controllers/interactives-controller","md2d/controllers/compare-models-controller","common/layout/layout","common/benchmark/benchmark"],function(e){var t=e("common/controllers/interactives-controller"),n=e("md2d/controllers/compare-models-controller"),r=e("common/layout/layout"),i=e("common/benchmark/benchmark"),s;return s={version:"0.0.1",interactivesController:t,compareModelsController:n},window.controllers=s,window.layout=r,window.benchmark=i,s}),t(["md2d/public-api"],undefined,undefined,!0)})();