(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d=Object.prototype.hasOwnProperty,v=function(e,t){function r(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},m=function(e,t){return function(){return e.apply(t,arguments)}};p=typeof exports!="undefined"&&exports!==null?exports:this,n=function(){function e(e){this.dom_id=e,this.dom_id?this.dom_element=$(this.dom_id):this.dom_element=$("<div>"),this.dom_element.addClass("component")}return e}(),t=function(e){function t(e,n,r){this.dom_id=e,this.name=n!=null?n:"play",this.actions=r!=null?r:[],t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button").addClass(this.name).addClass("up"),this.state="up",this.init_mouse_handlers()}return v(t,e),t.prototype.set_state=function(e){return this.dom_element.removeClass(this.state),this.state=e,this.dom_element.addClass(this.state)},t.prototype.init_mouse_handlers=function(){var e,t=this;return e=this,this.dom_element.mousedown(function(t){return e.set_state("down"),e.start_down_ticker()}),this.dom_element.mouseup(function(){return clearInterval(t.ticker),e.set_state("up"),e.do_action()}),this.dom_element.mouseleave(function(){return clearInterval(t.ticker),e.set_state("up")})},t.prototype.add_action=function(e){return this.actions.push(e)},t.prototype.do_action=function(){var e,t,n,r,i;r=this.actions,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e());return i},t.prototype.start_down_ticker=function(){var e;return e=this,this.ticker_count=0,this.ticker=setInterval(function(){e.do_action(),e.ticker_count+=1,e.ticker_count>4&&e.do_action();if(e.ticker_count>8)return e.do_action(),e.do_action()},250)},t}(n),p.ButtonComponent=t,h=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id,"toggle"),this.buttons=[];for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r);this.button_index=0,this.enable_button(0)}return v(t,e),t.prototype.add_button=function(e){var t,n;e.dom_element.remove(),e.dom_element.css("margin","0px"),this.dom_element.append(e.dom_element),this.buttons.push(e),this.add_width(e.dom_element),this.add_height(e.dom_element),n=this,t=this.buttons.length-1;if(t!==this.button_index)return this.disable_button(t)},t.prototype.add_width=function(e){var t,n;n=this.dom_element.width(),t=e.outerWidth(!0);if(n<t)return this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t.prototype.disable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.addClass("hidden")},t.prototype.enable_button=function(e){var t;t=this.buttons[e];if(t)return t.dom_element.removeClass("hidden")},t.prototype.set_active=function(e){return this.disable_button(this.button_index),this.button_index=e,this.button_index=this.button_index%this.buttons.length,this.enable_button(this.button_index)},t.prototype.enable_next_button=function(){return this.set_active(this.button_index+1)},t.prototype.current_button=function(){return this.button_index<this.buttons.length?this.buttons[this.button_index]:null},t.prototype.do_action=function(){if(this.current_button())return this.current_button().do_action(),this.enable_next_button()},t}(t),p.ToggleButtonComponent=h,e=function(e){function t(e,n){var r,i,s;this.dom_id=e,n==null&&(n=[]),t.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button_bar"),this.buttons=[],this.dom_element.width("1px"),this.dom_element.height("1px");for(i=0,s=n.length;i<s;i++)r=n[i],this.add_button(r)}return v(t,e),t.prototype.add_button=function(e){var t;return t=e.dom_element,this.dom_element.append(t),this.add_width(t),this.add_height(t),this.buttons.push(e)},t.prototype.add_width=function(e){var t;return t=this.dom_element.width(),t+=e.outerWidth(!0),this.dom_element.width(""+t+"px")},t.prototype.add_height=function(e){var t,n;n=this.dom_element.height(),t=e.outerHeight(!0);if(n<t)return this.dom_element.height(""+t+"px")},t}(n),p.ButtonBarComponent=e,a=function(e){function n(e,r,i){var s,o,u,a,f,l=this;this.dom_id=e,this.playable=r,i==null&&(i=!0),n.__super__.constructor.call(this,this.dom_id),a=new t(null,"play"),a.add_action(function(){return l.playable.play()}),u=new t(null,"pause"),u.add_action(function(){return l.playable.stop()}),this.toggle=new h(null,[a,u]),this.play_index=0,this.stop_index=1,f=new t(null,"reset"),f.add_action(function(){return l.playable.seek(1),l.play()}),this.add_button(f),i||(o=new t(null,"forward"),o.add_action(function(){return l.playable.forward(),l.stop()}),this.add_button(o)),this.add_button(this.toggle),i||(s=new t(null,"back"),s.add_action(function(){return l.playable.back(),l.stop()}),this.add_button(s)),this.play()}return v(n,e),n.prototype.stop=function(){return this.toggle.set_active(this.play_index)},n.prototype.play=function(){return this.toggle.set_active(this.stop_index)},n}(e),p.PlaybackBarComponent=a,r=function(){function e(e,t){var n=this;this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.dom_element=$(this.dom_id),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.step=this.dom_element.attr("data-stop")||.01,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.label_id=this.dom_element.attr("data-label-id"),this.orientation=this.dom_element.attr("data-orientation")||"horizontal",this.dom_element.slider(),this.update_options(),this.dom_element.bind("slide",function(e,t){console.log("slider value: "+t.value),n.update_label(t.value);if(n.value_changed_function)return n.value_changed_function(t.value)}),this.update_label(this.value)}return e.prototype.set_max=function(e){return this.max=e,this.update_options()},e.prototype.set_min=function(e){return this.min=e,this.update_options()},e.prototype.update_options=function(){var e;return e={orientation:this.orientation,min:this.min,max:this.max,value:this.value,step:this.step,range:"min"},this.dom_element.slider("option",e)},e.prototype.update_label=function(e){if(this.label_id)return $(this.label_id).text(""+this.label+" "+e)},e}(),p=typeof exports!="undefined"&&exports!==null?exports:this,p.JSliderComponent=r,s=function(){function e(e){this.model=e}return e.prototype.play=function(){return this.model.resume()},e.prototype.stop=function(){return this.model.stop()},e.prototype.forward=function(){return this.stop(),this.model.stepForward()},e.prototype.back=function(){return this.stop(),this.model.stepBack()},e.prototype.seek=function(e){return this.stop(),this.model.seek(e)},e.prototype.isPlaying=function(){return!this.model.is_stopped()},e}(),i=function(){function e(e,t,n,r,i){var s=this;this.svg_element=e,this.playable=t!=null?t:null,this.width=200,this.height=34,this.xpos=n,this.ypos=r,this.scale=i||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view(),this.setup_buttons(),this.playable.isPlaying()?this.hide(this.play):this.hide(this.stop),model.addPropertiesListener(["play","stop"],function(){return s.update_ui()})}return e.prototype.offset=function(e){return e*this.unit_width*2+this.unit_width},e.prototype.setup_buttons=function(){},e.prototype.make_button=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=this;t=e.action,u=e.offset,h=e.type,f=e.point_set,h==null&&(h="svg:polyline"),f==null&&(f=this.icon_shapes[t]),u=this.offset(u),s=this.group.append("svg:g"),s.attr("class","component playbacksvgbutton").attr("x",u).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width*2).attr("style","fill: #cccccc"),i=s.append("rect"),i.attr("class","bg").attr("x",u).attr("y",this.vertical_padding/3).attr("width",this.unit_width*2).attr("height",this.unit_width*1.5).attr("rx","0");for(v=0,g=f.length;v<g;v++){l=f[v],n=s.append(h),n.attr("class",""+t+" button-art"),c="";for(m=0,y=l.length;m<y;m++)a=l[m],p=u+10+a.x*this.unit_width,d=this.vertical_padding/.75+a.y*this.unit_width,c+=" "+p+","+d,n.attr("points",c);t==="stop"&&(r=s.append("rect"),r.attr("class","pause-center").attr("x",p+this.unit_width/3).attr("y",this.vertical_padding/.75-1).attr("width",this.unit_width/3).attr("height",this.unit_width+2))}return o=s.append("rect"),o.attr("class","highlight").attr("x",u+1).attr("y",this.vertical_padding/1.85).attr("width",this.unit_width*2-2).attr("height",this.unit_width/1.4).attr("rx","0"),s.on("click",function(){return b.action(t)}),s},e.prototype.action=function(e){console.log("running "+e+" ");if(this.playable)switch(e){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+e)}else console.log("no @playable defined");return this.update_ui()},e.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component model-controller playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.position=function(e,t,n){return this.xpos=e,this.ypos=t,this.scale=n||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},e.prototype.update_ui=function(){if(this.playable)return this.playable.isPlaying()?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},e.prototype.hide=function(e){return e.style("visibility","hidden")},e.prototype.show=function(e){return e.style("visibility","visible")},e.prototype.icon_shapes={play:[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],stop:[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],reset:[[{x:1,y:0},{x:.3,y:.5},{x:1,y:1}],[{x:0,y:0},{x:.3,y:0},{x:.3,y:1},{x:0,y:1},{x:0,y:0}]],back:[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],forward:[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]]},e}(),p=typeof exports!="undefined"&&exports!==null?exports:this,p.PlayOnlyComponentSVG=o,p.ModelPlayer=s,o=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.setup_buttons=function(){return this.play=this.make_button({action:"play",offset:0}),this.stop=this.make_button({action:"stop",offset:0})},t}(i),p=typeof exports!="undefined"&&exports!==null?exports:this,p.PlayOnlyComponentSVG=o,u=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.play=this.make_button({action:"play",offset:1}),this.stop=this.make_button({action:"stop",offset:1})},t}(i),p=typeof exports!="undefined"&&exports!==null?exports:this,p.PlayResetComponentSVG=u,f=function(e){function t(){t.__super__.constructor.apply(this,arguments)}return v(t,e),t.prototype.setup_buttons=function(){return this.reset=this.make_button({action:"reset",offset:0}),this.back=this.make_button({action:"back",offset:1}),this.play=this.make_button({action:"play",offset:2}),this.stop=this.make_button({action:"stop",offset:2}),this.forward=this.make_button({action:"forward",offset:3})},t}(i),p=typeof exports!="undefined"&&exports!==null?exports:this,p.PlaybackComponentSVG=f,l=function(){function e(e,t,n,r,i){this.dom_id=e!=null?e:"#slider",this.value_changed_function=t,this.min=n,this.max=r,this.value=i,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return e.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},e.prototype.init_view=function(){var e;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),e=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=e,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(e=this.height/4,this.y1=this.y2=e,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},e.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},e.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},e.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/4,this.update_handle()},e.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},e.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},e.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},e.prototype.set_scaled_value=function(e){return this.value=(e-this.min)/this.domain,this.handle_x=e/this.domain*this.width,this.update()},e.prototype.scaled_value=function(){var e;return e=this.value,e*=this.max-this.min,e+=this.min,e},e.prototype.update_label=function(){var e;return this.label?(e=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+e)):this.text_label.hide()},e.prototype.handle_mousedown=function(e){var t=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(e){return t.handle_mouseup(e)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(e){return t.handle_drag(e)}),this.handle_drag(e)},e.prototype.handle_drag=function(e){var t,n,r,i;return this.dragging?(document.onselectstart=function(){return!1},r=e.pageX-this.slider_well.position().left,i=e.pageY-this.slider_well.position().top,this.horizontal_orientation()?(t=this.width-this.handle_width/4,n=this.handle_width/4,this.handle_x=r,this.handle_x<n&&(this.handle_x=n),this.handle_x>t&&(this.handle_x=t),this.value=this.handle_x/this.width):(this.handle_y=e.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},e.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},e.prototype.init_mouse_handlers=function(){var e=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(t){return e.handle_mousedown(t)})},e}(),p=typeof exports!="undefined"&&exports!==null?exports:this,p.SliderComponent=l,c=function(){function e(e,t,n,r){this.dom_selector=e!=null?e:"#thermometer",this.value=t,this.min=n,this.max=r,this.resize=m(this.resize,this),this.dom_element=typeof this.dom_selector=="string"?$(this.dom_selector):this.dom_selector,this.dom_element.addClass("thermometer"),this.thermometer_fill=$("<div>").addClass("thermometer_fill"),this.dom_element.append(this.thermometer_fill),this.redraw()}return e.prototype.add_value=function(e){return this.value=e,this.redraw()},e.prototype.scaled_value=function(){return(this.value-this.min)/(this.max-this.min)},e.prototype.resize=function(){return this.redraw()},e.prototype.redraw=function(){return this.thermometer_fill.height(""+this.scaled_value()*this.dom_element.height()+"px")},e}(),p=typeof exports!="undefined"&&exports!==null?exports:this,p.Thermometer=c}).call(this);