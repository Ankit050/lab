((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=Object.prototype.hasOwnProperty,o=function(a,b){function d(){this.constructor=a}for(var c in b)n.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};m=typeof exports!="undefined"&&exports!==null?exports:this,c=function(){function a(a){this.dom_id=a,this.dom_id?this.dom_element=$(this.dom_id):this.dom_element=$("<div>"),this.dom_element.addClass("component")}return a}(),b=function(a){function b(a,c,d){this.dom_id=a,this.name=c!=null?c:"play",this.actions=d!=null?d:[],b.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button").addClass(this.name).addClass("up"),this.state="up",this.init_mouse_handlers()}return o(b,a),b.prototype.set_state=function(a){return this.dom_element.removeClass(this.state),this.state=a,this.dom_element.addClass(this.state)},b.prototype.init_mouse_handlers=function(){var a,b=this;return a=this,this.dom_element.mousedown(function(b){return a.set_state("down")}),this.dom_element.mouseup(function(){return a.set_state("up"),a.do_action()}),this.dom_element.mouseleave(function(){return a.set_state("up")})},b.prototype.add_action=function(a){return this.actions.push(a)},b.prototype.do_action=function(){var a,b,c,d,e;d=this.actions,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a());return e},b}(c),m.ButtonComponent=b,l=function(a){function b(a,c){var d,e,f;this.dom_id=a,c==null&&(c=[]),b.__super__.constructor.call(this,this.dom_id,"toggle"),this.buttons=[];for(e=0,f=c.length;e<f;e++)d=c[e],this.add_button(d);this.button_index=0,this.enable_button(0)}return o(b,a),b.prototype.add_button=function(a){var b,c;a.dom_element.remove(),a.dom_element.css("margin","0px"),this.dom_element.append(a.dom_element),this.buttons.push(a),this.add_width(a.dom_element),this.add_height(a.dom_element),c=this,b=this.buttons.length-1;if(b!==this.button_index)return this.disable_button(b)},b.prototype.add_width=function(a){var b,c;c=this.dom_element.width(),b=a.outerWidth(!0);if(c<b)return this.dom_element.width(""+b+"px")},b.prototype.add_height=function(a){var b,c;c=this.dom_element.height(),b=a.outerHeight(!0);if(c<b)return this.dom_element.height(""+b+"px")},b.prototype.disable_button=function(a){var b;b=this.buttons[a];if(b)return b.dom_element.addClass("hidden")},b.prototype.enable_button=function(a){var b;b=this.buttons[a];if(b)return b.dom_element.removeClass("hidden")},b.prototype.set_active=function(a){return this.disable_button(this.button_index),this.button_index=a,this.button_index=this.button_index%this.buttons.length,this.enable_button(this.button_index)},b.prototype.enable_next_button=function(){return this.set_active(this.button_index+1)},b.prototype.current_button=function(){return this.button_index<this.buttons.length?this.buttons[this.button_index]:null},b.prototype.do_action=function(){if(this.current_button())return this.current_button().do_action(),this.enable_next_button()},b}(b),m.ToggleButtonComponent=l,a=function(a){function b(a,c){var d,e,f;this.dom_id=a,c==null&&(c=[]),b.__super__.constructor.call(this,this.dom_id),this.dom_element.addClass("button_bar"),this.buttons=[],this.dom_element.width("1px"),this.dom_element.height("1px");for(e=0,f=c.length;e<f;e++)d=c[e],this.add_button(d)}return o(b,a),b.prototype.add_button=function(a){var b;return b=a.dom_element,this.dom_element.append(b),this.add_width(b),this.add_height(b),this.buttons.push(a)},b.prototype.add_width=function(a){var b;return b=this.dom_element.width(),b+=a.outerWidth(!0),this.dom_element.width(""+b+"px")},b.prototype.add_height=function(a){var b,c;c=this.dom_element.height(),b=a.outerHeight(!0);if(c<b)return this.dom_element.height(""+b+"px")},b}(c),m.ButtonBarComponent=a,g=function(a){function c(a,d,e){var f,g,h,i,j,k=this;this.dom_id=a,this.playable=d,e==null&&(e=!0),c.__super__.constructor.call(this,this.dom_id),i=new b(null,"play"),i.add_action(function(){return k.playable.play()}),h=new b(null,"pause"),h.add_action(function(){return k.playable.stop()}),this.toggle=new l(null,[i,h]),this.play_index=0,this.stop_index=1,j=new b(null,"reset"),j.add_action(function(){return k.playable.seek(1),k.play()}),this.add_button(j),e||(g=new b(null,"forward"),g.add_action(function(){return k.playable.forward(),k.stop()}),this.add_button(g)),this.add_button(this.toggle),e||(f=new b(null,"back"),f.add_action(function(){return k.playable.back(),k.stop()}),this.add_button(f)),this.play()}return o(c,a),c.prototype.stop=function(){return this.toggle.set_active(this.play_index)},c.prototype.play=function(){return this.toggle.set_active(this.stop_index)},c}(a),m.PlaybackBarComponent=g,d=function(){function a(a,b){var c=this;this.dom_id=a!=null?a:"#slider",this.value_changed_function=b,this.dom_element=$(this.dom_id),this.precision=this.dom_element.attr("data-precision")||3,this.min=this.dom_element.attr("data-min")||0,this.max=this.dom_element.attr("data-max")||1,this.step=this.dom_element.attr("data-stop")||.01,this.value=this.dom_element.attr("data-value")||.5,this.label=this.dom_element.attr("data-label"),this.label_id=this.dom_element.attr("data-label-id"),this.orientation=this.dom_element.attr("data-orientation")||"horizontal",this.dom_element.slider(),this.update_options(),this.dom_element.bind("slide",function(a,b){console.log("slider value: "+b.value),c.update_label(b.value);if(c.value_changed_function)return c.value_changed_function(b.value)}),this.update_label(this.value)}return a.prototype.set_max=function(a){return this.max=a,this.update_options()},a.prototype.set_min=function(a){return this.min=a,this.update_options()},a.prototype.update_options=function(){var a;return a={orientation:this.orientation,min:this.min,max:this.max,value:this.value,step:this.step,range:"min"},this.dom_element.slider("option",a)},a.prototype.update_label=function(a){if(this.label_id)return $(this.label_id).text(""+this.label+" "+a)},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.JSliderComponent=d,f=function(){function a(a,b,c,d,e){this.svg_element=a,this.playable=b!=null?b:null,this.offsets={play:1,stop:1},this.width=200,this.height=34,this.xpos=c,this.ypos=d,this.scale=e||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.group.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_play_button(),this.init_stop_button(),this.hide(this.play)},a.prototype.position=function(a,b,c){return this.xpos=a,this.ypos=b,this.scale=c||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlayOnlyComponentSVG=f,m.ModelPlayer=e,e=function(){function a(a){this.model=a,this.playing=!0}return a.prototype.play=function(){return this.model.resume(),this.playing=!0},a.prototype.stop=function(){return this.model.stop(),this.playing=!1},a.prototype.forward=function(){return this.stop(),this.model.stepForward()},a.prototype.back=function(){return this.stop(),this.model.stepBack()},a.prototype.seek=function(a){return this.stop(),this.model.seek(a),this.play()},a}(),h=function(){function a(a,b){this.dom_id=a!=null?a:"#playback",this.playable=b!=null?b:null,this.dom_element=d3.select(this.dom_id).attr("class","component playback"),this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=parseInt(this.dom_element.style("width")),this.height=parseInt(this.dom_element.style("height")),this.unit_width=this.width/9,this.height<this.unit_width&&(this.height=this.unit_width+2,this.dom_element.style("height",this.height+"px")),this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.svg.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_reset_button=function(){var a;return a=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",a)},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_back_button=function(){var a;return a=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",a)},a.prototype.init_forward_button=function(){var a;return a=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",a)},a.prototype.init_view=function(){return this.svg=this.dom_element.append("svg:svg").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlaybackComponent=h,m.ModelPlayer=e,i=function(){function a(a,b,c,d,e){this.svg_element=a,this.playable=b!=null?b:null,this.offsets={reset:0,back:1,play:2,stop:2,forward:3},this.width=200,this.height=34,this.xpos=c,this.ypos=d,this.scale=e||1,this.unit_width=this.width/9,this.vertical_padding=(this.height-this.unit_width)/2,this.stroke_width=this.unit_width/10,this.init_view()}return a.prototype.offset=function(a){return this.offsets[a]*this.unit_width*2+this.unit_width},a.prototype.make_button=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.group.append("svg:g"),i=this.offset(a),e.attr("x",i).attr("y",this.vertical_padding).attr("width",this.unit_width).attr("height",this.unit_width);for(k=0,m=c.length;k<m;k++){g=c[k],d=e.append(b),d.attr("class",""+a+" button-art"),h="";for(l=0,n=g.length;l<n;l++)f=g[l],i=this.offset(a)+f.x*this.unit_width,j=this.vertical_padding+f.y*this.unit_width,h+=" "+i+","+j,d.attr("points",h)}return e.on("click",function(){return o.action(a)}),e},a.prototype.action=function(a){console.log("running "+a+" ");if(this.playable)switch(a){case"play":this.playable.play();break;case"stop":this.playable.stop();break;case"forward":this.playable.forward();break;case"back":this.playable.back();break;case"reset":this.playable.seek(1);break;default:console.log("cant find action for "+a)}else console.log("no @playable defined");return this.update_ui()},a.prototype.init_reset_button=function(){var a;return a=[[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:.25,y:0},{x:.5,y:.25}]],this.reset=this.make_button("reset","svg:polyline",a)},a.prototype.init_play_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:.5},{x:0,y:1}]],this.play=this.make_button("play","svg:polygon",a)},a.prototype.init_stop_button=function(){var a;return a=[[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}]],this.stop=this.make_button("stop","svg:polygon",a)},a.prototype.init_back_button=function(){var a;return a=[[{x:.5,y:0},{x:0,y:.5},{x:.5,y:1}],[{x:1,y:0},{x:.5,y:.5},{x:1,y:1}]],this.back=this.make_button("back","svg:polyline",a)},a.prototype.init_forward_button=function(){var a;return a=[[{x:.5,y:0},{x:1,y:.5},{x:.5,y:1}],[{x:0,y:0},{x:.5,y:.5},{x:0,y:1}]],this.forward=this.make_button("forward","svg:polyline",a)},a.prototype.init_view=function(){return this.svg=this.svg_element.append("svg:svg").attr("class","component playbacksvg").attr("x",this.xpos).attr("y",this.ypos),this.group=this.svg.append("g").attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height),this.init_reset_button(),this.init_play_button(),this.init_stop_button(),this.init_forward_button(),this.init_back_button(),this.hide(this.play)},a.prototype.position=function(a,b,c){return this.xpos=a,this.ypos=b,this.scale=c||1,this.svg.attr("x",this.xpos).attr("y",this.ypos),this.group.attr("transform","scale("+this.scale+","+this.scale+")").attr("width",this.width).attr("height",this.height)},a.prototype.update_ui=function(){if(this.playable)return this.playable.playing?(this.hide(this.play),this.show(this.stop)):(this.hide(this.stop),this.show(this.play))},a.prototype.hide=function(a){return a.style("visibility","hidden")},a.prototype.show=function(a){return a.style("visibility","visible")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.PlaybackComponentSVG=i,m.ModelPlayer=e,j=function(){function a(a,b,c,d,e){this.dom_id=a!=null?a:"#slider",this.value_changed_function=b,this.min=c,this.max=d,this.value=e,this.dom_element=$(this.dom_id),this.dom_element.addClass("component").addClass("slider"),this.min=this.min||this.dom_element.attr("data-min")||0,this.max=this.max||this.dom_element.attr("data-max")||1,this.value=this.value||this.dom_element.attr("data-value")||.5,this.precision=this.dom_element.attr("data-precision")||3,this.label=this.dom_element.attr("data-label"),this.domain=this.max-this.min,this.mouse_down=!1,this.width=this.dom_element.width(),this.height=this.dom_element.height(),this.init_view(),this.init_mouse_handlers()}return a.prototype.horizontal_orientation=function(){if(this.width>this.height)return!0},a.prototype.init_view=function(){var a;return this.slider_well=$("<div>").addClass("slider_well"),this.dom_element.append(this.slider_well),a=this.width/2,this.y1=this.height,this.y2=0,this.x1=this.x2=a,this.handle_y=(this.y1+this.y2)/2,this.handle_x=(this.x1+this.x2)/2,this.horizontal_orientation()&&(a=this.height/4,this.y1=this.y2=a,this.x1=0,this.x2=this.width,this.handle_y=(this.y1+this.y2)/2,this.handle_x=this.value/this.domain*this.width),this.init_slider_fill(),this.slider_well_height=this.slider_well.height(),this.slider_well_width=this.slider_well.width(),this.init_handle(),this.init_label()},a.prototype.init_slider_fill=function(){return this.slider_fill=$("<div>").addClass("slider_fill"),this.slider_well.append(this.slider_fill),this.horizontal_orientation()?this.slider_fill.addClass("horizontal"):this.slider_fill.addClass("vertical"),this.update_slider_filled()},a.prototype.update_slider_filled=function(){return this.horizontal_orientation()?this.slider_fill.width(""+this.handle_x+"px"):this.slider_fill.height(""+this.handle_y+"px")},a.prototype.init_handle=function(){return this.handle=$("<div>").addClass("handle"),this.slider_well.append(this.handle),this.handle_width=parseInt(this.handle.width()),this.handle_height=parseInt(this.handle.height()),this.handle_width_offset=this.handle_width/2-(this.handle_width-this.slider_well_width)/2,this.handle_height_offset=this.handle_height/2-(this.handle_height-this.slider_well_height)/2,this.update_handle()},a.prototype.update=function(){return this.update_handle(),this.update_slider_filled(),this.update_label()},a.prototype.update_handle=function(){return this.handle.css("left",""+(this.handle_x-this.handle_width/2)+"px").css("top",""+(this.handle_y-this.handle_height_offset)+"px")},a.prototype.init_label=function(){return this.text_label=$("<div/>").addClass("label"),this.dom_element.append(this.text_label),this.update_label()},a.prototype.set_scaled_value=function(a){var b;return b=this.value,b*=this.max-this.min,b+=this.min,b},a.prototype.scaled_value=function(){var a;return a=this.value,a*=this.max-this.min,a+=this.min,a},a.prototype.update_label=function(){var a;return this.label?(a=this.scaled_value().toFixed(this.precision),this.text_label.text(""+this.label+": "+a)):this.text_label.hide()},a.prototype.handle_mousedown=function(a){var b=this;return this.dragging=!0,$(document).bind("mouseup.drag",this.documentMouseUpDelegate=function(a){return b.handle_mouseup(a)}),$(document).bind("mousemove.drag",this.documentMouseMoveDelegate=function(a){return b.handle_drag(a)}),this.handle_drag(a)},a.prototype.handle_drag=function(a){var b,c,d,e;return this.dragging?(document.onselectstart=function(){return!1},d=a.pageX-this.slider_well.position().left,e=a.pageY-this.slider_well.position().top,this.horizontal_orientation()?(b=this.width-this.handle_width/4,c=this.handle_width/4,this.handle_x=d,this.handle_x<c&&(this.handle_x=c),this.handle_x>b&&(this.handle_x=b),this.value=this.handle_x/this.width):(this.handle_y=a.y,this.handle.attr("cy",this.handle_y),this.slider_fill.attr("y",this.handle_y).attr("height",this.height-this.handle_y),this.value=this.handle_y/this.height),typeof this.value_changed_function=="function"&&this.value_changed_function(this.scaled_value()),this.update()):!1},a.prototype.handle_mouseup=function(){return document.onselectstart=function(){return!0},this.dragging&&($(document).unbind("mousemove",this.documentMouseMoveDelegate),$(document).unbind("mouseup",this.documentMouseUpDelegate),this.dragging=!1),!0},a.prototype.init_mouse_handlers=function(){var a=this;return this.slider_well.bind("mousedown",this.documentMouseUpDelegate=function(b){return a.handle_mousedown(b)})},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.SliderComponent=j,k=function(){function a(a){this.dom_id=a!=null?a:"#thermometer",this.dom_element=d3.select(this.dom_id).attr("class","thermometer"),this.width=1,this.height=12,this.max=.7,this.samples=[],this.last_draw_time=(new Date).getTime(),this.sample_interval_ms=250,this.last_draw_time-=this.sample_interval_ms,this.init_svg()}return a.prototype.init_svg=function(){return this.dom_element.style("border","1px solid black"),this.svg=this.dom_element.append("svg:svg").attr("width",this.width+"em").attr("height",this.height+"em").append("svg:g"),this.thermometer=this.svg.append("svg:rect"),this.thermometer.attr("width",this.width+"em"),this.thermometer.attr("height",this.height+"em"),this.thermometer.style("fill","#f4b626"),d3.select("#therm_text").attr("class","therm_text")},a.prototype.time_to_redraw=function(){var a;return a=(new Date).getTime(),a>this.last_draw_time+this.sample_interval_ms},a.prototype.add_value=function(a){this.samples.push(a);if(this.time_to_redraw())return this.redraw(),this.samples=[]},a.prototype.get_avg=function(){var a,b,c,d,e;b=0,e=this.samples;for(c=0,d=e.length;c<d;c++)a=e[c],b+=a;return b/this.samples.length},a.prototype.scaled_display_value=function(){return this.get_avg()/this.max*this.height},a.prototype.redraw=function(){var a,b;return a=this.get_avg().toFixed(4),b=this.scaled_display_value(),this.thermometer.attr("y",this.height-b+"em"),this.thermometer.attr("height",b+"em"),this.last_draw_time=(new Date).getTime(),d3.select("#therm_text").text("Temperature")},a}(),m=typeof exports!="undefined"&&exports!==null?exports:this,m.Thermometer=k})).call(this);