(function(){function K(){return C+B(model.stepCounter()*sample_time)+D}function L(a){return nodes[model.INDICES.X][a]}function M(a){return nodes[model.INDICES.Y][a]}function N(a){return nodes[model.INDICES.RADIUS][a]}function O(a){return nodes[model.INDICES.SPEED][a]}function P(a){return nodes[model.INDICES.VX][a]}function Q(a){return nodes[model.INDICES.VY][a]}function R(a){return nodes[model.INDICES.AX][a]}function S(a){return nodes[model.INDICES.AY][a]}function T(a){return nodes[model.INDICES.CHARGE][a]}function U(){layout.mc_container=u.append("svg:svg").attr("class","mc_container").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height),E=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","neg-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),E.append("svg:stop").attr("stop-color","#ffefff").attr("offset","0%"),E.append("svg:stop").attr("stop-color","#fdadad").attr("offset","40%"),E.append("svg:stop").attr("stop-color","#e95e5e").attr("offset","80%"),E.append("svg:stop").attr("stop-color","#fdadad").attr("offset","100%"),F=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","pos-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),F.append("svg:stop").attr("stop-color","#dfffff").attr("offset","0%"),F.append("svg:stop").attr("stop-color","#9abeff").attr("offset","40%"),F.append("svg:stop").attr("stop-color","#767fbf").attr("offset","80%"),F.append("svg:stop").attr("stop-color","#9abeff").attr("offset","100%"),G=layout.mc_container.append("svg:defs").append("svg:radialGradient").attr("id","neu-grad").attr("cx","50%").attr("cy","47%").attr("r","53%").attr("fx","35%").attr("fy","30%"),G.append("svg:stop").attr("stop-color","#dfffef").attr("offset","0%"),G.append("svg:stop").attr("stop-color","#75a643").attr("offset","40%"),G.append("svg:stop").attr("stop-color","#2a7216").attr("offset","80%"),G.append("svg:stop").attr("stop-color","#75a643").attr("offset","100%")}function ba(a){}function bb(a,b){H?(Z.style("opacity",1e-6),H=!1):(d3.event.shiftKey?H=b:H=!1,bc(b))}function bc(a){Z.style("opacity",1).style("left",l(nodes[model.INDICES.X][a])+I+6+"px").style("top",o(nodes[model.INDICES.Y][a])+J-30+"px").transition().duration(250),_.text(K()+"\n"+"speed: "+d3.format("+6.3e")(O(a))+"\n"+"vx:    "+d3.format("+6.3e")(P(a))+"\n"+"vy:    "+d3.format("+6.3e")(Q(a))+"\n"+"ax:    "+d3.format("+6.3e")(R(a))+"\n"+"ay:    "+d3.format("+6.3e")(S(a))+"\n")}function bd(a){}function be(){H||Z.style("opacity",1e-6)}function by(){var a=bv.selectAll("circle").data(lj_data.variables,function(a){return a}),b=bv.select("path").attr("d",lj_line(lennard_jones_potential)),c=bp.domain()[1]-bp.domain()[0];a.enter().append("svg:circle").attr("class",function(a){return a===bu?"selected":null}).attr("cx",function(a){return bp(a.x)}).attr("cy",function(a){return br(a.y)}).attr("r",8).on("mousedown",function(a){a.coefficient=="epsilon"?a.x=lj_data.coefficients.rmin:a.y=0,coefficient_selected=bu=a,by()}),a.attr("class",function(a){return a===coefficient_selected?"selected":null}).attr("cx",function(a){return bp(a.x)}).attr("cy",function(a){return br(a.y)}),a.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function bz(){if(!bu)return;bf.onselectstart=function(){return!1};var a=d3.svg.mouse(bv.node()),b,c;bu.coefficient=="epsilon"?(b=lj_data.coefficients.rmin,c=br.invert(Math.max(0,Math.min(bj.height,a[1]))),c>lj_epsilon_max&&(c=lj_epsilon_max),c<lj_epsilon_min&&(c=lj_epsilon_min),update_epsilon(c)):(c=0,b=bp.invert(Math.max(0,Math.min(bj.width,a[0]))),b<lj_sigma_min&&(b=lj_sigma_min),b>lj_sigma_max&&(b=lj_sigma_max),update_sigma(b)),layout.update_molecule_radius(),model.tick(),bu.x=b,bu.y=c,by()}function bA(){isNaN(bq)||(bf.onselectstart=function(){return!0},layout.lj_redraw(),bq=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(bs)||(layout.lj_redraw(),bs=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),bu=null}function bW(){bU=model.get_speed(),speed_graph.xmax=d3.max(bU),speed_graph.xmin=d3.min(bU),speed_graph.quantile=d3.quantile(bU,.1),bP=speed_graph.ymax,bK=d3.scale.linear().domain([speed_graph.xmin,speed_graph.xmax]).range([0,bF]),bL=d3.scale.linear().domain([speed_graph.ymax,speed_graph.ymin]).nice().range([0,bG])}function bX(){speed_bins=d3.layout.histogram().frequency(!1).bins(bK.ticks(60))(bU),bM=(bE.width-speed_bins.length)/speed_bins.length,bO=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y})}function cf(){layout.lennard_jones_forces_checkbox.checked?model.set_lennard_jones_forces(!0):model.set_lennard_jones_forces(!1)}function cg(){layout.coulomb_forces_checkbox.checked?model.set_coulomb_forces(!0):model.set_coulomb_forces(!1),layout.setup_particles()}typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),layout={version:"0.0.1"},layout.selection="",layout.display={},layout.canonical={width:1280,height:800},layout.regular_display=!1,layout.not_rendered=!0,layout.fontsize=!1,layout.cancelFullScreen=!1,layout.screen_factor=1,layout.checkbox_factor=1.1,layout.checkbox_scale=1.1,layout.canonical.width=1280,layout.canonical.height=800,layout.getDisplayProperties=function(a){if(!arguments.length)var a={};return a.screen={width:screen.width,height:screen.height},a.client={width:document.body.clientWidth,height:document.body.clientHeight},a.window={width:document.width,height:document.height},a.page={width:layout.getPageWidth(),height:layout.getPageHeight()},a},layout.checkForResize=function(){(layout.display.screen.width!=screen.width||layout.display.screen.height!=screen.height||layout.display.window.width!=document.width||layout.display.window.height!=document.height)&&layout.setupScreen()},layout.setupScreen=function(a){function d(){b.style.width=layout.display.page.width*.42+"px",b.style.height=layout.display.page.width*.4-4+"px",layout.finishSetupMoleculeContainer()}function e(){bf.style.width=layout.display.page.width*.24+"px",bf.style.height=layout.display.page.width*.18+"px",layout.finishSetupPotentialChart()}function f(){speed_distribution_chart.style.width=layout.display.page.width*.23+"px",speed_distribution_chart.style.height=layout.display.page.width*.18+"px",layout.finishSetupSpeedDistributionChart()}function g(){kechart.style.width=layout.display.page.width*.48+4+"px",kechart.style.height=layout.display.page.width*.2+5+"px",layout.finishSetupKEChart()}function h(){b.style.width=layout.display.page.height*.7+"px",b.style.height=layout.display.page.height*.7+"px",layout.finishSetupMoleculeContainer()}function i(){bf.style.width=layout.display.page.width*.24+"px",bf.style.height=layout.display.page.height*.28+"px",layout.finishSetupPotentialChart()}function j(){speed_distribution_chart.style.width=layout.display.page.width*.22+"px",speed_distribution_chart.style.height=layout.display.page.height*.28+"px",layout.finishSetupSpeedDistributionChart()}function k(){kechart.style.width=layout.display.page.width*.47+5+"px",kechart.style.height=layout.display.page.height*.4+0+"px",layout.finishSetupKEChart()}function l(){var a=layout.display.page.height*.74;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function m(){var a=document.getElementById("description-right");a!==null&&(a.style.width=Math.max(layout.display.page.width*.3,layout.display.page.width-layout.display.page.height-20)+"px")}function n(){var a=layout.display.page.height*.78;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function o(){var a=layout.display.page.height*.75;b.style.width=a+"px",b.style.height=a+"px",layout.finishSetupMoleculeContainer()}function p(){var a=document.getElementById("description-right");a!==null&&(a.style.width=layout.display.window.width*.3+"px")}var c=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen;layout.display=layout.getDisplayProperties(),layout.regular_display||(layout.regular_display=layout.getDisplayProperties());if(c){layout.screen_factor=layout.display.screen.width/layout.canonical.width,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor),layout.bodycss.style.fontSize=layout.screen_factor+"em",layout.not_rendered=!0;switch(layout.selection){case"simple-screen":o(),p();break;case"simple-static-screen":layout.not_rendered&&(o(),m());break;case"simple-iframe":o(),p();break;default:h(),i(),j(),k()}}else{layout.cancelFullScreen?(layout.cancelFullScreen=!1,layout.regular_display=layout.previous_display):layout.regular_display=layout.getDisplayProperties(),layout.screen_factor=layout.regular_display.page.width/layout.canonical.width,layout.checkbox_factor=Math.max(.8,layout.checkbox_scale*layout.screen_factor);switch(layout.selection){case"simple-screen":layout.bodycss.style.fontSize=layout.screen_factor+"em",l(),m();break;case"simple-static-screen":layout.not_rendered&&(layout.bodycss.style.fontSize=layout.screen_factor+"em",l(),m(),layout.not_rendered=!1);break;case"simple-iframe":layout.bodycss.style.fontSize=layout.screen_factor+"em",n();break;case"full-static-screen":layout.not_rendered&&(layout.bodycss.style.fontSize=layout.screen_factor+"em",d(),e(),f(),g(),layout.not_rendered=!1);break;default:layout.bodycss.style.fontSize=layout.screen_factor+"em",d(),e(),f(),g()}layout.regular_display=layout.getDisplayProperties()}layout.transform&&$("input[type=checkbox]").css(layout.transform,"scale("+layout.checkbox_factor+","+layout.checkbox_factor+")"),layout.setupTemperature(),bZ&&(bZ.style.display="none")},layout.getStyleForSelector=function(a){var b,c=document.styleSheets;for(var d=0;d<c.length;d++)if(c[d])try{b=c[d].rules||c[d].cssRules;if(b)for(var e=0;e<b.length;e++)if(b[e].selectorText==a)return b[e]}catch(f){}return!1},layout.getPageHeight=function(){var a;return self.innerHeight?a=self.innerHeight:document.documentElement&&document.documentElement.clientHeight?a=document.documentElement.clientHeight:document.body&&(a=layout.display.window.height),a},layout.getPageWidth=function(){var a;return self.innerWidth?a=self.innerWidth:document.documentElement&&document.documentElement.clientWidth?a=document.documentElement.clientWidth:document.body&&(a=window.width),a},layout.getTransformProperty=function(a){var b=["transform","WebkitTransform","msTransform","MozTransform","OTransform"],c;while(c=b.shift())if(typeof a.style[c]!="undefined")return c;return!1};var a=document.getElementById("description-right");a!==null&&(layout.fontsize=parseInt(layout.getStyleForSelector("#description-right").style.fontSize)),layout.bodycss=layout.getStyleForSelector("body"),layout.transform=layout.getTransformProperty(document.body);var b=document.getElementById("molecule-container"),c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,z,A,B=d3.format("5.3f"),C="time: ",D=" (ns)",E,F,G,H,I,J;layout.finishSetupMoleculeContainer=function(){mc_graph.grid_lines=mc_graph.grid_lines==undefined|mc_graph.grid_lines,mc_graph.xunits=mc_graph.xunits==undefined|mc_graph.xunits,mc_graph.yunits=mc_graph.yunits==undefined|mc_graph.yunits,mc_graph.model_time_label=mc_graph.model_time_label==undefined|mc_graph.model_time_label,mc_graph.atom_mubers=mc_graph.atom_mubers==undefined|mc_graph.atom_mubers,mc_graph.playback_controller=mc_graph.playback_controller==undefined|mc_graph.playback_controller,mc_graph.playback_only_controller=mc_graph.playback_only_controller==undefined|mc_graph.playback_only_controller,c=b.clientWidth,d=b.clientHeight,e={top:mc_graph.title?40*layout.screen_factor:20,right:25,bottom:mc_graph.xlabel?46*layout.screen_factor:20,left:mc_graph.ylabel?60*layout.screen_factor:25};if(mc_graph.playback_controller||mc_graph.playback_only_controller)e.bottom+=30*layout.screen_factor;f={width:c-e.left-e.right,height:d-e.top-e.bottom},I=b.offsetLeft+e.left,J=b.offsetTop+e.top,z=f.width/2-50,A=f.height+(mc_graph.ylabel?75*layout.screen_factor:30),g=f.width,h=f.height,i=function(a,b){return"translate("+l(a)+",0)"},j=function(a,b){return"translate(0,"+o(a)+")"},k=function(a,b){return a?"#ccc":"#666"},l=d3.scale.linear().domain([mc_graph.xmin,mc_graph.xmax]).range([0,g]),m=l.copy(),n=Math.NaN,o=d3.scale.linear().domain([mc_graph.ymax,mc_graph.ymin]).nice().range([0,h]).nice(),p=o.copy(),q=Math.NaN,r=null,undefined!==u?(d3.select(b).select("svg").attr("width",c).attr("height",d),u.select("svg").attr("width",c).attr("height",d),u.select("rect.mc_plot").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE"),u.select("svg.mc_container").attr("top",0).attr("left",0).attr("width",f.width).attr("height",f.height).attr("viewBox","0 0 "+f.width+" "+f.height),mc_graph.title&&u.select("text.title").attr("x",f.width/2).attr("dy","-1em"),mc_graph.xlabel&&u.select("text.xlabel").attr("x",f.width/2).attr("y",f.height),mc_graph.ylabel&&u.select("text.ylabel").attr("transform","translate(-40 "+f.height/2+") rotate(-90)"),mc_graph.model_time_label&&w.text(K()).attr("x",f.width-100).attr("y",f.height),u.selectAll("g.x").remove(),u.selectAll("g.y").remove(),layout.update_molecule_radius(),V.attr("cx",function(a,b){return l(L(b))}).attr("cy",function(a,b){return o(M(b))}).attr("r",function(a,b){return l(N(b))}),W.attr("transform",function(a,b){return"translate("+l(L(b))+","+o(M(b))+")"}),(mc_graph.playback_controller||mc_graph.play_only_controller)&&t.position(z,A,layout.screen_factor),layout.mc_redraw()):(s=d3.select(b).append("svg:svg").attr("width",c).attr("height",d),u=s.append("svg:g").attr("transform","translate("+e.left+","+e.top+")"),v=u.append("svg:rect").attr("class","mc_plot").attr("width",f.width).attr("height",f.height).style("fill","#EEEEEE"),mc_graph.title&&u.append("svg:text").attr("class","title").text(mc_graph.title).attr("x",f.width/2).attr("dy","-1em").style("text-anchor","middle"),mc_graph.xlabel&&u.append("svg:text").attr("class","xlabel").text(mc_graph.xlabel).attr("x",f.width/2).attr("y",f.height).attr("dy","2.4em").style("text-anchor","middle"),mc_graph.ylabel&&u.append("svg:g").append("svg:text").attr("class","ylabel").text(mc_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+f.height/2+") rotate(-90)"),mc_graph.model_time_label&&(w=u.append("svg:text").attr("class","model_time_label").text(K()).attr("x",f.width-100).attr("y",f.height).attr("dy","2.4em").style("text-anchor","start")),mc_graph.playback_controller&&(t=new PlaybackComponentSVG(s,model_player,z,A,layout.screen_factor)),mc_graph.play_only_controller&&(t=new PlayOnlyComponentSVG(s,model_player,z,A,layout.screen_factor)),layout.mc_redraw(),U())},layout.mc_redraw=function(){d3.event&&d3.event.transform&&isNaN(n)&&isNaN(q)&&d3.event.transform(x,y);var a=l.tickFormat(10),b=o.tickFormat(10);if(mc_graph.xunits){var c=u.selectAll("g.x").data(l.ticks(10),String).attr("transform",i);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",i);mc_graph.grid_lines&&d.append("svg:line").attr("stroke",k).attr("y1",0).attr("y2",f.height),d.append("svg:text").attr("y",f.height).attr("dy","1em").attr("text-anchor","middle").text(a),c.exit().remove()}if(mc_graph.xunits){var e=u.selectAll("g.y").data(o.ticks(10),String).attr("transform",j);e.select("text").text(b);var g=e.enter().insert("svg:g","a").attr("class","y").attr("transform",j).attr("background-fill","#FFEEB6");mc_graph.grid_lines&&g.append("svg:line").attr("stroke",k).attr("x1",0).attr("x2",f.width),g.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b),mc_graph.model_time_label&&w.text(K()),e.exit().remove()}},layout.update_molecule_radius=function(){var a=molecules_lennard_jones.coefficients(),b=a.rmin*mol_rmin_radius_factor;model.set_radius(b),layout.mc_container.selectAll("circle").data(atoms).attr("r",function(a,b){return l(N(b))}),layout.mc_container.selectAll("text").attr("font-size",l(b*1.3))};var V,W,X,Y,Z=d3.select("#viz").append("div").attr("class","tooltip").style("opacity",1e-6),_=Z.append("pre");layout.setup_particles=function(){var a=molecules_lennard_jones.coefficients(),b=a.rmin*mol_rmin_radius_factor;model.set_radius(b),layout.mc_container.selectAll("circle").remove(),layout.mc_container.selectAll("g").remove(),V=layout.mc_container.selectAll("circle").data(atoms),V.enter().append("svg:circle").attr("r",function(a,b){return l(N(b))}).attr("cx",function(a,b){return l(L(b))}).attr("cy",function(a,b){return o(M(b))}).style("cursor","crosshair").style("fill",function(a,b){return layout.coulomb_forces_checkbox.checked?l(T(b))>0?"url('#pos-grad')":"url('#neg-grad')":"url('#neu-grad')"}).on("mousedown",bb).on("mouseout",be);var c=l(a.rmin*mol_rmin_radius_factor*1.5);mol_number>100&&(c*=.9),W=layout.mc_container.selectAll("g.label").data(atoms),X=W.enter().append("svg:g").attr("class","label").attr("transform",function(a,b){return"translate("+l(L(b))+","+o(M(b))+")"}),mc_graph.atom_mubers?X.append("svg:text").attr("class","index").attr("font-size",c).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(a){return a.index}):X.append("svg:text").attr("class","index").attr("font-size",c).attr("style","font-weight: bold; opacity: .7").attr("x",0).attr("y","0.31em").text(function(a,b){return layout.coulomb_forces_checkbox.checked?"":""})},layout.update_molecule_positions=function(){mc_graph.model_time_label&&w.text(K()),W=layout.mc_container.selectAll("g.label").data(atoms),W.attr("transform",function(a,b){return"translate("+l(L(b))+","+o(M(b))+")"}),V=layout.mc_container.selectAll("circle").data(atoms),V.attr("cx",function(a,b){return l(nodes[model.INDICES.X][b])}).attr("cy",function(a,b){return o(nodes[model.INDICES.Y][b])}).attr("r",function(a,b){return l(nodes[model.INDICES.RADIUS][b])}),H&&bc(H)};var bf=document.getElementById("lj-potential-chart"),bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx;layout.finishSetupPotentialChart=function(){bg=bf.clientWidth,bh=bf.clientHeight,bi={top:lj_graph.title?36:20,right:30,bottom:lj_graph.xlabel?46:20,left:lj_graph.ylabel?60:45},bj={width:bg-bi.left-bi.right,height:bh-bi.top-bi.bottom},bk=bj.width,bl=bj.height,bm=function(a){return"translate("+bp(a)+",0)"},bn=function(a){return"translate(0,"+br(a)+")"},bo=function(a){return a?"#ccc":"#666"},bp=d3.scale.linear().domain([lj_data.xmin,lj_data.xmax]).range([0,bk]),bq=Math.NaN,br=d3.scale.linear().domain([lj_data.ymax,lj_data.ymin]).nice().range([0,bl]).nice(),lj_line=d3.svg.line().x(function(a,b){return bp(lennard_jones_potential[b][0])}).y(function(a,b){return br(lennard_jones_potential[b][1])}),bs=Math.NaN,bt=null,lj_selected=lj_data.variables[0],bu,coefficient_selected=lj_data.variables[0],undefined!==bv?(d3.select(bf).select("svg").attr("width",bg).attr("height",bh),bv.select("svg").attr("width",bg).attr("height",bh),bv.select("rect.plot").attr("width",bj.width).attr("height",bj.height).style("fill","#EEEEEE"),bv.select("svg.container").attr("top",0).attr("left",0).attr("width",bj.width).attr("height",bj.height).attr("viewBox","0 0 "+bj.width+" "+bj.height),bv.select("svg.linebox").attr("top",0).attr("left",0).attr("width",bj.width).attr("height",bj.height).attr("viewBox","0 0 "+bj.width+" "+bj.height),lj_graph.title&&bv.select("text.title").attr("x",bj.width/2).attr("dy","-1em"),lj_graph.xlabel&&bv.select("text.xlabel").attr("x",bj.width/2).attr("y",bj.height),lj_graph.ylabel&&bv.select("text.ylabel").attr("transform","translate(-40 "+bj.height/2+") rotate(-90)"),bv.selectAll("g.x").remove(),bv.selectAll("g.y").remove()):(bv=d3.select(bf).append("svg:svg").attr("width",bg).attr("height",bh).append("svg:g").attr("transform","translate("+bi.left+","+bi.top+")"),bw=bv.append("svg:rect").attr("class","plot").attr("width",bj.width).attr("height",bj.height).style("fill","#EEEEEE").attr("pointer-events","all").call(d3.behavior.zoom().x(bp).y(br).scaleExtent([1,8]).on("zoom",layout.lj_redraw)).on("mousedown",function(){d3.event.altKey&&(lj_points.push(lj_selected=bt=d3.svg.mouse(bv.node())),by(),d3.event.preventDefault(),d3.event.stopPropagation())}),bv.append("svg:svg").attr("class","linebox").attr("top",0).attr("left",0).attr("width",bj.width).attr("height",bj.height).attr("viewBox","0 0 "+bj.width+" "+bj.height).append("svg:path").attr("class","line").attr("d",lj_line(lennard_jones_potential)),lj_graph.title&&bv.append("svg:text").attr("class","title").text(lj_graph.title).attr("x",bj.width/2).attr("dy","-1em").style("text-anchor","middle"),lj_graph.xlabel&&bv.append("svg:text").attr("class","xlabel").text(lj_graph.xlabel).attr("x",bj.width/2).attr("y",bj.height).attr("dy","2.4em").style("text-anchor","middle"),lj_graph.ylabel&&bv.append("svg:g").append("svg:text").attr("class","ylabel").text(lj_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+bj.height/2+") rotate(-90)"),bv.on("mousemove",bz).on("mouseup",bA)),layout.lj_redraw()},layout.lj_redraw=function(){var a=bp.tickFormat(10),b=br.tickFormat(10),c=bv.selectAll("g.x").data(bp.ticks(10),String).attr("transform",bm);c.select("text").text(a);var d=c.enter().insert("svg:g","a").attr("class","x").attr("transform",bm);d.append("svg:line").attr("stroke",bo).attr("y1",0).attr("y2",bj.height),d.append("svg:text").attr("y",bj.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bv[0][0]);bq=bp.invert(b[0])}),c.exit().remove();var e=bv.selectAll("g.y").data(br.ticks(10),String).attr("transform",bn);e.select("text").text(b);var f=e.enter().insert("svg:g","a").attr("class","y").attr("transform",bn).attr("background-fill","#FFEEB6");f.append("svg:line").attr("stroke",bo).attr("x1",0).attr("x2",bj.width),f.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bv[0][0]);bs=br.invert(b[1])}),e.exit().remove(),by()},d3.select(bf).on("mousemove",function(a){var b=d3.svg.mouse(bv[0][0]);if(!isNaN(bq)){var c=bp.invert(b[0]),d=bp.domain()[0],e=bp.domain()[1],f=e-d;if(c!==0){var g,h,i;h=f/bq,g=1+(bq/c-1)*(f/(bq-d))/h,i=[d,d+f*g],bp.domain(i),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(bs)){var j=br.invert(b[1]),k=br.domain()[1],l=br.domain()[0],m=l-k;if(j!==0){var n,o,p;o=m/bs,n=1-(j/bs-1)*(m/(bs-k))/o,p=[k+m*n,k],br.domain(p),layout.lj_redraw()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(a){isNaN(bq)||(layout.lj_redraw(),bq=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(bs)||(layout.lj_redraw(),bs=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),speed_distribution_chart=document.getElementById("speed-distribution-chart");var bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV;layout.finishSetupSpeedDistributionChart=function(){bB=speed_distribution_chart.clientWidth,bC=speed_distribution_chart.clientHeight,bD={top:speed_graph.title?36:20,right:30,bottom:speed_graph.xlabel?46:20,left:speed_graph.ylabel?60:45},bE={width:bB-bD.left-bD.right,height:bC-bD.top-bD.bottom},bF=bE.width,bG=bE.height,bH=function(a){return"translate("+bK(a)+",0)"},bI=function(a){return"translate(0,"+bL(a)+")"},bJ=function(a){return a?"#ccc":"#666"},bW(),bX(),undefined!==bQ?(d3.select(speed_distribution_chart).select("svg").attr("width",bB).attr("height",bC),bQ.select("rect.plot").attr("width",bE.width).attr("height",bE.height),speed_graph.title&&bQ.select("text.title").attr("x",bE.width/2).attr("dy","-1em"),speed_graph.xlabel&&bQ.select("text.xlabel").attr("x",bE.width/2).attr("y",bE.height),speed_graph.ylabel&&bQ.select("text.ylabel").attr("transform","translate(-40 "+bE.height/2+") rotate(-90)"),bQ.selectAll("g.x").remove(),bQ.selectAll("g.y").remove()):(bQ=d3.select(speed_distribution_chart).append("svg:svg").attr("width",bB).attr("height",bC).append("svg:g").attr("transform","translate("+bD.left+","+bD.top+")"),bR=bQ.append("svg:rect").attr("class","plot").attr("width",bE.width).attr("height",bE.height).style("fill","#EEEEEE"),speed_graph.title&&bQ.append("svg:text").attr("class","title").text(speed_graph.title).attr("x",bE.width/2).attr("dy","-1em").style("text-anchor","middle"),speed_graph.xlabel&&bQ.append("svg:text").attr("class","xlabel").text(speed_graph.xlabel).attr("x",bE.width/2).attr("y",bE.height).attr("dy","2.4em").style("text-anchor","middle"),speed_graph.ylabel&&bQ.append("svg:g").append("svg:text").attr("class","ylabel").text(speed_graph.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+bE.height/2+") rotate(-90)")),layout.speed_redraw()},layout.speed_redraw=function(){d3.event&&d3.event.transform&&isNaN(speed_downx)&&isNaN(speed_downy)&&d3.event.transform(bK,bL);var a=bK.tickFormat(5),b=bL.tickFormat(5),c=bQ.selectAll("g.y").data(bL.ticks(5),String).attr("transform",bI);c.select("text").text(b);var d=c.enter().insert("svg:g","a").attr("class","y").attr("transform",bI).attr("background-fill","#FFEEB6");d.append("svg:line").attr("stroke",bJ).attr("x1",0).attr("x2",bE.width),d.append("svg:text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(bQ[0][0]);speed_downy=bL.invert(b[1]),speed_downscaley=bL.copy()}),c.exit().remove(),layout.speed_update()},layout.speed_update=function(){bW(),bU.length>2&&(speed_kde=science.stats.kde().sample(bU),bK.domain([speed_graph.xmin,speed_graph.xmax]),speed_bins=d3.layout.histogram().frequency(!0).bins(bK.ticks(60))(bU),bM=(bE.width-speed_bins.length)/speed_bins.length,bO=(speed_graph.xmax-speed_graph.xmin)/speed_bins.length,speed_max=d3.max(speed_bins,function(a){return a.y}),bQ.selectAll("g.bar").remove(),bS=bQ.selectAll("g.bar").data(speed_bins),bS.enter().append("svg:g").attr("class","bar").attr("transform",function(a,b){return"translate("+bK(a.x)+","+(bG-bL(bP-a.y))+")"}).append("svg:rect").attr("class","bar").attr("fill","steelblue").attr("width",bM).attr("height",function(a){return bL(bP-a.y)}))};var bY=document.getElementById("start-benchmarks"),bZ=document.getElementById("benchmarks-table"),b$=[{name:"molecules",run:function(){return mol_number}},{name:"temperature",run:function(){return temperature}},{name:"100 Steps (steps/s)",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}},{name:"100 Steps w/graphics",run:function(){modelStop();var a=+Date.now(),b=-1;while(b++<100)model.tick(),model_listener();return elapsed=Date.now()-a,d3.format("5.1f")(100/elapsed*1e3)}}];bY&&(bY.onclick=function(){benchmark.run(bZ,b$)}),layout.datatable_visible=!1;var b_=document.getElementById("toggle-datatable"),ca=document.getElementById("datatable-table");layout.hide_datatable=function(){ca&&(ca.style.display="none")},layout.render_datatable=function(a){function i(){return ca.getElementsByTagName("tr").length==0}function j(a){a=a||"data";var b=ca.appendChild(document.createElement("tr"));return b.className=a,b}function k(a,b,c,d){c=c||"td",d=d||1;var e=a.appendChild(document.createElement(c));e.textContent=b,d>1&&(e.colSpan=d)}function l(a,b,c){c=c||"td";var d;d=-1;while(++d<b.length)k(a,b[d])}function m(a,b,c){c=c||"td";var d=a.getElementsByTagName(c),f=0;if(d.length>0){d[0].textContent=b;while(++f<d.length)d[f].textContent=h[f](nodes[model.INDICES[e[f]]][b])}f--;while(++f<e.length)k(a,h[f](nodes[model.INDICES[e[f]]][b]))}function n(a,b){i()&&k(j("title"),a,"th"),k(results_row,b)}function o(a,b,c){c=c||1;var d;d=-1;while(++d<b.length)k(a,b[d],"th",c)}function p(a){var b=-1,c=d.length;while(++b<a)b>=d.length&&j();while(--c>=b)ca.removeChild(d[b]);return ca.getElementsByClassName("data")}function q(a,b){var c=-1;while(++c<b.length)k(a,b[c])}function r(a,b,c,d){var e;e=-1;while(++e<d.length)q(b[e],d[e])}ca.style.display="";var b,c=ca.getElementsByClassName("title"),d=ca.getElementsByClassName("data"),e=["PX","PY","X","Y","VX","VY","AX","AY","SPEED","RADIUS","MASS","CHARGE"],f=d3.format(" 2d"),g=d3.format(" 3.4f"),h=[f,g,g,g,g,g,g,g,g,g,g,g,f];a=a||!1;if(c.length==0){var s=j("title");o(s,e),d=p(atoms.length)}a&&(d=p(atoms.length)),b=-1;while(++b<atoms.length)m(d[b],b)},b_&&(b_.onclick=function(){layout.datatable_visible?(layout.datatable_visible=!1,b_.textContent="Show Data Table",ca.style.display="none"):(layout.datatable_visible=!0,b_.textContent="Hide Data Table",layout.render_datatable(),ca.style.display="")});var cb=document.getElementById("select-temperature"),cc=document.createElement("span");if(cb==null)layout.setupTemperature=function(){};else{layout.setupTemperature=function(){if(Modernizr.inputtypes.range){var a=document.createElement("input");a.type="range",a.min="0",a.max="25",a.step="0.5",a.value=+cb.value,cb.parentNode.replaceChild(a,cb),a.id="select-temperature",cb=a,cc.id="select-temperature-display",cc.innerText=temperature,cb.parentNode.appendChild(cc),cb=document.getElementById("select-temperature")}cb.onchange=cd};function cd(){temperature=+cb.value,cb.type==="range"&&(cc.innerText=d3.format("4.1f")(temperature)),model.temperature(temperature)}cb.type==="range"&&(cb.value=temperature,cc.innerText=d3.format("4.1f")(temperature)),layout.temperature_control_checkbox=document.getElementById("temperature-control-checkbox");function ce(){layout.temperature_control_checkbox.checked?model.set_temperature_control(!0):model.set_temperature_control(!1)}layout.temperature_control_checkbox.onchange=ce}layout.lennard_jones_forces_checkbox=document.getElementById("lennard-jones-forces-checkbox"),layout.lennard_jones_forces_checkbox&&(layout.lennard_jones_forces_checkbox.onchange=cf),layout.coulomb_forces_checkbox=document.getElementById("coulomb-forces-checkbox"),layout.coulomb_forces_checkbox&&(layout.coulomb_forces_checkbox.onchange=cg);var ch=document.getElementById("stats");layout.displayStats=function(){var a=model.ke(),b=model.pe(),c=a+b;ch&&(ch.textContent="Time: "+d3.format("5.3f")(model.stepCounter()*sample_time)+" (ns), "+"KE: "+d3.format("1.4f")(a)+", "+"TE: "+d3.format("1.4f")(c)+", "+"Pressure: "+d3.format("6.3f")(model.pressure())+", "+"Rate: "+d3.format("5.1f")(model.get_rate())+" (steps/s)")};if(document.querySelectorAll){var ci=document.querySelector("#fullscreen");ci&&(ci.style.cursor="pointer",ci.addEventListener("click",function(){var a=document.documentElement,b=a.requestFullScreen||a.webkitRequestFullScreen||a.mozRequestFullScreen,c=document.fullScreen||document.webkitIsFullScreen||document.mozFullScreen,d=document.cancelFullScreen||document.webkitCancelFullScreen||document.mozCancelFullScreen;b?c?(layout.cancelFullScreen=!0,d.call(document)):(layout.cancelFullScreen=!1,b.call(a)):alert("You'll need to use a newer browser to use the\nfull-screen API.\n\nChrome v15 (beta)\nhttp://www.google.com/landing/chrome/beta/\n\nChrome v17 Canary:\nhttp://tools.google.com/dlpage/chromesxs\n\nSafari v5.1.1:\n\nFireFox v9 Aurora:\nhttps://www.mozilla.org/en-US/firefox/channel/\n\nFireFox v10 Nightly\nhttp://nightly.mozilla.org/\nOpen 'about:config' and set: full-screen-api-enabled")},!1))}layout.heatCoolButtons=function(a,b,c,d){var e=new ButtonComponent(a,"circlesmall-plus"),f=new ButtonComponent(b,"circlesmall-minus");e.add_action(function(){var c=model.temperature();c<d?($(a).removeClass("inactive"),$(b).removeClass("inactive"),c=Math.floor(c*2)/2+.5,model.temperature(c)):$(a).addClass("inactive")}),f.add_action(function(){var d=model.temperature();d>c?($(a).removeClass("inactive"),$(b).removeClass("inactive"),d=Math.floor(d*2)/2-.5,model.temperature(d)):$(b).addClass("inactive")})}})();