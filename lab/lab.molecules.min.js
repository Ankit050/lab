(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){});var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=i._cached?i._cached:i();return s};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function a(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var s={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,t),e.modules[t]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),e.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),e.define("/node_modules/arrays/package.json",function(e,t,n,r,i){t.exports={}}),e.define("/node_modules/arrays/index.js",function(e,t,n,r,i){var s;s={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t=t||0;var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r};for(var a in s)s.hasOwnProperty(a)&&(n[a]=s[a])}),e.define("/constants/index.js",function(e,t,n,r,i){var s=e("./units"),o=s.unit,u=s.ratio,a=s.convert,f={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:u(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}},l,c;f.COULOMB_CONSTANT={value:1/(4*Math.PI*f.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},n.unit=o,n.ratio=u,n.convert=a;for(l in f)f.hasOwnProperty(l)&&(c=f[l],n[l]=function(e){return{as:function(t){return s.convert(e.value,{from:e.unit,to:t})}}}(c))}),e.define("/constants/units.js",function(e,t,n,r,i){var s=1.66054e-27,o=1.602177e-19,u=o,a=1e-15,f=1e-9,l=10,c=1e3,h={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},p,d,v;n.unit=p={FEMTOSECOND:{name:"femtosecond",value:1,type:h.TIME},SECOND:{name:"second",value:a,type:h.TIME},NANOMETER:{name:"nanometer",value:1,type:h.LENGTH},ANGSTROM:{name:"Angstrom",value:1*l,type:h.LENGTH},METER:{name:"meter",value:1*f,type:h.LENGTH},DALTON:{name:"Dalton",value:1,type:h.MASS},GRAM:{name:"gram",value:1*s*c,type:h.MASS},KILOGRAM:{name:"kilogram",value:1*s,type:h.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:h.ENERGY},JOULE:{name:"Joule",value:s*f*f*(1/a)*(1/a),type:h.ENERGY},EV:{name:"electron volt",value:s*f*f*(1/a)*(1/a)*(1/u),type:h.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:h.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*u,type:h.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:h.CHARGE},COULOMB:{name:"Coulomb",value:o,type:h.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:h.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:h.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:h.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:h.FORCE},NEWTON:{name:"Newton",value:1*s*f*(1/a)*(1/a),type:h.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*s*f*f*(1/a)*(1/a)*(1/u),type:h.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:h.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*f*(1/a),type:h.VELOCITY}},n.ratio=d=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},n.convert=v=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*d(r,{per:n})}}),e.define("/math/index.js",function(e,t,n,r,i){n.normal=e("./distributions").normal,n.getWindowedAverager=e("./utils").getWindowedAverager,n.minimize=e("./minimizer").minimize}),e.define("/math/distributions.js",function(e,t,n,r,i){n.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),e.define("/math/utils.js",function(e,t,n,r,i){n.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:NaN}}}),e.define("/math/minimizer.js",function(e,t,n,r,i){n.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var r=n.precision,i=n.bounds,s=n.maxiter||1e3,o=n.stopval||-Infinity,u=n.maxstep||.01,a=n.eps||.01,f=t.length,l,c,h,p,d,v,m,g,y,b;v=u*u,l=[];for(y=0;y<f;y++)l[y]=t[y];c=e.apply(null,l),h=c[0],d=c[1],g=0;do{if(h<=o)break;if(g>s)return console.log("maxiter reached"),{error:"maxiter reached",f:h,iter:s,x:l};m=0;for(y=0;y<f;y++)m+=d[y]*d[y];if(a*a*m>v){b=Math.sqrt(v/m)/a;for(y=0;y<f;y++)d[y]=b*d[y]}for(y=0;y<f;y++)l[y]-=a*d[y],i&&l[y]<i[y][0]&&(l[y]=i[y][0]),i&&l[y]>i[y][1]&&(l[y]=i[y][1]);p=h,c=e.apply(null,l),h=c[0],d=c[1],g++}while(Math.abs(h-p)>r);return[h,l]}}),e.define("/potentials/index.js",function(e,t,n,r,i){var s=n.potentials={};n.coulomb=e("./coulomb"),n.lennardJones=e("./lennard-jones")}),e.define("/potentials/coulomb.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=.346;COULOMB_CONSTANT_IN_METERS_PER_FARAD=s.COULOMB_CONSTANT.as(s.unit.METERS_PER_FARAD),NANOMETERS_PER_METER=s.ratio(o.NANOMETER,{per:o.METER}),COULOMBS_SQ_PER_ELEMENTARY_CHARGE_SQ=Math.pow(s.ratio(o.COULOMB,{per:o.ELEMENTARY_CHARGE}),2),EV_PER_JOULE=s.ratio(o.EV,{per:o.JOULE}),MW_FORCE_UNITS_PER_NEWTON=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON}),k_ePotential=u*COULOMB_CONSTANT_IN_METERS_PER_FARAD*COULOMBS_SQ_PER_ELEMENTARY_CHARGE_SQ*NANOMETERS_PER_METER*EV_PER_JOULE,k_eForce=u*COULOMB_CONSTANT_IN_METERS_PER_FARAD*COULOMBS_SQ_PER_ELEMENTARY_CHARGE_SQ*NANOMETERS_PER_METER*NANOMETERS_PER_METER*MW_FORCE_UNITS_PER_NEWTON,potential=n.potential=function(e,t,n){return k_ePotential*(t*n/e)},forceFromSquaredDistance=n.forceFromSquaredDistance=function(e,t,n){return-k_eForce*(t*n/e)},forceOverDistanceFromSquaredDistance=n.forceOverDistanceFromSquaredDistance=function(e,t,n){return forceFromSquaredDistance(e,t,n)/Math.sqrt(e)},force=n.force=function(e,t,n){return forceFromSquaredDistance(e*e,t,n)}}),e.define("/potentials/lennard-jones.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.ratio(o.NANOMETER,{per:o.METER}),a=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON});n.pairwiseEpsilon=function(e,t){return.5*(e+t)},n.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},n.rmin=function(e){return Math.pow(2,1/6)*e},n.radius=function(e){return.5*e},n.newLJCalculator=function(e,t){var r,i,f,l,c,h,p,d=function(e,d){r=e,i=d,f=n.rmin(i),r!=null&&i!=null&&(l=4*r*Math.pow(i,12),c=4*r*Math.pow(i,6),h=12*s.convert(l,{from:o.EV,to:o.JOULE})*u*a,p=6*s.convert(c,{from:o.EV,to:o.JOULE})*u*a),typeof t=="function"&&t(v(),this)},v=function(){return{epsilon:r,sigma:i,rmin:f}},m=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},g=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},y;return m(e.epsilon),g(e.sigma),d(e.epsilon,e.sigma),y={coefficients:v,setEpsilon:function(e){m(e),d(e,i)},setSigma:function(e){g(e),d(r,e)},potentialFromSquaredDistance:function(e){return e?l*Math.pow(e,-6)-c*Math.pow(e,-3):-Infinity},potential:function(e){return y.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*y.forceOverDistanceFromSquaredDistance(e*e)}}}}),e.define("/md2d.js",function(e,t,n,r,i){typeof window=="undefined"&&(window={});var s=e("arrays"),o=e("./constants"),u=o.unit,a=e("./math"),f=e("./potentials").coulomb,l=e("./potentials").lennardJones,c=!0,h=function(){try{new Float32Array}catch(e){return!1}return!0}(),p=1,d=1e3,v=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),m=.34,g=39.95,y=o.convert(g,{from:u.DALTON,to:u.KILOGRAM}),b=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),w=8e-5,E,S,x,T,N,C,k=function(e,t,n,r){return e*r-t*n},L=function(e,t){return e*e+t*t},A=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/b},O=function(e,t){var n=2*t,r=e*b,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},M=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")},_=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t};n.ELEMENT_INDICES=S={MASS:0,EPSILON:1,SIGMA:2,RADIUS:3},n.INDICES=E={RADIUS:0,PX:1,PY:2,X:3,Y:4,VX:5,VY:6,SPEED:7,AX:8,AY:9,CHARGE:10,ELEMENT:11,PINNED:12,FRICTION:13,VISIBLE:14},n.ATOM_PROPERTIES={RADIUS:"radius",PX:"px",PY:"py",X:"x",Y:"y",VX:"vx",VY:"vy",SPEED:"speed",AX:"ax",AY:"ay",CHARGE:"charge",ELEMENT:"element",PINNED:"pinned",FRICTION:"friction",VISIBLE:"visible"},n.OBSTACLE_INDICES=x={X:0,Y:1,WIDTH:2,HEIGHT:3,MASS:4,VX:5,VY:6,X_PREV:7,Y_PREV:8,COLOR_R:9,COLOR_G:10,COLOR_B:11,VISIBLE:12},n.RADIAL_INDICES=N={ATOM1:0,ATOM2:1,LENGTH:2,STRENGTH:3},n.VDW_INDICES=C={ATOM1:0,ATOM2:1},n.SAVEABLE_INDICES=T=["X","Y","VX","VY","CHARGE","ELEMENT","PINNED","FRICTION","VISIBLE"],n.makeModel=function(){var e,t=!1,n=!1,r=!1,i=!1,v=!0,m=!1,g=!1,y=!1,b,O=.001,D=[10,10],P,H=0,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt=0,ct,ht,pt,dt,vt,mt=0,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt=0,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut=window.state={},zt=[],Wt=[],Xt=5,Vt=[],$t=[],Jt=function(e,t,n){Vt[e][t]=Vt[t][e]=Xt*Xt*n.sigma*n.sigma,e===t&&Kt(e,n)},Kt=function(e,t){q[e][S.RADIUS]=l.radius(t.sigma);if(!R||!Y)return;for(var n=0,r=R.length;n<r;n++)R[n]=q[Y[n]][S.RADIUS]},Qt=function(t){var r=[],i,o;for(o=0;o<nt.length;o++)r[o]=nt[o];i=I,n=!1,e.createAtoms({num:t});for(o=0;o<nt.length;o++)s.copy(r[o],nt[o]);F=r[0].length,I=i},Gt=function(t){var n=h&&c?"Float32Array":"regular",r=h&&c?"Uint16Array":"regular",i=N;ut=e.radialBonds=[],ut[i.ATOM1]=rt=s.create(t,0,r),ut[i.ATOM2]=it=s.create(t,0,r),ut[i.LENGTH]=st=s.create(t,0,n),ut[i.STRENGTH]=ot=s.create(t,0,n)},Yt=function(e){var t=[],n;for(n=0;n<ut.length;n++)t[n]=ut[n];Gt(e);for(n=0;n<ut.length;n++)s.copy(t[n],ut[n])},Zt=function(t){var n=h&&c?"Float32Array":"regular",r=h&&c?"Uint16Array":"regular";vt=e.springForces=[],vt[0]=ct=s.create(t,0,r),vt[1]=ht=s.create(t,0,n),vt[2]=pt=s.create(t,0,n),vt[3]=dt=s.create(t,0,n)},en=function(e){var t=[],n;if(vt)for(n=0;n<vt.length;n++)t[n]=vt[n];Zt(e);for(n=0;n<t.length;n++)s.copy(t[n],vt[n])},tn=function(t){var n=h&&c?"Float32Array":"regular",r=h&&c?"Uint8Array":"regular",i=x;Ot=e.obstacles=[],Ot[i.X]=gt=s.create(t,0,n),Ot[i.Y]=yt=s.create(t,0,n),Ot[i.WIDTH]=bt=s.create(t,0,n),Ot[i.HEIGHT]=wt=s.create(t,0,n),Ot[i.MASS]=xt=s.create(t,0,n),Ot[i.VX]=Et=s.create(t,0,n),Ot[i.VY]=St=s.create(t,0,n),Ot[i.X_PREV]=Tt=s.create(t,0,n),Ot[i.Y_PREV]=Nt=s.create(t,0,n),Ot[i.COLOR_R]=Ct=s.create(t,0,n),Ot[i.COLOR_G]=kt=s.create(t,0,n),Ot[i.COLOR_B]=Lt=s.create(t,0,n),Ot[i.VISIBLE]=At=s.create(t,0,r)},nn=function(e){var t=[],n;for(n=0;n<Ot.length;n++)t[n]=Ot[n];tn(e);for(n=0;n<Ot.length;n++)s.copy(t[n],Ot[n])},rn,sn=function(){return r&&i?1e3:1e3},on=function(){y=!0,rn=a.getWindowedAverager(sn())},un=function(){var e=0,t;for(t=0;t<F;t++)e+=q[Y[t]][0]*(V[t]*V[t]+$[t]*$[t]);return A(e/2,F)},an=function(e,t){V[e]*=t,$[e]*=t,U[e]*=t,z[e]*=t},fn=function(e,t,n){V[e]+=t,$[e]+=n,U[e]=V[e]*q[Y[e]][0],z[e]=$[e]*q[Y[e]][0]},ln=function(e,t){V[e]-=t*(X[e]-Dt),$[e]+=t*(W[e]-_t),U[e]=V[e]*q[Y[e]][0],z[e]=$[e]*q[Y[e]][0]},cn=function(){for(var e=0;e<F;e++)fn(e,-Bt,-jt),ln(e,-qt)},hn=function(){var e=0,t=0,n=0,r=0,i;for(i=0;i<F;i++)e+=W[i],t+=X[i],n+=U[i],r+=z[i];_t=e/F,Dt=t/F,Pt=n,Ht=r,Bt=n/I,jt=r/I},pn=function(){var e=0,t=0,n,r;for(r=0;r<F;r++)n=q[Y[r]][0],e+=n*k(W[r]-_t,X[r]-Dt,V[r]-Bt,$[r]-jt),t+=n*L(W[r]-_t,X[r]-Dt);Ft=e,It=t,qt=Ft/It},dn=function(){hn(),pn()},vn=function(e){W[e]+=V[e]*B+.5*K[e]*j,X[e]+=$[e]*B+.5*Q[e]*j},mn=function(e){var t=Et[e],n=St[e];if(t||n)Tt[e]=gt[e],Nt[e]=yt[e],gt[e]+=t*B,yt[e]+=n*B},gn=function(e){var t=R[e],n=t,r=t,i=D[0]-t,s=D[1]-t;W[e]<n?(W[e]=n+(n-W[e]),V[e]*=-1,U[e]*=-1):W[e]>i&&(W[e]=i-(W[e]-i),V[e]*=-1,U[e]*=-1),X[e]<r?(X[e]=r+(r-X[e]),$[e]*=-1,z[e]*=-1):X[e]>s&&(X[e]=s-(X[e]-s),$[e]*=-1,z[e]*=-1)},yn=function(e,t,n){if(Mt<1)return;var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=0;r=R[e],i=W[e],s=X[e];for(o=0;o<Mt;o++)u=gt[o]-r,a=gt[o]+bt[o]+r,f=yt[o]+wt[o]+r,l=yt[o]-r,c=Tt[o]-r,h=Tt[o]+bt[o]+r,p=Nt[o]+wt[o]+r,d=Nt[o]-r,i>u&&i<a&&s>l&&s<f&&(t<=c?(W[e]=u-(i-u),S=1):t>=h?(W[e]=a+(a-i),S=1):n<=p?(X[e]=l-(s-l),S=-1):n>=d&&(X[e]=f+(f-s),S=-1)),w=xt[o],S&&(w!==Infinity?(b=q[Y[e]][0],E=w+b,S===1?(v=V[e],g=Et[o],V[e]=(v*(b-w)+2*w*g)/E,Et[o]=(g*(w-b)+2*U[e])/E):(m=$[e],y=St[o],$[e]=(m*(b-w)+2*w*y)/E,St[o]=(y*(w-b)+2*z[e])/E)):S===1?V[e]*=-1:$[e]*=-1)},bn=function(e){var t=q[Y[e]][0];V[e]+=.5*K[e]*B,U[e]=t*V[e],$[e]+=.5*Q[e]*B,z[e]=t*$[e]},wn=function(e){et[e]&&(K[e]=0,Q[e]=0)},En=function(e){var t,n,s,o,u,a,l,c=Y[e],h,p=1/q[c][0],d,m=G[e];for(t=0;t<e;t++)h=Y[t],d=1/q[h][0],n=W[t]-W[e],s=X[t]-X[e],o=n*n+s*s,u=0,v&&o<Vt[c][h]&&(u+=$t[c][h].forceOverDistanceFromSquaredDistance(o)),r&&i&&(u+=f.forceOverDistanceFromSquaredDistance(o,m,G[t])),u&&(a=u*n,l=u*s,K[e]+=a*p,Q[e]+=l*p,K[t]-=a*d,Q[t]-=l*d)},Sn=function(){if(!g)return;var e;for(e=0;e<F;e++)Q[e]-=g},xn=function(){if(!P)return;var e=F,t=-12e3*w*P,n,r;while(e--)n=q[Y[e]][S.MASS],r=t*Z[e]/n,K[e]+=V[e]*r,Q[e]+=$[e]*r},Tn=function(){if(lt<1)return;var e,t,n,s,a,l,c,h,p,d,m,g,y,b,w,E,S;for(e=0,t=ut[0].length;e<t;e++)n=rt[e],s=it[e],a=Y[n],l=Y[s],E=1/q[a][0],S=1/q[l][0],c=W[s]-W[n],h=X[s]-X[n],p=c*c+h*h,d=Math.sqrt(p),m=ot[e],g=st[e],y=o.convert(m*(d-g),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/d,v&&p<Vt[a][l]&&(y-=$t[a][l].forceOverDistanceFromSquaredDistance(p)),r&&i&&(y-=f.forceOverDistanceFromSquaredDistance(p,G[n],G[s])),b=y*c,w=y*h,K[n]+=b*E,Q[n]+=w*E,K[s]-=b*S,Q[s]-=w*S},Nn=function(){if(mt<1)return;var e,t,n,r,i,s,a,f,l,c,h;for(e=0;e<mt;e++){h=ct[e],t=1/q[Y[h]][0],n=ht[e]-W[h],r=pt[e]-X[h];if(n===0&&r===0)continue;s=n*n+r*r,i=Math.sqrt(s),a=dt[e],f=o.convert(a*i,{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/i,l=f*n,c=f*r,K[h]+=l*t,Q[h]+=c*t}},Cn=function(e,t){var n,r;e==null&&(e=b),Rt=un(),y&&Math.abs(rn(Rt)-e)<=e*O&&(y=!1);if(t||m||y&&Rt>0){n=Math.sqrt(e/Rt);for(r=0;r<F;r++)an(r,n);Rt=e}};return e={outputState:Ut,useCoulombInteraction:function(e){r=!!e},useLennardJonesInteraction:function(e){v=!!e},useThermostat:function(e){m=!!e},setGravitationalField:function(e){typeof e=="number"&&e!==0?g=e:g=!1},setTargetTemperature:function(e){M(e),b=e},setTime:function(e){Ut.time=H=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;D=[n,r]},getSize:function(){return[D[0],D[1]]},getLJCalculator:function(){return $t},setElements:function(e){var t,r,i,s,o,u;if(n)throw new Error("md2d: setElements cannot be called after atoms have been created");q=e;for(t=0;t<q.length;t++)zt[t]=[],Wt[t]=[],$t[t]=[],Vt[t]=[];for(t=0;t<q.length;t++){i=q[t][S.EPSILON],o=q[t][S.SIGMA],q[t][S.RADIUS]=l.radius(o);for(r=t;r<q.length;r++)s=q[r][S.EPSILON],u=q[r][S.SIGMA],zt[t][r]=zt[r][t]=l.pairwiseEpsilon(i,s),Wt[t][r]=Wt[r][t]=l.pairwiseSigma(o,u),function(e,t){$t[e][t]=$t[t][e]=l.newLJCalculator({epsilon:zt[e][t],sigma:Wt[e][t]},function(n){Jt(e,t,n)})}(t,r)}},createAtoms:function(r){var i=h&&c?"Float32Array":"regular",o=h&&c?"Uint8Array":"regular",u,a;if(n)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");n=!0,t=!0;if(typeof r=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");a=r.num;if(typeof a=="undefined")throw new Error("md2d: createAtoms was called without the required 'num' option specifying the number of atoms to create.");if(a!==Math.floor(a))throw new Error("md2d: createAtoms was passed a non-integral 'num' option.");if(a<p)throw new Error("md2d: create Atoms was passed an 'num' option equal to: "+a+" which is less than the minimum allowable value: N_MIN = "+p+".");if(a>d)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+a+" which is greater than the minimum allowable value: N_MAX = "+d+".");u=function(){var e=0,t;for(t in E)E.hasOwnProperty(t)&&e++;return e}(),nt=e.atoms=s.create(u,null,"regular"),R=e.radius=nt[E.RADIUS]=s.create(a,0,i),U=e.px=nt[E.PX]=s.create(a,0,i),z=e.py=nt[E.PY]=s.create(a,0,i),W=e.x=nt[E.X]=s.create(a,0,i),X=e.y=nt[E.Y]=s.create(a,0,i),V=e.vx=nt[E.VX]=s.create(a,0,i),$=e.vy=nt[E.VY]=s.create(a,0,i),J=e.speed=nt[E.SPEED]=s.create(a,0,i),K=e.ax=nt[E.AX]=s.create(a,0,i),Q=e.ay=nt[E.AY]=s.create(a,0,i),G=e.charge=nt[E.CHARGE]=s.create(a,0,i),Z=e.friction=nt[E.FRICTION]=s.create(a,0,i),Y=e.element=nt[E.ELEMENT]=s.create(a,0,o),et=e.pinned=nt[E.PINNED]=s.create(a,0,o),tt=e.visible=nt[E.VISIBLE]=s.create(a,0,o),F=0,I=0},addAtom:function(e,t,n,r,s,o,u,a,f){var l,c;F+1>nt[0].length&&Qt(F+1),l=q[e],c=l[S.MASS],Y[F]=e,R[F]=q[e][S.RADIUS],W[F]=t,X[F]=n,V[F]=r,$[F]=s,U[F]=r*c,z[F]=s*c,K[F]=0,Q[F]=0,J[F]=Math.sqrt(r*r+s*s),G[F]=o,Z[F]=u,et[F]=a,tt[F]=f,o&&(i=!0),I+=c,F++},setAtomProperties:function(e,t){var n;for(n in t){if(!t.hasOwnProperty(n))continue;this[n][e]=t[n]}},addRadialBond:function(e,t,n,r){var i,s;e<t?(i=e,s=t):(i=t,s=e),lt+1>rt.length&&Yt(lt+1),rt[lt]=e,it[lt]=t,st[lt]=n,ot[lt]=r,at[i]||(at[i]={}),at[i][s]=!0,lt++},addSpringForce:function(e,t,n,r){en(mt+1),ct[mt]=e,ht[mt]=t,pt[mt]=n,dt[mt]=r,mt++},updateSpringForce:function(e,t,n){ht[e]=t,pt[e]=n},removeSpringForce:function(e){if(e>=mt)return;mt--;if(mt===0)Zt(0);else{var t=[],n;for(n=0;n<vt.length;n++)n!==e&&t.push(vt[e]);Zt(mt);for(n=0;n<vt.length;n++)s.copy(t[e],vt[e])}},addObstacle:function(e,t,n,r,i,s,o){var u;Mt+1>gt.length&&nn(Mt+1),gt[Mt]=e,yt[Mt]=t,Tt[Mt]=e,Nt[Mt]=t,bt[Mt]=n,wt[Mt]=r,Et[Mt]=0,St[Mt]=0,i=parseFloat(i),u=i*n*r,xt[Mt]=u,Ct[Mt]=s[0],kt[Mt]=s[1],Lt[Mt]=s[2],At[Mt]=o,Mt++},canPlaceAtom:function(t,n,r,i){var s,o,u,a,f;s=R[i];for(f=0;f<Mt;f++)if(n>gt[f]-s&&n<gt[f]+bt[f]+s&&r>yt[f]-s&&r<yt[f]+wt[f]+s)return!1;return typeof i=="number"&&(o=W[i],u=X[i],W[i]=X[i]=Infinity),a=e.newPotentialCalculator(t,0,!1)(n,r),typeof i=="number"&&(W[i]=o,X[i]=u),a<=0},initializeAtomsFromProperties:function(t){var n,r,i,s,o,u,a,f,l,c,h;if(!t.X||!t.Y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!t.VX||!t.VY)throw new Error("md2d: For now, velocities must be set when locations are set.");for(c=0,h=t.X.length;c<h;c++)u=t.ELEMENT?t.ELEMENT[c]:0,n=t.X[c],r=t.Y[c],i=t.VX[c],s=t.VY[c],o=t.CHARGE?t.CHARGE[c]:0,f=t.PINNED?t.PINNED[c]:0,l=t.VISIBLE?t.VISIBLE[c]:1,a=t.FRICTION?t.FRICTION[c]:0,e.addAtom(u,n,r,i,s,o,a,f,l);Rt=un(),e.computeOutputState()},initializeAtomsRandomly:function(t){var n=t.temperature||100,r=t.num||nt[0].length,i=Math.floor(Math.sqrt(r)),s=Math.ceil(r/i),o,u,f,l,c,h,p,d,v,m,g,y,b,w;M(n),c=D[0]/(1+s),l=D[1]/(1+i),o=-1;for(u=1;u<=i;u++)for(f=1;f<=s;f++){o++;if(o===r)break;w=Math.floor(Math.random()*q.length),h=a.normal(1,.25),p=2*Math.random()*Math.PI,d=f*c,v=u*l,m=h*Math.cos(p),g=h*Math.sin(p),y=2*(o%2)-1,e.addAtom(w,d,v,m,g,y,0,0)}dn(),cn(),Cn(n,!0),Rt=un(),e.computeOutputState()},initializeObstacles:function(t){var n=t.x.length,r;tn(n);for(r=0;r<n;r++)e.addObstacle(t.x[r],t.y[r],t.width[r],t.height[r],t.density[r],t.color[r],t.visible[r])},initializeRadialBonds:function(t){var n=t.atom1Index.length,r;at={},Gt(n);for(r=0;r<n;r++)e.addRadialBond(t.atom1Index[r],t.atom2Index[r],t.bondLength[r],t.bondStrength[r])},createVdwPairsArray:function(t){var n=h&&c?"Uint16Array":"regular",r=C,i=t.ELEMENT.length,o=i*(i-1)/2;vdwPairs=e.vdwPairs=[],vdwPairs[r.ATOM1]=vdwPairAtom1Index=s.create(o,0,n),vdwPairs[r.ATOM2]=vdwPairAtom2Index=s.create(o,0,n),e.updateVdwPairsArray()},updateVdwPairsArray:function(){var e,t,n,r,i,s,o,u,a,f,l,c=4;prevVdwPairsNum=ft||0,ft=0;for(e=0;e<F;e++)for(t=e+1;t<F;t++){if(lt!=0&&at[e]&&at[e][t])continue;G[e]*G[t]<=0&&(n=W[t]-W[e],r=X[t]-X[e],i=n*n+r*r,s=q[Y[e]][S.SIGMA],o=q[Y[e]][S.EPSILON],u=q[Y[t]][S.SIGMA],a=q[Y[t]][S.EPSILON],f=.5*(s+u),f*=f,l=o*a,i<f*c&&l>0&&(vdwPairAtom1Index[ft]=e,vdwPairAtom2Index[ft]=t,ft++))}if(ft<prevVdwPairsNum)for(e=ft;e<prevVdwPairsNum;e++)vdwPairAtom1Index[e]=0,vdwPairAtom2Index[e]=0},relaxToTemperature:function(t){t!=null&&(b=t),M(b),on();while(y)e.integrate()},integrate:function(t,r){var i;if(!n)throw new Error("md2d: integrate called before atoms created.");t==null&&(t=100),B=r||1,j=B*B,i=q[Y[0]][S.RADIUS];var s=H,o=Math.floor(t/B),u,a,f,l;for(u=1;u<=o;u++){H=s+u*B;for(a=0;a<F;a++)f=W[a],l=X[a],vn(a),gn(a),yn(a,f,l),bn(a),K[a]=Q[a]=0,En(a);for(a=0;a<Mt;a++)mn(a);Tn(),Nn(),Sn(),xn();for(a=0;a<F;a++)wn(a),bn(a),J[a]=Math.sqrt(V[a]*V[a]+$[a]*$[a]);Cn()}e.computeOutputState()},getTotalMass:function(){return I},getRadiusOfElement:function(e){return q[e][S.RADIUS]},computeOutputState:function(){var e,t,n,s,a,l,c,h,p,d,m,g,y;y=0,g=0;for(e=0;e<F;e++){g+=.5*q[Y[e]][0]*(V[e]*V[e]+$[e]*$[e]);for(t=e+1;t<F;t++)c=W[t]-W[e],h=X[t]-X[e],p=c*c+h*h,v&&(y+=-$t[Y[e]][Y[t]].potentialFromSquaredDistance(p)),r&&i&&(y+=-f.potential(Math.sqrt(p),G[e],G[t]))}for(e=0;e<lt;e++)n=rt[e],s=it[e],a=Y[n],l=Y[s],c=W[s]-W[n],h=X[s]-X[n],p=c*c+h*h,d=ot[e],m=Math.sqrt(p)-st[e],y+=.5*d*m*m,v&&(y+=$t[a][l].potentialFromSquaredDistance(p));Ut.time=H,Ut.pressure=0,Ut.PE=y,Ut.KE=o.convert(g,{from:u.MW_ENERGY_UNIT,to:u.EV}),Ut.T=Rt,Ut.pCM=[Pt,Ht],Ut.CM=[_t,Dt],Ut.vCM=[Bt,jt],Ut.omega_CM=qt},newPotentialCalculator:function(e,t,n){return function(s,a){var l=0,c=0,h=0,p,d,m=$t[e],g,y,b,w,E,S,x;for(g=0;g<F;g++)y=s-W[g],b=a-X[g],w=y*y+b*b,S=0,v&&(x=m[Y[g]],l+=-x.potentialFromSquaredDistance(w,e,Y[g]),n&&(S+=x.forceOverDistanceFromSquaredDistance(w))),r&&i&&t&&(E=Math.sqrt(w),l+=-f.potential(E,t,G[g]),n&&(S+=f.forceOverDistanceFromSquaredDistance(w,t,G[g]))),S&&(c+=S*y,h+=S*b);return n?(p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),d=o.convert(h,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[l,[p,d]]):l}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=q[t][S.RADIUS],u=a.minimize(s,[n,r],{bounds:[[o,D[0]-o],[o,D[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=q[t][S.RADIUS],f=a.minimize(o,[n,r],{bounds:[[u,D[0]-u],[u,D[1]-u]],stopval:1e-4,precision:1e-6});return f.error?!1:f[1]},atomsInMolecule:[],depth:0,getMoleculeAtoms:function(e){this.atomsInMolecule.push(e);var t=[],n=this.getBondedAtoms(e),r=this.depth,i,s,o;this.depth++;for(i=0,s=n.length;i<s;i++)o=n[i],~this.atomsInMolecule.indexOf(o)||(t=t.concat(this.getMoleculeAtoms(o)));return r===0?(this.depth=0,this.atomsInMolecule=[]):t.push(e),t},getBondedAtoms:function(e){var t=[],n,r;if(ut)for(n=0,r=ut[0].length;n<r;n++)rt[n]===e&&t.push(it[n]),it[n]===e&&t.push(rt[n]);return t},setViscosity:function(e){P=e},serialize:function(){var e={},t,n,r,i;for(r=0,i=T.length;r<i;r++)t=T[r],n=nt[E[t]],e[t]=n.slice?n.slice():_(n);return e}}}}),e("/md2d.js");var t=e("/md2d"),n=e("arrays"),r;modeler={},modeler.VERSION="0.2.0",modeler.model=function(e){function I(e){$.unique(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function q(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],j[t]&&(r=r.concat(j[t]));j.all&&(r=r.concat(j.all)),I(r)}function R(){var e,t=0,n=i.get_num_atoms();e=-1;while(++e<n)t+=r.speed[e];return t/n}function U(e,t){var n;return r.integrate(),b=k.pressure,N=k.PE,C=k.KE,T=k.time,w.push(b),w.splice(0,w.length-16),W(),d||(n=Date.now(),E?(E=n-E,E&&S.push(E),E=n,S.splice(0,S.length-128)):E=n),t||o.tick(),d}function z(){return m===0}function W(){var e,t=[],r=M.length;e=-1;while(++e<r)t[e]=n.clone(M[e]);v.length=m,m++,g++,y=!0,v.push({nodes:t,pressure:k.pressure,pe:k.PE,ke:k.KE,time:k.time}),m>1e3&&(v.splice(1,1),m=1e3)}function X(){m=0,g=0,v.length=1,K(m)}function V(){v=[],m=0,g=0}function J(){v.length=m+1}function K(e){var t,i=M.length;if(e<0)throw new Error("modeler: request for tick_history_list["+e+"]");if(e>=v.length)throw new Error("modeler: request for tick_history_list["+e+"], tick_history_list.length="+v.length);t=-1;while(++t<i)n.copy(v[e].nodes[t],M[t]);C=v[e].ke,T=v[e].time,r.setTime(T)}function Q(){return w.reduce(function(e,t){return e+t})/w.length}function G(){var e,t,n=0,r=S.length;e=-1;while(++e<r)n+=S[e];return t=n/r,t?1/t*1e3:0}function Y(e){x=e,r.setTargetTemperature(e)}function Z(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null&&(F["set_"+t]?F["set_"+t](e[t]):F[t]=e[t],n.push(t));q(n)}function et(){r.computeOutputState(),b=k.pressure,N=k.PE,C=k.KE,T=k.time}var i={},s=e.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],o=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek"),u,a,f,l,c,h,p=!1,d=!0,v=[],m=0,g=0,y=!1,b,w=[0],E,S=[],x,T,N,C,k,L,A=e.width,O=e.height,M,_,D,P,H,B={vx:0,vy:0,density:Infinity,color:[128,128,128]},j={},F={temperature:300,coulomb_forces:!0,lennard_jones_forces:!0,temperature_control:!0,gravitationalField:!1,chargeShading:!1,showVDWLines:!1,VDWLinesRatio:1.99,viscosity:0,set_temperature:function(e){this.temperature=e,r&&r.setTargetTemperature(e)},set_temperature_control:function(e){this.temperature_control=e,r&&r.useThermostat(e)},set_coulomb_forces:function(e){this.coulomb_forces=e,r&&r.useCoulombInteraction(e)},set_epsilon:function(e){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(e){console.log("set_sigma: This method is temporarily deprecated")},set_gravitationalField:function(e){this.gravitationalField=e,r&&r.setGravitationalField(e)}};return i.INDICES={RADIUS:t.INDICES.RADIUS,PX:t.INDICES.PX,PY:t.INDICES.PY,X:t.INDICES.X,Y:t.INDICES.Y,VX:t.INDICES.VX,VY:t.INDICES.VY,SPEED:t.INDICES.SPEED,AX:t.INDICES.AX,AY:t.INDICES.AY,CHARGE:t.INDICES.CHARGE,FRICTION:t.INDICES.FRICTION,VISIBLE:t.INDICES.VISIBLE,ELEMENT:t.INDICES.ELEMENT},i.ATOM_PROPERTIES={RADIUS:t.ATOM_PROPERTIES.RADIUS,PX:t.ATOM_PROPERTIES.PX,PY:t.ATOM_PROPERTIES.PY,X:t.ATOM_PROPERTIES.X,Y:t.ATOM_PROPERTIES.Y,VX:t.ATOM_PROPERTIES.VX,VY:t.ATOM_PROPERTIES.VY,SPEED:t.ATOM_PROPERTIES.SPEED,AX:t.ATOM_PROPERTIES.AX,AY:t.ATOM_PROPERTIES.AY,CHARGE:t.ATOM_PROPERTIES.CHARGE,FRICTION:t.ATOM_PROPERTIES.FRICTION,VISIBLE:t.ATOM_PROPERTIES
.VISIBLE,ELEMENT:t.ATOM_PROPERTIES.ELEMENT},i.OBSTACLE_INDICES={X:t.OBSTACLE_INDICES.X,Y:t.OBSTACLE_INDICES.Y,WIDTH:t.OBSTACLE_INDICES.WIDTH,HEIGHT:t.OBSTACLE_INDICES.HEIGHT,COLOR_R:t.OBSTACLE_INDICES.COLOR_R,COLOR_G:t.OBSTACLE_INDICES.COLOR_G,COLOR_B:t.OBSTACLE_INDICES.COLOR_B,VISIBLE:t.OBSTACLE_INDICES.VISIBLE},i.RADIAL_INDICES={ATOM1:t.RADIAL_INDICES.ATOM1,ATOM2:t.RADIAL_INDICES.ATOM2,LENGTH:t.RADIAL_INDICES.LENGTH,STRENGTH:t.RADIAL_INDICES.STRENGTH},i.VDW_INDICES={ATOM1:t.VDW_INDICES.ATOM1,ATOM2:t.VDW_INDICES.ATOM2},L=e.model_listener,Z(e),i.getStats=function(){return{speed:R(),ke:C,temperature:x,pressure:Q(),current_step:g,steps:v.length-1}},i.getStatsHistory=function(){var e,t,n,r=[];r.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(e=0,t=v.length;e<t;e++)n=v[e],r.push(n.time+"	"+n.pe+"	"+n.ke+"	"+(n.pe+n.ke));return r.join("\n")},i.stepCounter=function(){return g},i.steps=function(){return v.length-1},i.isNewStep=function(){return y},i.seek=function(e){return arguments.length||(e=0),d=!0,y=!1,m=e,g=e,K(m),o.seek(),L&&L(),g},i.stepBack=function(e){arguments.length||(e=1);var t=-1;d=!0,y=!1;while(++t<e)m>1&&(m--,g--,K(m-1),L&&L());return g},i.stepForward=function(e){arguments.length||(e=1);var t=-1;d=!0;while(++t<e)m<v.length?(K(m),m++,g++,L&&L()):U();return g},i.createNewAtoms=function(e){var n,c,h,d,v;typeof e=="number"?v=e:e.num!=null?v=e.num:e.X&&(v=e.X.length),n=[];for(h=0,d=s.length;h<d;h++)c=s[h],n[c.id]=[c.mass,c.epsilon,c.sigma];return r=t.makeModel(),r.setSize([A,O]),r.setElements(n),r.createAtoms({num:v}),M=r.atoms,k=r.outputState,u=F.temperature_control,x=F.temperature,a=F.chargeShading,f=F.showVDWLines,l=F.VDWLinesRatio,H=F.viscosity,p=F.gravitationalField,r.useLennardJonesInteraction(F.lennard_jones_forces),r.useCoulombInteraction(F.coulomb_forces),r.useThermostat(u),r.setViscosity(H),r.setGravitationalField(p),r.setTargetTemperature(x),e.X&&e.Y?r.initializeAtomsFromProperties(e):(r.initializeAtomsRandomly({temperature:x}),e.relax&&r.relaxToTemperature()),et(),V(),W(),g=0,y=!0,o.reset(),i},i.createRadialBonds=function(e){return r.initializeRadialBonds(e),D=r.radialBonds,et(),i},i.createVdwPairs=function(e){return r.createVdwPairsArray(e),P=r.vdwPairs,et(),i},i.createObstacles=function(e){var t=e.x.length,n,s;for(n=0;n<t;n++)for(s in B){if(!B.hasOwnProperty(s))continue;e[s]||(e[s]=[]),typeof e[s][n]=="undefined"&&(e[s][n]=B[s])}return r.initializeObstacles(e),_=r.obstacles,i},i.setEpsilon=function(e){r.setLJEpsilon(e)},i.setSigma=function(e){r.setLJSigma(e)},i.getEpsilon=function(){return r.getLJEpsilon()},i.getSigma=function(){return r.getLJSigma()},i.getLJCalculator=function(){return r.getLJCalculator()},i.reset=function(){i.resetTime(),X(),o.reset()},i.resetTime=function(){r.setTime(0)},i.getTime=function(){return k?k.time:undefined},i.getTotalMass=function(){return r.getTotalMass()},i.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*s.length)),t==null&&(t=0);var n=i.size(),o=r.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=Math.random()*n[0]-2*o,a=Math.random()*n[1]-2*o,f=r.findMinimumPELocation(e,u,a,0,0,t);if(f&&i.addAtom(e,f[0],f[1],0,0,t,0,0))return!0}while(++l<c);return!1},i.addAtom=function(e,t,n,s,o,u,a,f,l){var c=i.size(),h=r.getRadiusOfElement(e);return t<h&&(t=h),t>c[0]-h&&(t=c[0]-h),n<h&&(n=h),n>c[1]-h&&(n=c[1]-h),r.canPlaceAtom(e,t,n)?(r.addAtom(e,t,n,s,o,u,a,f,l),M=r.atoms,r.computeOutputState(),L&&L(),!0):!1},i.setAtomProperties=function(e,t,n,s){var o,u,a,f,l;if(s){o=r.getMoleculeAtoms(e);if(o.length>0){u=typeof t.x=="number"?t.x-r.atoms[i.INDICES.X][e]:0,a=typeof t.y=="number"?t.y-r.atoms[i.INDICES.Y][e]:0;for(var c=0,h=o.length;c<h;c++){f=r.atoms[i.INDICES.X][o[c]]+u,l=r.atoms[i.INDICES.Y][o[c]]+a;if(!i.setAtomProperties(o[c],{x:f,y:l},n,!1))return!1}}}if(n){var p=typeof t.x=="number"?t.x:r.atoms[i.INDICES.X][e],d=typeof t.y=="number"?t.y:r.atoms[i.INDICES.Y][e],v=typeof t.element=="number"?t.y:r.atoms[i.INDICES.ELEMENT][e];if(!r.canPlaceAtom(v,p,d,e))return!1}return r.setAtomProperties(e,t),!0},i.addSpringForce=function(e,t,n,i){r.addSpringForce(e,t,n,i)},i.updateSpringForce=function(e,t,n){r.updateSpringForce(e,t,n)},i.removeSpringForce=function(e){r.removeSpringForce(e)},i.get_speed=function(){return n.copy(r.speed,[])},i.get_rate=function(){return G()},i.is_stopped=function(){return d},i.set_lennard_jones_forces=function(e){c=e,r.useLennardJonesInteraction(e)},i.set_coulomb_forces=function(e){h=e,r.useCoulombInteraction(e)},i.get_nodes=function(){return M},i.get_num_atoms=function(){return M[0].length},i.get_obstacles=function(){return _},i.get_radial_bonds=function(){return D},i.get_vdw_pairs=function(){return r.vdwPairs&&r.updateVdwPairsArray(),P},i.on=function(e,t){return o.on(e,t),i},i.tickInPlace=function(){return o.tick(),i},i.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,r=-1;while(++r<e)U(null,n);return i},i.relax=function(){return r.relaxToTemperature(),i},i.start=function(){return i.resume()},i.resume=function(){return d=!1,d3.timer(function(t){return d?!0:(U(t,!1),!1)}),o.play(),i},i.stop=function(){return d=!0,o.stop(),i},i.ke=function(){return k?k.KE:undefined},i.ave_ke=function(){return k?k.KE/i.get_num_atoms():undefined},i.pe=function(){return k?k.PE:undefined},i.ave_pe=function(){return k?k.PE/i.get_num_atoms():undefined},i.speed=function(){return R()},i.pressure=function(){return Q()},i.temperature=function(e){return arguments.length?(Y(e),i):x},i.size=function(e){return arguments.length?(r.setSize(e),i):r.getSize()},i.set=function(e){Z(e)},i.get=function(e){return F[e]},i.setModelListener=function(e){return L=e,i.on("tick",L),i},i.addPropertiesListener=function(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],j[i]||(j[i]=[]),j[i].push(t)},i.serialize=function(e){var t=$.extend({},F);return e&&(t.atoms=r.serialize()),s&&(t.elements=s),t.width=A,t.height=O,t},i}})();