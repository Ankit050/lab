(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){});var a=function(b,c){var d=a.resolve(b,c||"/"),e=a.modules[d];if(!e)throw new Error("Failed to resolve module "+b+", tried "+d);var f=e._cached?e._cached:e();return f};a.paths=[],a.modules={},a.extensions=[".js",".coffee"],a._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},a.resolve=function(){return function(b,c){function h(b){if(a.modules[b])return b;for(var c=0;c<a.extensions.length;c++){var d=a.extensions[c];if(a.modules[b+d])return b+d}}function i(b){b=b.replace(/\/+$/,"");var c=b+"/package.json";if(a.modules[c]){var e=a.modules[c](),f=e.browserify;if(typeof f=="object"&&f.main){var g=h(d.resolve(b,f.main));if(g)return g}else if(typeof f=="string"){var g=h(d.resolve(b,f));if(g)return g}else if(e.main){var g=h(d.resolve(b,e.main));if(g)return g}}return h(b+"/index")}function j(a,b){var c=k(b);for(var d=0;d<c.length;d++){var e=c[d],f=h(e+"/"+a);if(f)return f;var g=i(e+"/"+a);if(g)return g}var f=h(a);if(f)return f}function k(a){var b;a==="/"?b=[""]:b=d.normalize(a).split("/");var c=[];for(var e=b.length-1;e>=0;e--){if(b[e]==="node_modules")continue;var f=b.slice(0,e+1).join("/")+"/node_modules";c.push(f)}return c}c||(c="/");if(a._core[b])return b;var d=a.modules.path();c=d.resolve("/",c);var e=c||"/";if(b.match(/^(?:\.\.?\/|\/)/)){var f=h(d.resolve(e,b))||i(d.resolve(e,b));if(f)return f}var g=j(b,e);if(g)return g;throw new Error("Cannot find module '"+b+"'")}}(),a.alias=function(b,c){var d=a.modules.path(),e=null;try{e=a.resolve(b+"/package.json","/")}catch(f){e=a.resolve(b,"/")}var g=d.dirname(e),h=(Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b})(a.modules);for(var i=0;i<h.length;i++){var j=h[i];if(j.slice(0,g.length+1)===g+"/"){var k=j.slice(g.length);a.modules[c+k]=a.modules[g+k]}else j===g&&(a.modules[c]=a.modules[g])}},a.define=function(b,c){var d=a._core[b]?"":a.modules.path().dirname(b),e=function(b){return a(b,d)};e.resolve=function(b){return a.resolve(b,d)},e.modules=a.modules,e.define=a.define;var f={exports:{}};a.modules[b]=function(){return a.modules[b]._cached=f.exports,c.call(f.exports,e,f,f.exports,d,b),a.modules[b]._cached=f.exports,f.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var a=[],b=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return b&&window.addEventListener("message",function(b){if(b.source===window&&b.data==="browserify-tick"){b.stopPropagation();if(a.length>0){var c=a.shift();c()}}},!0),function(c){b?(a.push(c),window.postMessage("browserify-tick","*")):setTimeout(c,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(b){if(b==="evals")return a("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),a.define("path",function(a,b,c,d,e){function f(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}function g(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var h=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){var a="",b=!1;for(var c=arguments.length;c>=-1&&!b;c--){var d=c>=0?arguments[c]:process.cwd();if(typeof d!="string"||!d)continue;a=d+"/"+a,b=d.charAt(0)==="/"}return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b=a.charAt(0)==="/",c=a.slice(-1)==="/";return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),!a&&!b&&(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(f(a,function(a,b){return a&&typeof a=="string"}).join("/"))},c.dirname=function(a){var b=h.exec(a)[1]||"",c=!1;return b?b.length===1||c&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=h.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return h.exec(a)[3]||""}}),a.define("/arrays/arrays.js",function(a,b,c,d,e){var f;f=c.arrays={},f.version="0.0.1",f.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,f.typed=!1;try{var g=new Float64Array(0);f.typed=!0}catch(h){}f.create=function(a,b,c){c||(f.webgl||f.typed?c="Float32Array":c="regular"),b=b||0;var d,e;if(c==="regular")d=new Array(a);else switch(c){case"Float64Array":d=new Float64Array(a);break;case"Float32Array":d=new Float32Array(a);break;case"Int32Array":d=new Int32Array(a);break;case"Int16Array":d=new Int16Array(a);break;case"Int8Array":d=new Int8Array(a);break;case"Uint32Array":d=new Uint32Array(a);break;case"Uint16Array":d=new Uint16Array(a);break;case"Uint8Array":d=new Uint8Array(a);break;default:d=new Array(a)}e=-1;while(++e<a)d[e]=b;return d},f.constructor_function=function(a){if(a.buffer&&a.buffer.__proto__.constructor)return a.__proto__.constructor;if(a.constructor===Array)return a.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+a+", source.constructor: "+a.constructor+", source.buffer: "+a.buffer+", source.buffer.slice: "+a.buffer.slice+", source.buffer.__proto__: "+a.buffer.__proto__+", source.buffer.__proto__.constructor: "+a.buffer.__proto__.constructor)},f.copy=function(a,b){var c=a.length,d=-1;while(++d<c)b[d]=a[d];return b.length=c,b},f.clone=function(a){var b,c=a.length,d,e;e=f.constructor_function(a);if(e===Array){d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d}if(a.buffer.slice)return d=new e(a.buffer.slice(0)),d;d=new e(c);for(b=0;b<c;b++)d[b]=a[b];return d},f.between=function(a,b,c){return c<Math.max(a,b)&&c>Math.min(a,b)},f.max=function(a){return Math.max.apply(Math,a)},f.min=function(a){return Math.min.apply(Math,a)},f.maxTypedArray=function(a){var b,c,d=Number.MIN_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b>d?b:d;return d},f.minTypedArray=function(a){var b,c,d=Number.MAX_VALUE,e=a.length;for(c=0;c<e;c++)b=a[c],d=b<d?b:d;return d},f.maxAnyArray=function(a){try{return Math.max.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MIN_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c>e?c:e;return e}}},f.minAnyArray=function(a){try{return Math.min.apply(Math,a)}catch(b){if(b instanceof TypeError){var c,d,e=Number.MAX_VALUE,f=a.length;for(d=0;d<f;d++)c=a[d],e=c<e?c:e;return e}}},f.average=function(a){var b,c=0,d=a.length;for(b=0;b<d;b++)c+=a[b];return c/d}}),a.define("/constants/index.js",function(a,b,c,d,e){var f=a("./units"),g=f.unit,h=f.ratio,i=f.convert,j={ELEMENTARY_CHARGE:{value:1,unit:g.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:g.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:g.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:h(g.DALTON,{per:g.GRAM}),unit:g.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:g.FARADS_PER_METER}},k,l;j.COULOMB_CONSTANT={value:1/(4*Math.PI*j.PERMITTIVITY_OF_FREE_SPACE.value),unit:g.METERS_PER_FARAD},c.unit=g,c.ratio=h,c.convert=i;for(k in j)j.hasOwnProperty(k)&&(l=j[k],c[k]=function(a){return{as:function(b){return f.convert(a.value,{from:a.unit,to:b})}}}(l))}),a.define("/constants/units.js",function(a,b,c,d,e){var f=1.66054e-27,g=1.602177e-19,h=g,i=1e-15,j=1e-9,k=10,l=1e3,m={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},n,o,p;c.unit=n={FEMTOSECOND:{name:"femtosecond",value:1,type:m.TIME},SECOND:{name:"second",value:i,type:m.TIME},NANOMETER:{name:"nanometer",value:1,type:m.LENGTH},ANGSTROM:{name:"Angstrom",value:1*k,type:m.LENGTH},METER:{name:"meter",value:1*j,type:m.LENGTH},DALTON:{name:"Dalton",value:1,type:m.MASS},GRAM:{name:"gram",value:1*f*l,type:m.MASS},KILOGRAM:{name:"kilogram",value:1*f,type:m.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:m.ENERGY},JOULE:{name:"Joule",value:f*j*j*(1/i)*(1/i),type:m.ENERGY},EV:{name:"electron volt",value:f*j*j*(1/i)*(1/i)*(1/h),type:m.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:m.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*h,type:m.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:m.CHARGE},COULOMB:{name:"Coulomb",value:g,type:m.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:m.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:m.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:m.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:m.FORCE},NEWTON:{name:"Newton",value:1*f*j*(1/i)*(1/i),type:m.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:m.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*j*(1/i),type:m.VELOCITY}},c.ratio=o=function(a,b){var c=function(a,b){if(a.type!==b.type)throw new Error("Attempt to convert incompatible type '"+a.name+"'' to '"+b.name+"'")};if(b.per)return c(a,b.per),a.value/b.per.value;if(b.as)return c(a,b.as),b.as.value/a.value;throw new Error("units.ratio() received arguments it couldn't understand.")},c.convert=p=function(a,b){var c=b&&b.from,d=b&&b.to;if(!c)throw new Error('units.convert() did not receive a "from" argument');if(!d)throw new Error('units.convert() did not receive a "to" argument');return a*o(d,{per:c})}}),a.define("/math/index.js",function(a,b,c,d,e){c.normal=a("./distributions").normal,c.getWindowedAverager=a("./utils").getWindowedAverager}),a.define("/math/distributions.js",function(a,b,c,d,e){c.normal=function(){var a=null;return function(b,c){b==null&&(b=0),c==null&&(c=1);var d,e,f,g,h;return a?(e=a,a=null,e):(g=Math.random(),h=Math.random(),f=2*Math.PI*g,d=Math.sqrt(-2*Math.log(h)),a=b+c*d*Math.sin(f),b+c*d*Math.cos(f))}}()}),a.define("/math/utils.js",function(a,b,c,d,e){c.getWindowedAverager=function(a){a==null&&(a=1e3);var b=0,c=[],d=0;return function(e){return d-=c[b]||0,d+=e,c[b]=e,++b===a&&(b=0),c.length===a?d/a:NaN}}}),a.define("/potentials/index.js",function(a,b,c,d,e){var f=c.potentials={};c.coulomb=a("./coulomb"),c.makeLennardJonesCalculator=a("./lennard-jones").makeLennardJonesCalculator}),a.define("/potentials/coulomb.js",function(a,b,c,d,e){var f=a("../constants"),g=f.unit,h=f.COULOMB_CONSTANT.as(f.unit.METERS_PER_FARAD),i=f.ratio(g.NANOMETER,{per:g.METER}),j=Math.pow(f.ratio(g.COULOMB,{per:g.ELEMENTARY_CHARGE}),2),k=f.ratio(g.EV,{per:g.JOULE}),l=f.ratio(g.MW_FORCE_UNIT,{per:g.NEWTON}),m=h*j*i*k,n=h*j*i*i*l,o=c.potential=function(a,b,c){return m*(b*c/a)},p=c.forceFromSquaredDistance=function(a,b,c){return-n*(b*c/a)},q=c.forceOverDistanceFromSquaredDistance=function(a,b,c){return p(a,b,c)/Math.sqrt(a)},r=c.force=function(a,b,c){return p(a*a,b,c)}}),a.define("/potentials/lennard-jones.js",function(a,b,c,d,e){var f=a("../constants"),g=f.unit,h=f.ratio(g.NANOMETER,{per:g.METER}),i=f.ratio(g.MW_FORCE_UNIT,{per:g.NEWTON});c.makeLennardJonesCalculator=function(a,b){var c=[],d=[],e=[],j=[],k=[],l=[],m=[],n=[],o=function(a){var o,q,r,s,t,u,v,w,x,y,z,A;for(o=0,q=a.length;o<q;o++){c[o]=[],d[o]=[],e[o]=[],j[o]=[],k[o]=[],l[o]=[],m[o]=[],n[o]=[];for(r=0;r<o+1;r++)t=(a[o][1]+a[r][1])/2,u=Math.sqrt(a[o][2]*a[r][2]),v=Math.pow(2,1/6)*u,A=v*5,t!=null&&u!=null&&(w=4*t*Math.pow(u,12),x=4*t*Math.pow(u,6),y=12*f.convert(w,{from:g.EV,to:g.JOULE})*h*i,z=6*f.convert(x,{from:g.EV,to:g.JOULE})*h*i),c[o][r]=c[r][o]=t,d[o][r]=d[r][o]=u,e[o][r]=e[r][o]=v,j[o][r]=j[r][o]=w,k[o][r]=k[r][o]=x,l[o][r]=l[r][o]=y,m[o][r]=m[r][o]=z,n[o][r]=n[r][o]=A*A}typeof b=="function"&&b(p(),this)},p=function(){return{epsilon:c,sigma:d,rmin:e,cutoffDistanceSq:n}},q=function(a){if(a==null||parseFloat(a)!==a)throw new Error("lennardJones: epsilon value "+a+" is invalid")},r=function(a){if(a==null||parseFloat(a)!==a||a<=0)throw new Error("lennardJones: sigma value "+a+" is invalid")},s;return o(a),s={coefficients:p,potentialFromSquaredDistance:function(a,b,c){return j[b][c]*Math.pow(a,-6)-k[b][c]*Math.pow(a,-3)},potential:function(a,b,c){return s.potentialFromSquaredDistance(a*a,b,c)},forceOverDistanceFromSquaredDistance:function(a,b,c){var d=1/a,e=d*d*d,f=e*d,g=f*e;return l[b][c]*g-m[b][c]*f},force:function(a,b,c){return a*s.forceOverDistanceFromSquaredDistance(a*a,b,c)}}}}),a.define("/md2d.js",function(a,b,c,d,e){typeof window=="undefined"&&(window={});var f=a("./arrays/arrays").arrays,g=a("./constants"),h=g.unit,i=a("./math"),j=a("./potentials").coulomb,k=a("./potentials").makeLennardJonesCalculator,l=!0,m=function(){try{new Float32Array}catch(a){return!1}return!0}(),n=2,o=1e3,p=-120*g.BOLTZMANN_CONSTANT.as(h.EV_PER_KELVIN),q=.34,r=39.95,s=g.convert(r,{from:h.DALTON,to:h.KILOGRAM}),t=g.BOLTZMANN_CONSTANT.as(h.JOULES_PER_KELVIN),u,v,w,x=function(a,b,c,d){return a*d-b*c},y=function(a,b){return a*a+b*b},z=function(){},A=function(a,b){var c=2*b,d=2/c*a,e=g.convert(d,{from:h.MW_ENERGY_UNIT,to:h.JOULE});return e/t},B=function(a,b){var c=2*b,d=a*t,e=g.convert(d,{from:h.JOULE,to:h.MW_ENERGY_UNIT}),f=e*c/2;return f},C=function(a){var b=parseFloat(a);if(isNaN(b))throw new Error("md2d: requested temperature "+a+" could not be understood.");if(b<0)throw new Error("md2d: requested temperature "+b+" was less than zero");if(b===Infinity)throw new Error("md2d: requested temperature was Infinity!")},D=function(a){var b=[];for(var c=0,d=a.length;c<d;c++)b[c]=a[c];return b};c.INDICES=v={RADIUS:0,PX:1,PY:2,X:3,Y:4,VX:5,VY:6,SPEED:7,AX:8,AY:9,CHARGE:10,ELEMENT:11},c.SAVEABLE_INDICES=w=["X","Y","VX","VY","CHARGE","ELEMENT"],c.NODE_PROPERTIES_COUNT=u=12,c.makeModel=function(){var a,b=!1,c=!1,d=!1,e=!0,p=!1,q=!1,r,s=.001,t=[10,10],z,B,E,F,G=0,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ba,bb,bc,bd,be,bf,bg,bh=window.state={},bi=[],bj=function(a){bi=a.cutoffDistanceSq,M&&X&&bk()},bk=function(){var a=bl.coefficients().sigma,b,c;for(b=0,c=M.length;b<c;b++)M[b]=.5*a[X[b]][X[b]]},bl,bm,bn=function(){return d?1e3:1e3},bo=function(){q=!0,bm=i.getWindowedAverager(bn())},bp=function(){var a=0,b;for(b=0;b<J;b++)a+=L[X[b]][0]*(R[b]*R[b]+S[b]*S[b]);return A(a/2,J)},bq=function(a,b){R[a]*=b,S[a]*=b,N[a]*=b,O[a]*=b},br=function(a,b,c){R[a]+=b,S[a]+=c,N[a]+=L[X[a]][0]*b,O[a]+=L[X[a]][0]*c},bs=function(a,b){R[a]-=b*(Q[a]-$),S[a]+=b*(P[a]-Z)},bt=function(){for(var a=0;a<J;a++)br(a,-bb,-bc),bs(a,-bf)},bu=function(){for(var a=0;a<J;a++)br(a,bb,bc),bs(a,bf)},bv=function(){var a=0,b=0,c=0,d=0,e;for(e=0;e<J;e++)a+=P[e],b+=Q[e],c+=N[e],d+=O[e];Z=a/J,$=b/J,_=c,ba=d,bb=c/K,bc=d/K},bw=function(){var a=0,b=0,c,d;for(d=0;d<J;d++)c=L[X[d]][0],a+=c*x(P[d]-Z,Q[d]-$,R[d]-bb,S[d]-bc),b+=c*y(P[d]-Z,Q[d]-$);bd=a,be=b,bf=bd/be},bx=function(){bv(),bw()},by=function(a){P[a]+=R[a]*H+.5*U[a]*I,Q[a]+=S[a]*H+.5*V[a]*I},bz=function(a){P[a]<F?(P[a]=F+(F-P[a]),R[a]*=-1):P[a]>B&&(P[a]=B-(P[a]-B),R[a]*=-1),Q[a]<E?(Q[a]=E+(E-Q[a]),S[a]*=-1):Q[a]>z&&(Q[a]=z-(Q[a]-z),S[a]*=-1)},bA=function(a){var b=L[X[a]][0];R[a]+=.5*U[a]*H,N[a]=b*R[a],S[a]+=.5*V[a]*H,O[a]=b*S[a]},bB=function(a){var b,c,f,g,h,i,k,l=X[a],m,n=1/L[l][0],o,p=W[a];for(b=0;b<a;b++)m=X[b],o=1/L[m][0],c=P[b]-P[a],f=Q[b]-Q[a],g=c*c+f*f,h=0,e&&g<bi[l][m]&&(h+=bl.forceOverDistanceFromSquaredDistance(g,l,m)),d&&(h+=j.forceOverDistanceFromSquaredDistance(g,p,W[b])),h&&(i=h*c,k=h*f,U[a]+=i*n,V[a]+=k*n,U[b]-=i*o,V[b]-=k*o)},bC=function(a,b){var c,d;a==null&&(a=r),bg=bp(),q&&Math.abs(bm(bg)-a)<=a*s&&(q=!1);if(b||p||q&&bg>0){c=Math.sqrt(a/bg);for(d=0;d<J;d++)bq(d,c);bg=a}};return a={outputState:bh,useCoulombInteraction:function(a){d=!!a},useLennardJonesInteraction:function(a){e=!!a},useThermostat:function(a){p=!!a},setTargetTemperature:function(a){C(a),r=a},setTime:function(a){bh.time=G=a},setSize:function(a){if(b)throw new Error("The molecular model's size has already been set, and cannot be reset.");var c=a[0]&&a[0]>0?a[0]:10,d=a[1]&&a[1]>0?a[1]:10;t=[c,d]},getSize:function(){return[t[0],t[1]]},getLJCalculator:function(){return bl},setElements:function(a){if(c)throw new Error("md2d: setElements cannot be called after atoms have been created");L=a,bl=window.lennardJones=k(L,bj)},createAtoms:function(d){var e=m&&l?"Float32Array":"regular",g=m&&l?"Uint8Array":"regular",h;if(c)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");c=!0,b=!0;if(typeof d=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");J=d.X&&d.Y?d.X.length:d.num;if(typeof J=="undefined")throw new Error("md2d: createAtoms was called without the required 'N' option specifying the number of atoms to create.");if(J!==Math.floor(J))throw new Error("md2d: createAtoms was passed a non-integral 'N' option.");if(J<n)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+J+" which is less than the minimum allowable value: N_MIN = "+n+".");if(J>o)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+J+" which is greater than the minimum allowable value: N_MAX = "+o+".");Y=a.nodes=f.create(u,null,"regular"),M=a.radius=Y[v.RADIUS]=f.create(J,0,e),N=a.px=Y[v.PX]=f.create(J,0,e),O=a.py=Y[v.PY]=f.create(J,0,e),P=a.x=Y[v.X]=f.create(J,0,e),Q=a.y=Y[v.Y]=f.create(J,0,e),R=a.vx=Y[v.VX]=f.create(J,0,e),S=a.vy=Y[v.VY]=f.create(J,0,e),T=a.speed=Y[v.SPEED]=f.create(J,0,e),U=a.ax=Y[v.AX]=f.create(J,0,e),V=a.ay=Y[v.AY]=f.create(J,0,e),W=a.charge=Y[v.CHARGE]=f.create(J,0,e),X=a.element=Y[v.ELEMENT]=f.create(J,0,g)},initializeAtomsFromProperties:function(b){var c=0,d,e;if(!b.X||!b.Y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!b.VX||!b.VY)throw new Error("md2d: For now, velocities must be set when locations are set.");for(d=0,e=J;d<e;d++)P[d]=b.X[d],Q[d]=b.Y[d],R[d]=b.VX[d],S[d]=b.VY[d],T[d]=Math.sqrt(R[d]*R[d]+S[d]*S[d]);if(b.CHARGE)for(d=0,e=J;d<e;d++)W[d]=b.CHARGE[d];if(b.ELEMENT)for(d=0,e=J;d<e;d++)X[d]=b.ELEMENT[d],c+=L[X[d]][0];else c=J*L[0][0];K=a.totalMass=c,bk(),bg=bp(),a.computeOutputState()},initializeAtomsRandomly:function(b){var c=b.temperature||100,d=Math.floor(Math.sqrt(J)),e=Math.ceil(J/d),f,g,h,j,k,l,m,n=bl.coefficients();C(c),k=t[0]/(1+e),j=t[1]/(1+d),f=-1,K=0;for(g=1;g<=d;g++)for(h=1;h<=e;h++){f++;if(f===J)break;P[f]=h*k,Q[f]=g*j,l=i.normal(1,.25),m=2*Math.random()*Math.PI,R[f]=l*Math.cos(m),N[f]=L[X[f]][0]*R[f],S[f]=l*Math.sin(m),O[f]=L[X[f]][0]*S[f],U[f]=0,V[f]=0,T[f]=Math.sqrt(R[f]*R[f]+S[f]*S[f]),W[f]=2*(f%2)-1,X[f]=Math.floor(Math.random()*L.length),M[f]=n.rmin[X[f]][X[f]]/2,a.totalMass=K+=L[X[f]][0]}bx(),bt(),bC(c,!0),bg=bp(),a.computeOutputState()},relaxToTemperature:function(b){b!=null&&(r=b),C(r),bo();while(q)a.integrate()},integrate:function(b,d){if(!c)throw new Error("md2d: integrate called before atoms created.");b==null&&(b=100),H=d||1,I=H*H,F=M[0],E=M[0],B=t[0]-M[0],z=t[1]-M[0];var e=G,f=Math.floor(b/H),g,h;for(g=1;g<=f;g++){G=e+g*H;for(h=0;h<J;h++)by(h),bz(h),bA(h),U[h]=V[h]=0,bB(h);for(h=0;h<J;h++)bA(h),T[h]=Math.sqrt(R[h]*R[h]+S[h]*S[h]);bC()}a.computeOutputState()},computeOutputState:function(){var a,b,c,f,i,k,l;l=0,k=0;for(a=0;a<J;a++){k+=.5*L[X[a]][0]*(R[a]*R[a]+S[a]*S[a]);for(b=a+1;b<J;b++)c=P[b]-P[a],f=Q[b]-Q[a],i=c*c+f*f,e&&(l+=-bl.potentialFromSquaredDistance(i,X[a],X[b])),d&&(l+=-j.potential(Math.sqrt(i),W[a],W[b]))}bh.time=G,bh.pressure=0,bh.PE=l,bh.KE=g.convert(k,{from:h.MW_ENERGY_UNIT,to:h.EV}),bh.T=bg,bh.pCM=[_,ba],bh.CM=[Z,$],bh.vCM=[bb,bc],bh.omega_CM=bf},serialize:function(){var a={},b,c,d,e;for(d=0,e=w.length;d<e;d++)b=w[d],c=Y[v[b]],a[b]=c.slice?c.slice():D(c);return a}}}}),a("/md2d.js");var b=a("./md2d"),c;modeler={},modeler.VERSION="0.2.0",modeler.model=function(a){function T(a){$.unique(a);for(var b=0,c=a.length;b<c;b++)a[b]()}function U(a){var b,c,d=[],e,f;typeof a=="string"?c=[a]:c=a;for(e=0,f=c.length;e<f;e++)b=c[e],R[b]&&(d=d.concat(R[b]));R.all&&(d=d.concat(R.all)),T(d)}function V(){var a,b=0,c=Q[0].length;a=-1;while(++a<c)b+=I[a];return b/c}function W(){return m===0}function X(){var a,b=[],c=P;a=-1;while(++a<c)b[a]=arrays.clone(Q[a]);l.length=m,m++,n++,o=!0,l.push({nodes:b,pressure:z.pressure,pe:z.PE,ke:z.KE,time:z.time}),m>1e3&&(l.splice(0,1),m=1e3)}function Y(){var a;return W()&&X(),c.integrate(),r=z.pressure,x=z.PE,y=z.KE,w=z.time,s.push(r),s.splice(0,s.length-16),X(),k?A&&A():(a=Date.now(),t?(t=a-t,t&&u.push(t),t=a,u.splice(0,u.length-128)):t=a,g.tick({type:"tick"})),k}function Z(){l=[],m=0,n=-1}function _(){l.length=m+1}function ba(a){var b,d=P;if(a<0)throw new Error("modeler: request for tick_history_list["+a+"]");if(a>=l.length)throw new Error("modeler: request for tick_history_list["+a+"], tick_history_list.length="+l.length);b=-1;while(++b<d)arrays.copy(l[a].nodes[b],Q[b]);y=l[a].ke,w=l[a].time,c.setTime(w)}function bb(){return s.reduce(function(a,b){return a+b})/s.length}function bc(a){if(!arguments.length)return bc.reduce(function(a,b){return a+b})/s.length;bc.push(a),bc.splice(0,bc.length-100)}function bd(){var a,b,c=0,d=u.length;a=-1;while(++a<d)c+=u[a];return b=c/d,b?1/b*1e3:0}function be(a){v=a,c.setTargetTemperature(a)}function bf(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&a[b]!==undefined&&a[b]!==null&&(S["set_"+b]?S["set_"+b](a[b]):S[b]&&(S[b]=a[b]),c.push(b));U(c)}function bg(a){var d,g,i,j,k;c=b.makeModel(),c.setSize([N,O]);if(e){g=[];for(j=0,k=e.length;j<k;j++)i=e[j],g[i.id]=[i.mass,i.epsilon,i.sigma];c.setElements(g)}return typeof a=="number"?c.createAtoms({num:a}):c.createAtoms(a),Q=c.nodes,B=c.radius,C=c.px,D=c.py,E=c.x,F=c.y,G=c.vx,H=c.vy,I=c.speed,J=c.ax,K=c.ay,L=c.mass,M=c.charge,z=c.outputState,f.length=Q[0].length,h=S.temperature_control,v=S.temperature,Z(),o=!0,c.useLennardJonesInteraction(S.lennard_jones_forces),c.useCoulombInteraction(S.coulomb_forces),c.useThermostat(S.temperature_control),d=v,c.setTargetTemperature(d),a.X&&a.Y?c.initializeAtomsFromProperties(a):c.initializeAtomsRandomly({temperature:d}),c}var d={},e=a.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],f=[],g=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek"),h,i,j,k=!0,l=[],m=0,n=0,o=!1,p,q,r,s=[0],t,u=[],v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=a.width,O=a.height,P=12,Q,R={},S={temperature:300,coulomb_forces:!1,lennard_jones_forces:!0,temperature_control:!0,set_temperature:function(a){this.temperature=a,c&&c.setTargetTemperature(a)},set_temperature_control:function(a){this.temperature_control=a,c&&c.useThermostat(a)},set_coulomb_forces:function(a){this.coulomb_forces=a,c&&c.useCoulombInteraction(a)},set_epsilon:function(a){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(a){console.log("set_sigma: This method is temporarily deprecated")}};return d.INDICES={RADIUS:b.INDICES.RADIUS,PX:b.INDICES.PX,PY:b.INDICES.PY,X:b.INDICES.X,Y:b.INDICES.Y,VX:b.INDICES.VX,VY:b.INDICES.VY,SPEED:b.INDICES.SPEED,AX:b.INDICES.AX,AY:b.INDICES.AY,CHARGE:b.INDICES.CHARGE,ELEMENT:b.INDICES.ELEMENT},A=a.model_listener,bf(a),d.getStats=function(){return{speed:V(),ke:y,temperature:v,pressure:bb(),current_step:n,steps:l.length-1}},d.getStatsHistory=function(){var a,b,c,d=[];d.push("time (fs)\ttotal PE (eV)\ttotal KE (eV)\ttotal energy (eV)");for(a=0,b=l.length;a<b;a++)c=l[a],d.push(c.time+"\t"+c.pe+"\t"+c.ke+"\t"+(c.pe+c.ke));return d.join("\n")},d.stepCounter=function(){return n},d.steps=function(){return W()?0:l.length-1},d.isNewStep=function(){return o},d.seek=function(a){return arguments.length||(a=0),k=!0,o=!1,m=a,n=a,ba(m),g.seek(),U("seek"),n},d.stepBack=function(a){arguments.length||(a=1);var b=-1;k=!0,o=!1;while(++b<a)m>1&&(m--,n--,ba(m-1),A&&A());return n},d.stepForward=function(a){arguments.length||(a=1);var b=-1;k=!0;while(++b<a)m<l.length?(ba(m),m++,n++,A&&A()):Y();return n},d.setEpsilon=function(a){c.setLJEpsilon(a)},d.setSigma=function(a){c.setLJSigma(a)},d.getEpsilon=function(){return c.getLJEpsilon()},d.getSigma=function(){return c.getLJSigma()},d.getLJCalculator=function(){return c.getLJCalculator()},d.resetTime=function(){c.setTime(0)},d.getTime=function(){return z?z.time:undefined},d.set_radius=function(a){},d.get_speed=function(){return arrays.copy(I,[])},d.get_rate=function(){return bd()},d.is_stopped=function(){return k},d.set_lennard_jones_forces=function(a){i=a,c.useLennardJonesInteraction(a)},d.set_coulomb_forces=function(a){j=a,c.useCoulombInteraction(a)},d.get_nodes=function(){return Q},d.get_atoms=function(){return f},d.on=function(a,b){return g.on(a,b),d},d.tickInPlace=function(){return g.tick({type:"tick"}),d},d.tick=function(a){arguments.length||(a=1);var b=-1;while(++b<a)Y();return d},d.relax=function(){return c.relaxToTemperature(),d},d.start=function(){return d.resume()},d.resume=function(){return k=!1,d3.timer(Y),g.play(),U("play"),d},d.stop=function(){return k=!0,g.stop(),d},d.ke=function(){return z?z.KE:undefined},d.ave_ke=function(){return z?z.KE/Q[0].length:undefined},d.pe=function(){return z?z.PE:undefined},d.ave_pe=function(){return z?z.PE/Q[0].length:undefined},d.speed=function(){return V()},d.pressure=function(){return bb()},d.temperature=function(a){return arguments.length?(be(a),d):v},d.size=function(a){return arguments.length?(c.setSize(a),d):c.getSize()},d.createNewAtoms=function(a){return bg(a)},d.set=function(a){bf(a)},d.get=function(a){return S[a]},d.addPropertiesListener=function(a,b){var c,d,e;for(c=0,d=a.length;c<d;c++)e=a[c],R[e]||(R[e]=[]),R[e].push(b)},d.serialize=function(a){var b=$.extend({},S);return a&&(b.atoms=c.serialize()),e&&(b.elements=e),b.width=N,b.height=O,b},d}})();