(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){});var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=i._cached?i._cached:i();return s};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function a(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var s={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,t),e.modules[t]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),e.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),e.define("/arrays/arrays.js",function(e,t,n,r,i){var s;s=n.arrays={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t=t||0;var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r}}),e.define("/constants/index.js",function(e,t,n,r,i){var s=e("./units"),o=s.unit,u=s.ratio,a=s.convert,f={ELEMENTARY_CHARGE:{value:1,unit:o.ELEMENTARY_CHARGE},ATOMIC_MASS:{value:1,unit:o.DALTON},BOLTZMANN_CONSTANT:{value:1.380658e-23,unit:o.JOULES_PER_KELVIN},AVAGADRO_CONSTANT:{value:u(o.DALTON,{per:o.GRAM}),unit:o.INVERSE_MOLE},PERMITTIVITY_OF_FREE_SPACE:{value:8.854187e-12,unit:o.FARADS_PER_METER}},l,c;f.COULOMB_CONSTANT={value:1/(4*Math.PI*f.PERMITTIVITY_OF_FREE_SPACE.value),unit:o.METERS_PER_FARAD},n.unit=o,n.ratio=u,n.convert=a;for(l in f)f.hasOwnProperty(l)&&(c=f[l],n[l]=function(e){return{as:function(t){return s.convert(e.value,{from:e.unit,to:t})}}}(c))}),e.define("/constants/units.js",function(e,t,n,r,i){var s=1.66054e-27,o=1.602177e-19,u=o,a=1e-15,f=1e-9,l=10,c=1e3,h={TIME:"time",LENGTH:"length",MASS:"mass",ENERGY:"energy",ENTROPY:"entropy",CHARGE:"charge",INVERSE_QUANTITY:"inverse quantity",FARADS_PER_METER:"farads per meter",METERS_PER_FARAD:"meters per farad",FORCE:"force",VELOCITY:"velocity",AREA:"area",PRESSURE:"pressure"},p,d,v;n.unit=p={FEMTOSECOND:{name:"femtosecond",value:1,type:h.TIME},SECOND:{name:"second",value:a,type:h.TIME},NANOMETER:{name:"nanometer",value:1,type:h.LENGTH},ANGSTROM:{name:"Angstrom",value:1*l,type:h.LENGTH},METER:{name:"meter",value:1*f,type:h.LENGTH},DALTON:{name:"Dalton",value:1,type:h.MASS},GRAM:{name:"gram",value:1*s*c,type:h.MASS},KILOGRAM:{name:"kilogram",value:1*s,type:h.MASS},MW_ENERGY_UNIT:{name:"MW Energy Unit (Dalton * nm^2 / fs^2)",value:1,type:h.ENERGY},JOULE:{name:"Joule",value:s*f*f*(1/a)*(1/a),type:h.ENERGY},EV:{name:"electron volt",value:s*f*f*(1/a)*(1/a)*(1/u),type:h.ENERGY},EV_PER_KELVIN:{name:"electron volts per Kelvin",value:1,type:h.ENTROPY},JOULES_PER_KELVIN:{name:"Joules per Kelvin",value:1*u,type:h.ENTROPY},ELEMENTARY_CHARGE:{name:"elementary charge",value:1,type:h.CHARGE},COULOMB:{name:"Coulomb",value:o,type:h.CHARGE},INVERSE_MOLE:{name:"inverse moles",value:1,type:h.INVERSE_QUANTITY},FARADS_PER_METER:{name:"Farads per meter",value:1,type:h.FARADS_PER_METER},METERS_PER_FARAD:{name:"meters per Farad",value:1,type:h.METERS_PER_FARAD},MW_FORCE_UNIT:{name:"MW force units (Dalton * nm / fs^2)",value:1,type:h.FORCE},NEWTON:{name:"Newton",value:1*s*f*(1/a)*(1/a),type:h.FORCE},EV_PER_NM:{name:"electron volts per nanometer",value:1*s*f*f*(1/a)*(1/a)*(1/u),type:h.FORCE},MW_VELOCITY_UNIT:{name:"MW velocity units (nm / fs)",value:1,type:h.VELOCITY},METERS_PER_SECOND:{name:"meters per second",value:1*f*(1/a),type:h.VELOCITY}},n.ratio=d=function(e,t){var n=function(e,t){if(e.type!==t.type)throw new Error("Attempt to convert incompatible type '"+e.name+"'' to '"+t.name+"'")};if(t.per)return n(e,t.per),e.value/t.per.value;if(t.as)return n(e,t.as),t.as.value/e.value;throw new Error("units.ratio() received arguments it couldn't understand.")},n.convert=v=function(e,t){var n=t&&t.from,r=t&&t.to;if(!n)throw new Error('units.convert() did not receive a "from" argument');if(!r)throw new Error('units.convert() did not receive a "to" argument');return e*d(r,{per:n})}}),e.define("/math/index.js",function(e,t,n,r,i){n.normal=e("./distributions").normal,n.getWindowedAverager=e("./utils").getWindowedAverager,n.minimize=e("./minimizer").minimize,window&&(window.minimize=n.minimize)}),e.define("/math/distributions.js",function(e,t,n,r,i){n.normal=function(){var e=null;return function(t,n){t==null&&(t=0),n==null&&(n=1);var r,i,s,o,u;return e?(i=e,e=null,i):(o=Math.random(),u=Math.random(),s=2*Math.PI*o,r=Math.sqrt(-2*Math.log(u)),e=t+n*r*Math.sin(s),t+n*r*Math.cos(s))}}()}),e.define("/math/utils.js",function(e,t,n,r,i){n.getWindowedAverager=function(e){e==null&&(e=1e3);var t=0,n=[],r=0;return function(i){return r-=n[t]||0,r+=i,n[t]=i,++t===e&&(t=0),n.length===e?r/e:NaN}}}),e.define("/math/minimizer.js",function(e,t,n,r,i){n.minimize=function(e,t,n){n=n||{},n.precision==null&&(n.precision=.01);var r=n.precision,i=n.bounds,s=n.maxiter||1e3,o=n.stopval||-Infinity,u=n.maxstep||.01,a=n.eps||.01,f=t.length,l,c,h,p,d,v,m,g,y,b;v=u*u,l=[];for(y=0;y<f;y++)l[y]=t[y];c=e.apply(null,l),h=c[0],d=c[1],g=0;do{if(h<=o)break;if(g>s)return console.log("maxiter reached"),{error:"maxiter reached",f:h,iter:s,x:l};m=0;for(y=0;y<f;y++)m+=d[y]*d[y];if(a*a*m>v){b=Math.sqrt(v/m)/a;for(y=0;y<f;y++)d[y]=b*d[y]}for(y=0;y<f;y++)l[y]-=a*d[y],i&&l[y]<i[y][0]&&(l[y]=i[y][0]),i&&l[y]>i[y][1]&&(l[y]=i[y][1]);p=h,c=e.apply(null,l),h=c[0],d=c[1],g++}while(Math.abs(h-p)>r);return[h,l]}}),e.define("/potentials/index.js",function(e,t,n,r,i){var s=n.potentials={};n.coulomb=e("./coulomb"),n.lennardJones=e("./lennard-jones")}),e.define("/potentials/coulomb.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.COULOMB_CONSTANT.as(s.unit.METERS_PER_FARAD),a=s.ratio(o.NANOMETER,{per:o.METER}),f=Math.pow(s.ratio(o.COULOMB,{per:o.ELEMENTARY_CHARGE}),2),l=s.ratio(o.EV,{per:o.JOULE}),c=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON}),h=u*f*a*l,p=u*f*a*a*c,d=n.potential=function(e,t,n){return h*(t*n/e)},v=n.forceFromSquaredDistance=function(e,t,n){return-p*(t*n/e)},m=n.forceOverDistanceFromSquaredDistance=function(e,t,n){return v(e,t,n)/Math.sqrt(e)},g=n.force=function(e,t,n){return v(e*e,t,n)}}),e.define("/potentials/lennard-jones.js",function(e,t,n,r,i){var s=e("../constants"),o=s.unit,u=s.ratio(o.NANOMETER,{per:o.METER}),a=s.ratio(o.MW_FORCE_UNIT,{per:o.NEWTON});n.pairwiseEpsilon=function(e,t){return.5*(e+t)},n.pairwiseSigma=function(e,t){return Math.sqrt(e*t)},n.rmin=function(e){return Math.pow(2,1/6)*e},n.radius=function(e){return.5*n.rmin(e)},n.newLJCalculator=function(e,t){var r,i,f,l,c,h,p,d=function(e,d){r=e,i=d,f=n.rmin(i),r!=null&&i!=null&&(l=4*r*Math.pow(i,12),c=4*r*Math.pow(i,6),h=12*s.convert(l,{from:o.EV,to:o.JOULE})*u*a,p=6*s.convert(c,{from:o.EV,to:o.JOULE})*u*a),typeof t=="function"&&t(v(),this)},v=function(){return{epsilon:r,sigma:i,rmin:f}},m=function(e){if(e==null||parseFloat(e)!==e)throw new Error("lennardJones: epsilon value "+e+" is invalid")},g=function(e){if(e==null||parseFloat(e)!==e||e<=0)throw new Error("lennardJones: sigma value "+e+" is invalid")},y;return m(e.epsilon),g(e.sigma),d(e.epsilon,e.sigma),y={coefficients:v,setEpsilon:function(e){m(e),d(e,i)},setSigma:function(e){g(e),d(r,e)},potentialFromSquaredDistance:function(e){return l*Math.pow(e,-6)-c*Math.pow(e,-3)},potential:function(e){return y.potentialFromSquaredDistance(e*e)},forceOverDistanceFromSquaredDistance:function(e){var t=1/e,n=t*t*t,r=n*t,i=r*n;return h*i-p*r},force:function(e){return e*y.forceOverDistanceFromSquaredDistance(e*e)}}}}),e.define("/md2d.js",function(e,t,n,r,i){typeof window=="undefined"&&(window={});var s=e("./arrays/arrays").arrays,o=e("./constants"),u=o.unit,a=e("./math"),f=e("./potentials").coulomb,l=e("./potentials").lennardJones,c=!0,h=function(){try{new Float32Array}catch(e){return!1}return!0}(),p=2,d=1e3,v=-120*o.BOLTZMANN_CONSTANT.as(u.EV_PER_KELVIN),m=.34,g=39.95,y=o.convert(g,{from:u.DALTON,to:u.KILOGRAM}),b=o.BOLTZMANN_CONSTANT.as(u.JOULES_PER_KELVIN),w,E,S,x=function(e,t,n,r){return e*r-t*n},T=function(e,t){return e*e+t*t},N=function(e,t){var n=2*t,r=2/n*e,i=o.convert(r,{from:u.MW_ENERGY_UNIT,to:u.JOULE});return i/b},C=function(e,t){var n=2*t,r=e*b,i=o.convert(r,{from:u.JOULE,to:u.MW_ENERGY_UNIT}),s=i*n/2;return s},k=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("md2d: requested temperature "+e+" could not be understood.");if(t<0)throw new Error("md2d: requested temperature "+t+" was less than zero");if(t===Infinity)throw new Error("md2d: requested temperature was Infinity!")},L=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t[n]=e[n];return t};n.ELEMENT_INDICES=E={MASS:0,EPSILON:1,SIGMA:2,RADIUS:3},n.INDICES=w={RADIUS:0,PX:1,PY:2,X:3,Y:4,VX:5,VY:6,SPEED:7,AX:8,AY:9,CHARGE:10,ELEMENT:11},n.SAVEABLE_INDICES=S=["X","Y","VX","VY","CHARGE","ELEMENT"],n.makeModel=function(){var e,t=!1,n=!1,r=!1,i=!0,v=!1,m=!1,g,y=.001,b=[10,10],C,A,O,M,_=0,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt=0,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt=window.state={},dt=[],vt=[],mt=5,gt=[],yt=[],bt=function(e,t,n){gt[e][t]=gt[t][e]=mt*mt*n.sigma*n.sigma,e===t&&wt(e,n)},wt=function(e,t){j[e][E.RADIUS]=l.radius(t.sigma);if(!F||!K)return;for(var n=0,r=F.length;n<r;n++)F[n]=j[K[n]][E.RADIUS]},Et=function(t){var r=[],i,o;for(o=0;o<Q.length;o++)r[o]=Q[o];i=B,n=!1,e.createAtoms({num:t});for(o=0;o<Q.length;o++)s.copy(r[o],Q[o]);H=r[0].length,B=i},St=function(e){var t=h&&c?"Float32Array":"regular",n=h&&c?"Uint16Array":"regular";tt=[],tt[0]=G=s.create(e,0,n),tt[1]=Y=s.create(e,0,n),tt[2]=Z=s.create(e,0,t),tt[3]=et=s.create(e,0,t)},xt=function(e){var t=[],n;for(n=0;n<tt.length;n++)t[n]=tt[n];St(e);for(n=0;n<tt.length;n++)s.copy(t[n],tt[n])},Tt,Nt=function(){return r?1e3:1e3},Ct=function(){m=!0,Tt=a.getWindowedAverager(Nt())},kt=function(){var e=0,t;for(t=0;t<H;t++)e+=j[K[t]][0]*(z[t]*z[t]+W[t]*W[t]);return N(e/2,H)},Lt=function(e,t){z[e]*=t,W[e]*=t,I[e]*=t,q[e]*=t},At=function(e,t,n){z[e]+=t,W[e]+=n,I[e]=z[e]*j[K[e]][0],q[e]=W[e]*j[K[e]][0]},Ot=function(e,t){z[e]-=t*(U[e]-it),W[e]+=t*(R[e]-rt),I[e]=z[e]*j[K[e]][0],q[e]=W[e]*j[K[e]][0]},Mt=function(){for(var e=0;e<H;e++)At(e,-ut,-at),Ot(e,-ct)},_t=function(){for(var e=0;e<H;e++)At(e,ut,at),Ot(e,ct)},Dt=function(){var e=0,t=0,n=0,r=0,i;for(i=0;i<H;i++)e+=R[i],t+=U[i],n+=I[i],r+=q[i];rt=e/H,it=t/H,st=n,ot=r,ut=n/B,at=r/B},Pt=function(){var e=0,t=0,n,r;for(r=0;r<H;r++)n=j[K[r]][0],e+=n*x(R[r]-rt,U[r]-it,z[r]-ut,W[r]-at),t+=n*T(R[r]-rt,U[r]-it);ft=e,lt=t,ct=ft/lt},Ht=function(){Dt(),Pt()},Bt=function(e){R[e]+=z[e]*D+.5*V[e]*P,U[e]+=W[e]*D+.5*$[e]*P},jt=function(e){R[e]<M?(R[e]=M+(M-R[e]),z[e]*=-1,I[e]*=-1):R[e]>A&&(R[e]=A-(R[e]-A),z[e]*=-1,I[e]*=-1),U[e]<O?(U[e]=O+(O-U[e]),W[e]*=-1,q[e]*=-1):U[e]>C&&(U[e]=C-(U[e]-C),W[e]*=-1,q[e]*=-1)},Ft=function(e){var t=j[K[e]][0];z[e]+=.5*V[e]*D,I[e]=t*z[e],W[e]+=.5*$[e]*D,q[e]=t*W[e]},It=function(e){var t,n,s,o,u,a,l,c=K[e],h,p=1/j[c][0],d,v=J[e];for(t=0;t<e;t++)h=K[t],d=1/j[h][0],n=R[t]-R[e],s=U[t]-U[e],o=n*n+s*s,u=0,i&&o<gt[c][h]&&(u+=yt[c][h].forceOverDistanceFromSquaredDistance(o)),r&&(u+=f.forceOverDistanceFromSquaredDistance(o,v,J[t])),u&&(a=u*n,l=u*s,V[e]+=a*p,$[e]+=l*p,V[t]-=a*d,$[t]-=l*d)},qt=function(){if(nt<1)return;var e,t,n,r,i,s,a,f,l,c,h,p,d,v,m;for(e=0,t=tt[0].length;e<t;e++)n=G[e],r=Y[e],v=1/j[K[n]][0],m=1/j[K[r]][0],i=R[r]-R[n],s=U[r]-U[n],a=i*i+s*s,f=Math.sqrt(a),l=et[e],c=Z[e],h=o.convert(l*(f-c),{from:u.EV_PER_NM,to:u.MW_FORCE_UNIT})/f,p=h*i,d=h*s,V[n]+=p*v,$[n]+=d*v,V[r]-=p*m,$[r]-=d*m},Rt=function(e,t){var n,r;e==null&&(e=g),ht=kt(),m&&Math.abs(Tt(ht)-e)<=e*y&&(m=!1);if(t||v||m&&ht>0){n=Math.sqrt(e/ht);for(r=0;r<H;r++)Lt(r,n);ht=e}};return e={outputState:pt,useCoulombInteraction:function(e){r=!!e},useLennardJonesInteraction:function(e){i=!!e},useThermostat:function(e){v=!!e},setTargetTemperature:function(e){k(e),g=e},setTime:function(e){pt.time=_=e},setSize:function(e){if(t)throw new Error("The molecular model's size has already been set, and cannot be reset.");var n=e[0]&&e[0]>0?e[0]:10,r=e[1]&&e[1]>0?e[1]:10;b=[n,r]},getSize:function(){return[b[0],b[1]]},getLJCalculator:function(){return yt},setElements:function(e){var t,r,i,s,o,u;if(n)throw new Error("md2d: setElements cannot be called after atoms have been created");j=e;for(t=0;t<j.length;t++)dt[t]=[],vt[t]=[],yt[t]=[],gt[t]=[];for(t=0;t<j.length;t++){i=j[t][E.EPSILON],o=j[t][E.SIGMA],j[t][E.RADIUS]=l.radius(o);for(r=t;r<j.length;r++)s=j[r][E.EPSILON],u=j[r][E.SIGMA],dt[t][r]=dt[r][t]=l.pairwiseEpsilon(i,s),vt[t][r]=vt[r][t]=l.pairwiseSigma(o,u),function(e,t){yt[e][t]=yt[t][e]=l.newLJCalculator({epsilon:dt[e][t],sigma:vt[e][t]},function(n){bt(e,t,n)})}(t,r)}},createAtoms:function(r){var i=h&&c?"Float32Array":"regular",o=h&&c?"Uint8Array":"regular",u,a;if(n)throw new Error("md2d: createAtoms was called even though the particles have already been created for this model instance.");n=!0,t=!0;if(typeof r=="undefined")throw new Error("md2d: createAtoms was called without options specifying the atoms to create.");a=r.num;if(typeof a=="undefined")throw new Error("md2d: createAtoms was called without the required 'num' option specifying the number of atoms to create.");if(a!==Math.floor(a))throw new Error("md2d: createAtoms was passed a non-integral 'num' option.");if(a<p)throw new Error("md2d: create Atoms was passed an 'num' option equal to: "+a+" which is less than the minimum allowable value: N_MIN = "+p+".");if(a>d)throw new Error("md2d: create Atoms was passed an 'N' option equal to: "+a+" which is greater than the minimum allowable value: N_MAX = "+d+".");u=function(){var e=0,t;for(t in w)w.hasOwnProperty(t)&&e++;return e}(),Q=e.atoms=s.create(u,null,"regular"),F=e.radius=Q[w.RADIUS]=s.create(a,0,i),I=e.px=Q[w.PX]=s.create(a,0,i),q=e.py=Q[w.PY]=s.create(a,0,i),R=e.x=Q[w.X]=s.create(a,0,i),U=e.y=Q[w.Y]=s.create(a,0,i),z=e.vx=Q[w.VX]=s.create(a,0,i),W=e.vy=Q[w.VY]=s.create(a,0,i),X=e.speed=Q[w.SPEED]=s.create(a,0,i),V=e.ax=Q[w.AX]=s.create(a,0,i),$=e.ay=Q[w.AY]=s.create(a,0,i),J=e.charge=Q[w.CHARGE]=s.create(a,0,i),K=e.element=Q[w.ELEMENT]=s.create(a,0,o),H=0,B=0},addAtom:function(e,t,n,r,i,s){var o,u;H+1>Q[0].length&&Et(H+1),o=j[e],u=o[E.MASS],K[H]=e,F[H]=j[e][E.RADIUS],R[H]=t,U[H]=n,z[H]=r,W[H]=i,I[H]=r*u,q[H]=i*u,V[H]=0,$[H]=0,X[H]=Math.sqrt(r*r+i*i),J[H]=s,B+=u,H++},addRadialBond:function(e,t,n,r){nt+1>G.length&&xt(H+1),G[nt]=e,Y[nt]=t,Z[nt]=n,et[nt]=r,nt++},initializeAtomsFromProperties:function(t){var n,r,i,s,o,u,a,f;if(!t.X||!t.Y)throw new Error("md2d: initializeAtomsFromProperties must specify at minimum X and Y locations.");if(!t.VX||!t.VY)throw new Error("md2d: For now, velocities must be set when locations are set.");for(a=0,f=t.X.length;a<f;a++)u=t.ELEMENT?t.ELEMENT[a]:0,n=t.X[a],r=t.Y[a],i=t.VX[a],s=t.VY[a],o=t.CHARGE?t.CHARGE[a]:0,e.addAtom(u,n,r,i,s,o);ht=kt(),e.computeOutputState()},initializeAtomsRandomly:function(t){var n=t.temperature||100,r=t.num||Q[0].length,i=Math.floor(Math.sqrt(r)),s=Math.ceil(r/i),o,u,f,l,c,h,p,d,v,m,g,y,w;k(n),c=b[0]/(1+s),l=b[1]/(1+i),o=-1;for(u=1;u<=i;u++)for(f=1;f<=s;f++){o++;if(o===r)break;w=Math.floor(Math.random()*j.length),h=a.normal(1,.25),p=2*Math.random()*Math.PI,d=f*c,v=u*l,m=h*Math.cos(p),g=h*Math.sin(p),y=2*(o%2)-1,e.addAtom(w,d,v,m,g,y)}Ht(),Mt(),Rt(n,!0),ht=kt(),e.computeOutputState()},initializeRadialBonds:function(t){var n=t.atom1Index.length,r;St(t.atom1Index.length);for(r=0;r<n;r++)e.addRadialBond(t.atom1Index[r],t.atom2Index[r],t.bondLength[r],t.bondStrength[r])},relaxToTemperature:function(t){t!=null&&(g=t),k(g),Ct();while(m)e.integrate()},integrate:function(t,r){var i;if(!n)throw new Error("md2d: integrate called before atoms created.");t==null&&(t=100),D=r||1,P=D*D,i=j[K[0]][E.RADIUS],M=i,O=i,A=b[0]-i,C=b[1]-i;var s=_,o=Math.floor(t/D),u,a;for(u=1;u<=o;u++){_=s+u*D;for(a=0;a<H;a++)Bt(a),jt(a),Ft(a),V[a]=$[a]=0,It(a);qt();for(a=0;a<H;a++)Ft(a),X[a]=Math.sqrt(z[a]*z[a]+W[a]*W[a]);Rt()}e.computeOutputState()},getTotalMass:function(){return B},getRadiusOfElement:function(e){return j[e][E.RADIUS]},computeOutputState:function(){var e,t,n,s,a,l,c,h,p,d,v,m;m=0,v=0;for(e=0;e<H;e++){v+=.5*j[K[e]][0]*(z[e]*z[e]+W[e]*W[e]);for(t=e+1;t<H;t++)a=R[t]-R[e],l=U[t]-U[e],c=a*a+l*l,i&&(d=yt[K[e]][K[t]],m+=-d.potentialFromSquaredDistance(c,K[e],K[t])),r&&(m+=-f.potential(Math.sqrt(c),J[e],J[t]))}for(e=0;e<nt;e++)n=G[e],s=Y[e],a=R[s]-R[n],l=U[s]-U[n],c=a*a+l*l,h=et[e],p=Math.sqrt(c)-Z[e],m=.5*h*p*p;pt.time=_,pt.pressure=0,pt.PE=m,pt.KE=o.convert(v,{from:u.MW_ENERGY_UNIT,to:u.EV}),pt.T=ht,pt.pCM=[st,ot],pt.CM=[rt,it],pt.vCM=[ut,at],pt.omega_CM=ct},newPotentialCalculator:function(e,t,n){return function(s,a){var l=0,c=0,h=0,p,d,v=yt[e],m,g,y,b,w,E,S;for(m=0;m<H;m++)g=s-R[m],y=a-U[m],b=g*g+y*y,E=0,i&&(S=v[K[m]],l+=-S.potentialFromSquaredDistance(b,e,K[m]),n&&(E+=S.forceOverDistanceFromSquaredDistance(b))),r&&t&&(w=Math.sqrt(b),l+=-f.potential(w,t,J[m]),n&&(E+=f.forceOverDistanceFromSquaredDistance(b,t,J[m]))),E&&(c+=E*g,h+=E*y);return n?(p=o.convert(c,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),d=o.convert(h,{from:u.MW_FORCE_UNIT,to:u.EV_PER_NM}),[l,[p,d]]):l}},findMinimumPELocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=j[t][E.RADIUS],u=a.minimize(s,[n,r],{bounds:[[o,b[0]-o],[o,b[1]-o]]});return u.error?!1:u[1]},findMinimumPESquaredLocation:function(t,n,r,i){var s=e.newPotentialCalculator(t,i,!0),o=function(e,t){var n,r,i;return n=s(e,t),r=n[0],i=n[1],i[0]*=2*r,i[1]*=2*r,[r*r,i]},u=j[t][E.RADIUS],f=a.minimize(o,[n,r],{bounds:[[u,b[0]-u],[u,b[1]-u]],stopval:1e-4,precision:1e-6});return f.error?!1:f[1]},serialize:function(){var e={},t,n,r,i;for(r=0,i=S.length;r<i;r++)t=S[r],n=Q[w[t]],e[t]=n.slice?n.slice():L(n);return e}}}}),e("/md2d.js");var t=e("./md2d"),n;modeler={},modeler.VERSION="0.2.0",modeler.model=function(e){function A(e){$.unique(e);for(var t=0,n=e.length;t<n;t++)e[t]()}function O(e){var t,n,r=[],i,s;typeof e=="string"?n=[e]:n=e;for(i=0,s=n.length;i<s;i++)t=n[i],k[t]&&(r=r.concat(k[t]));k.all&&(r=r.concat(k.all)),A(r)}function M(){var e,t=0,i=r.get_num_atoms();e=-1;while(++e<i)t+=n.speed[e];return t/i}function _(e,t){var r;return n.integrate(),d=S.pressure,w=S.PE,E=S.KE,b=S.time,v.push(d),v.splice(0,v.length-16),P(),f||(r=Date.now(),m?(m=r-m,m&&g.push(m),m=r,g.splice(0,g.length-128)):m=r),t||s.tick(),f}function D(){return c===0}function P(){var e,t=[],n=C.length;e=-1;while(++e<n)t[e]=arrays.clone(C[e]);l.length=c,c++,h++,p=!0,l.push({nodes:t,pressure:S.pressure,pe:S.PE,ke:S.KE,time:S.time}),c>1e3&&(l.splice(0,1),c=1e3)}function H(){l=[],c=0,h=0}function B(){l.length=c+1}function j(e){var t,r=C.length;if(e<0)throw new Error("modeler: request for tick_history_list["+e+"]");if(e>=l.length)throw new Error("modeler: request for tick_history_list["+e+"], tick_history_list.length="+l.length);t=-1;while(++t<r)arrays.copy(l[e].nodes[t],C[t]);E=l[e].ke,b=l[e].time,n.setTime(b)}function F(){return v.reduce(function(e,t){return e+t})/v.length}function I(){var e,t,n=0,r=g.length;e=-1;while(++e<r)n+=g[e];return t=n/r,t?1/t*1e3:0}function q(e){y=e,n.setTargetTemperature(e)}function R(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&e[t]!==undefined&&e[t]!==null&&(L["set_"+t]?L["set_"+t](e[t]):L[t]&&(L[t]=e[t]),n.push(t));O(n)}function U(){n.computeOutputState(),d=S.pressure,w=S.PE,E=S.KE,b=S.time}var r={},i=e.elements||[{id:0,mass:39.95,epsilon:-0.1,sigma:.34}],s=d3.dispatch("tick","play","stop","reset","stepForward","stepBack","seek"),o,u,a,f=!0,l=[],c=0,h=0,p=!1,d,v=[0],m,g=[],y,b,w,E,S,x,T=e.width,N=e.height,C,k={},L={temperature:300,coulomb_forces:!1,lennard_jones_forces:!0,temperature_control:!0,set_temperature:function(e){this.temperature=e,n&&n.setTargetTemperature(e)},set_temperature_control:function(e){this.temperature_control=e,n&&n.useThermostat(e)},set_coulomb_forces:function(e){this.coulomb_forces=e,n&&n.useCoulombInteraction(e)},set_epsilon:function(e){console.log("set_epsilon: This method is temporarily deprecated")},set_sigma:function(e){console.log("set_sigma: This method is temporarily deprecated")}};return r.INDICES={RADIUS:t.INDICES.RADIUS,PX:t.INDICES.PX,PY:t.INDICES.PY,X:t.INDICES.X,Y:t.INDICES.Y,VX:t.INDICES.VX,VY:t.INDICES.VY,SPEED:t.INDICES.SPEED,AX:t.INDICES.AX,AY:t.INDICES.AY,CHARGE:t.INDICES.CHARGE,ELEMENT:t.INDICES.ELEMENT},x=e.model_listener,R(e),r.getStats=function(){return{speed:M(),ke:E,temperature:y,pressure:F(),current_step:h,steps:l.length-1}},r.getStatsHistory=function(){var e,t,n,r=[];r.push("time (fs)	total PE (eV)	total KE (eV)	total energy (eV)");for(e=0,t=l.length;e<t;e++)n=l[e],r.push(n.time+"	"+n.pe+"	"+n.ke+"	"+(n.pe+n.ke));return r.join("\n")},r.stepCounter=function(){return h},r.steps=function(){return l.length-1},r.isNewStep=function(){return p},r.seek=function(e){return arguments.length||(e=0),f=!0,p=!1,c=e,h=e,j(c),s.seek(),O("seek"),x&&x(),h},r.stepBack=function(e){arguments.length||(e=1);var t=-1;f=!0,p=!1;while(++t<e)c>1&&(c--,h--,j(c-1),x&&x());return h},r.stepForward=function(e){arguments.length||(e=1);var t=-1;f=!0;while(++t<e)c<l.length?(j(c),c++,h++,x&&x()):_();return h},r.createNewAtoms=function(e){var s,u,a,f,l;typeof e=="number"?l=e:e.num!=null?l=e.num:e.X&&(l=e.X.length),s=[];for(a=0,f=i.length;a<f;a++)u=i[a],s[u.id]=[u.mass,u.epsilon,u.sigma];return n=t.makeModel(),n.setSize([T,N]),n.setElements(s),n.createAtoms({num:l}),C=n.atoms,S=n.outputState,o=L.temperature_control,y=L.temperature,n.useLennardJonesInteraction(L.lennard_jones_forces),n.useCoulombInteraction(L.coulomb_forces),n.useThermostat(o),n.setTargetTemperature(y),e.X&&e.Y?n.initializeAtomsFromProperties(e):(n.initializeAtomsRandomly({temperature:y}),e.relax&&n.relaxToTemperature()),U(),H(),P(),h=0,p=!0,r},r.createRadialBonds=function(e){return n.initializeRadialBonds(e),U(),r},r.setEpsilon=function(e){n.setLJEpsilon(e)},r.setSigma=function(e){n.setLJSigma(e)},r.getEpsilon=function(){return n.getLJEpsilon()},r.getSigma=function(){return n.getLJSigma()},r.getLJCalculator=function(){return n.getLJCalculator()},r.getPotentialFunction=function(e,t,r){return t==null&&(t=0),r=!!r,n.newPotentialCalculator(e,t,r)},r.resetTime=function(){n.setTime(0)},r.getTime=function(){return S?S.time:undefined},r.getTotalMass=function(){return n.getTotalMass()},r.addRandomAtom=function(e,t){e==null&&(e=Math.floor(Math.random()*i.length)),t==null&&(t=0);var s=r.size(),o=n.getRadiusOfElement(e),u,a,f,l=0,c=10;do{u=Math.random()*s[0]-2*o,a=Math.random()*s[1]-2*o,f=n.findMinimumPELocation(e,u,a,0,0,t);if(f&&r.addAtom(e,f[0],f[1],0,0,t))return!0}while(++l<c);return!1},r.addAtom=function(e,t,i,s,o,u){var a=r.size(),f=n.getRadiusOfElement(e);return t<f&&(t=f),t>a[0]-f&&(t=a[0]-f),i<f&&(i=f),i>a[1]-f&&(i=a[1]-f),r.getPotentialFunction(e,0,!1)(t,i)<=0?(n.addAtom(e,t,i,s,o,u),C=n.atoms,n.computeOutputState(),x&&x(),!0):!1},r.get_speed=function(){return arrays.copy(n.speed,[])},r.get_rate=function(){return I()},r.is_stopped=function(){return f},r.set_lennard_jones_forces=function(e){u=e,n.useLennardJonesInteraction(e)},r.set_coulomb_forces=function(e){a=e,n.useCoulombInteraction(e)},r.get_nodes=function(){return C},r.get_num_atoms=function(){return C[0].length},r.on=function(e,t){return s.on(e,t),r},r.tickInPlace=function(){return s.tick(),r},r.tick=function(e,t){arguments.length||(e=1);var n=t&&t.dontDispatchTickEvent||!1,i=-1;while(++i<e)_(null,n);return r},r.relax=function(){return n.relaxToTemperature(),r},r.start=function(){return r.resume()},r.resume=function(){return f=!1,d3.timer(_),s.play(),O("play"),r},r.stop=function(){return f=!0,s.stop(),r},r.ke=function(){return S?S.KE:undefined},r.ave_ke=function(){return S?S.KE/r.get_num_atoms():undefined},r.pe=function(){return S?S.PE:undefined},r.ave_pe=function(){return S?S.PE/r.get_num_atoms():undefined},r.speed=function(){return M()},r.pressure=function(){return F()},r.temperature=function(e){return arguments.length?(q(e),r):y},r.size=function(e){return arguments.length?(n.setSize(e),r):n.getSize()},r.set=function(e){R(e)},r.get=function(e){return L[e]},r.addPropertiesListener=function(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],k[i]||(k[i]=[]),k[i].push(t)},r.serialize=function(e){var t=$.extend({},L);return e&&(t.atoms=n.serialize()),i&&(t.elements=i),t.width=T,t.height=N,t},r}})();