(function(){molecules_coulomb={},molecules_coulomb={version:"0.0.1"};var a=-50;molecules_coulomb.force=function(b,c,d){return a*(c*d/(b*b))},molecules_coulomb.energy=function(b,c,d){return-a*(c*d/b)},molecules_lennard_jones={},molecules_lennard_jones={version:"0.0.1"};var b=-1,c=4,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6);molecules_lennard_jones.epsilon=function(a){return molecules_lennard_jones.coefficients(a,c)},molecules_lennard_jones.sigma=function(a){return molecules_lennard_jones.coefficients(b,a)},molecules_lennard_jones.coefficients=function(a,g){arguments.length&&(b=a,c=g,d=Math.pow(2,1/6)*c,e=4*b*Math.pow(c,12),f=4*b*Math.pow(c,6));var h={epsilon:b,sigma:c,rmin:d,alpha:e,beta:f};return h},molecules_lennard_jones.potential=function(a){return(e/Math.pow(a,12)-f/Math.pow(a,6))*-1},molecules_lennard_jones.force=function(a){return 12*e/Math.pow(a,13)-6*f/Math.pow(a,7)},modeler={},modeler.layout={},modeler.VERSION="0.1.0",modeler.layout.model=function(){function bu(a){var b={};return b.index=a,b.radius=bt[bg][a],b.px=bt[bh][a],b.py=bt[bi][a],b.x=bt[bj][a],b.y=bt[bk][a],b.vx=bt[bl][a],b.vy=bt[bm][a],b.speed=bt[bn][a],b.ax=bt[bo][a],b.ay=bt[bp][a],b.mass=bt[bq][a]*2,b.charge=bt[br][a],b}function bv(){var a,d=c,e=[];a=-1;while(++a<d)b[a]=bu(a);b.length=d}function bw(a){return.005*Math.pow(Math.E/2,a)}function bx(){var a,b;for(a=0;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>H){K=a;break}}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b>I)break}for(;a<=100;a+=.001){b=molecules_lennard_jones.force(a);if(b<I){J=a;break}}}function by(){var a,b;for(a=.001;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<L){O=a;break}}for(;a<=100;a+=.001){b=molecules_coulomb.force(a,-1,1);if(b<M)break}N=a}function bz(){var a=bt[0].length,b,c,d,i,j,q,r,j,s,t,u,v,x,y,z,A,B,C,D,E,F=X[0],G=X[0],I=e[0]-X[0],K=e[1]-X[0];T=0,E=-1;while(++E<P){c=-1;while(++c<a)C=$[c],D=_[c],$[c]+=ba[c]*Q+.5*R*bd[c],_[c]+=bb[c]*Q+.5*R*be[c],ba[c]+=.5*Q*bd[c],bb[c]+=.5*Q*be[c],z=$[c]-C,A=_[c]-D,q=Math.sqrt(z*z+A*A),bc[c]=q,$[c]<F?($[c]=F+(F-$[c]),Y[c]=$[c]+z,Z[c]=D,ba[c]*=-1,T+=bc[c]):$[c]>I?($[c]=I+(I-$[c]),Y[c]=$[c]+z,Z[c]=D,ba[c]*=-1,T+=bc[c]):_[c]<G?(_[c]=G+(G-_[c]),Z[c]=_[c]+A,Y[c]=C,bb[c]*=-1,T+=bc[c]):_[c]>K?(_[c]=K+(K-_[c]),Z[c]=_[c]+A,Y[c]=C,bb[c]*=-1,T+=bc[c]):(Y[c]=C,Z[c]=D);c=-1;while(++c<a)bd[c]=0,be[c]=0;if(g||h){c=-1;while(++c<a){d=c;while(++d<a)z=$[d]-$[c],A=_[d]-_[c],s=z*z+A*A,q=Math.sqrt(s),g&&q<J&&(u=Math.max(H,molecules_lennard_jones.force(q)),x=z/q*u,y=A/q*u,bd[c]+=x,be[c]+=y,bd[d]-=x,be[d]-=y),h&&q<N&&(v=Math.min(L,molecules_coulomb.force(q,w[c],w[d])),k+=molecules_coulomb.energy(q,w[c],w[d]),x=z/q*v,y=A/q*v,bd[c]+=x,be[c]+=y,bd[d]-=x,be[d]-=y)}}if(f){l=bO(),o=m*1.1,p=m*.9,speed_max=m*2,speed_max_one_percent=speed_max*.01,speed_min=m*.5,speed_min_one_percent=speed_min*.01,c=-1;while(++c<a)l>o?(bd[c]*=.5,be[c]*=.5,bc[c]>speed_max&&(n=speed_max/bc[c],ba[c]*=n,bb[c]*=n,bc[c]=speed_max-Math.random()*speed_max_one_percent,Y[c]=$[c]-ba[c],Z[c]=_[c]-bb[c])):l<p&&(bd[c]*=2,be[c]*=2,bc[c]<speed_min&&(n=speed_min/bc[c],ba[c]*=n,bb[c]*=n,bc[c]=speed_min+Math.random()*speed_min_one_percent,Y[c]=$[c]-ba[c],Z[c]=_[c]-bb[c]))}c=-1;while(++c<a)ba[c]+=.5*Q*bd[c],bb[c]+=.5*Q*be[c]}}function bA(){return bz(),U.push(T),U.splice(0,U.length-16),bL(),bv(),bD(),u||(t=Date.now(),V?(V=t-V,V&&W.push(V),V=t,W.splice(0,W.length-128)):V=t,d.tick({type:"tick"})),u}function bB(){A=[],B=0,C=-1}function bC(){A.length=B+1}function bD(){var a,b,c,d=[],e=bt.length;a=-1;while(++a<e)d[a]=arrays.clone(bt[a]);A.length=B,B++,C++,D=!0,A.push({nodes:d,ke:j}),B>1e3&&(A.splice(0,1),B=1e3)}function bE(a){var b,c=bt.length;if(a<0)throw new Error("modeler: request for tick_history_list["+a+"]");if(a>=A.length)throw new Error("modeler: request for tick_history_list["+a+"], tick_history_list.length="+A.length);b=-1;while(++b<c)arrays.copy(A[a].nodes[b],bt[b]);j=A[a].ke,bv()}function bF(a){var b,c,d=bt[0].length;b=-1;while(++b<d)c=a/bc[b],ba[b]=($[b]-Y[b])*c,bb[b]=(_[b]-Z[b])*c,Y[b]+=ba[b],Z[b]+=bb[b],bc[b]=a}function bG(a){var b,c=bt[0].length;b=-1;while(++b<c)ba[b]=($[b]-Y[b])*a,bb[b]=(_[b]-Z[b])*a,Y[b]+=ba[b],Z[b]+=bb[b],bc[b]*-a}function bH(a){var b,c,d=bt[0].length;b=-1;while(++b<d)bc[b]>a&&(c=a/bc[b],ba[b]=($[b]-Y[b])*c,bb[b]=(_[b]-Z[b])*c,Y[b]+=ba[b],Z[b]+=bb[b],bc[b]=a)}function bI(a){var b,c=bt[0].length;b=-1;while(++b<c)bd[b]=a,be[b]=a}function bJ(){return U.reduce(function(a,b){return a+b})/U.length}function bK(a){if(arguments.length)bK.push(a),bK.splice(0,bK.length-100);else return bK.reduce(function(a,b){return a+b})/U.length}function bL(){var a,b,c,d,e,f,g=bt[0].length;j=0,k=0,a=-1;while(++a<g)b=bc[a],c=b*b*bf[a],j+=c,d=bd[a],e=be[a],f=d+d,k+=f}function bM(){var a,b,c,d,e=bt[0].length;k=0,a=-1;while(++a<e)b=bd[a],c=be[a],d=Math.sqrt(b*b+c*c),k+=d;return k}function bN(){var a,b,c,d=bt[0].length;j=0,a=-1;while(++a<d)b=bc[a],c=b*b*bf[a],j+=c;return j}function bO(){var a,b=0,c=bt[0].length;a=-1;while(++a<c)b+=bc[a];return b/c}function bP(){var a,b,c=0,d=W.length;a=-1;while(++a<d)c+=W[a];return b=c/d,b?1/b*1e3:0}function bQ(a){var b;save_temperature_control=f,f=!0,b=-1;while(++b<a)bz();f=save_temperature_control,bv()}function bR(a){temperature=a,m=bw(temperature)}var a={},b=[],c,d=d3.dispatch("tick"),e=[1,1],f,g,h,j,k,l,m,n,o,p,q,r,s,u=!0,v=.9,w=-0.1,x=.1,y=.8,z,A=[],B=0,C=0,D=!1,E,F,G,H=-200,I=.001,J,K,L=20,M=.01,N,O,P=50,Q=1/P,R=Q*Q,S,T,U=[0],V,W=[],X,Y,Z,$,_,ba,bb,bc,bd,be,bf,w,bg=0,bh=1,bi=2,bj=3,bk=4,bl=5,bm=6,bn=7,bo=8,bp=9,bq=10,br=11;a.RADIUS=0,a.PX=1,a.PY=2,a.X=3,a.Y=4,a.VX=5,a.VY=6,a.SPEED=7,a.AX=8,a.AY=9,a.HALFMASS=10,a.CHARGE=11;var bs=12,bt=arrays.create(bs,null,"regular");return a.getStats=function(){var a;return a={speed:bO(),ke:j,temperature:temperature,pressure:bJ(),current_step:C,steps:A.length-1},a},a.stepCounter=function(){return C},a.steps=function(){return A.length-1},a.isNewStep=function(){return D},a.stepBack=function(a){if(!arguments.length)var a=1;var b=-1;u=!0,D=!1;while(++b<a)B>1&&(B--,C--,bE(B-1),model_listener&&model_listener());return C},a.stepForward=function(a){if(!arguments.length)var a=1;var b=-1;u=!0;while(++b<a)B<A.length?(bE(B),B++,C++,model_listener&&model_listener()):(bA(),model_listener&&model_listener());return C},a.on=function(b,c){return d.on(b,c),a},a.tickInPlace=function(){return d.tick({type:"tick"}),a},a.tick=function(b){if(!arguments.length)var b=1;var c=-1;while(++c<b)bA();return a},a.set_lj_coefficients=function(b,c){return F=b,G=c,bx(),a},a.getEpsilon=function(){return F},a.getSigma=function(){return G},a.set_radius=function(a){var b,c=bt[0].length;b=-1;while(++b<c)X[b]=a;bv()},a.get_speed=function(a){if(!arguments.length)var a=[];return arrays.copy(bc,a)},a.get_rate=function(){return bP()},a.set_temperature_control=function(a){f=a},a.set_lennard_jones_forces=function(a){g=a},a.set_coulomb_forces=function(a){h=a},a.get_atoms=function(){return b},a.initialize=function(b){var b=b||{},c,d,i,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=bt[0].length,I=e[0],J=e[1],K=4,L=25,M,N,O,P,Q;return bu,bv,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bM,bN,bO,bQ,bR,g=b.lennard_jones_forces||!0,h=b.coulomb_forces||!0,model_listener=b.model_listener||!1,f=b.temperature_control||!1,bB(),M=bw(K),bx(),by(),bQ(L),l=bO(),j=bN(),k=bM(),bD(),a},a.nodes=function(b){var b=b||{},d=b.num||50,e=b.xdomain||100,f=b.ydomain||100,g=b.temperature||3,h=b.rmin||4.4,j=b.mol_rmin_radius_factor||.38,k;c=d,bt=arrays.create(bs,null,"regular");var l=!!window.WebGLRenderingContext,m=benchmark.what_browser.browser!="Safari",n=l&&m?"Float32Array":"regular";bt[a.RADIUS]=arrays.create(d,h*j,n),X=bt[a.RADIUS],bt[a.PX]=arrays.create(d,0,n),Y=bt[a.PX],bt[a.PY]=arrays.create(d,0,n),Z=bt[a.PY],bt[a.X]=arrays.create(d,0,n),$=bt[a.X],bt[a.Y]=arrays.create(d,0,n),_=bt[a.Y],bt[a.VX]=arrays.create(d,0,n),ba=bt[a.VX],bt[a.VY]=arrays.create(d,0,n),bb=bt[a.VY],bt[a.SPEED]=arrays.create(d,0,n),bc=bt[a.SPEED],bt[a.AX]=arrays.create(d,0,n),bd=bt[a.AX],bt[a.AY]=arrays.create(d,0,n),be=bt[a.AY],bt[a.HALFMASS]=arrays.create(d,.5,n),bf=bt[a.HALFMASS],bt[a.CHARGE]=arrays.create(d,0,n),w=bt[a.CHARGE],dTheta=2*Math.PI/d,v0=bw(g),i=-1;while(++i<d)Y[i]=Math.random()*e*.8+e*.1,Z[i]=Math.random()*f*.8+f*.1,ba[i]=v0*Math.cos(dTheta*i),bb[i]=v0*Math.sin(dTheta*i),$[i]=ba[i]+Y[i],_[i]=bb[i]+Z[i],bc[i]=Math.sqrt(ba[i]*ba[i]+bb[i]*bb[i]),bd[i]=0,be[i]=0,w[i]=2*(i%2)-1;return bv(),a},a.start=function(){return a.initialize(),a.resume()},a.resume=function(){return u=!1,d3.timer(bA),a},a.stop=function(){return u=!0,a},a.ke=function(){return j=j||bN(),j},a.pe=function(){return k=k||bM(),k},a.speed=function(){return bO()},a.pressure=function(){return bJ()},a.temperature=function(b){return arguments.length?(bR(b),a):temperature},a.links=function(b){return arguments.length?(links=b,a):links},a.size=function(b){return arguments.length?(e=b,a):e},a.linkDistance=function(b){return arguments.length?(linkDistance=d3.functor(b),a):linkDistance},a.linkStrength=function(b){return arguments.length?(linkStrength=d3.functor(b),a):linkStrength},a.friction=function(b){return arguments.length?(v=b,a):v},a.charge=function(b){return arguments.length?(w=typeof b=="function"?b:+b,a):w},a.gravity=function(b){return arguments.length?(x=b,a):x},a.theta=function(b){return arguments.length?(y=b,a):y},a}})();