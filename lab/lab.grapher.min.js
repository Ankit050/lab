(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),grapher={version:"0.0.1"},grapher.data=function(a){var b=0,c=a.length,d=[];for(b=0;b<c;b+=2)d.push({x:a[b],y:a[b+1]});return d},grapher.indexedData=function(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f},grapher.graph=function(a,b,c){function A(a){if(a)for(var b in z)a[b]===undefined&&(a[b]=z[b]);else a=z;return a}function B(a){if(a||!b)b=A(b);b.dataChange?u="ns-resize":u="crosshair",b.xrange=b.xmax-b.xmin,b.yrange=b.ymax-b.ymin,n={top:b.title?40:20,right:30,bottom:b.xlabel?60:10,left:b.ylabel?70:45},o={width:d-n.left-n.right,height:e-n.top-n.bottom},r=function(a){return a[0]},s=function(a){return a[1]},p=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,o.width]),q=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,o.height]).nice(),t=d3.svg.line().x(function(a,b){return p(points[b][0])}).y(function(a,b){return q(points[b][1])})}function C(c){function k(a){a?m.text(a):m.text("")}function l(){var a=b.yrange/2,c=a/2,d;return b.datacount=o.width/30,b.xtic=b.xrange/b.datacount,b.ytic=b.yrange/b.datacount,d=d3.range(b.datacount).map(function(d){return[d*b.xtic+b.xmin,b.ymin+c+Math.random()*a]}),d}function r(){if(!y)return;switch(d3.event.keyCode){case 8:case 46:if(b.dataChange){var a=points.indexOf(y);points.splice(a,1),y=points.length?points[a>0?a-1:0]:null,E()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}}function s(){n={top:b.title?40:20,right:30,bottom:b.xlabel?60:10,left:b.ylabel?70:45},o.width=d-n.left-n.right,o.height=e-n.top-n.bottom,g.attr("width",o.width).attr("height",o.height)}function z(){p.domain([b.xmin,b.xmax]).range([0,o.width])}function A(){q.domain([b.ymin,b.ymax]).range([o.height,0])}function D(){var a=function(a){return"translate("+p(a)+",0)"},c=function(a){return"translate(0,"+q(a)+")"},d=function(a){return a?"#ccc":"#666"},e=p.tickFormat(b.datacount),h=p.tickFormat(b.datacount),i=f.selectAll("g.x").data(p.ticks(10),String).attr("transform",a);i.select("text").text(e);var j=i.enter().insert("g","a").attr("class","x").attr("transform",a);j.append("line").attr("stroke",d).attr("y1",0).attr("y2",o.height),j.append("text").attr("class","axis").attr("y",o.height).attr("dy","1em").attr("text-anchor","middle").text(e).style("cursor","ew-resize").on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",G).on("touchstart.drag",G),i.exit().remove();var k=f.selectAll("g.y").data(q.ticks(10),String).attr("transform",c);k.select("text").text(h);var l=k.enter().insert("g","a").attr("class","y").attr("transform",c).attr("background-fill","#FFEEB6");l.append("line").attr("stroke",d).attr("x1",0).attr("x2",o.width),l.append("text").attr("class","axis").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(h).style("cursor","ns-resize").on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",H).on("touchstart.drag",H),k.exit().remove(),g.call(d3.behavior.zoom().x(p).y(q).on("zoom",D)),E()}function E(){var a=f.select("path").attr("d",t(points)),c=f.select("svg").selectAll("circle").data(points,function(a){return a});b.circleRadius&&c.enter().append("circle").attr("class",function(a){return a===y?"selected":null}).attr("cx",function(a){return p(a[0])}).attr("cy",function(a){return q(a[1])}).attr("r",b.circleRadius).style("cursor",u).on("mousedown.drag",I).on("touchstart.drag",I),c.attr("class",function(a){return a===y?"selected":null}).attr("cx",function(a){return p(a[0])}).attr("cy",function(a){return q(a[1])}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function F(){grapher.registerKeyboardHandler(r),d3.select("body").style("cursor","move");if(d3.event.altKey){if(b.dataChange){var a=d3.svg.mouse(f.node()),c=[];c[0]=p.invert(Math.max(0,Math.min(o.width,a[0]))),c[1]=q.invert(Math.max(0,Math.min(o.height,a[1]))),points.push(c),points.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0}),y=c,E()}d3.event.preventDefault(),d3.event.stopPropagation()}}function G(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(f[0][0]);v=p.invert(b[0])}function H(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(f[0][0]);w=q.invert(b[1])}function I(a){grapher.registerKeyboardHandler(r),document.onselectstart=function(){return!1},y=x=a,E()}function J(){var a=d3.svg.mouse(f[0][0]),c,d,e,g=d3.event.changedTouches;x&&b.dataChange&&(x[1]=q.invert(Math.max(0,Math.min(o.height,a[1]))),E());if(!isNaN(v)){d3.select("body").style("cursor","ew-resize");var h=p.invert(a[0]),i=p.domain()[0],j=p.domain()[1],k=j-i;h!==0&&(c=v/h,e=[i,i+k*c],p.domain(e),D()),d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(w)){d3.select("body").style("cursor","ns-resize");var l=q.invert(a[1]),m=q.domain()[1],n=q.domain()[0],r=n-m;l!==0&&(d=w/l,e=[n,n-r*d],q.domain(e),D()),d3.event.preventDefault(),d3.event.stopPropagation()}}function K(){document.onselectstart=function(){return!0},d3.select("body").style("cursor","auto"),d3.select("body").style("cursor","auto"),isNaN(v)||(D(),v=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(w)||(D(),w=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),x&&(x=null)}c||(c=a),c.each(function(){this.clientWidth&&this.clientHeight&&(d=this.clientWidth,e=this.clientHeight,o.width=d-n.left-n.right,o.height=e-n.top-n.bottom),points=b.points||l(),z(),A(),f=d3.select(this).append("svg").attr("width",d).attr("height",e).append("g").attr("transform","translate("+n.left+","+n.top+")"),g=f.append("rect").attr("width",o.width).attr("height",o.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown.drag",F).on("touchstart.drag",F).call(d3.behavior.zoom().x(p).y(q).on("zoom",D)),f.append("svg").attr("top",0).attr("left",0).attr("width",o.width).attr("height",o.height).attr("viewBox","0 0 "+o.width+" "+o.height).attr("class","line").append("path").attr("class","line").attr("d",t(points)),b.title&&(h=f.append("text").attr("class","title").text(b.title).attr("x",o.width/2).attr("dy","-0.8em").style("text-anchor","middle")),b.xlabel&&(i=f.append("text").attr("class","axis").text(b.xlabel).attr("x",o.width/2).attr("y",o.height).attr("dy","2.4em").style("text-anchor","middle")),b.ylabel&&(j=f.append("g").append("text").attr("class","axis").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+o.height/2+") rotate(-90)")),d3.select(this).on("mousemove.drag",J).on("touchmove.drag",J).on("mouseup.drag",K).on("touchend.drag",K),D(),m=f.append("text").attr("class","graph-notification").text("").attr("x",o.width/2).attr("y",o.height/2).style("text-anchor","middle")}),C.elem=a,C.redraw=D,C.update=E,C.notify=k,C.initialize=B,C.updateXScale=z,C.updateYScale=A}function D(){b.title&&h&&h.text(b.title)}function E(){b.xlabel&&i&&i.text(b.xlabel)}function F(){b.ylabel&&j?j.text(b.ylabel):j.style("display","none")}function G(a){return p(a[0])}function H(a){return q(a[1])}function I(){redraw()}var d=600,e=300;arguments.length&&(a=d3.select(a),d=a.property("clientWidth"),e=a.property("clientHeight"));var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=Math.NaN,w=Math.NaN,x=null,y=null,z={xmax:60,xmin:0,ymax:40,ymin:0,title:"Simple Graph1",xlabel:"X Axis",ylabel:"Y Axis",circleRadius:10,dataChange:!0,points:!1,notification:!1};return B(b),C.options=function(a){return arguments.length?C:b},C.margin=function(a){return arguments.length?(margin=a,C):margin},C.xmin=function(a){return arguments.length?(b.xmin=a,b.xrange=b.xmax-b.xmin,C.updateXScale&&(C.updateXScale(),C.redraw()),C):b.xmin},C.xmax=function(a){return arguments.length?(b.xmax=a,b.xrange=b.xmax-b.xmin,C.updateXScale&&(C.updateXScale(),C.redraw()),C):b.xmax},C.ymin=function(a){return arguments.length?(b.ymin=a,b.yrange=b.ymax-b.ymin,C.updateYScale&&(C.updateYScale(),C.redraw()),C):b.ymin},C.ymax=function(a){return arguments.length?(b.ymax=a,b.yrange=b.ymax-b.ymin,C.updateYScale&&(C.updateYScale(),C.redraw()),C):b.ymax},C.xLabel=function(a){return arguments.length?(b.xlabel=a,E(),C):b.xlabel},C.yLabel=function(a){return arguments.length?(b.ylabel=a,F(),C):b.ylabel},C.title=function(a){return arguments.length?(b.title=a,D(),C):b.title},C.width=function(a){return arguments.length?(o.width=a,C):o.width},C.height=function(a){return arguments.length?(o.height=a,C):o.height},C.x=function(a){return arguments.length?(r=a,C):r},C.y=function(a){return arguments.length?(s=a,C):s},C.elem=function(b){return arguments.length?(a=d3.select(b),a.call(C),C):a},C.data=function(a){if(!arguments.length)return points;var b=p.domain(),c=b[1]-b[0],d=c*.8;return points=a,points.length>b[1]?(b[0]+=d,b[1]+=d,p.domain(b),C.redraw()):C.update(),C},C.add_data=function(a){if(!arguments.length)return points;var b=p.domain(),c=b[1]-b[0],d=c*.8,e;if(a instanceof Array&&a.length>0)if(a[0]instanceof Array)for(e=0;e<a.length;e++)points.push(a[e]);else{if(a.length!==2)throw new Error("invalid argument to graph.add_data() "+a+" length should === 2.");points.push(a)}return points[points.length-1][0]>b[1]?(b[0]+=d,b[1]+=d,p.domain(b),C.redraw()):C.update(),C},C.reset=function(a){return arguments.length?C.initialize(a):C.initialize(),C.redraw(),C},a&&(a.call(C),c&&C.notify(c)),C},grapher.realTimeGraph=function(a,b){function H(a,b,c){var d=0,e=b||0,f=a.length,g=[];c=c||1;for(d=0;d<f;d++)g.push({x:(d+e)*c,y:a[d]});return g}function I(){return B?B.length:!1}function J(a,c){e=a,f=c,d.style.width=e+"px",d.style.height=f+"px",g={top:b.title?40:20,right:35,bottom:b.xlabel?50:30,left:b.ylabel?60:35},width=e-g.left-g.right,height=f-g.top-g.bottom,h={width:width,height:height},i=h.width,j=h.height,l.domain([b.xmin,b.xmax]).range([0,h.width]),o.domain([b.ymin,b.ymax]).nice().range([h.height,0]).nice(),m=Math.NaN,p=Math.NaN,s=null}function K(){function a(){d3.event&&d3.event.transform&&isNaN(m)&&isNaN(p)&&d3.event.transform(x,y);var b=l.tickFormat(10),d=o.tickFormat(8),e=w.selectAll("g.x").data(l.ticks(8),String).attr("transform",n);e.select("text").text(b);var f=e.enter().insert("g","a").attr("class","x").attr("transform",n);f.append("line").attr("stroke",k).attr("y1",0).attr("y2",h.height),f.append("text").attr("y",h.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",v).on("touchstart.drag",v),e.exit().remove();var g=w.selectAll("g.y").data(o.ticks(10),String).attr("transform",q);g.select("text").text(d);var i=g.enter().insert("g","a").attr("class","y").attr("transform",q).attr("background-fill","#FFEEB6");i.append("line").attr("stroke",k).attr("x1",0).attr("x2",h.width),i.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(d).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",F).on("touchstart.drag",F),g.exit().remove(),z.call(d3.behavior.zoom().x(l).y(o).scaleExtent([1,8]).on("zoom",a)),c()}function c(){var a,b=d.children[0].getElementsByTagName("rect")[0];gcanvas.style.zIndex==="-100"&&w.select("path.line").attr("d",r(B)),V();if(K.selectable_points){var e=w.selectAll("circle").data(B,function(a){return a});e.enter().append("circle").attr("class",function(a){return a===t?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",1).on("mousedown",function(a){t=s=a,c()}),e.attr("class",function(a){return a===t?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),e.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function u(){z.style("cursor","move")}function v(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(w[0][0]);m=l.invert(b[0])}function F(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(w[0][0]);p=o.invert(b[1])}function G(){var b=d3.svg.mouse(w[0][0]),c,d,e,f=d3.event.changedTouches;document.onselectstart=function(){return!0};if(!isNaN(m)){var g=l.invert(b[0]),h=l.domain()[0],i=l.domain()[1],j=i-h;d3.select("body").style("cursor","ew-resize"),g!==0&&(c=m/g,e=[h,h+j*c],l.domain(e),a()),d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(p)){var k=o.invert(b[1]),n=o.domain()[1],q=o.domain()[0],r=q-n;d3.select("body").style("cursor","ns-resize"),k!==0&&(d=p/k,e=[q,q-r*d],o.domain(e),a()),d3.event.preventDefault(),d3.event.stopPropagation()}}function L(){d3.select("body").style("cursor","auto"),document.onselectstart=function(){return!0},isNaN(m)||(a(),m=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(p)||(a(),p=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),s&&(s=null)}function M(a){C={x:B[a].x,y:B[a].y}}function N(a){if(B.length===0)return;C=!1;var b=B.length,d=b*E,e={x:d,y:a},f,g;B.push(e),c()}function O(a){if(B.length===0)return;C=!1;var b=B.length,c=b*E,d=c-E,e=l.call(self,d,d),f=o.call(self,B[b-1].y,b-1),g={x:c,y:a},h,i;B.push(g),h=l.call(self,c,c),i=o.call(self,a,c),gctx.beginPath(),gctx.moveTo(e,f),gctx.lineTo(h,i),gctx.stroke()}function P(a){B=H(a,0,E),c()}function Q(b){x=d3.scale.linear().domain([0,b]).range([0,i]),K.xmax=b,x_tics_scale=d3.scale.linear().domain([K.xmin*K.sample,K.xmax*K.sample]).range([0,i]),c(),a()}function R(b){y=d3.scale.linear().domain([b,0]).range([0,j]),K.ymax=b,c(),a()}function S(){gcanvas.width=gcanvas.width,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,gcanvas.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)"}function T(){w.select("path.line").attr("d",[]),gcanvas.style.zIndex=100}function U(){gcanvas.style.zIndex=-100,c()}function V(){if(B.length===0)return;var a=l.call(self,0,0),b=o.call(self,B[0].y,0),c,d=0;S(),gctx.fillRect(0,0,gcanvas.width,gcanvas.height),gctx.beginPath(),gctx.moveTo(a,b);for(c=0;c<B.length-1;c++)d+=E,a=l.call(self,d,d),b=o.call(self,B[c].y,d),gctx.lineTo(a,b);gctx.stroke()}function W(){gcanvas=document.createElement("canvas"),d.appendChild(gcanvas),gcanvas.style.zIndex=-100,Y(gcanvas)}function X(){Y(gcanvas),V()}function Y(a){var b={};b.rect=d.children[0].getElementsByTagName("rect")[0],b.width=b.rect.width.baseVal.value,b.height=b.rect.height.baseVal.value,b.left=b.rect.getCTM().e,b.top=b.rect.getCTM().f,a.style.position="absolute",a.width=b.width,a.height=b.height,a.style.width=b.width+"px",a.style.height=b.height+"px",a.offsetLeft=b.left,a.offsetTop=b.top,a.style.left=b.left+"px",a.style.top=b.top+"px",a.style.border="solid 1px red",gctx=gcanvas.getContext("2d"),gctx.globalCompositeOperation="source-over",gctx.lineWidth=1,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,a.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)",gcanvas.style.border="solid 1px red"}J(e,f),w===undefined?(w=d3.select(d).append("svg").attr("width",e).attr("height",f).append("g").attr("transform","translate("+g.left+","+g.top+")"),z=w.append("rect").attr("class","plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown",u).on("touchstart",u),z.call(d3.behavior.zoom().x(l).y(o).scaleExtent([1,8]).on("zoom",a)),A=w.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height).append("path").attr("class","line").attr("d",r(B)),D=A.append("path").attr("class","marker").attr("d",[]),b.title&&w.append("text").attr("class","title").text(b.title).attr("x",h.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&w.append("text").attr("class","xlabel").text(b.xlabel).attr("x",h.width/2).attr("y",h.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&w.append("g").append("text").attr("class","ylabel").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+h.height/2+") rotate(-90)"),W(),a()):(d3.select(d).select("svg").attr("width",e).attr("height",f),w.select("rect.plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE"),w.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height),b.title&&w.select("text.title").attr("x",h.width/2).attr("dy","-1em"),b.xlabel&&w.select("text.xlabel").attr("x",h.width/2).attr("y",h.height),b.ylabel&&w.select("text.ylabel").attr("transform","translate(-40 "+h.height/2+") rotate(-90)"),w.selectAll("g.x").remove(),w.selectAll("g.y").remove(),X(),a()),d3.select(this).on("mousemove.drag",G).on("touchmove.drag",G).on("mouseup.drag",L).on("touchend.drag",L),K.node=d,K.scale=J,K.update=c,K.redraw=a,K.number_of_points=I,K.new_data=P,K.add_point=N,K.add_canvas_point=O,K.initialize_canvas=W,K.show_canvas=T,K.hide_canvas=U,K.clear_canvas=S,K.update_canvas=V,K.showMarker=M,K.change_xaxis=Q,K.change_yaxis=R}var c=d3.select(a),d=c.node(),e=c.property("clientWidth"),f=c.property("clientHeight"),g,h,i,j,k=function(a){return a?"#ccc":"#666"},l=d3.scale.linear(),m,n=function(a){return"translate("+l(a)+",0)"},o=d3.scale.linear(),p,q=function(a){return"translate(0,"+o(a)+")"},r=d3.svg.line().x(function(a,b){return l(B[b].x)}).y(function(a,b){return o(B[b].y)}),s,t,u,v,w,z,A,B,C,D,E,F={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1,sample:1};if(b)for(var G in F)b[G]===undefined&&(b[G]=F[G]);else b=F;return E=b.sample,b.dataChange?circleCursorStyle="ns-resize":circleCursorStyle="crosshair",b.xrange=b.xmax-b.xmin,b.yrange=b.ymax-b.ymin,J(e,f),B=H(b.dataset,0),K.resize=function(a,b){K.scale(a,b),K()},d&&K(),K},grapher.colors=function(a){var b={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return b[a]},grapher.registerKeyboardHandler=function(a){d3.select(window).on("keydown",a)}})();