(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),grapher={version:"0.0.1"},grapher.data=function(a){var b=0,c=a.length,d=[];for(b=0;b<c;b+=2)d.push({x:a[b],y:a[b+1]});return d},grapher.indexedData=function(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f},grapher.graph=function(a,b){function z(j){function k(){var a=b.yrange/2,c=a/2,d;return b.datacount=m.width/30,b.xtic=b.xrange/b.datacount,b.ytic=b.yrange/b.datacount,d=d3.range(b.datacount).map(function(d){return[d*b.xtic+b.xmin,b.ymin+c+Math.random()*a]}),d}function p(){if(!w)return;switch(d3.event.keyCode){case 8:case 46:if(b.dataChange){var a=points.indexOf(w);points.splice(a,1),w=points.length?points[a>0?a-1:0]:null,B()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}}function q(){l={top:b.title?40:20,right:30,bottom:b.xlabel?60:10,left:b.ylabel?70:45},m.width=c-l.left-l.right,m.height=d-l.top-l.bottom,f.attr("width",m.width).attr("height",m.height)}function x(){n.domain([b.xmin,b.xmax]).range([0,m.width])}function y(){o.domain([b.ymin,b.ymax]).range([m.height,0])}function A(){var a=function(a){return"translate("+n(a)+",0)"},c=function(a){return"translate(0,"+o(a)+")"},d=function(a){return a?"#ccc":"#666"},g=n.tickFormat(b.datacount),h=n.tickFormat(b.datacount),i=e.selectAll("g.x").data(n.ticks(10),String).attr("transform",a);i.select("text").text(g);var j=i.enter().insert("g","a").attr("class","x").attr("transform",a);j.append("line").attr("stroke",d).attr("y1",0).attr("y2",m.height),j.append("text").attr("class","axis").attr("y",m.height).attr("dy","1em").attr("text-anchor","middle").text(g).style("cursor","ew-resize").on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",D).on("touchstart.drag",D),i.exit().remove();var k=e.selectAll("g.y").data(o.ticks(10),String).attr("transform",c);k.select("text").text(h);var l=k.enter().insert("g","a").attr("class","y").attr("transform",c).attr("background-fill","#FFEEB6");l.append("line").attr("stroke",d).attr("x1",0).attr("x2",m.width),l.append("text").attr("class","axis").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").text(h).style("cursor","ns-resize").on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown.drag",E).on("touchstart.drag",E),k.exit().remove(),f.call(d3.behavior.zoom().x(n).y(o).on("zoom",A)),B()}function B(){var a=e.select("path").attr("d",r(points)),c=e.select("svg").selectAll("circle").data(points,function(a){return a});c.enter().append("circle").attr("class",function(a){return a===w?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return o(a[1])}).attr("r",b.circleRadius).style("cursor",s).on("mousedown.drag",F).on("touchstart.drag",F),c.attr("class",function(a){return a===w?"selected":null}).attr("cx",function(a){return n(a[0])}).attr("cy",function(a){return o(a[1])}),c.exit().remove(),d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function C(){grapher.registerKeyboardHandler(p),d3.select("body").style("cursor","move");if(d3.event.altKey){if(b.dataChange){var a=d3.svg.mouse(e.node()),c=[];c[0]=n.invert(Math.max(0,Math.min(m.width,a[0]))),c[1]=o.invert(Math.max(0,Math.min(m.height,a[1]))),points.push(c),points.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0}),w=c,B()}d3.event.preventDefault(),d3.event.stopPropagation()}}function D(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(e[0][0]);t=n.invert(b[0])}function E(a){document.onselectstart=function(){return!1};var b=d3.svg.mouse(e[0][0]);u=o.invert(b[1])}function F(a){grapher.registerKeyboardHandler(p),document.onselectstart=function(){return!1},w=v=a,B()}function G(){var a=d3.svg.mouse(e[0][0]),c,d,f,g=d3.event.changedTouches;v&&b.dataChange&&(v[1]=o.invert(Math.max(0,Math.min(m.height,a[1]))),B());if(!isNaN(t)){d3.select("body").style("cursor","ew-resize");var h=n.invert(a[0]),i=n.domain()[0],j=n.domain()[1],k=j-i;h!==0&&(c=t/h,f=[i,i+k*c],n.domain(f),A()),d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(u)){d3.select("body").style("cursor","ns-resize");var l=o.invert(a[1]),p=o.domain()[1],q=o.domain()[0],r=q-p;l!==0&&(d=u/l,f=[q,q-r*d],o.domain(f),A()),d3.event.preventDefault(),d3.event.stopPropagation()}}function H(){document.onselectstart=function(){return!0},d3.select("body").style("cursor","auto"),d3.select("body").style("cursor","auto"),isNaN(t)||(A(),t=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(u)||(A(),u=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),v&&(v=null)}j||(j=a),j.each(function(){this.clientWidth&&this.clientHeight&&(c=this.clientWidth,d=this.clientHeight,m.width=c-l.left-l.right,m.height=d-l.top-l.bottom),points=b.points||k(),x(),y(),e=d3.select(this).append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+l.left+","+l.top+")"),f=e.append("rect").attr("width",m.width).attr("height",m.height).style("fill","#EEEEEE").attr("pointer-events","all").on("mousedown.drag",C).on("touchstart.drag",C).call(d3.behavior.zoom().x(n).y(o).on("zoom",A)),e.append("svg").attr("top",0).attr("left",0).attr("width",m.width).attr("height",m.height).attr("viewBox","0 0 "+m.width+" "+m.height).attr("class","line").append("path").attr("class","line").attr("d",r(points)),b.title&&(g=e.append("text").attr("class","title").text(b.title).attr("x",m.width/2).attr("dy","-0.8em").style("text-anchor","middle")),b.xlabel&&(h=e.append("text").attr("class","axis").text(b.xlabel).attr("x",m.width/2).attr("y",m.height).attr("dy","2.4em").style("text-anchor","middle")),b.ylabel&&(i=e.append("g").append("text").attr("class","axis").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+m.height/2+") rotate(-90)")),d3.select(this).on("mousemove.drag",G).on("touchmove.drag",G).on("mouseup.drag",H).on("touchend.drag",H),A()}),z.elem=a,z.redraw=A,z.updateXScale=x,z.updateYScale=y}function A(){b.title&&g&&g.text(b.title)}function B(){b.xlabel&&h&&h.text(b.xlabel)}function C(){b.ylabel&&i?i.text(b.ylabel):i.style("display","none")}function D(a){return n(a[0])}function E(a){return o(a[1])}function F(){redraw()}var c=600,d=300;arguments.length&&(a=d3.select(a),c=a.property("clientWidth"),d=a.property("clientHeight"));var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=Math.NaN,u=Math.NaN,v=null,w=null,x={xmax:60,xmin:0,ymax:40,ymin:0,title:"Simple Graph1",xlabel:"X Axis",ylabel:"Y Axis",circleRadius:10,dataChange:!0};if(b)for(var y in x)b[y]===undefined&&(b[y]=x[y]);else b=x;return b.dataChange?s="ns-resize":s="crosshair",b.xrange=b.xmax-b.xmin,b.yrange=b.ymax-b.ymin,l={top:b.title?40:20,right:30,bottom:b.xlabel?60:10,left:b.ylabel?70:45},m={width:c-l.left-l.right,height:d-l.top-l.bottom},p=function(a){return a[0]},q=function(a){return a[1]},n=d3.scale.linear().domain([b.xmin,b.xmax]).range([0,m.width]),o=d3.scale.linear().domain([b.ymax,b.ymin]).nice().range([0,m.height]).nice(),r=d3.svg.line().x(function(a,b){return n(points[b][0])}).y(function(a,b){return o(points[b][1])}),z.options=function(a){return arguments.length?z:b},z.margin=function(a){return arguments.length?(margin=a,z):margin},z.xmin=function(a){return arguments.length?(b.xmin=a,b.xrange=b.xmax-b.xmin,z.updateXScale&&(z.updateXScale(),z.redraw()),z):b.xmin},z.xmax=function(a){return arguments.length?(b.xmax=a,b.xrange=b.xmax-b.xmin,z.updateXScale&&(z.updateXScale(),z.redraw()),z):b.xmax},z.ymin=function(a){return arguments.length?(b.ymin=a,b.yrange=b.ymax-b.ymin,z.updateYScale&&(z.updateYScale(),z.redraw()),z):b.ymin},z.ymax=function(a){return arguments.length?(b.ymax=a,b.yrange=b.ymax-b.ymin,z.updateYScale&&(z.updateYScale(),z.redraw()),z):b.ymax},z.xLabel=function(a){return arguments.length?(b.xlabel=a,B(),z):b.xlabel},z.yLabel=function(a){return arguments.length?(b.ylabel=a,C(),z):b.ylabel},z.title=function(a){return arguments.length?(b.title=a,A(),z):b.title},z.width=function(a){return arguments.length?(m.width=a,z):m.width},z.height=function(a){return arguments.length?(m.height=a,z):m.height},z.x=function(a){return arguments.length?(p=a,z):p},z.y=function(a){return arguments.length?(q=a,z):q},z.elem=function(b){return arguments.length?(a=d3.select(b),a.call(z),z):a},a&&a.call(z),z},grapher.realTimeGraph=function(a,b){function G(a,b){var c=0,d=b||0,e=a.length,f=[];for(c=0;c<e;c++)f.push({x:c+d,y:a[c]});return f}function H(a,c){e=a,f=c,d.style.width=e+"px",d.style.height=f+"px",g={top:b.title?40:20,right:35,bottom:b.xlabel?50:30,left:b.ylabel?60:35},width=e-g.left-g.right,height=f-g.top-g.bottom,h={width:width,height:height},i=h.width,j=h.height,l.domain([b.xmin,b.xmax]).range([0,h.width]),o.domain([b.xmin*b.sample,b.xmax*b.sample]).range([0,i]),q.domain([b.ymax,b.ymin]).nice().range([0,h.height]).nice(),m=Math.NaN,r=Math.NaN,u=null}function I(){function a(){d3.event&&d3.event.transform&&isNaN(m)&&isNaN(r)&&d3.event.transform(x,y);var a=o.tickFormat(10),b=q.tickFormat(10),c=B.selectAll("g.x").data(o.ticks(10),String).attr("transform",p);c.select("text").text(a);var d=c.enter().insert("g","a").attr("class","x").attr("transform",p);d.append("line").attr("stroke",k).attr("y1",0).attr("y2",h.height),d.append("text").attr("y",h.height).attr("dy","1em").attr("text-anchor","middle").style("cursor","ew-resize").text(a).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(B[0][0]);m=o.invert(b[0])}),c.exit().remove();var e=B.selectAll("g.y").data(q.ticks(10),String).attr("transform",s);e.select("text").text(b);var f=e.enter().insert("g","a").attr("class","y").attr("transform",s).attr("background-fill","#FFEEB6");f.append("line").attr("stroke",k).attr("x1",0).attr("x2",h.width),f.append("text").attr("x",-3).attr("dy",".35em").attr("text-anchor","end").style("cursor","ns-resize").text(b).on("mouseover",function(a){d3.select(this).style("font-weight","bold")}).on("mouseout",function(a){d3.select(this).style("font-weight","normal")}).on("mousedown",function(a){var b=d3.svg.mouse(B[0][0]);r=q.invert(b[1])}),e.exit().remove(),n()}function n(){var a,b,c,e,f,g=d.children[0].getElementsByTagName("rect")[0];if(gcanvas.style.zIndex==-100)var h=B.select("path").attr("d",t(D));S();if(I.selectable_points){var i=B.selectAll("circle").data(D,function(a){return a});i.enter().append("circle").attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}).attr("r",1).on("mousedown",function(a){v=u=a,n()}),i.attr("class",function(a){return a===v?"selected":null}).attr("cx",function(a){return x(a.x)}).attr("cy",function(a){return y(a.y)}),i.exit().remove()}d3.event&&d3.event.keyCode&&(d3.event.preventDefault(),d3.event.stopPropagation())}function E(){if(!u)return;d.onselectstart=function(){return!1};var a=d3.svg.mouse(B.node());u.x=l.invert(Math.max(0,Math.min(h.width,a[0]))),u.y=q.invert(Math.max(0,Math.min(h.height,a[1]))),n()}function F(){if(!u)return;d.onselectstart=function(){return!0},E(),u=null}function K(a){var b=D.length;if(b!==0){var c={x:b,y:a};D.push(c);var d=l.call(self,b,b),e=q.call(self,a,b);z.appendItem(w.createSVGPathSegLinetoAbs(d,e))}}function L(a){if(D.length===0)return;var b=D.length,c=l.call(self,b-1,b-1),d=q.call(self,D[b-1].y,b-1),e={x:b,y:a};D.push(e);var f=l.call(self,b,b),g=q.call(self,a,b);gctx.beginPath(),gctx.moveTo(c,d),gctx.lineTo(f,g),gctx.stroke()}function M(a){D=G(a,0),n()}function N(b){x=d3.scale.linear().domain([0,b]).range([0,i]),I.xmax=b,x_tics_scale=d3.scale.linear().domain([I.xmin*I.sample,I.xmax*I.sample]).range([0,i]),n(),S(),a()}function O(b){y=d3.scale.linear().domain([b,0]).range([0,j]),I.ymax=b,n(),S(),a()}function P(){gcanvas.width=gcanvas.width,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,gcanvas.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)"}function Q(){z.clear(),gcanvas.style.zIndex=100}function R(){gcanvas.style.zIndex=-100,B.select("path.line").attr("d",t(D))}function S(){if(D.length===0)return;var a=l.call(self,0,0),b=q.call(self,D[0].y,0),c;P(),gctx.fillRect(0,0,gcanvas.width,gcanvas.height),gctx.beginPath(),gctx.moveTo(a,b);for(c=0;c<D.length-1;c++)a=l.call(self,c,c),b=q.call(self,D[c].y,c),gctx.lineTo(a,b);gctx.stroke()}function T(){gcanvas=document.createElement("canvas"),d.appendChild(gcanvas),gcanvas.style.zIndex=-100,V(gcanvas)}function U(){V(gcanvas),S()}function V(a){var b={};b.rect=d.children[0].getElementsByTagName("rect")[0],b.width=b.rect.width.baseVal.value,b.height=b.rect.height.baseVal.value,b.left=b.rect.getCTM().e,b.top=b.rect.getCTM().f,a.style.position="absolute",a.width=b.width,a.height=b.height,a.style.width=b.width+"px",a.style.height=b.height+"px",a.offsetLeft=b.left,a.offsetTop=b.top,a.style.left=b.left+"px",a.style.top=b.top+"px",a.style.border="solid 1px red",gctx=gcanvas.getContext("2d"),gctx.globalCompositeOperation="source-over",gctx.lineWidth=1,gctx.fillStyle="rgba(0,255,0, 0.05)",gctx.fillRect(0,0,a.width,gcanvas.height),gctx.strokeStyle="rgba(255,65,0, 1.0)",gcanvas.style.border="solid 1px red"}H(e,f),B===undefined?(B=d3.select(d).append("svg").attr("width",e).attr("height",f).append("g").attr("transform","translate("+g.left+","+g.top+")"),C=B.append("rect").attr("class","plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE").attr("pointer-events","all"),C.call(d3.behavior.zoom().x(o).y(q).scaleExtent([1,8]).on("zoom",a)),B.append("svg").attr("class","viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height).append("path").attr("class","line").attr("d",t(D)),b.title&&B.append("text").attr("class","title").text(b.title).attr("x",h.width/2).attr("dy","-1em").style("text-anchor","middle"),b.xlabel&&B.append("text").attr("class","xlabel").text(b.xlabel).attr("x",h.width/2).attr("y",h.height).attr("dy","2.4em").style("text-anchor","middle"),b.ylabel&&B.append("g").append("text").attr("class","ylabel").text(b.ylabel).style("text-anchor","middle").attr("transform","translate(-40 "+h.height/2+") rotate(-90)"),B.on("mousemove",E).on("mouseup",F),w=B.select("path")[0][0],z=w.pathSegList,vis_node=B.node(),A=document.createElementNS("http://www.w3.org/2000/svg","circle"),A.setAttribute("cx",1),A.setAttribute("cy",1),A.setAttribute("r",1),T(),a()):(d3.select(d).select("svg").attr("width",e).attr("height",f),B.select("rect.plot").attr("width",h.width).attr("height",h.height).style("fill","#EEEEEE"),B.select("svg.viewbox").attr("top",0).attr("left",0).attr("width",h.width).attr("height",h.height).attr("viewBox","0 0 "+h.width+" "+h.height),b.title&&B.select("text.title").attr("x",h.width/2).attr("dy","-1em"),b.xlabel&&B.select("text.xlabel").attr("x",h.width/2).attr("y",h.height),b.ylabel&&B.select("text.ylabel").attr("transform","translate(-40 "+h.height/2+") rotate(-90)"),B.selectAll("g.x").remove(),B.selectAll("g.y").remove(),U(),a());var J=function(){var a="",b=function(b,c,d){var e=a,f=-1,g=b.length,h=[],i;e.length===0&&(h.push("M",l.call(self,b[0].x,0),",",q.call(self,b[0].y,0)),f++);while(++f<g)h.push("L",l.call(self,b[f].x,f),",",q.call(self,b[f].y,f));return a+=h.join("")};return b}();c.on("mousemove",function(b){document.onselectstart=function(){return!0};var c=d3.svg.mouse(B[0][0]);if(!isNaN(m)){var d=o.invert(c[0]),e=o.domain()[0],f=o.domain()[1],g=f-e;if(d!==0){var h,i,j;i=g/m,h=1+(m/d-1)*(g/(m-e))/i,j=[e,e+g*h],o.domain(j),I.sample!==1&&l.domain([j[0]/I.sample,j[1]/I.sample]),a()}d3.event.preventDefault(),d3.event.stopPropagation()}if(!isNaN(r)){var k=q.invert(c[1]),n=q.domain()[1],p=q.domain()[0],s=p-n;if(k!==0){var t,u,v;u=s/r,t=(k-n)/(r-n)*(s/(r-n))/u,v=[n+s*1/t,n],n>0&&(v[0]+=n),q.domain(v),a()}d3.event.preventDefault(),d3.event.stopPropagation()}}).on("mouseup",function(b){isNaN(m)||(a(),m=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation()),isNaN(r)||(a(),r=Math.NaN,d3.event.preventDefault(),d3.event.stopPropagation())}),I.node=d,I.scale=H,I.update=n,I.redraw=a,I.new_data=M,I.add_point=K,I.add_canvas_point=L,I.initialize_canvas=T,I.show_canvas=Q,I.hide_canvas=R,I.clear_canvas=P,I.update_canvas=S,I.change_xaxis=N,I.change_yaxis=O}var c=d3.select(a),d=c.node(),e=c.property("clientWidth"),f=c.property("clientHeight"),g,h,i,j,k=function(a){return a?"#ccc":"#666"},l=d3.scale.linear(),m,n=function(a){return"translate("+l(a)+",0)"},o=d3.scale.linear(),p=function(a){return"translate("+o(a)+",0)"},q=d3.scale.linear(),r,s=function(a){return"translate(0,"+q(a)+")"},t=d3.svg.line().x(function(a,b){return l(D[b].x)}).y(function(a,b){return q(D[b].y)}),u,v,w,z,A,B,C,D,E={title:"graph",xlabel:"x-axis",ylabel:"y-axis",xmax:10,xmin:0,ymax:10,ymin:0,dataset:[0],selectable_points:!0,circleRadius:!1,dataChange:!1};if(b)for(var F in E)b[F]===undefined&&(b[F]=E[F]);else b=E;return b.dataChange?circleCursorStyle="ns-resize":circleCursorStyle="crosshair",b.xrange=b.xmax-b.xmin,b.yrange=b.ymax-b.ymin,H(e,f),D=G(b.dataset,0),I.resize=function(a,b){I.scale(a,b),I()},d&&I(),I},grapher.colors=function(a){var b={bright_red:"#ff0000",dark_red:"#990000",bright_blue:"#4444ff",dark_blue:"#110077",bright_green:"#00dd00",dark_green:"#118800",bright_purple:"#cc00cc",dark_purple:"#770099",bright_orange:"#ee6600",dark_orange:"#aa4400",bright_turquoise:"#00ccbb",dark_turquoise:"#008877"};return b[a]},grapher.registerKeyboardHandler=function(a){d3.select(window).on("keydown",a)}})();