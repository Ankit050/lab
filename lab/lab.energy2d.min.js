(function(){typeof console=="undefined"&&(window.console={},console.log=console.info=console.warn=console.error=function(){}),energy2d={VERSION:"0.1.0"},energy2d.namespace=function(e){"use strict";var t=e.split("."),n=energy2d,r;t[0]==="energy2d"&&(t=t.slice(1));for(r=0;r<t.length;r+=1)typeof n[t[r]]=="undefined"&&(n[t[r]]={}),n=n[t[r]];return n};var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var s=i._cached?i._cached:i();return s};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function u(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function a(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),s=i.browserify;if(typeof s=="object"&&s.main){var o=u(r.resolve(t,s.main));if(o)return o}else if(typeof s=="string"){var o=u(r.resolve(t,s));if(o)return o}else if(i.main){var o=u(r.resolve(t,i.main));if(o)return o}}return u(t+"/index")}function f(e,t){var n=l(t);for(var r=0;r<n.length;r++){var i=n[r],s=u(i+"/"+e);if(s)return s;var o=a(i+"/"+e);if(o)return o}var s=u(e);if(s)return s}function l(e){var t;e==="/"?t=[""]:t=r.normalize(e).split("/");var n=[];for(var i=t.length-1;i>=0;i--){if(t[i]==="node_modules")continue;var s=t.slice(0,i+1).join("/")+"/node_modules";n.push(s)}return n}n||(n="/");if(e._core[t])return t;var r=e.modules.path();n=r.resolve("/",n);var i=n||"/";if(t.match(/^(?:\.\.?\/|\/)/)){var s=u(r.resolve(i,t))||a(r.resolve(i,t));if(s)return s}var o=f(t,i);if(o)return o;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(t,n){var r=e.modules.path(),i=null;try{i=e.resolve(t+"/package.json","/")}catch(s){i=e.resolve(t,"/")}var o=r.dirname(i),u=(Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t})(e.modules);for(var a=0;a<u.length;a++){var f=u[a];if(f.slice(0,o.length+1)===o+"/"){var l=f.slice(o.length);e.modules[n+l]=e.modules[o+l]}else f===o&&(e.modules[n]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var s={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=s.exports,n.call(s.exports,i,s,s.exports,r,t),e.modules[t]._cached=s.exports,s.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var e=[],t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return t&&window.addEventListener("message",function(t){if(t.source===window&&t.data==="browserify-tick"){t.stopPropagation();if(e.length>0){var n=e.shift();n()}}},!0),function(n){t?(e.push(n),window.postMessage("browserify-tick","*")):setTimeout(n,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if(t==="evals")return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),process.env||(process.env={}),process.argv||(process.argv=[]),e.define("path",function(e,t,n,r,i){function s(e,t){var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function o(e,t){var n=0;for(var r=e.length;r>=0;r--){var i=e[r];i=="."?e.splice(r,1):i===".."?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var u=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){var e="",t=!1;for(var n=arguments.length;n>=-1&&!t;n--){var r=n>=0?arguments[n]:process.cwd();if(typeof r!="string"||!r)continue;e=r+"/"+e,t=r.charAt(0)==="/"}return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t=e.charAt(0)==="/",n=e.slice(-1)==="/";return e=o(s(e.split("/"),function(e){return!!e}),!t).join("/"),!e&&!t&&(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(s(e,function(e,t){return e&&typeof e=="string"}).join("/"))},n.dirname=function(e){var t=u.exec(e)[1]||"",n=!1;return t?t.length===1||n&&t.length<=3&&t.charAt(1)===":"?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=u.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return u.exec(e)[3]||""}}),e.define("/arrays/arrays.js",function(e,t,n,r,i){var s;s=n.arrays={},s.version="0.0.1",s.webgl=typeof window!="undefined"&&!!window.WebGLRenderingContext,s.typed=!1;try{var o=new Float64Array(0);s.typed=!0}catch(u){}s.create=function(e,t,n){n||(s.webgl||s.typed?n="Float32Array":n="regular"),t===undefined&&(t=0);var r,i;if(n==="regular")r=new Array(e);else switch(n){case"Float64Array":r=new Float64Array(e);break;case"Float32Array":r=new Float32Array(e);break;case"Int32Array":r=new Int32Array(e);break;case"Int16Array":r=new Int16Array(e);break;case"Int8Array":r=new Int8Array(e);break;case"Uint32Array":r=new Uint32Array(e);break;case"Uint16Array":r=new Uint16Array(e);break;case"Uint8Array":r=new Uint8Array(e);break;default:r=new Array(e)}i=-1;while(++i<e)r[i]=t;return r},s.constructor_function=function(e){if(e.buffer&&e.buffer.__proto__.constructor)return e.__proto__.constructor;if(e.constructor===Array)return e.constructor;throw new Error("arrays.constructor_function: must be an Array or Typed Array:   source: "+e+", source.constructor: "+e.constructor+", source.buffer: "+e.buffer+", source.buffer.slice: "+e.buffer.slice+", source.buffer.__proto__: "+e.buffer.__proto__+", source.buffer.__proto__.constructor: "+e.buffer.__proto__.constructor)},s.copy=function(e,t){var n=e.length,r=-1;while(++r<n)t[r]=e[r];return s.constructor_function(t)===Array&&(t.length=n),t},s.clone=function(e){var t,n=e.length,r,i;i=s.constructor_function(e);if(i===Array){r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r}if(e.buffer.slice)return r=new i(e.buffer.slice(0)),r;r=new i(n);for(t=0;t<n;t++)r[t]=e[t];return r},s.between=function(e,t,n){return n<Math.max(e,t)&&n>Math.min(e,t)},s.max=function(e){return Math.max.apply(Math,e)},s.min=function(e){return Math.min.apply(Math,e)},s.maxTypedArray=function(e){var t,n,r=Number.MIN_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t>r?t:r;return r},s.minTypedArray=function(e){var t,n,r=Number.MAX_VALUE,i=e.length;for(n=0;n<i;n++)t=e[n],r=t<r?t:r;return r},s.maxAnyArray=function(e){try{return Math.max.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MIN_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n>i?n:i;return i}}},s.minAnyArray=function(e){try{return Math.min.apply(Math,e)}catch(t){if(t instanceof TypeError){var n,r,i=Number.MAX_VALUE,s=e.length;for(r=0;r<s;r++)n=e[r],i=n<i?n:i;return i}}},s.average=function(e){var t,n=0,r=e.length;for(t=0;t<r;t++)n+=e[t];return n/r}}),e.define("/physics-solvers/heat-solver.js",function(e,t,n,r,i){var s=e("../arrays/arrays.js").arrays,o=5;n.makeHeatSolver=function(e){"use strict";var t=e.getGridWidth(),n=e.getGridHeight(),r=e.getModelOptions(),i=r.timestep,u=r.boundary,a=r.model_width/e.getGridWidth(),f=r.model_height/e.getGridHeight(),l=o,c=e.getConductivityArray(),h=e.getCapacityArray(),p=e.getDensityArray(),d=e.getUVelocityArray(),v=e.getVVelocityArray(),m=e.getBoundaryTemperatureArray(),g=e.getFluidityArray(),y=s.create(t*n,0,e.getArrayType()),b=t-1,w=n-1,E=t-2,S=n-2,x=function(e){var r,i,s,o,l,h,p,d;if(u.temperature_at_border){r=u.temperature_at_border.upper,i=u.temperature_at_border.lower,s=u.temperature_at_border.left,o=u.temperature_at_border.right;for(l=0;l<t;l+=1)p=l*t,e[p]=r,e[p+w]=i;for(h=0;h<n;h+=1)e[h]=s,e[b*t+h]=o}else{if(!u.flux_at_border)throw new Error("Heat solver: wrong boundary settings definition.");r=u.flux_at_border.upper,i=u.flux_at_border.lower,s=u.flux_at_border.left,o=u.flux_at_border.right;for(l=0;l<t;l+=1)p=l*t,d=p+w,e[p]=e[p+1]+r*f/c[p],e[d]=e[p+S]-i*f/c[d];for(h=0;h<n;h+=1)e[h]=e[t+h]-s*a/c[h],e[b*t+h]=e[E*t+h]+o*a/c[b*t+h]}},T=function(e){var n=.5*i/a,r=.5*i/f,s,o,u,l,c,h,p,m;for(s=1;s<b;s+=1){u=s*t;for(o=1;o<w;o+=1)l=u+o,h=l-t,c=l+t,m=l-1,p=l+1,g[l]&&(y[l]=e[l]-n*(d[c]*e[c]-d[h]*e[h])-r*(v[p]*e[p]-v[m]*e[m]))}x(y);for(s=1;s<b;s+=1){u=s*t;for(o=1;o<w;o+=1)l=u+o,g[l]&&(h=l-t,c=l+t,m=l-1,p=l+1,e[l]=.5*(e[l]+y[l])-.5*n*d[l]*(y[c]-y[h])-.5*r*v[l]*(y[p]-y[m]))}x(e)};return{solve:function(e,n,r){var o=.5/(a*a),u=.5/(f*f),d=1/i,v,g,E,S,N,C,k,L,A,O,M,_,D,P,H;s.copy(n,y);for(k=0;k<l;k+=1){for(L=1;L<b;L+=1){O=L*t;for(A=1;A<w;A+=1)M=O+A,isNaN(m[M])?(D=M-t,_=M+t,H=M-1,P=M+1,g=h[M]*p[M]*d,v=c[M],E=o*(v+c[D]),S=o*(v+c[_]),N=u*(v+c[H]),C=u*(v+c[P]),n[M]=(y[M]*g+r[M]+E*n[D]+S*n[_]+N*n[H]+C*n[P])/(g+E+S+N+C)):n[M]=m[M]}x(n)}e&&T(n)}}}}),e.define("/physics-solvers/fluid-solver.js",function(e,t,n,r,i){var s=e("../arrays/arrays.js").arrays,o=5,u=0,a=0,f=1;n.makeFluidSolver=function(e){"use strict";var t=e.getGridWidth(),n=e.getGridHeight(),r=e.getModelOptions(),i=r.timestep,l=r.thermal_buoyancy,c=r.buoyancy_approximation,h=r.background_viscosity,p=r.model_width/e.getGridWidth(),d=r.model_height/e.getGridHeight(),v=o,m=u,g=e.getTemperatureArray(),y=e.getFluidityArray(),b=e.getUWindArray(),w=e.getVWindArray(),E=e.getArrayType(),S=s.create(t*n,0,E),x=s.create(t*n,0,E),T=.5/p,N=.5/d,C=1/(p*p),k=1/(d*d),L=t-1,A=n-1,O=t-2,M=n-2,_=function(e,n){var r=e===1,i=e===2,s=L*t,o=O*t,u,a,f,l,c,h,p;for(u=1;u<L;u+=1)f=u*t,l=f+1,c=f+A,h=f+M,n[f]=i?-n[l]:n[l],n[c]=i?-n[h]:n[h];for(a=1;a<A;a+=1)p=t+a,n[a]=r?-n[p]:n[p],n[s+a]=r?-n[o+a]:n[o+a];n[0]=.5*(n[t]+n[1]),n[s]=.5*(n[o]+n[s+1]),n[A]=.5*(n[t+A]+n[M]),n[s+A]=.5*(n[o+A]+n[s+M])},D=function(e,n){var r=0,i,s,o,u,a,f,l,c,h,p;for(o=1;o<L;o+=1){a=o*t;for(u=1;u<A;u+=1)f=a+u,c=f-t,l=f+t,p=f-1,h=f+1,y[f]||(i=b[f],s=w[f],r=0,y[c]?(r+=1,e[f]=i-e[c],n[f]=s+n[c]):y[l]&&(r+=1,e[f]=i-e[l],n[f]=s+n[l]),y[p]?(r+=1,e[f]=i+e[p],n[f]=s-n[p]):y[h]&&(r+=1,e[f]=i+e[h],n[f]=s-n[h]),r===0&&(e[f]=i,n[f]=s))}},P=function(e){var n,r,i,s,o,u,a,f;for(n=1;n<L;n+=1){i=n*t;for(r=1;r<A;r+=1)s=i+r,y[s]||(u=s-t,o=s+t,f=s-1,a=s+1,y[u]?e[s]=e[u]:y[o]&&(e[s]=e[o]),y[f]?e[s]=e[f]:y[a]&&(e[s]=e[a]))}},H=function(e,r){var i=0,s=n,o=0,u,a;for(u=r-1;u>0;u-=1){a=e*t+u;if(!y[a]){i=u;break}}for(u=r+1;u<n;u+=1){a=e*t+u;if(!y[a]){s=u;break}}for(u=i;u<s;u+=1)a=e*t+u,o+=g[a];return o/(s-i)},B=function(e){var n=m*i,r=l*i,s,o,u,h,p;switch(c){case a:s=function(e){var t=0,n=e.length,r;for(r=0;r<n;r+=1)t+=e[r];return t/n}(g);for(o=1;o<L;o+=1){h=o*t;for(u=1;u<A;u+=1)p=h+u,y[p]&&(e[p]+=(n-r)*g[p]+r*s)}break;case f:for(o=1;o<L;o+=1){h=o*t;for(u=1;u<A;u+=1)p=h+u,y[p]&&(s=H(o,u),e[p]+=(n-r)*g[p]+r*s)}}},j=function(e,n,r,i){var s=.5/(C+k),o,u,a,f,l,c,h,p,d;for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,i[l]=(e[c]-e[h])*T+(n[p]-n[d])*N,r[l]=0)}_(0,i),_(0,r),P(i),P(r);for(o=0;o<v;o+=1)for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,r[l]=s*((r[h]+r[c])*C+(r[d]+r[p])*k-i[l]))}for(u=1;u<L;u+=1){f=u*t;for(a=1;a<A;a+=1)l=f+a,y[l]&&(h=l-t,c=l+t,d=l-1,p=l+1,e[l]-=(r[c]-r[h])*T,n[l]-=(r[p]-r[d])*N)}_(1,e),_(2,n)},F=function(e,n,r){var o=i*h*C,u=i*h*k,a=1/(1+2*(o+u)),f,l,c,p,d,m,g,b,w;s.copy(r,n);for(f=0;f<v;f+=1){for(l=1;l<L;l+=1){p=l*t;for(c=1;c<A;c+=1)d=p+c,y[d]&&(g=d-t,m=d+t,w=d-1,b=d+1,r[d]=(n[d]+o*(r[g]+r[m])+u*(r[w]+r[b]))*a)}_(e,r)}},I=function(e,n,r){var o=.5*i/p,u=.5*i/d,a,f,l,c,h,v,m,g;for(a=1;a<L;a+=1){l=a*t;for(f=1;f<A;f+=1)c=l+f,y[c]&&(v=c-t,h=c+t,g=c-1,m=c+1,r[c]=n[c]-o*(S[h]*n[h]-S[v]*n[v])-u*(x[m]*n[m]-x[g]*n[g]))}_(e,r);for(a=1;a<L;a+=1){l=a*t;for(f=1;f<A;f+=1)c=l+f,y[c]&&(v=c-t,h=c+t,g=c-1,m=c+1,n[c]=.5*(n[c]+r[c])-.5*o*S[c]*(r[h]-r[v])-.5*u*x[c]*(r[m]-r[g]))}s.copy(n,r),_(e,r)},q=function(e,t,n){I(e,t,n)};return{solve:function(e,t){l!==0&&B(t),D(e,t),h>0&&(F(1,S,e),F(2,x,t),j(e,t,S,x),D(e,t)),s.copy(e,S),s.copy(t,x),q(1,S,e),q(2,x,t),j(e,t,S,x),D(e,t)}}}}),e.define("/part.js",function(e,t,n,r,i){var s=e("./default-config.js"),o=function(e,t,n,r,i){"use strict";var s=0,o,u;for(o=0,u=e-1;o<e;u=o+=1)n[o]>i!=n[u]>i&&r<(t[u]-t[o])*(i-n[o])/(n[u]-n[o])+t[o]&&(s=!s);return s};n.Part=function(e){"use strict";var t,n;e=s.fillWithDefaultValues(e,s.DEFAULT_VALUES.part);if(e.rectangle)this.rectangle=e.rectangle;else if(e.ellipse)this.ellipse=e.ellipse;else if(e.ring)this.ring=e.ring;else{if(!e.polygon)throw new Error("Part: shape not defined.");this.polygon=e.polygon}if(this.polygon&&typeof this.polygon.vertices=="string"){t=this.polygon.count,this.polygon.vertices=this.polygon.vertices.split(", ");if(t*2!==this.polygon.vertices.length)throw new Error("Part: polygon contains different vertices count than declared in the count parameter.");for(n=0;n<t*2;n+=1)this.polygon.vertices[n]=Number(this.polygon.vertices[n])}this.thermal_conductivity=e.thermal_conductivity,this.specific_heat=e.specific_heat,this.density=e.density,this.temperature=e.temperature,this.constant_temperature=e.constant_temperature,this.power=e.power,this.wind_speed=e.wind_speed,this.wind_angle=e.wind_angle,this.visible=e.visible,this.filled=e.filled,this.color=e.color,this.texture=e.texture,this.label=e.label},n.Part.prototype.getLabel=function(){"use strict";var e=this.label,t;return e==="%temperature"?t=this.temperature+" °C":e==="%density"?t=this.density+" kg/m³":e==="%specific_heat"?t=this.specific_heat+" J/(kg×°C)":e==="%thermal_conductivity"?t=this.thermal_conductivity+" W/(m×°C)":e==="%power_density"?t=this.power+" W/m³":e==="%area"?this.rectangle?t=this.rectangle.width*this.rectangle.height+" m²":this.ellipse&&(t=this.ellipse.width*this.ellipse.height*.25*Math.PI+" m²"):e==="%width"?this.rectangle?t=this.rectangle.width+" m":this.ellipse&&(t=this.ellipse.width+" m"):e==="%height"?this.rectangle?t=this.rectangle.height+" m":this.ellipse&&(t=this.ellipse.height+" m"):t=e,t},n.Part.prototype.getGridCells=function(e,t,n,r){"use strict";var i=e-1,s=t-1,u=i/n,a=s/r,f=function(e){var n,r,o,f,l,c,h,p=[];o=Math.min(Math.max(Math.ceil(e.x*u),0),i),f=Math.min(Math.max(Math.ceil(e.y*a),0),s),l=Math.min(Math.max(Math.floor((e.x+e.width)*u),0),i),c=Math.min(Math.max(Math.floor((e.y+e.height)*a),0),s),p=new Array((l-o+1)*(c-f+1)),h=0;for(n=o;n<=l;n+=1)for(r=f;r<=c;r+=1)p[h+=1]=n*t+r;return p},l=function(e){var n=e.x*u,r=e.y*a,o=e.a*.5*u,f=e.b*.5*a,l,c,h,p,d,v,m,g,y=[];h=Math.min(Math.max(Math.ceil(n-o),0),i),p=Math.min(Math.max(Math.floor(n+o),0),i),y=[],g=0;for(c=h;c<=p;c+=1){l=Math.sqrt(1-(c-n)*(c-n)/(o*o)),v=Math.min(Math.max(Math.ceil(r-f*l),0),s),m=Math.min(Math.max(Math.floor(r+f*l),0),s);for(d=v;d<=m;d+=1)y[g+=1]=c*t+d}return y},c=function(e){var n=e.x*u,r=e.y*a,o=e.outer*.5*u,f=e.outer*.5*a,l=e.inner*.5*u,c=e.inner*.5*a,h,p,d,v,m,g,y,b,w,E,S=[];p=Math.min(Math.max(Math.ceil(n-o),0),i),d=Math.min(Math.max(Math.floor(n+o),0),i);for(h=p;h<=d;h+=1){w=Math.sqrt(1-(h-n)*(h-n)/(o*o)),m=Math.min(Math.max(Math.ceil(r-f*w),0),s),b=Math.min(Math.max(Math.floor(r+f*w),0),s);if(Math.abs(h-n)<l){w=Math.sqrt(1-(h-n)*(h-n)/(l*l)),g=Math.min(Math.max(Math.ceil(r-c*w),0),s),y=Math.min(Math.max(Math.floor(r+c*w),0),s);for(v=m;v<=g;v+=1)S[E+=1]=h*t+v;for(v=y;v<=b;v+=1)S[E+=1]=h*t+v}else for(v=m;v<=b;v+=1)S[E+=1]=h*t+v}return S},h=function(e){var n=e.count,r=e.vertices,f=new Array(n),l=new Array(n),c=Number.MAX_VALUE,h=Number.MIN_VALUE,p=Number.MAX_VALUE,d=Number.MIN_VALUE,v,m,g,y,b,w,E,S=[];for(v=0;v<n;v+=1)f[v]=r[v*2]*u,l[v]=r[v*2+1]*a,f[v]<c&&(c=f[v]),f[v]>h&&(h=f[v]),l[v]<p&&(p=l[v]),l[v]>d&&(d=l[v]);m=Math.min(Math.max(Math.round(c),0),i),b=Math.min(Math.max(Math.round(p),0),s),g=Math.min(Math.max(Math.round(h),0),i),w=Math.min(Math.max(Math.round(d),0),s),S=[],E=0;for(v=m;v<=g;v+=1)for(y=b;y<=w;y+=1)o(n,f,l,v,y)&&(S[E+=1]=v*t+y);return S};if(this.rectangle)return f(this.rectangle);if(this.ellipse)return l(this.ellipse);if(this.ring)return c(this.ring);if(this.polygon)return h(this.polygon);throw new Error("Part: unknown shape.")}}),e.define("/default-config.js",function(e,t,n,r,i){var s=e("./constants.js");n.DEFAULT_VALUES={model:{model_width:10,model_height:10,timestep:.1,convective:!0,background_conductivity:10*s.AIR_THERMAL_CONDUCTIVITY,background_specific_heat:s.AIR_SPECIFIC_HEAT,background_density:s.AIR_DENSITY,background_temperature:0,background_viscosity:10*s.AIR_VISCOSITY,thermal_buoyancy:25e-5,buoyancy_approximation:1,boundary:{temperature_at_border:{upper:0,lower:0,left:0,right:0}},measurement_interval:100,viewupdate_interval:20,stoptime:undefined,sunny:!0,sun_angle:1.5707964,solar_power_density:2e4,solar_ray_count:24,solar_ray_speed:.001,photon_emission_interval:5,structure:undefined},part:{thermal_conductivity:1,specific_heat:1300,density:25,transmission:0,reflection:0,absorption:1,emissivity:0,temperature:0,constant_temperature:!1,power:0,wind_speed:0,wind_angle:0,visible:!0,filled:!0,color:"gray",label:undefined,texture:undefined,uid:undefined,draggable:!0}},n.fillWithDefaultValues=function(e,t){"use strict";var n,r,i=function(e){return e===undefined?undefined:JSON.parse(JSON.stringify(e))};if(e===undefined)return i(t);r=i(e);for(n in t)t.hasOwnProperty(n)&&e[n]===undefined&&(r[n]=i(t[n]));return r}}),e.define("/constants.js",function(e,t,n,r,i){n.AIR_THERMAL_CONDUCTIVITY=.025,n.AIR_SPECIFIC_HEAT=1012,n.AIR_DENSITY=1.204,n.AIR_VISCOSITY=1568e-8}),e.define("/core-model.js",function(e,t,n,r,i){var s=e("./arrays/arrays.js").arrays,o=e("./physics-solvers/heat-solver.js"),u=e("./physics-solvers/fluid-solver.js"),a=e("./part.js"),f=e("./default-config.js"),l=function(){"use strict";try{new Float64Array}catch(e){return"regular"}return"Float64Array"}(),c=100,h=100,p=c*h;n.makeCoreModel=function(e){"use strict";var t=function(){var t;e=f.fillWithDefaultValues(e,f.DEFAULT_VALUES.model),t=e.boundary.temperature_at_border||e.boundary.flux_at_border;if(!t)throw new Error("Core model: missing boundary settings.");if(t.upper===undefined||t.right===undefined||t.lower===undefined||t.left===undefined)throw new Error("Core model: incomplete boundary settings.");return e}(),n=c,r=h,i=0,d,v,m=s.create(p,t.background_temperature,l),g=s.create(p,NaN,l),y=s.create(p,0,l),b=s.create(p,0,l),w=s.create(p,0,l),E=s.create(p,0,l),S=s.create(p,0,l),x=s.create(p,t.background_conductivity,l),T=s.create(p,t.background_specific_heat,l),N=s.create(p,t.background_density,l),C=s.create(p,!0,l),k=function(){var e=[],n,r,i;if(t.structure&&t.structure.part){n=t.structure.part,n.constructor!==Array&&(n=[n]),e=new Array(n.length);for(r=0,i=n.length;r<i;r+=1)e[r]=new a.Part(n[r])}return e}(),L=function(){var e=t.model_width,i=t.model_height,s,o,u,a,f,l;if(!k||k.length===0)return;for(a=k.length-1;a>=0;a-=1){s=k[a],o=s.getGridCells(n,r,e,i);for(f=0,l=o.length;f<l;f+=1)u=o[f],C[u]=!1,m[u]=s.temperature,w[u]=s.power,x[u]=s.thermal_conductivity,T[u]=s.specific_heat,N[u]=s.density,s.wind_speed!==0&&(E[u]=s.wind_speed*Math.cos(s.wind_angle),S[u]=s.wind_speed*Math.sin(s.wind_angle)),s.constant_temperature&&(g[u]=s.temperature)}},A={nextStep:function(){t.convective&&v.solve(y,b),d.solve(t.convective,m,w),i+=1},getIndexOfStep:function(){return i},getModelOptions:function(){return t},getArrayType:function(){return l},getGridWidth:function(){return n},getGridHeight:function(){return r},getTemperatureArray:function(){return m},getUVelocityArray:function(){return y},getVVelocityArray:function(){return b},getUWindArray:function(){return E},getVWindArray:function(){return S},getBoundaryTemperatureArray:function(){return g},getPowerArray:function(){return w},getConductivityArray:function(){return x},getCapacityArray:function(){return T},getDensityArray:function(){return N},getFluidityArray:function(){return C},getPartsArray:function(){return k}};return d=o.makeHeatSolver(A),v=u.makeFluidSolver(A),L(),A}}),e("/core-model.js");var t=e("./core-model.js");energy2d.namespace("energy2d.modeler"),energy2d.modeler.makeModeler=function(e){"use strict";var n=t.makeCoreModel(e);return{nextStep:function(){n.nextStep()},getWidth:function(){return n.getModelOptions().model_width},getHeight:function(){return n.getModelOptions().model_height},getIndexOfStep:n.getIndexOfStep,getGridWidth:n.getGridWidth,getGridHeight:n.getGridHeight,getTemperatureArray:n.getTemperatureArray,getUVelocityArray:n.getUVelocityArray,getVVelocityArray:n.getVVelocityArray,getPartsArray:n.getPartsArray}},energy2d.namespace("energy2d.views.utils"),energy2d.views.utils.HSVToRGB=function(e,t,n){"use strict";var r,i,s,o,u,a,f,l;e=Math.max(0,Math.min(360,e)),t=Math.max(0,Math.min(100,t)),n=Math.max(0,Math.min(100,n)),t/=100,n/=100;if(t===0)return r=i=s=n,[Math.round(r*255),Math.round(i*255),Math.round(s*255)];e/=60,o=Math.floor(e),u=e-o,a=n*(1-t),f=n*(1-t*u),l=n*(1-t*(1-u));switch(o){case 0:r=n,i=l,s=a;break;case 1:r=f,i=n,s=a;break;case 2:r=a,i=n,s=l;break;case 3:r=a,i=f,s=n;break;case 4:r=l,i=a,s=n;break;default:r=n,i=a,s=f}return[Math.round(r*255),Math.round(i*255),Math.round(s*255)]},energy2d.views.utils.setupRGBTemperatureColorTables=function(e,t,n){"use strict";var r=energy2d.views.utils.HSVToRGB,i=[],s;for(s=0;s<256;s+=1)i=energy2d.views.utils.HSVToRGB(s,100,90),e[s]=i[0],n[s]=i[1],t[s]=i[2]},energy2d.namespace("energy2d.views"),energy2d.views.makeHeatmapView=function(e){"use strict";var t=energy2d.views.utils,n="energy2d-heatmap-view",r,i,s,o,u,a=[],f=[],l=[],c,h,p,d,v=0,m=50,g=function(){r=$("<canvas />"),r.attr("id",e||n),i=r[0].getContext("2d")},y={renderHeatmap:function(){var e,t,n,r,s,o,u,g,y;if(!h)throw new Error("Heatmap: bind heatmap before rendering.");i.clearRect(0,0,p,d),i.fillStyle="rgb(0,0,0)",e=c/(m-v),n=i.getImageData(0,0,p,d),r=n.data,g=0,y=4*p;for(s=0;s<p;s+=1){u=s*d,g=4*s;for(o=0;o<d;o+=1)t=c-Math.round(e*(h[u+o]-v)),t<0?t=0:t>c&&(t=c),r[g]=a[t],r[g+1]=f[t],r[g+2]=l[t],r[g+3]=255,g+=y}i.putImageData(n,0,0)},bindHeatmap:function(e,t,n){if(t*n!==e.length)throw new Error("Heatmap: provided heatmap has wrong dimensions.");h=e,p=t,d=n,r.attr("width",p),r.attr("height",d)},getHTMLElement:function(){return r},updateCanvasSize:function(){s=r.width(),o=r.height(),u?(r.attr("width",s),r.attr("height",o)):(r.attr("width",p),r.attr("height",d))},setHQRenderingEnabled:function(e){u=e,this.updateCanvasSize()},setMinTemperature:function(e){v=e},setMaxTemperature:function(e){m=e}};return t.setupRGBTemperatureColorTables(a,l,f),c=a.length-1,g(),y},energy2d.namespace("energy2d.views"),energy2d.views.makeVectormapView=function(e){"use strict";var t="energy2d-vectormap-view",n=100,r=8,i=Math.cos(.523598776),s=Math.sin(.523598776),o=4,u,a,f,l,c,h,p,d,v,m=function(){u=$("<canvas />"),u.attr("id",e||t),a=u[0].getContext("2d")},g=function(e,t,u,f){var l=1/Math.sqrt(u*u+f*f),c=u*l,h=f*l,p=e+c*r+u*n,d=t+h*r+f*n,v=o*(c*i+h*s),m=o*(h*i-c*s);a.beginPath(),a.moveTo(e,t),a.lineTo(p,d),a.lineTo(p-v,d-m),a.moveTo(p,d),v=o*(c*i-h*s),m=o*(h*i+c*s),a.lineTo(p-v,d-m),a.stroke()},y={renderVectormap:function(){var e,t,n,r,i,s,o,m,y,b;if(!c||!h)throw new Error("Vectormap: bind vectormap before rendering.");(f!==u.width()||l!==u.height())&&this.updateCanvasSize(),e=f/p,t=l/d,a.clearRect(0,0,f,l),a.strokeStyle="rgb(175,175,175)",a.lineWidth=1;for(o=1;o<p-1;o+=v){y=o*d,n=(o+.5)*e;for(m=1;m<d-1;m+=v)b=y+m,r=(m+.5)*t,i=c[b],s=h[b],i*i+s*s>1e-15&&g(n,r,i,s)}},bindVectormap:function(e,t,n,r,i){if(n*r!==e.length)throw new Error("Heatmap: provided U component of vectormap has wrong dimensions.");if(n*r!==t.length)throw new Error("Heatmap: provided V component of vectormap has wrong dimensions.");c=e,h=t,p=n,d=r,v=i},getHTMLElement:function(){return u},updateCanvasSize:function(){f=u.width(),l=u.height(),u.attr("width",f),u.attr("height",l)}};return m(),y},energy2d.namespace("energy2d.views"),energy2d.views.makeSimulationDescription=function(e){"use strict";var t="energy2d-description",n="energy2d-description",r,i,s=function(){var r,s,o,u;i=$("<div />"),i.attr("id",e.id||t),i.addClass(e.class||n),r=$("<div>"+e.title+"</div>"),r.attr("class",t+"-title"),i.append(r),s=$("<div>"+e.tagline+"</div>"),s.attr("class",t+"-tagline"),i.append(s),o=$("<div>"+e.content+"</div>"),o.attr("class",t+"-content"),i.append(o),u=$("<div>"+e.footnote+"</div>"),u.attr("class",t+"-footnote"),i.append(u)},o={bindSimulationController:function(e){r=e},getHTMLElement:function(){return i}};return s(),o},energy2d.namespace("energy2d.views"),energy2d.views.makeEnergy2DScene=function(e){"use strict";var t="energy2d-scene-view",n="energy2d-scene-view",r,i,s,o,u=0,a=function(){o=$("<div />"),o.attr("id",e||t),o.addClass(n),o.css("position","relative"),o.append(r.getHTMLElement()),o.append(i.getHTMLElement()),o.append(s.getHTMLElement())},f=function(e){var t=e.getHTMLElement();t.css("width","100%"),t.css("height","100%"),t.css("position","absolute"),t.css("left","0"),t.css("top","0"),t.css("z-index",u),u+=1},l={getHeatmapView:function(){return r},getVelocityView:function(){return i},getPartsView:function(){return s},getHTMLElement:function(){return o}};return r=energy2d.views.makeHeatmapView(),f(r),i=energy2d.views.makeVectormapView(),f(i),s=energy2d.views.makePartsView(),f(s),a(),l},energy2d.views.makePartsView=function(e){"use strict";var t="energy2d-parts-view",n="energy2d-parts-view",r,i,s,o,u,a,f,l,c,h=[],p=function(){r=$("<canvas />"),r.attr("id",e||t),r.addClass(n),i=r[0].getContext("2d"),i.strokeStyle="black",i.lineCap="round",i.lineJoin="round",i.lineWidth=2,i.font="12px sans-serif",i.textBaseline="middle"},d=function(){var e=8,t=8,n,r;n=$("<canvas />"),n.attr("width",e),n.attr("height",t),r=n[0].getContext("2d"),r.clearRect(0,0,e,t),r.strokeStyle="black",r.beginPath(),r.moveTo(0,0),r.lineTo(t,t),r.stroke(),h.push(n[0])},v=function(e){var t=e.x*a,n=e.y*f,r=e.a*a*.5,s=e.b*f*.5,o,u,l;i.beginPath();for(l=0;l<2*Math.PI;l+=.1)o=t+r*Math.cos(l),u=n+s*Math.sin(l),l===0?i.moveTo(o,u):i.lineTo(o,u);i.closePath()},m=function(e){var t=e.x*a-1,n=e.y*f-1,r=e.width*a+2,s=e.height*f+2,o=t+.5*r,u=n+.5*s;i.beginPath(),i.moveTo(t,n),i.lineTo(t+r,n),i.lineTo(t+r,n+s),i.lineTo(t,n+s),i.lineTo(t,n),i.closePath()},g=function(e){var t=e.vertices,n=0,r=0,s,o;i.beginPath(),i.moveTo(t[0]*a,t[1]*f);for(s=1,o=e.count;s<o;s+=1)i.lineTo(t[s*2]*a,t[s*2+1]*f);i.closePath()},y=function(e){var t,n,r,s,o,u,l;if(e.rectangle)n=e.rectangle.x+.5*e.rectangle.width,r=e.rectangle.y+.5*e.rectangle.height;else if(e.ellipse)n=e.ellipse.x,r=e.ellipse.y;else if(e.ring)n=e.ring.x,r=e.ring.y;else if(e.polygon){o=e.polygon.vertices,n=r=0;for(u=0,l=e.polygon.count;u<l;u+=1)n+=o[u*2],r+=o[u*2+1];n/=l,r/=l}n*=a,r*=f,i.fillStyle="white",t=e.getLabel(),s=i.measureText(t).width,i.fillText(t,n-.5*s,r)},b=function(e){var t="gray",n;if(e.color)if(typeof e.color=="string")n=e.color;else{n=e.color.toString(16);while(n.length<6)n="0"+n}else e.power>0?n="FFFF00":e.power<0?n="B0C4DE":e.constant_temperature?n="rgba(0, 0, 0, 0.0)":n=t;return n},w={renderParts:function(){var e,t,n,a;if(!u)throw new Error("Parts view: bind parts array before rendering.");(s!==r.width()||o!==r.height())&&this.updateCanvasSize(),i.clearRect(0,0,s,o);for(n=0,a=u.length;n<a;n+=1){e=u[n];if(!e.visible)continue;e.rectangle?m(e.rectangle):e.polygon?g(e.polygon):e.ellipse?v(e.ellipse):e.ring&&v({x:e.ring.x,y:e.ring.y,a:e.ring.outer,b:e.ring.outer}),e.filled&&(i.fillStyle=b(e),i.fill()),e.texture&&(i.fillStyle=i.createPattern(h[0],"repeat"),i.fill()),i.stroke(),e.ring&&(v({x:e.ring.x,y:e.ring.y,a:e.ring.inner,b:e.ring.inner}),t=i.globalCompositeOperation,i.globalCompositeOperation="destination-out",i.fill(),i.globalCompositeOperation=t,i.stroke()),e.label&&y(e)}},bindPartsArray:function(e,t,n){u=e,l=t,c=n,a=s/l,f=o/c},getHTMLElement:function(){return r},updateCanvasSize:function(){s=r.width(),o=r.height(),a=s/l,f=o/c,r.attr("width",s),r.attr("height",o)}};return p(),d(),w},energy2d.views.makeSimulationPlayerView=function(e){"use strict";var t="energy2d-simulation-player",n="energy2d-simulation-player",r,i,s=function(){var s;i=$("<div />"),i.attr("id",e||t),i.addClass(n),s=$('<button type="button" id="sim-stop">Stop</button>'),s.click(function(){r.simulationStop()}),i.append(s),s=$('<button type="button" id="sim-step">Step</button>'),s.click(function(){r.simulationStep()}),i.append(s),s=$('<button type="button" id="sim-play">Play</button>'),s.click(function(){r.simulationPlay()}),i.append(s),s=$('<button type="button" id="sim-reset">Reset</button>'),s.click(function(){r.simulationReset()}),i.append(s)},o={bindSimulationController:function(e){r=e},getHTMLElement:function(){return i}};return s(),o},energy2d.namespace("energy2d.controllers"),energy2d.controllers.makeInteractiveController=function(e,t,n){"use strict";var r=energy2d.modeler,i=energy2d.views,s,o,u,a,f,l,c,h,p,d,v=4,m=function(e){return typeof ACTUAL_ROOT=="undefined"||e.charAt(0)!=="/"?e:ACTUAL_ROOT+e},g=function(e){return u=i.makeEnergy2DScene(e.id),a=u.getHeatmapView(),f=u.getVelocityView(),l=u.getPartsView(),u},y=function(e){return c=i.makeSimulationPlayerView(e.id),c.bindSimulationController(s),c},b=function(e){return h=i.makeSimulationDescription(e),h.bindSimulationController(s),h},w=function(e){if(!e.type)throw new Error('Interactive controller: missing component "type" property.');switch(e.type){case"energy2d-scene-view":return g(e);case"energy2d-simulation-player":return y(e);default:throw new Error("Interactive controller: unknow type of component.")}},E=function(){var e=v;while(e>0)e-=1,o.nextStep();a.renderHeatmap(),f.renderVectormap()};return s={loadInteractive:function(e,t,n){var r=e.components||[],i=e.description||{},o=e.layout||{},u,a,f,l,c;for(l=0,c=r.length;l<c;l+=1)u=w(r[l]),f=u.getHTMLElement(),a=o[r[l].id]||{},a.css&&f.css(a.css),a.class&&f.addClass(a.class),a.container?f.appendTo(a.container):f.appendTo(t);i&&(u=b(i),f=u.getHTMLElement(),f.appendTo(n)),s.loadSceneModelFromURL(e.model)},loadSceneModelFromURL:function(e){$.get(m(e)).success(function(e){s.loadSceneModel(e)}).error(function(e,t,n){throw new Error("Interactive controller: loading scene options failed - "+t)})},loadSceneModel:function(e){var t,n;o=r.makeModeler(e.model),p=e,t=o.getGridWidth(),n=o.getGridHeight(),a.bindHeatmap(o.getTemperatureArray(),t,n),f.bindVectormap(o.getUVelocityArray(),o.getVVelocityArray(),t,n,4),l.bindPartsArray(o.getPartsArray(),o.getWidth(),o.getHeight()),a.renderHeatmap(),l.renderParts()},simulationPlay:function(){d||(d=setInterval(E,0))},simulationStep:function(){E()},simulationStop:function(){d!==undefined&&(clearInterval(d),d=undefined)},simulationReset:function(){s.simulationStop(),s.loadSceneModel(p)}},s.loadInteractive(e,t,n),s}})();